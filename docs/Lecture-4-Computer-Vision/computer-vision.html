<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Patrick Laub">

<title>AI for Actuaries - Computer Vision</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../Lecture-4-Computer-Vision/computer-vision.html">Module 4</a></li><li class="breadcrumb-item"><a href="../Lecture-4-Computer-Vision/computer-vision.html">Computer Vision</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">AI for Actuaries</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Module 1</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-1-Artificial-Intelligence/course-overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-1-Artificial-Intelligence/python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Module 2</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-2-Deep-Learning-Keras/deep-learning-keras.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Deep Learning with Keras</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-2-Deep-Learning-Keras/project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Project Details</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Module 3</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-3-Tabular-Data/categorical-variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Categorical Variables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-3-Tabular-Data/classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Classification</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Module 4</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-4-Computer-Vision/computer-vision.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Computer Vision</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Module 5</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-5-Natural-Language-Processing/natural-language-processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Natural Language Processing</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Module 6</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-6-Uncertainty-Quantification/uncertainty-quantification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Uncertainty Quantification</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Module 7</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-7-Recurrent-Neural-Networks-And-Time-Series/rnns-and-time-series.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Recurrent Neural Networks</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">
 <span class="menu-text">Module 8</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-8-Generative-Networks/generative-networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generative Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-8-Generative-Networks/gans.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generative Adversarial Networks</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true">
 <span class="menu-text">Module 9</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-9-Advanced-Topics/interpretability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interpretability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-9-Advanced-Topics/exam-revision.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Examinable Topics for Revision</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#load-packages" id="toc-load-packages" class="nav-link active" data-scroll-target="#load-packages">Load packages</a></li>
  <li><a href="#images" id="toc-images" class="nav-link" data-scroll-target="#images">Images</a>
  <ul class="collapse">
  <li><a href="#shapes-of-data" id="toc-shapes-of-data" class="nav-link" data-scroll-target="#shapes-of-data">Shapes of data</a></li>
  <li><a href="#shapes-of-photos" id="toc-shapes-of-photos" class="nav-link" data-scroll-target="#shapes-of-photos">Shapes of photos</a></li>
  <li><a href="#how-the-computer-sees-them" id="toc-how-the-computer-sees-them" class="nav-link" data-scroll-target="#how-the-computer-sees-them">How the computer sees them</a></li>
  <li><a href="#how-we-see-them" id="toc-how-we-see-them" class="nav-link" data-scroll-target="#how-we-see-them">How we see them</a></li>
  <li><a href="#why-is-255-special" id="toc-why-is-255-special" class="nav-link" data-scroll-target="#why-is-255-special">Why is 255 special?</a></li>
  <li><a href="#image-editing-with-kernels" id="toc-image-editing-with-kernels" class="nav-link" data-scroll-target="#image-editing-with-kernels">Image editing with kernels</a></li>
  </ul></li>
  <li><a href="#convolutional-layers" id="toc-convolutional-layers" class="nav-link" data-scroll-target="#convolutional-layers">Convolutional Layers</a>
  <ul class="collapse">
  <li><a href="#convolution-not-complicated" id="toc-convolution-not-complicated" class="nav-link" data-scroll-target="#convolution-not-complicated">‘Convolution’ not ‘complicated’</a></li>
  <li><a href="#images-are-rank-3-tensors" id="toc-images-are-rank-3-tensors" class="nav-link" data-scroll-target="#images-are-rank-3-tensors">Images are rank 3 tensors</a></li>
  <li><a href="#example-detecting-yellow" id="toc-example-detecting-yellow" class="nav-link" data-scroll-target="#example-detecting-yellow">Example: Detecting yellow</a></li>
  <li><a href="#example-detecting-yellow-ii" id="toc-example-detecting-yellow-ii" class="nav-link" data-scroll-target="#example-detecting-yellow-ii">Example: Detecting yellow II</a></li>
  <li><a href="#example-detecting-yellow-iii" id="toc-example-detecting-yellow-iii" class="nav-link" data-scroll-target="#example-detecting-yellow-iii">Example: Detecting yellow III</a></li>
  <li><a href="#terminology" id="toc-terminology" class="nav-link" data-scroll-target="#terminology">Terminology</a></li>
  <li><a href="#spatial-filter" id="toc-spatial-filter" class="nav-link" data-scroll-target="#spatial-filter">Spatial filter</a></li>
  <li><a href="#multidimensional-convolution" id="toc-multidimensional-convolution" class="nav-link" data-scroll-target="#multidimensional-convolution">Multidimensional convolution</a></li>
  <li><a href="#example-3x3-filter-over-rgb-input" id="toc-example-3x3-filter-over-rgb-input" class="nav-link" data-scroll-target="#example-3x3-filter-over-rgb-input">Example: 3x3 filter over RGB input</a></li>
  <li><a href="#input-output-relationship" id="toc-input-output-relationship" class="nav-link" data-scroll-target="#input-output-relationship">Input-output relationship</a></li>
  </ul></li>
  <li><a href="#convolutional-layer-options" id="toc-convolutional-layer-options" class="nav-link" data-scroll-target="#convolutional-layer-options">Convolutional Layer Options</a>
  <ul class="collapse">
  <li><a href="#padding" id="toc-padding" class="nav-link" data-scroll-target="#padding">Padding</a></li>
  <li><a href="#padding-1" id="toc-padding-1" class="nav-link" data-scroll-target="#padding-1">Padding</a></li>
  <li><a href="#convolution-layer" id="toc-convolution-layer" class="nav-link" data-scroll-target="#convolution-layer">Convolution layer</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example">Example</a></li>
  <li><a href="#x1-convolution" id="toc-x1-convolution" class="nav-link" data-scroll-target="#x1-convolution">1x1 convolution</a></li>
  <li><a href="#example-of-1x1-convolution" id="toc-example-of-1x1-convolution" class="nav-link" data-scroll-target="#example-of-1x1-convolution">Example of 1x1 convolution</a></li>
  <li><a href="#striding" id="toc-striding" class="nav-link" data-scroll-target="#striding">Striding</a></li>
  <li><a href="#choosing-strides" id="toc-choosing-strides" class="nav-link" data-scroll-target="#choosing-strides">Choosing strides</a></li>
  <li><a href="#specifying-a-convolutional-layer" id="toc-specifying-a-convolutional-layer" class="nav-link" data-scroll-target="#specifying-a-convolutional-layer">Specifying a convolutional layer</a></li>
  </ul></li>
  <li><a href="#convolutional-neural-networks" id="toc-convolutional-neural-networks" class="nav-link" data-scroll-target="#convolutional-neural-networks">Convolutional Neural Networks</a>
  <ul class="collapse">
  <li><a href="#definition-of-cnn" id="toc-definition-of-cnn" class="nav-link" data-scroll-target="#definition-of-cnn">Definition of CNN</a></li>
  <li><a href="#architecture" id="toc-architecture" class="nav-link" data-scroll-target="#architecture">Architecture</a></li>
  <li><a href="#architecture-2" id="toc-architecture-2" class="nav-link" data-scroll-target="#architecture-2">Architecture #2</a></li>
  <li><a href="#pooling" id="toc-pooling" class="nav-link" data-scroll-target="#pooling">Pooling</a></li>
  <li><a href="#pooling-for-multiple-channels" id="toc-pooling-for-multiple-channels" class="nav-link" data-scroll-target="#pooling-for-multiple-channels">Pooling for multiple channels</a></li>
  <li><a href="#whywhy-not-use-pooling" id="toc-whywhy-not-use-pooling" class="nav-link" data-scroll-target="#whywhy-not-use-pooling">Why/why not use pooling?</a></li>
  <li><a href="#what-do-the-cnn-layers-learn" id="toc-what-do-the-cnn-layers-learn" class="nav-link" data-scroll-target="#what-do-the-cnn-layers-learn">What do the CNN layers learn?</a></li>
  </ul></li>
  <li><a href="#demo-character-recognition" id="toc-demo-character-recognition" class="nav-link" data-scroll-target="#demo-character-recognition">Demo: Character Recognition</a>
  <ul class="collapse">
  <li><a href="#mnist-dataset" id="toc-mnist-dataset" class="nav-link" data-scroll-target="#mnist-dataset">MNIST Dataset</a></li>
  <li><a href="#mandarin-characters-dataset" id="toc-mandarin-characters-dataset" class="nav-link" data-scroll-target="#mandarin-characters-dataset">Mandarin Characters Dataset</a></li>
  <li><a href="#downloading-the-dataset" id="toc-downloading-the-dataset" class="nav-link" data-scroll-target="#downloading-the-dataset">Downloading the dataset</a></li>
  <li><a href="#directory-structure" id="toc-directory-structure" class="nav-link" data-scroll-target="#directory-structure">Directory structure</a></li>
  <li><a href="#splitting-into-trainvaltest-sets" id="toc-splitting-into-trainvaltest-sets" class="nav-link" data-scroll-target="#splitting-into-trainvaltest-sets">Splitting into train/val/test sets</a></li>
  <li><a href="#directory-structure-ii" id="toc-directory-structure-ii" class="nav-link" data-scroll-target="#directory-structure-ii">Directory structure II</a></li>
  <li><a href="#keras-image-dataset-loading" id="toc-keras-image-dataset-loading" class="nav-link" data-scroll-target="#keras-image-dataset-loading">Keras image dataset loading</a></li>
  <li><a href="#inspecting-the-datasets" id="toc-inspecting-the-datasets" class="nav-link" data-scroll-target="#inspecting-the-datasets">Inspecting the datasets</a></li>
  <li><a href="#plotting-some-characters-setup" id="toc-plotting-some-characters-setup" class="nav-link" data-scroll-target="#plotting-some-characters-setup">Plotting some characters (setup)</a></li>
  <li><a href="#plotting-some-training-characters" id="toc-plotting-some-training-characters" class="nav-link" data-scroll-target="#plotting-some-training-characters">Plotting some training characters</a></li>
  <li><a href="#plotting-some-valtest-characters" id="toc-plotting-some-valtest-characters" class="nav-link" data-scroll-target="#plotting-some-valtest-characters">Plotting some val/test characters</a></li>
  </ul></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a>
  <ul class="collapse">
  <li><a href="#inspect-the-model" id="toc-inspect-the-model" class="nav-link" data-scroll-target="#inspect-the-model">Inspect the model</a></li>
  <li><a href="#plot-the-cnn" id="toc-plot-the-cnn" class="nav-link" data-scroll-target="#plot-the-cnn">Plot the CNN</a></li>
  <li><a href="#fit-the-cnn" id="toc-fit-the-cnn" class="nav-link" data-scroll-target="#fit-the-cnn">Fit the CNN</a></li>
  <li><a href="#plot-the-lossaccuracy-curves-setup" id="toc-plot-the-lossaccuracy-curves-setup" class="nav-link" data-scroll-target="#plot-the-lossaccuracy-curves-setup">Plot the loss/accuracy curves (setup)</a></li>
  <li><a href="#plot-the-lossaccuracy-curves" id="toc-plot-the-lossaccuracy-curves" class="nav-link" data-scroll-target="#plot-the-lossaccuracy-curves">Plot the loss/accuracy curves</a></li>
  <li><a href="#look-at-the-metrics" id="toc-look-at-the-metrics" class="nav-link" data-scroll-target="#look-at-the-metrics">Look at the metrics</a></li>
  <li><a href="#predict-on-the-test-set" id="toc-predict-on-the-test-set" class="nav-link" data-scroll-target="#predict-on-the-test-set">Predict on the test set</a></li>
  <li><a href="#predict-on-the-test-set-ii" id="toc-predict-on-the-test-set-ii" class="nav-link" data-scroll-target="#predict-on-the-test-set-ii">Predict on the test set II</a></li>
  </ul></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1"></a>
  <ul class="collapse">
  <li><a href="#error-analysis-i" id="toc-error-analysis-i" class="nav-link" data-scroll-target="#error-analysis-i">Error analysis I</a></li>
  <li><a href="#error-analysis-ii" id="toc-error-analysis-ii" class="nav-link" data-scroll-target="#error-analysis-ii">Error analysis II</a></li>
  <li><a href="#error-analysis-iii" id="toc-error-analysis-iii" class="nav-link" data-scroll-target="#error-analysis-iii">Error analysis III</a></li>
  <li><a href="#error-analysis-iv" id="toc-error-analysis-iv" class="nav-link" data-scroll-target="#error-analysis-iv">Error analysis IV</a></li>
  <li><a href="#confidence-of-predictions" id="toc-confidence-of-predictions" class="nav-link" data-scroll-target="#confidence-of-predictions">Confidence of predictions</a></li>
  </ul></li>
  <li><a href="#hyperparameter-tuning" id="toc-hyperparameter-tuning" class="nav-link" data-scroll-target="#hyperparameter-tuning">Hyperparameter tuning</a>
  <ul class="collapse">
  <li><a href="#trial-error" id="toc-trial-error" class="nav-link" data-scroll-target="#trial-error">Trial &amp; error</a></li>
  <li><a href="#keras-tuner" id="toc-keras-tuner" class="nav-link" data-scroll-target="#keras-tuner">Keras Tuner</a></li>
  <li><a href="#do-a-random-search" id="toc-do-a-random-search" class="nav-link" data-scroll-target="#do-a-random-search">Do a random search</a></li>
  <li><a href="#tune-layers-separately" id="toc-tune-layers-separately" class="nav-link" data-scroll-target="#tune-layers-separately">Tune layers separately</a></li>
  <li><a href="#do-a-bayesian-search" id="toc-do-a-bayesian-search" class="nav-link" data-scroll-target="#do-a-bayesian-search">Do a Bayesian search</a></li>
  </ul></li>
  <li><a href="#leveraging-solutions-from-benchmark-problems" id="toc-leveraging-solutions-from-benchmark-problems" class="nav-link" data-scroll-target="#leveraging-solutions-from-benchmark-problems">Leveraging Solutions From Benchmark Problems</a>
  <ul class="collapse">
  <li><a href="#demo-object-classification" id="toc-demo-object-classification" class="nav-link" data-scroll-target="#demo-object-classification">Demo: Object classification</a></li>
  <li><a href="#how-does-that-work" id="toc-how-does-that-work" class="nav-link" data-scroll-target="#how-does-that-work">How does that work?</a></li>
  <li><a href="#benchmarks" id="toc-benchmarks" class="nav-link" data-scroll-target="#benchmarks">Benchmarks</a></li>
  <li><a href="#lenet-6-1998" id="toc-lenet-6-1998" class="nav-link" data-scroll-target="#lenet-6-1998">LeNet-6 (1998)</a></li>
  <li><a href="#alexnet-2011" id="toc-alexnet-2011" class="nav-link" data-scroll-target="#alexnet-2011">AlexNet (2011)</a></li>
  <li><a href="#data-augmentation" id="toc-data-augmentation" class="nav-link" data-scroll-target="#data-augmentation">Data Augmentation</a></li>
  <li><a href="#inception-module-2013" id="toc-inception-module-2013" class="nav-link" data-scroll-target="#inception-module-2013">Inception module (2013)</a></li>
  <li><a href="#googlenet-inception_v0-2014" id="toc-googlenet-inception_v0-2014" class="nav-link" data-scroll-target="#googlenet-inception_v0-2014">GoogLeNet / Inception_v0 (2014)</a></li>
  <li><a href="#depth-is-important-for-image-tasks" id="toc-depth-is-important-for-image-tasks" class="nav-link" data-scroll-target="#depth-is-important-for-image-tasks">Depth is important for image tasks</a></li>
  <li><a href="#residual-connection" id="toc-residual-connection" class="nav-link" data-scroll-target="#residual-connection">Residual connection</a></li>
  <li><a href="#resnet-2014" id="toc-resnet-2014" class="nav-link" data-scroll-target="#resnet-2014">ResNet (2014)</a></li>
  </ul></li>
  <li><a href="#transfer-learning" id="toc-transfer-learning" class="nav-link" data-scroll-target="#transfer-learning">Transfer learning</a>
  <ul class="collapse">
  <li><a href="#pretrained-model" id="toc-pretrained-model" class="nav-link" data-scroll-target="#pretrained-model">Pretrained model</a></li>
  <li><a href="#predicted-classes-mobilenet-1" id="toc-predicted-classes-mobilenet-1" class="nav-link" data-scroll-target="#predicted-classes-mobilenet-1">Predicted classes (MobileNet)</a></li>
  <li><a href="#predicted-classes-mobilenetv2-1" id="toc-predicted-classes-mobilenetv2-1" class="nav-link" data-scroll-target="#predicted-classes-mobilenetv2-1">Predicted classes (MobileNetV2)</a></li>
  <li><a href="#predicted-classes-inceptionv3-1" id="toc-predicted-classes-inceptionv3-1" class="nav-link" data-scroll-target="#predicted-classes-inceptionv3-1">Predicted classes (InceptionV3)</a></li>
  <li><a href="#transfer-learned-model" id="toc-transfer-learned-model" class="nav-link" data-scroll-target="#transfer-learned-model">Transfer learned model</a></li>
  <li><a href="#transfer-learned-model-ii" id="toc-transfer-learned-model-ii" class="nav-link" data-scroll-target="#transfer-learned-model-ii">Transfer learned model II</a></li>
  <li><a href="#transfer-learned-model-iii" id="toc-transfer-learned-model-iii" class="nav-link" data-scroll-target="#transfer-learned-model-iii">Transfer learned model III</a></li>
  <li><a href="#transfer-learning-1" id="toc-transfer-learning-1" class="nav-link" data-scroll-target="#transfer-learning-1">Transfer learning</a></li>
  <li><a href="#fine-tuning" id="toc-fine-tuning" class="nav-link" data-scroll-target="#fine-tuning">Fine-tuning</a></li>
  </ul></li>
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2"></a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="computer-vision.slides.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../Lecture-4-Computer-Vision/computer-vision.html">Module 4</a></li><li class="breadcrumb-item"><a href="../Lecture-4-Computer-Vision/computer-vision.html">Computer Vision</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Computer Vision</h1>
<p class="subtitle lead">ACTL3143 &amp; ACTL5111 Deep Learning for Actuaries</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Patrick Laub </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p>Computer vision is a field of Artificial Intelligence(AI) that focuses on extracting meaningful information from visual data (images and videos). One of the primary goals of computer vision is to correctly identify and classify visual data. Convolution Neural Networks (CNNs) are the most commonly used neural network architectures for computer vision related tasks.</p>
<section id="load-packages" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="load-packages">Load packages</h2>
<div id="77b854bd" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.models <span class="im">import</span> Sequential</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Dense</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.callbacks <span class="im">import</span> EarlyStopping</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.utils <span class="im">import</span> plot_model</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow <span class="im">import</span> keras</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext watermark</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>watermark <span class="op">-</span>p numpy,pandas,tensorflow</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>numpy     : 1.23.1
pandas    : 1.5.3
tensorflow: 2.12.0
</code></pre>
</div>
</div>
</section>
<section id="images" class="level1" data-visibility="uncounted">
<h1 data-visibility="uncounted">Images</h1>
<section id="shapes-of-data" class="level2">
<h2 class="anchored" data-anchor-id="shapes-of-data">Shapes of data</h2>
<p>A special attention to shapes of data are important in CNN architectures, because CNNs have special types of layers (e.g.&nbsp;convolution and pooling) which require explicit specifications of array dimensions.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="medium-tensor-rank.png" class="img-fluid figure-img"></p>
<figcaption>Illustration of tensors of different rank.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Paras Patidar (2019), <a href="https://medium.com/mlait/tensors-representation-of-data-in-neural-networks-bbe8a711b93b">Tensors — Representation of Data In Neural Networks</a>, Medium article.</p>
</div>
</section>
<section id="shapes-of-photos" class="level2">
<h2 class="anchored" data-anchor-id="shapes-of-photos">Shapes of photos</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="rgb-channels.png" class="img-fluid figure-img"></p>
<figcaption>A photo is a rank 3 tensor.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Kim et al (2021), <a href="https://www.mdpi.com/applsci/applsci-11-03418/article_deploy/html/images/applsci-11-03418-g001.png">Data Hiding Method for Color AMBTC Compressed Images Using Color Difference</a>, Applied Sciences.</p>
</div>
<p>Since the position of a pixel(one small sqaure) in a photo can be represented using 3 positional values, we call it a rank 3 tensor.</p>
</section>
<section id="how-the-computer-sees-them" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="how-the-computer-sees-them">How the computer sees them</h2>
<div id="822a5051" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.image <span class="im">import</span> imread</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>img1 <span class="op">=</span> imread(<span class="st">'pu.gif'</span>)<span class="op">;</span> img2 <span class="op">=</span> imread(<span class="st">'pl.gif'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>img3 <span class="op">=</span> imread(<span class="st">'pr.gif'</span>)<span class="op">;</span> img4 <span class="op">=</span> imread(<span class="st">'pg.bmp'</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="ss">f"Shapes are: </span><span class="sc">{</span>img1<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>img2<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>img3<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>img4<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">."</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="1ce9517f" class="cell" data-execution_count="4">
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>'Shapes are: (16, 16, 3), (16, 16, 3), (16, 16, 3), (16, 16, 3).'</code></pre>
</div>
</div>
<div class="columns">
<div class="column" style="width:25%;">
<div id="8bbcbf6d" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>img1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>array([[[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0]],

       [[255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0]],

       [[255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0]],

       [[255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0]],

       [[255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0]],

       [[  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]]], dtype=uint8)</code></pre>
</div>
</div>
</div><div class="column" style="width:25%;">
<div id="660d871c" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>img2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>array([[[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]]], dtype=uint8)</code></pre>
</div>
</div>
</div><div class="column" style="width:25%;">
<div id="60a3a369" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>img3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>array([[[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]]], dtype=uint8)</code></pre>
</div>
</div>
</div><div class="column" style="width:25%;">
<div id="b1842a6f" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>img4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>array([[[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [255, 163, 177],
        [255, 163, 177],
        [255, 255, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [255, 255, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0]],

       [[255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 255, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [255, 255, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177]],

       [[255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [ 51,   0, 255],
        [ 51,   0, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [ 51,   0, 255],
        [ 51,   0, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177]],

       [[255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [ 51,   0, 255],
        [ 51,   0, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [ 51,   0, 255],
        [ 51,   0, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177]],

       [[255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177]],

       [[255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177]],

       [[255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177]],

       [[255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177]],

       [[255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177]],

       [[255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0]],

       [[255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[255, 163, 177],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 163, 177],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 163, 177],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]]], dtype=uint8)</code></pre>
</div>
</div>
</div>
</div>
<p>The above code reads 4 images and then shows how computers read those images. Each image is read by the computer as a rank 3 tensor. Each image is of (16,16,3) dimensions.</p>
</section>
<section id="how-we-see-them" class="level2">
<h2 class="anchored" data-anchor-id="how-we-see-them">How we see them</h2>
<div id="cf5b5d1a" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.pyplot <span class="im">import</span> imshow</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="columns">
<div class="column" style="width:25%;">
<div id="6dce758c" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>imshow(img1)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-11-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:25%;">
<div id="48d290ff" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>imshow(img2)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:25%;">
<div id="419e730a" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>imshow(img3)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:25%;">
<div id="0f350468" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>imshow(img4)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-14-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="why-is-255-special" class="level2">
<h2 class="anchored" data-anchor-id="why-is-255-special">Why is 255 special?</h2>
<p>Each pixel’s colour intensity is stored in one byte.</p>
<p>One byte is 8 bits, so in binary that is 00000000 to 11111111.</p>
<p>The largest <em>unsigned</em> number this can be is <span class="math inline">\(2^8-1 = 255\)</span>.</p>
<div id="c58e0805" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>np.uint8(<span class="dv">0</span>), np.uint8(<span class="dv">1</span>), np.uint8(<span class="dv">255</span>), np.uint8(<span class="dv">256</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>(0, 1, 255, 0)</code></pre>
</div>
</div>
<p>If you had <em>signed</em> numbers, this would go from -128 to 127.</p>
<div id="eb2674da" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>np.int8(<span class="op">-</span><span class="dv">128</span>), np.int8(<span class="dv">0</span>), np.int8(<span class="dv">127</span>), np.int8(<span class="dv">128</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>(-128, 0, 127, -128)</code></pre>
</div>
</div>
<p>Alternatively, <em>hexidecimal</em> numbers are used. E.g. 10100001 is split into 1010 0001, and 1010=A, 0001=1, so combined it is 0xA1.</p>
</section>
<section id="image-editing-with-kernels" class="level2">
<h2 class="anchored" data-anchor-id="image-editing-with-kernels">Image editing with kernels</h2>
<p>Take a look at <a href="https://setosa.io/ev/image-kernels/">https://setosa.io/ev/image-kernels/</a>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="convolution.gif" class="img-fluid figure-img"></p>
<figcaption>An example of an image kernel in action.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: <a href="http://deeplearning.stanford.edu/wiki/index.php/Feature_extraction_using_convolution">Stanford’s deep learning tutorial</a> via <a href="https://stats.stackexchange.com/a/188216">Stack Exchange</a>.</p>
</div>
</section>
</section>
<section id="convolutional-layers" class="level1" data-visibility="uncounted">
<h1 data-visibility="uncounted">Convolutional Layers</h1>
<section id="convolution-not-complicated" class="level2">
<h2 class="anchored" data-anchor-id="convolution-not-complicated">‘Convolution’ not ‘complicated’</h2>
<p>Say <span class="math inline">\(X_1, X_2 \sim f_X\)</span> are i.i.d., and we look at <span class="math inline">\(S = X_1 + X_2\)</span>.</p>
<p>The density for <span class="math inline">\(S\)</span> is then</p>
<p><span class="math display">\[
f_S(s) = \int_{x_1=-\infty}^{\infty} f_X(x_1) \, f_X(s-x_1) \,\mathrm{d}s .
\]</span></p>
<p>This is the <em>convolution</em> operation, <span class="math inline">\(f_S = f_X \star f_X\)</span>.</p>
</section>
<section id="images-are-rank-3-tensors" class="level2">
<h2 class="anchored" data-anchor-id="images-are-rank-3-tensors">Images are rank 3 tensors</h2>
<p>Height, width, and number of channels.</p>
<p>An image can be represented using a rank 3 tensor, since it has 3 dimensions; height, width, and number of channels. The number of channels is also known as the ‘depth’. The left hand side of the picture shown below is tensor with height =5, width =5 and depth =3.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Glassner/16-1.png" class="img-fluid figure-img"></p>
<figcaption>Examples of rank 3 tensors.</figcaption>
</figure>
</div>
<p>Grayscale image has 1 channel. RGB image has 3 channels.</p>
<p>Each colour can be represented as a combination of three primary colours; red, green and blue.</p>
<p>Example: Yellow = Red + Green.</p>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="example-detecting-yellow" class="level2">
<h2 class="anchored" data-anchor-id="example-detecting-yellow">Example: Detecting yellow</h2>
<p>Suppose we wish to detect if a picture has yellow colour in it. One option would be to apply a neuron over each pixel and see if it detects the colour yellow. We know that each pixel is represented by 3 numerical values that correspond to red, green and blue. Higher numeric values for red and green indicate higher chances of detecting yellow. Higher values for blue indicate lower chances of detecting yellow. Utilising this information, we can assign RGB weights to be 1, 1, -1 respectively.</p>
<p>Next, a standard multiplication between numeric values and weights is carried out, and the weighted sum is passed through the neuron.</p>
<div class="columns">
<div class="column">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Glassner/16-3.png" class="img-fluid figure-img"></p>
<figcaption>Applying a neuron to an image pixel.</figcaption>
</figure>
</div>
</div><div class="column">
<p><br></p>
<p>Apply a neuron to each pixel in the image.</p>
<p><br></p>
<p>If red/green <span class="math inline">\(\nearrow\)</span> or blue <span class="math inline">\(\searrow\)</span> then yellowness <span class="math inline">\(\nearrow\)</span>.</p>
<p><br></p>
<p>Set RGB weights to 1, 1, -1.</p>
</div>
</div>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="example-detecting-yellow-ii" class="level2">
<h2 class="anchored" data-anchor-id="example-detecting-yellow-ii">Example: Detecting yellow II</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Glassner/16-4.png" class="img-fluid figure-img"></p>
<figcaption>Scan the 3-channel input (colour image) with the neuron to produce a 1-channel output (grayscale image).</figcaption>
</figure>
</div>
<p>The output is produced by <em>sweeping</em> the neuron over the input. This is called <strong>convolution</strong>.</p>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="example-detecting-yellow-iii" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="example-detecting-yellow-iii">Example: Detecting yellow III</h2>
<p>The following picture demonstrates how yellow-coloured areas (in the colour picture) are transformed into a white colour (in the greyscale picture). This is a result of the way we assigned the weights. Since we assigned +1 weights to red and green, and -1 to blue, it ended up resulting in large positive values (for the weighted sum) for the pixels in the yellow-coloured areas. Large positive values in the greyscale correspond to white colour. Therefore, the areas which were yellow in the colour picture converted to white in the greyscale. In practice, we do not manually assign weights, instead, we let the neural network decide the optimal weights during training.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Glassner/16-5.png" class="img-fluid figure-img"></p>
<figcaption>The more yellow the pixel in the colour image (left), the more white it is in the grayscale image.</figcaption>
</figure>
</div>
<p>The neuron or its weights is called a <strong>filter</strong>. We <em>convolve</em> the image with a filter, i.e.&nbsp;a <strong>convolutional filter</strong>.</p>
</section>
<section id="terminology" class="level2">
<h2 class="anchored" data-anchor-id="terminology">Terminology</h2>
<ul>
<li>The same neuron is used to sweep over the image, so we can store the weights in some shared memory and process the pixels in parallel. We say that the neurons are <em>weight sharing</em>.</li>
<li>In the previous example, the neuron only takes one pixel as input. Usually a larger filter containing a <em>block of weights</em> is used to process not only a pixel but also its neighboring pixels all at once.</li>
<li>The weights are called the filter <strong>kernels</strong>.</li>
<li>The cluster of pixels that forms the input of a filter is called its <em>footprint</em>.</li>
</ul>
</section>
<section id="spatial-filter" class="level2">
<h2 class="anchored" data-anchor-id="spatial-filter">Spatial filter</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Glassner/16-9.png" class="img-fluid figure-img"></p>
<figcaption>Example 3x3 filter</figcaption>
</figure>
</div>
<p>When a filter’s footprint is &gt; 1 pixel, it is a <strong>spatial filter</strong>.</p>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
<p>The above spatial filter is a 3x3 filter. Hence, there are 9 weights to learn.</p>
</section>
<section id="multidimensional-convolution" class="level2">
<h2 class="anchored" data-anchor-id="multidimensional-convolution">Multidimensional convolution</h2>
<p>In a multidimensional filter, the number of channels of the input must be equal to the number of channels in the filter (depths must be the same).</p>
<p>Need <span class="math inline">\(\# \text{ Channels in Input} = \# \text{ Channels in Filter}\)</span>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Glassner/16-18.png" class="img-fluid figure-img"></p>
<figcaption>Example: a 3x3 filter with 3 channels, containing 27 weights.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="example-3x3-filter-over-rgb-input" class="level2">
<h2 class="anchored" data-anchor-id="example-3x3-filter-over-rgb-input">Example: 3x3 filter over RGB input</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Glassner/16-19.png" class="img-fluid figure-img"></p>
<figcaption>Each channel is multipled separately &amp; then added together.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
<p>The above figure shows how we pick a 3x3x3 block from the image, and then apply the 3x3 filter. The multiplication is carried out channel-wise, i.e.&nbsp;we select the first channel of the filter and the first channel of the image and carry out the element wise multiplation. Once the elementwise multiplications for the three pairs of channels are completed, we sum them all, and pass through the neuron.</p>
</section>
<section id="input-output-relationship" class="level2">
<h2 class="anchored" data-anchor-id="input-output-relationship">Input-output relationship</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Glassner/16-10.png" class="img-fluid figure-img"></p>
<figcaption>Matching the original image footprints against the output location.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
<p>The above figure shows how 9 inputs transform in to one output. As a result, dimensions of the output matrix is smaller than the dimensions of the input matrix. There are some options we can use if we wish to keep the size of input and output matrices same.</p>
</section>
</section>
<section id="convolutional-layer-options" class="level1" data-visibility="uncounted">
<h1 data-visibility="uncounted">Convolutional Layer Options</h1>
<section id="padding" class="level2">
<h2 class="anchored" data-anchor-id="padding">Padding</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Glassner/16-15.png" class="img-fluid figure-img"></p>
<figcaption>What happens when filters go off the edge of the input?</figcaption>
</figure>
</div>
<ul>
<li>How to avoid the filter’s receptive field falling off the side of the input.</li>
<li>If we only scan the filter over places of the input where the filter can fit perfectly, it will lead to loss of information, especially after many filters.</li>
</ul>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="padding-1" class="level2">
<h2 class="anchored" data-anchor-id="padding-1">Padding</h2>
<p>Add a border of extra elements around the input, called <strong>padding</strong>. Normally we place zeros in all the new elements, called <strong>zero padding</strong>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Glassner/16-17.png" class="img-fluid figure-img"></p>
<figcaption>Padded values can be added to the outside of the input.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="convolution-layer" class="level2">
<h2 class="anchored" data-anchor-id="convolution-layer">Convolution layer</h2>
<ul>
<li>Multiple filters are bundled together in one layer.</li>
<li>The filters are applied <em>simultaneously</em> and <em>independently</em> to the input.</li>
<li>Filters can have different footprints, but in practice we almost always use the same footprint for every filter in a convolution layer.</li>
<li>Number of channels in the output will be the same as the number of filters.</li>
</ul>
<p>The motivation behind applying filters <em>simultaneously</em> and <em>independently</em> is to let the filters learn different patterns in the input-output relationship. The idea is quite similar to using many neurons in one <code>Dense</code> layer (in a <code>Dense</code> layer, we would use multiple neurons so that different neurons can capture different patterns in the input-output relationship).</p>
</section>
<section id="example" class="level2">
<h2 class="anchored" data-anchor-id="example">Example</h2>
<div class="columns">
<div class="column">
<p>In the image:</p>
<ul>
<li>6-channel input tensor</li>
<li>input pixels</li>
<li>four 3x3 filters</li>
<li>four output tensors</li>
<li>final output tensor.</li>
</ul>
</div><div class="column">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Glassner/16-21.png" class="img-fluid figure-img"></p>
<figcaption>Example network highlighting that the number of output channels equals the number of filters.</figcaption>
</figure>
</div>
</div>
</div>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
<p>The above picture shows how we take in an image with 6 channels, select a 3x3 block (in pink colour), apply 4 different filters of same dimensions (in pink, green, blue and yellow), retrieve the output with 1 channel (1 output for each filter) and finally stack them together to create 1 output tensor. Note that the number of channels in the output tensor is 4, which is equal to the number of spatial filters used.</p>
</section>
<section id="x1-convolution" class="level2">
<h2 class="anchored" data-anchor-id="x1-convolution">1x1 convolution</h2>
<ul>
<li>Feature reduction: Reduce the number of channels in the input tensor (removing correlated features) by using fewer filters than the number of channels in the input. This is because the number of channels in the output is always the same as number of filters.</li>
<li>1x1 convolution: Convolution using 1x1 filters.</li>
<li>When the channels are correlated, 1x1 convolution is very effective at reducing channels without loss of information.</li>
</ul>
</section>
<section id="example-of-1x1-convolution" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="example-of-1x1-convolution">Example of 1x1 convolution</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Glassner/16-23.png" class="img-fluid figure-img"></p>
<figcaption>Example network with 1x1 convolution.</figcaption>
</figure>
</div>
<ul>
<li>Input tensor contains 300 channels.</li>
<li>Use 175 1x1 filters in the convolution layer (300 weights each).</li>
<li>Each filter produces a 1-channel output.</li>
<li>Final output tensor has 175 channels.</li>
</ul>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="striding" class="level2">
<h2 class="anchored" data-anchor-id="striding">Striding</h2>
<p>Striding options allows to modify the movement of the filter across the image. Instead moving one step at a time (either horizontally or vertically), we can increase the number of steps using the <em>striding</em> option.</p>
<p>We don’t have to go one pixel across/down at a time.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Glassner/16-29.png" class="img-fluid figure-img"></p>
<figcaption>Example: Use a stride of three horizontally and two vertically.</figcaption>
</figure>
</div>
<p>Dimension of output will be smaller than input.</p>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="choosing-strides" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="choosing-strides">Choosing strides</h2>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Glassner/16-31.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Glassner/16-32.png" class="img-fluid"></p>
</div>
</div>
</div>
<p>When a filter scans the input step by step, it processes the same input elements multiple times. Even with larger strides, this can still happen (left image).</p>
<p><strong>If</strong> we want to save time, we can choose strides that prevents input elements from being used more than once. Example (right image): 3x3 filter, stride 3 in both directions.</p>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="specifying-a-convolutional-layer" class="level2">
<h2 class="anchored" data-anchor-id="specifying-a-convolutional-layer">Specifying a convolutional layer</h2>
<p>Need to choose:</p>
<ul>
<li>number of filters,</li>
<li>their footprints (e.g.&nbsp;3x3, 5x5, etc.),</li>
<li>activation functions,</li>
<li>padding &amp; striding (optional).</li>
</ul>
<p>All the filter weights are learned during training.</p>
</section>
</section>
<section id="convolutional-neural-networks" class="level1" data-visibility="uncounted">
<h1 data-visibility="uncounted">Convolutional Neural Networks</h1>
<section id="definition-of-cnn" class="level2">
<h2 class="anchored" data-anchor-id="definition-of-cnn">Definition of CNN</h2>
<div class="columns">
<div class="column" style="width:60%;">
<p><br> <br></p>
<p>A neural network that uses <em>convolution layers</em> is called a <em>convolutional neural network</em>.</p>
</div><div class="column" style="width:40%;">
<p><img src="xkcd-trained_a_neural_net_2x.png" class="img-fluid"></p>
</div>
</div>
<div class="footer">
<p>Source: Randall Munroe (2019), <a href="https://xkcd.com/2173/">xkcd #2173: Trained a Neural Net</a>.</p>
</div>
</section>
<section id="architecture" class="level2">
<h2 class="anchored" data-anchor-id="architecture">Architecture</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Geron-mls2_1411.png" class="img-fluid figure-img"></p>
<figcaption>Typical CNN architecture.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Aurélien Géron (2019), <em>Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</em>, 2nd Edition, Figure 14-11.</p>
</div>
<p>A standard CNN architecture has the following components: an input layer, a sequence of feature extraction layers (which combine convolution and pooling operations sequentially), a sequence of classification layers (which include flattening and fully connected layers) and a final output layer. Convolution layers are used to extract meaningful patterns from the input using spatial filters. Pooling layers are used to reduce the spatial dimensions of the feature maps generated from convolutional layers. The purpose of the feature extraction layers is to learn complex but meaningful, high levels patterns in data. The aim of classification layers is to receive the learned patterns and make decisions more closely related to the classification task at hand.</p>
</section>
<section id="architecture-2" class="level2">
<h2 class="anchored" data-anchor-id="architecture-2">Architecture #2</h2>
<p><img src="mathworks-typical-cnn.svg" class="img-fluid"></p>
<div class="footer">
<p>Source: MathWorks, <a href="https://au.mathworks.com/campaigns/offers/next/deep-learning-ebook.html"><em>Introducing Deep Learning with MATLAB</em></a>, Ebook.</p>
</div>
<p>On a high level, the idea would be to keep on increasing the number of channels (depth) and decrease the dimensions of the feature map. We can see how the depth increases, and spatial dimensions reduce from first convolution layer to the second pooling layer.</p>
</section>
<section id="pooling" class="level2">
<h2 class="anchored" data-anchor-id="pooling">Pooling</h2>
<p><strong>Pooling</strong>, or <strong>downsampling</strong>, is a technique to blur a tensor.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Glassner/16-27.png" class="img-fluid figure-img"></p>
<figcaption>Illustration of pool operations.</figcaption>
</figure>
</div>
<p>(a): Input tensor (b): Subdivide input tensor into 2x2 blocks (c): Average pooling (d): Max pooling (e): Icon for a pooling layer</p>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="pooling-for-multiple-channels" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="pooling-for-multiple-channels">Pooling for multiple channels</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Glassner/16-28.png" class="img-fluid figure-img"></p>
<figcaption>Pooling a multichannel input.</figcaption>
</figure>
</div>
<ul>
<li>Input tensor: 6x6 with 1 channel, zero padding.</li>
<li>Convolution layer: Three 3x3 filters.</li>
<li>Convolution layer output: 6x6 with 3 channels.</li>
<li>Pooling layer: apply max pooling to each channel.</li>
<li>Pooling layer output: 3x3, 3 channels.</li>
</ul>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="whywhy-not-use-pooling" class="level2">
<h2 class="anchored" data-anchor-id="whywhy-not-use-pooling">Why/why not use pooling?</h2>
<p><strong>Why?</strong> Pooling <em>reduces the size</em> of tensors, therefore reduces memory usage and execution time (recall that 1x1 convolution <em>reduces the number of channels</em> in a tensor).</p>
<p><strong>Why not?</strong></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="reddit-hinton-pooling.png" class="img-fluid figure-img"></p>
<figcaption>Geoffrey Hinton</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Hinton, <a href="https://www.reddit.com/r/MachineLearning/comments/2lmo0l/comment/clyj4jv/?utm_source=share&amp;utm_medium=web2x&amp;context=3">Reddit AMA</a>.</p>
</div>
</section>
<section id="what-do-the-cnn-layers-learn" class="level2">
<h2 class="anchored" data-anchor-id="what-do-the-cnn-layers-learn">What do the CNN layers learn?</h2>
<p><img src="distill-feature-visualisation.png" class="img-fluid"></p>
<div class="footer">
<p>Source: Distill article, <a href="https://distill.pub/2017/feature-visualization/">Feature Visualization</a>.</p>
</div>
</section>
</section>
<section id="demo-character-recognition" class="level1" data-visibility="uncounted">
<h1 data-visibility="uncounted">Demo: Character Recognition</h1>
<section id="mnist-dataset" class="level2">
<h2 class="anchored" data-anchor-id="mnist-dataset">MNIST Dataset</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="wiki-MnistExamples.png" class="img-fluid figure-img"></p>
<figcaption>The MNIST dataset.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Wikipedia, <a href="https://en.wikipedia.org/wiki/MNIST_database">MNIST database</a>.</p>
</div>
</section>
<section id="mandarin-characters-dataset" class="level2">
<h2 class="anchored" data-anchor-id="mandarin-characters-dataset">Mandarin Characters Dataset</h2>
<p>57 poorly written Mandarin characters (<span class="math inline">\(57 \times 7 = 399\)</span>).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="mandarin-practice-notebook3.png" class="img-fluid figure-img"></p>
<figcaption>Dataset of notes when learning/practising basic characters.</figcaption>
</figure>
</div>
</section>
<section id="downloading-the-dataset" class="level2">
<h2 class="anchored" data-anchor-id="downloading-the-dataset">Downloading the dataset</h2>
<p>The data is zipped (6.9 MB) and stored on my GitHub homepage.</p>
<div id="c8ea8fe8" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Download the dataset if it hasn't already been downloaded.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> Path(<span class="st">"mandarin"</span>).exists():</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"Downloading dataset..."</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">!</span>wget https:<span class="op">//</span>laub.au<span class="op">/</span>data<span class="op">/</span>mandarin.<span class="bu">zip</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">!</span>unzip mandarin.<span class="bu">zip</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"Already downloaded."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Already downloaded.</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Remember, the Jupyter notebook associated with your final report should either download your dataset when it is run, or you should supply the data separately.</p>
</div>
</div>
</section>
<section id="directory-structure" class="level2">
<h2 class="anchored" data-anchor-id="directory-structure">Directory structure</h2>
<div class="columns">
<div class="column">
<p>Inspect directory structure</p>
<div id="0e6fcbd2" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install directory_tree</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="1a8211b2" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> directory_tree <span class="im">import</span> display_tree</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>display_tree(<span class="st">"mandarin"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>mandarin/
├── bai/
│   ├── bai-1.png
│   ├── bai-2.png
│   ├── bai-3.png
│   ├── bai-4.png
│   ├── bai-5.png
│   ├── bai-6.png
│   └── bai-7.png
├── ben/
│   ├── ben-1.png
│   ├── ben-2.png
│   ├── ben-3.png
│   ├── ben-4.png
│   ├── ben-5.png
│   ├── ben-6.png
│   └── ben-7.png
├── chong/
│   ├── chong-1.png
│   ├── chong-2.png
│   ├── chong-3.png
│   ├── chong-4.png
│   ├── chong-5.png
│   ├── chong-6.png
│   └── chong-7.png
├── chu/
│   ├── chu-1.png
│   ├── chu-2.png
│   ├── chu-3.png
│   ├── chu-4.png
│   ├── chu-5.png
│   ├── chu-6.png
│   └── chu-7.png
├── chuan/
│   ├── chuan-1.png
│   ├── chuan-2.png
│   ├── chuan-3.png
│   ├── chuan-4.png
│   ├── chuan-5.png
│   ├── chuan-6.png
│   └── chuan-7.png
├── cong/
│   ├── cong-1.png
│   ├── cong-2.png
│   ├── cong-3.png
│   ├── cong-4.png
│   ├── cong-5.png
│   ├── cong-6.png
│   └── cong-7.png
├── da/
│   ├── da-1.png
│   ├── da-2.png
│   ├── da-3.png
│   ├── da-4.png
│   ├── da-5.png
│   ├── da-6.png
│   └── da-7.png
├── dan/
│   ├── dan-1.png
│   ├── dan-2.png
│   ├── dan-3.png
│   ├── dan-4.png
│   ├── dan-5.png
│   ├── dan-6.png
│   └── dan-7.png
├── dong/
│   ├── dong-1.png
│   ├── dong-2.png
│   ├── dong-3.png
│   ├── dong-4.png
│   ├── dong-5.png
│   ├── dong-6.png
│   └── dong-7.png
├── fei/
│   ├── fei-1.png
│   ├── fei-2.png
│   ├── fei-3.png
│   ├── fei-4.png
│   ├── fei-5.png
│   ├── fei-6.png
│   └── fei-7.png
├── fu/
│   ├── fu-1.png
│   ├── fu-2.png
│   ├── fu-3.png
│   ├── fu-4.png
│   ├── fu-5.png
│   ├── fu-6.png
│   └── fu-7.png
├── fu2/
│   ├── fu2-1.png
│   ├── fu2-2.png
│   ├── fu2-3.png
│   ├── fu2-4.png
│   ├── fu2-5.png
│   ├── fu2-6.png
│   └── fu2-7.png
├── gao/
│   ├── gao-1.png
│   ├── gao-2.png
│   ├── gao-3.png
│   ├── gao-4.png
│   ├── gao-5.png
│   ├── gao-6.png
│   └── gao-7.png
├── gong/
│   ├── gong-1.png
│   ├── gong-2.png
│   ├── gong-3.png
│   ├── gong-4.png
│   ├── gong-5.png
│   ├── gong-6.png
│   └── gong-7.png
├── guo/
│   ├── guo-1.png
│   ├── guo-2.png
│   ├── guo-3.png
│   ├── guo-4.png
│   ├── guo-5.png
│   ├── guo-6.png
│   └── guo-7.png
├── hu/
│   ├── hu-1.png
│   ├── hu-2.png
│   ├── hu-3.png
│   ├── hu-4.png
│   ├── hu-5.png
│   ├── hu-6.png
│   └── hu-7.png
├── huo/
│   ├── huo-1.png
│   ├── huo-2.png
│   ├── huo-3.png
│   ├── huo-4.png
│   ├── huo-5.png
│   ├── huo-6.png
│   └── huo-7.png
├── kou/
│   ├── kou-1.png
│   ├── kou-2.png
│   ├── kou-3.png
│   ├── kou-4.png
│   ├── kou-5.png
│   ├── kou-6.png
│   └── kou-7.png
├── ku/
│   ├── ku-1.png
│   ├── ku-2.png
│   ├── ku-3.png
│   ├── ku-4.png
│   ├── ku-5.png
│   ├── ku-6.png
│   └── ku-7.png
├── lin/
│   ├── lin-1.png
│   ├── lin-2.png
│   ├── lin-3.png
│   ├── lin-4.png
│   ├── lin-5.png
│   ├── lin-6.png
│   └── lin-7.png
├── ma/
│   ├── ma-1.png
│   ├── ma-2.png
│   ├── ma-3.png
│   ├── ma-4.png
│   ├── ma-5.png
│   ├── ma-6.png
│   └── ma-7.png
├── ma2/
│   ├── ma2-1.png
│   ├── ma2-2.png
│   ├── ma2-3.png
│   ├── ma2-4.png
│   ├── ma2-5.png
│   ├── ma2-6.png
│   └── ma2-7.png
├── ma3/
│   ├── ma3-1.png
│   ├── ma3-2.png
│   ├── ma3-3.png
│   ├── ma3-4.png
│   ├── ma3-5.png
│   ├── ma3-6.png
│   └── ma3-7.png
├── mei/
│   ├── mei-1.png
│   ├── mei-2.png
│   ├── mei-3.png
│   ├── mei-4.png
│   ├── mei-5.png
│   ├── mei-6.png
│   └── mei-7.png
├── men/
│   ├── men-1.png
│   ├── men-2.png
│   ├── men-3.png
│   ├── men-4.png
│   ├── men-5.png
│   ├── men-6.png
│   └── men-7.png
├── ming/
│   ├── ming-1.png
│   ├── ming-2.png
│   ├── ming-3.png
│   ├── ming-4.png
│   ├── ming-5.png
│   ├── ming-6.png
│   └── ming-7.png
├── mu/
│   ├── mu-1.png
│   ├── mu-2.png
│   ├── mu-3.png
│   ├── mu-4.png
│   ├── mu-5.png
│   ├── mu-6.png
│   └── mu-7.png
├── nan/
│   ├── nan-1.png
│   ├── nan-2.png
│   ├── nan-3.png
│   ├── nan-4.png
│   ├── nan-5.png
│   ├── nan-6.png
│   └── nan-7.png
├── niao/
│   ├── niao-1.png
│   ├── niao-2.png
│   ├── niao-3.png
│   ├── niao-4.png
│   ├── niao-5.png
│   ├── niao-6.png
│   └── niao-7.png
├── niu/
│   ├── niu-1.png
│   ├── niu-2.png
│   ├── niu-3.png
│   ├── niu-4.png
│   ├── niu-5.png
│   ├── niu-6.png
│   └── niu-7.png
├── nu/
│   ├── nu-1.png
│   ├── nu-2.png
│   ├── nu-3.png
│   ├── nu-4.png
│   ├── nu-5.png
│   ├── nu-6.png
│   └── nu-7.png
├── nuan/
│   ├── nuan-1.png
│   ├── nuan-2.png
│   ├── nuan-3.png
│   ├── nuan-4.png
│   ├── nuan-5.png
│   ├── nuan-6.png
│   └── nuan-7.png
├── peng/
│   ├── peng-1.png
│   ├── peng-2.png
│   ├── peng-3.png
│   ├── peng-4.png
│   ├── peng-5.png
│   ├── peng-6.png
│   └── peng-7.png
├── quan/
│   ├── quan-1.png
│   ├── quan-2.png
│   ├── quan-3.png
│   ├── quan-4.png
│   ├── quan-5.png
│   ├── quan-6.png
│   └── quan-7.png
├── ren/
│   ├── ren-1.png
│   ├── ren-2.png
│   ├── ren-3.png
│   ├── ren-4.png
│   ├── ren-5.png
│   ├── ren-6.png
│   └── ren-7.png
├── ri/
│   ├── ri-1.png
│   ├── ri-2.png
│   ├── ri-3.png
│   ├── ri-4.png
│   ├── ri-5.png
│   ├── ri-6.png
│   └── ri-7.png
├── rou/
│   ├── rou-1.png
│   ├── rou-2.png
│   ├── rou-3.png
│   ├── rou-4.png
│   ├── rou-5.png
│   ├── rou-6.png
│   └── rou-7.png
├── sen/
│   ├── sen-1.png
│   ├── sen-2.png
│   ├── sen-3.png
│   ├── sen-4.png
│   ├── sen-5.png
│   ├── sen-6.png
│   └── sen-7.png
├── shan/
│   ├── shan-1.png
│   ├── shan-2.png
│   ├── shan-3.png
│   ├── shan-4.png
│   ├── shan-5.png
│   ├── shan-6.png
│   └── shan-7.png
├── shan2/
│   ├── shan2-1.png
│   ├── shan2-2.png
│   ├── shan2-3.png
│   ├── shan2-4.png
│   ├── shan2-5.png
│   ├── shan2-6.png
│   └── shan2-7.png
├── shui/
│   ├── shui-1.png
│   ├── shui-2.png
│   ├── shui-3.png
│   ├── shui-4.png
│   ├── shui-5.png
│   ├── shui-6.png
│   └── shui-7.png
├── tai/
│   ├── tai-1.png
│   ├── tai-2.png
│   ├── tai-3.png
│   ├── tai-4.png
│   ├── tai-5.png
│   ├── tai-6.png
│   └── tai-7.png
├── tian/
│   ├── tian-1.png
│   ├── tian-2.png
│   ├── tian-3.png
│   ├── tian-4.png
│   ├── tian-5.png
│   ├── tian-6.png
│   └── tian-7.png
├── wang/
│   ├── wang-1.png
│   ├── wang-2.png
│   ├── wang-3.png
│   ├── wang-4.png
│   ├── wang-5.png
│   ├── wang-6.png
│   └── wang-7.png
├── wen/
│   ├── wen-1.png
│   ├── wen-2.png
│   ├── wen-3.png
│   ├── wen-4.png
│   ├── wen-5.png
│   ├── wen-6.png
│   └── wen-7.png
├── xian/
│   ├── xian-1.png
│   ├── xian-2.png
│   ├── xian-3.png
│   ├── xian-4.png
│   ├── xian-5.png
│   ├── xian-6.png
│   └── xian-7.png
├── xuan/
│   ├── xuan-1.png
│   ├── xuan-2.png
│   ├── xuan-3.png
│   ├── xuan-4.png
│   ├── xuan-5.png
│   ├── xuan-6.png
│   └── xuan-7.png
├── yan/
│   ├── yan-1.png
│   ├── yan-2.png
│   ├── yan-3.png
│   ├── yan-4.png
│   ├── yan-5.png
│   ├── yan-6.png
│   └── yan-7.png
├── yang/
│   ├── yang-1.png
│   ├── yang-2.png
│   ├── yang-3.png
│   ├── yang-4.png
│   ├── yang-5.png
│   ├── yang-6.png
│   └── yang-7.png
├── yin/
│   ├── yin-1.png
│   ├── yin-2.png
│   ├── yin-3.png
│   ├── yin-4.png
│   ├── yin-5.png
│   ├── yin-6.png
│   └── yin-7.png
├── yu/
│   ├── yu-1.png
│   ├── yu-2.png
│   ├── yu-3.png
│   ├── yu-4.png
│   ├── yu-5.png
│   ├── yu-6.png
│   └── yu-7.png
├── yu2/
│   ├── yu2-1.png
│   ├── yu2-2.png
│   ├── yu2-3.png
│   ├── yu2-4.png
│   ├── yu2-5.png
│   ├── yu2-6.png
│   └── yu2-7.png
├── yue/
│   ├── yue-1.png
│   ├── yue-2.png
│   ├── yue-3.png
│   ├── yue-4.png
│   ├── yue-5.png
│   ├── yue-6.png
│   └── yue-7.png
├── zhong/
│   ├── zhong-1.png
│   ├── zhong-2.png
│   ├── zhong-3.png
│   ├── zhong-4.png
│   ├── zhong-5.png
│   ├── zhong-6.png
│   └── zhong-7.png
├── zhu/
│   ├── zhu-1.png
│   ├── zhu-2.png
│   ├── zhu-3.png
│   ├── zhu-4.png
│   ├── zhu-5.png
│   ├── zhu-6.png
│   └── zhu-7.png
├── zhu2/
│   ├── zhu2-1.png
│   ├── zhu2-2.png
│   ├── zhu2-3.png
│   ├── zhu2-4.png
│   ├── zhu2-5.png
│   ├── zhu2-6.png
│   └── zhu2-7.png
└── zhuo/
    ├── zhuo-1.png
    ├── zhuo-2.png
    ├── zhuo-3.png
    ├── zhuo-4.png
    ├── zhuo-5.png
    ├── zhuo-6.png
    └── zhuo-7.png</code></pre>
</div>
</div>
</div><div class="column">
<div id="8cc95823" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>tree <span class="op">=</span> display_tree(<span class="st">"mandarin"</span>, string_rep<span class="op">=</span><span class="va">True</span>).split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(tree[:<span class="dv">12</span>]))</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"..."</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(tree[<span class="op">-</span><span class="dv">4</span>:]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>mandarin/
├── bai/
│   ├── bai-1.png
│   ├── bai-2.png
│   ├── bai-3.png
│   ├── bai-4.png
│   ├── bai-5.png
│   ├── bai-6.png
│   └── bai-7.png
├── ben/
│   ├── ben-1.png
│   ├── ben-2.png
...
    ├── zhuo-5.png
    ├── zhuo-6.png
    └── zhuo-7.png
</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="splitting-into-trainvaltest-sets" class="level2">
<h2 class="anchored" data-anchor-id="splitting-into-trainvaltest-sets">Splitting into train/val/test sets</h2>
<div id="9493940f" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install split<span class="op">-</span>folders</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="df6a54de" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> splitfolders</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>splitfolders.ratio(<span class="st">"mandarin"</span>, output<span class="op">=</span><span class="st">"mandarin-split"</span>,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    seed<span class="op">=</span><span class="dv">1337</span>, ratio<span class="op">=</span>(<span class="dv">5</span><span class="op">/</span><span class="dv">7</span>, <span class="dv">1</span><span class="op">/</span><span class="dv">7</span>, <span class="dv">1</span><span class="op">/</span><span class="dv">7</span>))</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>display_tree(<span class="st">"mandarin-split"</span>, max_depth<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Copying files: 0 files [00:00, ? files/s]Copying files: 195 files [00:00, 1944.77 files/s]Copying files: 399 files [00:00, 2043.90 files/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>mandarin-split/
├── test/
├── train/
└── val/</code></pre>
</div>
</div>
</section>
<section id="directory-structure-ii" class="level2">
<h2 class="anchored" data-anchor-id="directory-structure-ii">Directory structure II</h2>
<div class="columns">
<div class="column">
<div id="640e3e27" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>display_tree(<span class="st">"mandarin-split"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>mandarin-split/
├── test/
│   ├── bai/
│   │   └── bai-5.png
│   ├── ben/
│   │   └── ben-5.png
│   ├── chong/
│   │   └── chong-5.png
│   ├── chu/
│   │   └── chu-5.png
│   ├── chuan/
│   │   └── chuan-5.png
│   ├── cong/
│   │   └── cong-5.png
│   ├── da/
│   │   └── da-5.png
│   ├── dan/
│   │   └── dan-5.png
│   ├── dong/
│   │   └── dong-5.png
│   ├── fei/
│   │   └── fei-5.png
│   ├── fu/
│   │   └── fu-5.png
│   ├── fu2/
│   │   └── fu2-5.png
│   ├── gao/
│   │   └── gao-5.png
│   ├── gong/
│   │   └── gong-5.png
│   ├── guo/
│   │   └── guo-5.png
│   ├── hu/
│   │   └── hu-5.png
│   ├── huo/
│   │   └── huo-5.png
│   ├── kou/
│   │   └── kou-5.png
│   ├── ku/
│   │   └── ku-5.png
│   ├── lin/
│   │   └── lin-5.png
│   ├── ma/
│   │   └── ma-5.png
│   ├── ma2/
│   │   └── ma2-5.png
│   ├── ma3/
│   │   └── ma3-5.png
│   ├── mei/
│   │   └── mei-5.png
│   ├── men/
│   │   └── men-5.png
│   ├── ming/
│   │   └── ming-5.png
│   ├── mu/
│   │   └── mu-5.png
│   ├── nan/
│   │   └── nan-5.png
│   ├── niao/
│   │   └── niao-5.png
│   ├── niu/
│   │   └── niu-5.png
│   ├── nu/
│   │   └── nu-5.png
│   ├── nuan/
│   │   └── nuan-5.png
│   ├── peng/
│   │   └── peng-5.png
│   ├── quan/
│   │   └── quan-5.png
│   ├── ren/
│   │   └── ren-5.png
│   ├── ri/
│   │   └── ri-5.png
│   ├── rou/
│   │   └── rou-5.png
│   ├── sen/
│   │   └── sen-5.png
│   ├── shan/
│   │   └── shan-5.png
│   ├── shan2/
│   │   └── shan2-5.png
│   ├── shui/
│   │   └── shui-5.png
│   ├── tai/
│   │   └── tai-5.png
│   ├── tian/
│   │   └── tian-5.png
│   ├── wang/
│   │   └── wang-5.png
│   ├── wen/
│   │   └── wen-5.png
│   ├── xian/
│   │   └── xian-5.png
│   ├── xuan/
│   │   └── xuan-5.png
│   ├── yan/
│   │   └── yan-5.png
│   ├── yang/
│   │   └── yang-5.png
│   ├── yin/
│   │   └── yin-5.png
│   ├── yu/
│   │   └── yu-5.png
│   ├── yu2/
│   │   └── yu2-5.png
│   ├── yue/
│   │   └── yue-5.png
│   ├── zhong/
│   │   └── zhong-5.png
│   ├── zhu/
│   │   └── zhu-5.png
│   ├── zhu2/
│   │   └── zhu2-5.png
│   └── zhuo/
│       └── zhuo-5.png
├── train/
│   ├── bai/
│   │   ├── bai-1.png
│   │   ├── bai-2.png
│   │   ├── bai-3.png
│   │   ├── bai-4.png
│   │   └── bai-6.png
│   ├── ben/
│   │   ├── ben-1.png
│   │   ├── ben-2.png
│   │   ├── ben-3.png
│   │   ├── ben-4.png
│   │   └── ben-6.png
│   ├── chong/
│   │   ├── chong-1.png
│   │   ├── chong-2.png
│   │   ├── chong-3.png
│   │   ├── chong-4.png
│   │   └── chong-6.png
│   ├── chu/
│   │   ├── chu-1.png
│   │   ├── chu-2.png
│   │   ├── chu-3.png
│   │   ├── chu-4.png
│   │   └── chu-6.png
│   ├── chuan/
│   │   ├── chuan-1.png
│   │   ├── chuan-2.png
│   │   ├── chuan-3.png
│   │   ├── chuan-4.png
│   │   └── chuan-6.png
│   ├── cong/
│   │   ├── cong-1.png
│   │   ├── cong-2.png
│   │   ├── cong-3.png
│   │   ├── cong-4.png
│   │   └── cong-6.png
│   ├── da/
│   │   ├── da-1.png
│   │   ├── da-2.png
│   │   ├── da-3.png
│   │   ├── da-4.png
│   │   └── da-6.png
│   ├── dan/
│   │   ├── dan-1.png
│   │   ├── dan-2.png
│   │   ├── dan-3.png
│   │   ├── dan-4.png
│   │   └── dan-6.png
│   ├── dong/
│   │   ├── dong-1.png
│   │   ├── dong-2.png
│   │   ├── dong-3.png
│   │   ├── dong-4.png
│   │   └── dong-6.png
│   ├── fei/
│   │   ├── fei-1.png
│   │   ├── fei-2.png
│   │   ├── fei-3.png
│   │   ├── fei-4.png
│   │   └── fei-6.png
│   ├── fu/
│   │   ├── fu-1.png
│   │   ├── fu-2.png
│   │   ├── fu-3.png
│   │   ├── fu-4.png
│   │   └── fu-6.png
│   ├── fu2/
│   │   ├── fu2-1.png
│   │   ├── fu2-2.png
│   │   ├── fu2-3.png
│   │   ├── fu2-4.png
│   │   └── fu2-6.png
│   ├── gao/
│   │   ├── gao-1.png
│   │   ├── gao-2.png
│   │   ├── gao-3.png
│   │   ├── gao-4.png
│   │   └── gao-6.png
│   ├── gong/
│   │   ├── gong-1.png
│   │   ├── gong-2.png
│   │   ├── gong-3.png
│   │   ├── gong-4.png
│   │   └── gong-6.png
│   ├── guo/
│   │   ├── guo-1.png
│   │   ├── guo-2.png
│   │   ├── guo-3.png
│   │   ├── guo-4.png
│   │   └── guo-6.png
│   ├── hu/
│   │   ├── hu-1.png
│   │   ├── hu-2.png
│   │   ├── hu-3.png
│   │   ├── hu-4.png
│   │   └── hu-6.png
│   ├── huo/
│   │   ├── huo-1.png
│   │   ├── huo-2.png
│   │   ├── huo-3.png
│   │   ├── huo-4.png
│   │   └── huo-6.png
│   ├── kou/
│   │   ├── kou-1.png
│   │   ├── kou-2.png
│   │   ├── kou-3.png
│   │   ├── kou-4.png
│   │   └── kou-6.png
│   ├── ku/
│   │   ├── ku-1.png
│   │   ├── ku-2.png
│   │   ├── ku-3.png
│   │   ├── ku-4.png
│   │   └── ku-6.png
│   ├── lin/
│   │   ├── lin-1.png
│   │   ├── lin-2.png
│   │   ├── lin-3.png
│   │   ├── lin-4.png
│   │   └── lin-6.png
│   ├── ma/
│   │   ├── ma-1.png
│   │   ├── ma-2.png
│   │   ├── ma-3.png
│   │   ├── ma-4.png
│   │   └── ma-6.png
│   ├── ma2/
│   │   ├── ma2-1.png
│   │   ├── ma2-2.png
│   │   ├── ma2-3.png
│   │   ├── ma2-4.png
│   │   └── ma2-6.png
│   ├── ma3/
│   │   ├── ma3-1.png
│   │   ├── ma3-2.png
│   │   ├── ma3-3.png
│   │   ├── ma3-4.png
│   │   └── ma3-6.png
│   ├── mei/
│   │   ├── mei-1.png
│   │   ├── mei-2.png
│   │   ├── mei-3.png
│   │   ├── mei-4.png
│   │   └── mei-6.png
│   ├── men/
│   │   ├── men-1.png
│   │   ├── men-2.png
│   │   ├── men-3.png
│   │   ├── men-4.png
│   │   └── men-6.png
│   ├── ming/
│   │   ├── ming-1.png
│   │   ├── ming-2.png
│   │   ├── ming-3.png
│   │   ├── ming-4.png
│   │   └── ming-6.png
│   ├── mu/
│   │   ├── mu-1.png
│   │   ├── mu-2.png
│   │   ├── mu-3.png
│   │   ├── mu-4.png
│   │   └── mu-6.png
│   ├── nan/
│   │   ├── nan-1.png
│   │   ├── nan-2.png
│   │   ├── nan-3.png
│   │   ├── nan-4.png
│   │   └── nan-6.png
│   ├── niao/
│   │   ├── niao-1.png
│   │   ├── niao-2.png
│   │   ├── niao-3.png
│   │   ├── niao-4.png
│   │   └── niao-6.png
│   ├── niu/
│   │   ├── niu-1.png
│   │   ├── niu-2.png
│   │   ├── niu-3.png
│   │   ├── niu-4.png
│   │   └── niu-6.png
│   ├── nu/
│   │   ├── nu-1.png
│   │   ├── nu-2.png
│   │   ├── nu-3.png
│   │   ├── nu-4.png
│   │   └── nu-6.png
│   ├── nuan/
│   │   ├── nuan-1.png
│   │   ├── nuan-2.png
│   │   ├── nuan-3.png
│   │   ├── nuan-4.png
│   │   └── nuan-6.png
│   ├── peng/
│   │   ├── peng-1.png
│   │   ├── peng-2.png
│   │   ├── peng-3.png
│   │   ├── peng-4.png
│   │   └── peng-6.png
│   ├── quan/
│   │   ├── quan-1.png
│   │   ├── quan-2.png
│   │   ├── quan-3.png
│   │   ├── quan-4.png
│   │   └── quan-6.png
│   ├── ren/
│   │   ├── ren-1.png
│   │   ├── ren-2.png
│   │   ├── ren-3.png
│   │   ├── ren-4.png
│   │   └── ren-6.png
│   ├── ri/
│   │   ├── ri-1.png
│   │   ├── ri-2.png
│   │   ├── ri-3.png
│   │   ├── ri-4.png
│   │   └── ri-6.png
│   ├── rou/
│   │   ├── rou-1.png
│   │   ├── rou-2.png
│   │   ├── rou-3.png
│   │   ├── rou-4.png
│   │   └── rou-6.png
│   ├── sen/
│   │   ├── sen-1.png
│   │   ├── sen-2.png
│   │   ├── sen-3.png
│   │   ├── sen-4.png
│   │   └── sen-6.png
│   ├── shan/
│   │   ├── shan-1.png
│   │   ├── shan-2.png
│   │   ├── shan-3.png
│   │   ├── shan-4.png
│   │   └── shan-6.png
│   ├── shan2/
│   │   ├── shan2-1.png
│   │   ├── shan2-2.png
│   │   ├── shan2-3.png
│   │   ├── shan2-4.png
│   │   └── shan2-6.png
│   ├── shui/
│   │   ├── shui-1.png
│   │   ├── shui-2.png
│   │   ├── shui-3.png
│   │   ├── shui-4.png
│   │   └── shui-6.png
│   ├── tai/
│   │   ├── tai-1.png
│   │   ├── tai-2.png
│   │   ├── tai-3.png
│   │   ├── tai-4.png
│   │   └── tai-6.png
│   ├── tian/
│   │   ├── tian-1.png
│   │   ├── tian-2.png
│   │   ├── tian-3.png
│   │   ├── tian-4.png
│   │   └── tian-6.png
│   ├── wang/
│   │   ├── wang-1.png
│   │   ├── wang-2.png
│   │   ├── wang-3.png
│   │   ├── wang-4.png
│   │   └── wang-6.png
│   ├── wen/
│   │   ├── wen-1.png
│   │   ├── wen-2.png
│   │   ├── wen-3.png
│   │   ├── wen-4.png
│   │   └── wen-6.png
│   ├── xian/
│   │   ├── xian-1.png
│   │   ├── xian-2.png
│   │   ├── xian-3.png
│   │   ├── xian-4.png
│   │   └── xian-6.png
│   ├── xuan/
│   │   ├── xuan-1.png
│   │   ├── xuan-2.png
│   │   ├── xuan-3.png
│   │   ├── xuan-4.png
│   │   └── xuan-6.png
│   ├── yan/
│   │   ├── yan-1.png
│   │   ├── yan-2.png
│   │   ├── yan-3.png
│   │   ├── yan-4.png
│   │   └── yan-6.png
│   ├── yang/
│   │   ├── yang-1.png
│   │   ├── yang-2.png
│   │   ├── yang-3.png
│   │   ├── yang-4.png
│   │   └── yang-6.png
│   ├── yin/
│   │   ├── yin-1.png
│   │   ├── yin-2.png
│   │   ├── yin-3.png
│   │   ├── yin-4.png
│   │   └── yin-6.png
│   ├── yu/
│   │   ├── yu-1.png
│   │   ├── yu-2.png
│   │   ├── yu-3.png
│   │   ├── yu-4.png
│   │   └── yu-6.png
│   ├── yu2/
│   │   ├── yu2-1.png
│   │   ├── yu2-2.png
│   │   ├── yu2-3.png
│   │   ├── yu2-4.png
│   │   └── yu2-6.png
│   ├── yue/
│   │   ├── yue-1.png
│   │   ├── yue-2.png
│   │   ├── yue-3.png
│   │   ├── yue-4.png
│   │   └── yue-6.png
│   ├── zhong/
│   │   ├── zhong-1.png
│   │   ├── zhong-2.png
│   │   ├── zhong-3.png
│   │   ├── zhong-4.png
│   │   └── zhong-6.png
│   ├── zhu/
│   │   ├── zhu-1.png
│   │   ├── zhu-2.png
│   │   ├── zhu-3.png
│   │   ├── zhu-4.png
│   │   └── zhu-6.png
│   ├── zhu2/
│   │   ├── zhu2-1.png
│   │   ├── zhu2-2.png
│   │   ├── zhu2-3.png
│   │   ├── zhu2-4.png
│   │   └── zhu2-6.png
│   └── zhuo/
│       ├── zhuo-1.png
│       ├── zhuo-2.png
│       ├── zhuo-3.png
│       ├── zhuo-4.png
│       └── zhuo-6.png
└── val/
    ├── bai/
    │   └── bai-7.png
    ├── ben/
    │   └── ben-7.png
    ├── chong/
    │   └── chong-7.png
    ├── chu/
    │   └── chu-7.png
    ├── chuan/
    │   └── chuan-7.png
    ├── cong/
    │   └── cong-7.png
    ├── da/
    │   └── da-7.png
    ├── dan/
    │   └── dan-7.png
    ├── dong/
    │   └── dong-7.png
    ├── fei/
    │   └── fei-7.png
    ├── fu/
    │   └── fu-7.png
    ├── fu2/
    │   └── fu2-7.png
    ├── gao/
    │   └── gao-7.png
    ├── gong/
    │   └── gong-7.png
    ├── guo/
    │   └── guo-7.png
    ├── hu/
    │   └── hu-7.png
    ├── huo/
    │   └── huo-7.png
    ├── kou/
    │   └── kou-7.png
    ├── ku/
    │   └── ku-7.png
    ├── lin/
    │   └── lin-7.png
    ├── ma/
    │   └── ma-7.png
    ├── ma2/
    │   └── ma2-7.png
    ├── ma3/
    │   └── ma3-7.png
    ├── mei/
    │   └── mei-7.png
    ├── men/
    │   └── men-7.png
    ├── ming/
    │   └── ming-7.png
    ├── mu/
    │   └── mu-7.png
    ├── nan/
    │   └── nan-7.png
    ├── niao/
    │   └── niao-7.png
    ├── niu/
    │   └── niu-7.png
    ├── nu/
    │   └── nu-7.png
    ├── nuan/
    │   └── nuan-7.png
    ├── peng/
    │   └── peng-7.png
    ├── quan/
    │   └── quan-7.png
    ├── ren/
    │   └── ren-7.png
    ├── ri/
    │   └── ri-7.png
    ├── rou/
    │   └── rou-7.png
    ├── sen/
    │   └── sen-7.png
    ├── shan/
    │   └── shan-7.png
    ├── shan2/
    │   └── shan2-7.png
    ├── shui/
    │   └── shui-7.png
    ├── tai/
    │   └── tai-7.png
    ├── tian/
    │   └── tian-7.png
    ├── wang/
    │   └── wang-7.png
    ├── wen/
    │   └── wen-7.png
    ├── xian/
    │   └── xian-7.png
    ├── xuan/
    │   └── xuan-7.png
    ├── yan/
    │   └── yan-7.png
    ├── yang/
    │   └── yang-7.png
    ├── yin/
    │   └── yin-7.png
    ├── yu/
    │   └── yu-7.png
    ├── yu2/
    │   └── yu2-7.png
    ├── yue/
    │   └── yue-7.png
    ├── zhong/
    │   └── zhong-7.png
    ├── zhu/
    │   └── zhu-7.png
    ├── zhu2/
    │   └── zhu2-7.png
    └── zhuo/
        └── zhuo-7.png</code></pre>
</div>
</div>
</div><div class="column">
<div id="4892d421" class="cell" data-execution_count="23">
<div class="cell-output cell-output-stdout">
<pre><code>train/
├── bai/
│   ├── bai-1.png
│   ├── bai-2.png
│   ├── bai-3.png
│   ├── bai-4.png
│   └── bai-6.png
...
val/
├── bai/
│   └── bai-7.png
├── ben/
│   └── ben-7.png
...
test/
├── bai/
│   └── bai-5.png
├── ben/
│   └── ben-5.png
...</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="keras-image-dataset-loading" class="level2">
<h2 class="anchored" data-anchor-id="keras-image-dataset-loading">Keras image dataset loading</h2>
<div class="columns">
<div class="column">
<div id="4e2c4b21" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="annotated-cell-63"><pre class="sourceCode python code-annotation-code code-with-copy"><code class="sourceCode python"><span id="annotated-cell-63-1"><a href="#annotated-cell-63-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.utils <span class="im">import</span><span class="op">\</span></span>
<span id="annotated-cell-63-2"><a href="#annotated-cell-63-2" aria-hidden="true" tabindex="-1"></a>  image_dataset_from_directory</span>
<span id="annotated-cell-63-3"><a href="#annotated-cell-63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-63-4"><a href="#annotated-cell-63-4" aria-hidden="true" tabindex="-1"></a>data_dir <span class="op">=</span> <span class="st">"mandarin-split"</span></span>
<span id="annotated-cell-63-5"><a href="#annotated-cell-63-5" aria-hidden="true" tabindex="-1"></a>batch_size <span class="op">=</span> <span class="dv">32</span></span>
<span id="annotated-cell-63-6"><a href="#annotated-cell-63-6" aria-hidden="true" tabindex="-1"></a>img_height <span class="op">=</span> <span class="dv">80</span></span>
<span id="annotated-cell-63-7"><a href="#annotated-cell-63-7" aria-hidden="true" tabindex="-1"></a>img_width <span class="op">=</span> <span class="dv">80</span></span>
<span id="annotated-cell-63-8"><a href="#annotated-cell-63-8" aria-hidden="true" tabindex="-1"></a>img_size <span class="op">=</span> (img_height, img_width)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column">
<div id="77f70bf2" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="annotated-cell-64"><pre class="sourceCode python code-annotation-code code-with-copy"><code class="sourceCode python"><span id="annotated-cell-64-1"><a href="#annotated-cell-64-1" aria-hidden="true" tabindex="-1"></a>train_ds <span class="op">=</span> image_dataset_from_directory(</span>
<span id="annotated-cell-64-2"><a href="#annotated-cell-64-2" aria-hidden="true" tabindex="-1"></a>    data_dir <span class="op">+</span> <span class="st">"/train"</span>,</span>
<span id="annotated-cell-64-3"><a href="#annotated-cell-64-3" aria-hidden="true" tabindex="-1"></a>    image_size<span class="op">=</span>img_size,</span>
<span id="annotated-cell-64-4"><a href="#annotated-cell-64-4" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="annotated-cell-64-5"><a href="#annotated-cell-64-5" aria-hidden="true" tabindex="-1"></a>    shuffle<span class="op">=</span><span class="va">False</span>,</span>
<span id="annotated-cell-64-6"><a href="#annotated-cell-64-6" aria-hidden="true" tabindex="-1"></a>    color_mode<span class="op">=</span><span class="st">'grayscale'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Found 285 files belonging to 57 classes.</code></pre>
</div>
</div>
</div>
</div>
<div class="columns">
<div class="column">
<div id="4d793bca" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="annotated-cell-66"><pre class="sourceCode python code-annotation-code code-with-copy"><code class="sourceCode python"><span id="annotated-cell-66-1"><a href="#annotated-cell-66-1" aria-hidden="true" tabindex="-1"></a>val_ds <span class="op">=</span> image_dataset_from_directory(</span>
<span id="annotated-cell-66-2"><a href="#annotated-cell-66-2" aria-hidden="true" tabindex="-1"></a>    data_dir <span class="op">+</span> <span class="st">"/val"</span>,</span>
<span id="annotated-cell-66-3"><a href="#annotated-cell-66-3" aria-hidden="true" tabindex="-1"></a>    image_size<span class="op">=</span>img_size,</span>
<span id="annotated-cell-66-4"><a href="#annotated-cell-66-4" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="annotated-cell-66-5"><a href="#annotated-cell-66-5" aria-hidden="true" tabindex="-1"></a>    shuffle<span class="op">=</span><span class="va">False</span>,</span>
<span id="annotated-cell-66-6"><a href="#annotated-cell-66-6" aria-hidden="true" tabindex="-1"></a>    color_mode<span class="op">=</span><span class="st">'grayscale'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Found 57 files belonging to 57 classes.</code></pre>
</div>
</div>
</div><div class="column">
<div id="1b8c608b" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="annotated-cell-68"><pre class="sourceCode python code-annotation-code code-with-copy"><code class="sourceCode python"><span id="annotated-cell-68-1"><a href="#annotated-cell-68-1" aria-hidden="true" tabindex="-1"></a>test_ds <span class="op">=</span> image_dataset_from_directory(</span>
<span id="annotated-cell-68-2"><a href="#annotated-cell-68-2" aria-hidden="true" tabindex="-1"></a>    data_dir <span class="op">+</span> <span class="st">"/test"</span>,</span>
<span id="annotated-cell-68-3"><a href="#annotated-cell-68-3" aria-hidden="true" tabindex="-1"></a>    image_size<span class="op">=</span>img_size,</span>
<span id="annotated-cell-68-4"><a href="#annotated-cell-68-4" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="annotated-cell-68-5"><a href="#annotated-cell-68-5" aria-hidden="true" tabindex="-1"></a>    shuffle<span class="op">=</span><span class="va">False</span>,</span>
<span id="annotated-cell-68-6"><a href="#annotated-cell-68-6" aria-hidden="true" tabindex="-1"></a>    color_mode<span class="op">=</span><span class="st">'grayscale'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Found 57 files belonging to 57 classes.</code></pre>
</div>
</div>
</div>
</div>
<ol type="1">
<li>Imports <code>image_dataset_from_directory</code> class from <code>tensorflow.keras.utils</code> library</li>
<li>Specifies the name of the folder</li>
<li>Specifies the number of images to be trained at the same time</li>
<li>Specifies the height of the image</li>
<li>Specifies the width of the image</li>
<li>Specifies the image size</li>
<li>Creates a data object to store the train set. Note that <code>color_mode='grayscale'</code> command tells the computer to bring in the images in greyscale instead of the RGB scale.</li>
<li>Creates a data object to store the validation set</li>
<li>Creates a data object to store the test set</li>
</ol>
</section>
<section id="inspecting-the-datasets" class="level2">
<h2 class="anchored" data-anchor-id="inspecting-the-datasets">Inspecting the datasets</h2>
<div id="b4bf2f2c" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(train_ds.class_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['bai', 'ben', 'chong', 'chu', 'chuan', 'cong', 'da', 'dan', 'dong', 'fei', 'fu', 'fu2', 'gao', 'gong', 'guo', 'hu', 'huo', 'kou', 'ku', 'lin', 'ma', 'ma2', 'ma3', 'mei', 'men', 'ming', 'mu', 'nan', 'niao', 'niu', 'nu', 'nuan', 'peng', 'quan', 'ren', 'ri', 'rou', 'sen', 'shan', 'shan2', 'shui', 'tai', 'tian', 'wang', 'wen', 'xian', 'xuan', 'yan', 'yang', 'yin', 'yu', 'yu2', 'yue', 'zhong', 'zhu', 'zhu2', 'zhuo']</code></pre>
</div>
</div>
<div id="64a5d755" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NB: Need shuffle=False earlier for these X &amp; y to line up.</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> np.concatenate(<span class="bu">list</span>(train_ds.<span class="bu">map</span>(<span class="kw">lambda</span> x, y: x)))</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> np.concatenate(<span class="bu">list</span>(train_ds.<span class="bu">map</span>(<span class="kw">lambda</span> x, y: y)))</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>X_val <span class="op">=</span> np.concatenate(<span class="bu">list</span>(val_ds.<span class="bu">map</span>(<span class="kw">lambda</span> x, y: x)))</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>y_val <span class="op">=</span> np.concatenate(<span class="bu">list</span>(val_ds.<span class="bu">map</span>(<span class="kw">lambda</span> x, y: y)))</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> np.concatenate(<span class="bu">list</span>(test_ds.<span class="bu">map</span>(<span class="kw">lambda</span> x, y: x)))</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>y_test <span class="op">=</span> np.concatenate(<span class="bu">list</span>(test_ds.<span class="bu">map</span>(<span class="kw">lambda</span> x, y: y)))</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>X_train.shape, y_train.shape, X_val.shape, y_val.shape, X_test.shape, y_test.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2024-01-30 20:22:12.946789: W tensorflow/tsl/platform/profile_utils/cpu_utils.cc:128] Failed to get CPU frequency: 0 Hz</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>((285, 80, 80, 1), (285,), (57, 80, 80, 1), (57,), (57, 80, 80, 1), (57,))</code></pre>
</div>
</div>
</section>
<section id="plotting-some-characters-setup" class="level2">
<h2 class="anchored" data-anchor-id="plotting-some-characters-setup">Plotting some characters (setup)</h2>
<div id="70447990" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_mandarin_characters(ds, plot_char_label <span class="op">=</span> <span class="dv">0</span>):</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    num_plotted <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> images, labels <span class="kw">in</span> ds:</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>       <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(images.shape[<span class="dv">0</span>]):</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>           label <span class="op">=</span> labels[i]</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>           <span class="cf">if</span> label <span class="op">==</span> plot_char_label:</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>               plt.subplot(<span class="dv">1</span>, <span class="dv">5</span>, num_plotted <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>               plt.imshow(images[i].numpy().astype(<span class="st">"uint8"</span>), cmap<span class="op">=</span><span class="st">"gray"</span>)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>               plt.title(ds.class_names[label])</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>               plt.axis(<span class="st">"off"</span>)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>               num_plotted <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plotting-some-training-characters" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="plotting-some-training-characters">Plotting some training characters</h2>
<div id="c61c3fdd" class="cell" data-execution_count="31">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-32-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-32-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plotting-some-valtest-characters" class="level2">
<h2 class="anchored" data-anchor-id="plotting-some-valtest-characters">Plotting some val/test characters</h2>
<div class="columns">
<div class="column">
<div id="ba9d4735" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>bai_val <span class="op">=</span> X_val[y_val <span class="op">==</span> <span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>plt.imshow(bai_val, cmap<span class="op">=</span><span class="st">"gray"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-33-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div><div class="column">
<div id="15bfaab9" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>bai_test <span class="op">=</span> X_test[y_test <span class="op">==</span> <span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>plt.imshow(bai_test)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-34-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="section" class="level1">
<h1></h1>
<h2 class="anchored" data-anchor-id="section">
Make the CNN
</h2>
<div id="2ba58bed" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="annotated-cell-12"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-12-1"><a href="#annotated-cell-12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="op">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-12-2" class="code-annotation-target"><a href="#annotated-cell-12-2" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> Rescaling, Conv2D, MaxPooling2D, Flatten</span>
<span id="annotated-cell-12-3"><a href="#annotated-cell-12-3" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-12-4" class="code-annotation-target"><a href="#annotated-cell-12-4" aria-hidden="true" tabindex="-1"></a>num_classes <span class="op">=</span> np.unique(y_train).shape[<span class="dv">0</span>]</span>
<span id="annotated-cell-12-5"><a href="#annotated-cell-12-5" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">123</span>)</span>
<span id="annotated-cell-12-6"><a href="#annotated-cell-12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-12-7"><a href="#annotated-cell-12-7" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential([</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-12-8" class="code-annotation-target"><a href="#annotated-cell-12-8" aria-hidden="true" tabindex="-1"></a>  Rescaling(<span class="fl">1.</span><span class="op">/</span><span class="dv">255</span>, input_shape<span class="op">=</span>(img_height, img_width, <span class="dv">1</span>)),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-12-9" class="code-annotation-target"><a href="#annotated-cell-12-9" aria-hidden="true" tabindex="-1"></a>  Conv2D(<span class="dv">16</span>, <span class="dv">3</span>, padding<span class="op">=</span><span class="st">"same"</span>, activation<span class="op">=</span><span class="st">"relu"</span>, name<span class="op">=</span><span class="st">"conv1"</span>),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-12-10" class="code-annotation-target"><a href="#annotated-cell-12-10" aria-hidden="true" tabindex="-1"></a>  MaxPooling2D(name<span class="op">=</span><span class="st">"pool1"</span>),</span>
<span id="annotated-cell-12-11"><a href="#annotated-cell-12-11" aria-hidden="true" tabindex="-1"></a>  Conv2D(<span class="dv">32</span>, <span class="dv">3</span>, padding<span class="op">=</span><span class="st">"same"</span>, activation<span class="op">=</span><span class="st">"relu"</span>, name<span class="op">=</span><span class="st">"conv2"</span>),</span>
<span id="annotated-cell-12-12"><a href="#annotated-cell-12-12" aria-hidden="true" tabindex="-1"></a>  MaxPooling2D(name<span class="op">=</span><span class="st">"pool2"</span>),</span>
<span id="annotated-cell-12-13"><a href="#annotated-cell-12-13" aria-hidden="true" tabindex="-1"></a>  Conv2D(<span class="dv">64</span>, <span class="dv">3</span>, padding<span class="op">=</span><span class="st">"same"</span>, activation<span class="op">=</span><span class="st">"relu"</span>, name<span class="op">=</span><span class="st">"conv3"</span>),</span>
<span id="annotated-cell-12-14"><a href="#annotated-cell-12-14" aria-hidden="true" tabindex="-1"></a>  MaxPooling2D(name<span class="op">=</span><span class="st">"pool3"</span>),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-12-15" class="code-annotation-target"><a href="#annotated-cell-12-15" aria-hidden="true" tabindex="-1"></a>  Flatten(), Dense(<span class="dv">128</span>, activation<span class="op">=</span><span class="st">"relu"</span>), Dense(num_classes)</span>
<span id="annotated-cell-12-16"><a href="#annotated-cell-12-16" aria-hidden="true" tabindex="-1"></a>])</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-12" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="2" data-code-annotation="1">Imports CNN specific preprocessing layers from <code>tensorflow.keras.layers</code></span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="4" data-code-annotation="2">Specifies the number of unique categories in the train set</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="8" data-code-annotation="3">Rescales the numeric representations of data which ranges from [0,255] in to [0, 1] range</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="9" data-code-annotation="4">Applies the convolution layer. Here <code>padding="same"</code> ensures that the dimensions of the input and output matrices remain same</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="10" data-code-annotation="5">Applies <code>MaxPooling</code>, which reduces the spatial dimensions by carrying forward the maximum value over an input window</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="15" data-code-annotation="6">Applies the <code>Flatten</code> layer to convert the 2D array (from pooling) in to a single column vector, and passes through couple of <code>Dense</code> layers to train the neural network for the specific classification problem. Note that the output layer has number of neurons equal to <code>numClasses</code>, which corresponds to the number of unique classes in the output.</span>
</dd>
</dl>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>Rescaling</code> layer will rescale the intensities to [0, 1].</p>
</div>
</div>
<div class="footer">
<p>Architecture inspired by <a href="https://www.tensorflow.org/tutorials/images/classification">https://www.tensorflow.org/tutorials/images/classification</a>.</p>
</div>
<section id="inspect-the-model" class="level2">
<h2 class="anchored" data-anchor-id="inspect-the-model">Inspect the model</h2>
<div id="78e49d2c" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>model.summary(print_fn<span class="op">=</span>skip_empty)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model: "sequential"
_________________________________________________________________
Layer (type)                Output Shape              Param #
=================================================================
rescaling (Rescaling)       (None, 80, 80, 1)         0
conv1 (Conv2D)              (None, 80, 80, 16)        160
pool1 (MaxPooling2D)        (None, 40, 40, 16)        0
conv2 (Conv2D)              (None, 40, 40, 32)        4640
pool2 (MaxPooling2D)        (None, 20, 20, 32)        0
conv3 (Conv2D)              (None, 20, 20, 64)        18496
pool3 (MaxPooling2D)        (None, 10, 10, 64)        0
flatten (Flatten)           (None, 6400)              0
dense (Dense)               (None, 128)               819328
dense_1 (Dense)             (None, 57)                7353
=================================================================
Total params: 849,977
Trainable params: 849,977
Non-trainable params: 0
_________________________________________________________________</code></pre>
</div>
</div>
</section>
<section id="plot-the-cnn" class="level2">
<h2 class="anchored" data-anchor-id="plot-the-cnn">Plot the CNN</h2>
<div class="columns">
<div class="column">
<div id="82af9579" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>plot_model(model, layer_range<span class="op">=</span>(<span class="st">""</span>, <span class="st">"pool2"</span>), show_shapes<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-37-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div><div class="column">
<div id="11530d5c" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>plot_model(model, layer_range<span class="op">=</span>(<span class="st">"pool2"</span>, <span class="st">""</span>), show_shapes<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-38-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="fit-the-cnn" class="level2">
<h2 class="anchored" data-anchor-id="fit-the-cnn">Fit the CNN</h2>
<div id="48479105" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="annotated-cell-14"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-14" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-14-1" class="code-annotation-target"><a href="#annotated-cell-14-1" aria-hidden="true" tabindex="-1"></a>loss <span class="op">=</span> tf.keras.losses.SparseCategoricalCrossentropy(from_logits<span class="op">=</span><span class="va">True</span>)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-14" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-14-2" class="code-annotation-target"><a href="#annotated-cell-14-2" aria-hidden="true" tabindex="-1"></a>topk <span class="op">=</span> tf.keras.metrics.SparseTopKCategoricalAccuracy(k<span class="op">=</span><span class="dv">5</span>)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-14" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-14-3" class="code-annotation-target"><a href="#annotated-cell-14-3" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span><span class="st">'adam'</span>, loss<span class="op">=</span>loss, metrics<span class="op">=</span>[<span class="st">'accuracy'</span>, topk])</span>
<span id="annotated-cell-14-4"><a href="#annotated-cell-14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-14-5"><a href="#annotated-cell-14-5" aria-hidden="true" tabindex="-1"></a>epochs <span class="op">=</span> <span class="dv">100</span></span>
<span id="annotated-cell-14-6"><a href="#annotated-cell-14-6" aria-hidden="true" tabindex="-1"></a>es <span class="op">=</span> EarlyStopping(patience<span class="op">=</span><span class="dv">15</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>,</span>
<span id="annotated-cell-14-7"><a href="#annotated-cell-14-7" aria-hidden="true" tabindex="-1"></a>    monitor<span class="op">=</span><span class="st">"val_accuracy"</span>, verbose<span class="op">=</span><span class="dv">2</span>)</span>
<span id="annotated-cell-14-8"><a href="#annotated-cell-14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-14-9"><a href="#annotated-cell-14-9" aria-hidden="true" tabindex="-1"></a>hist <span class="op">=</span> model.fit(train_ds.shuffle(<span class="dv">1000</span>), validation_data<span class="op">=</span>val_ds,</span>
<span id="annotated-cell-14-10"><a href="#annotated-cell-14-10" aria-hidden="true" tabindex="-1"></a>  epochs<span class="op">=</span>epochs, callbacks<span class="op">=</span>[es], verbose<span class="op">=</span><span class="dv">0</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-14" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-lines="1" data-code-annotation="1">Defines the loss function with an added command <code>from_logits=True</code>. Doing this instead of defining a <code>softmax</code> function at the output <code>Dense</code> layer of the neural network is expected to be more numerically stable</span>
</dd>
<dt data-target-cell="annotated-cell-14" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-lines="2" data-code-annotation="2">Specifies a new metric to keep track of accuracy of the top 5 predicted classes. This means that, for each input image, the metric will consider whether the true class is among the top 5 predicted classes by the model</span>
</dd>
<dt data-target-cell="annotated-cell-14" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-lines="3" data-code-annotation="3">Compiles the model as usual with an optimizer, a loss function and metrics to monitor</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Restoring model weights from the end of the best epoch: 22.
Epoch 37: early stopping</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Instead of using softmax activation, just added <code>from_logits=True</code> to the loss function; this is more numerically stable.</p>
</div>
</div>
</section>
<section id="plot-the-lossaccuracy-curves-setup" class="level2">
<h2 class="anchored" data-anchor-id="plot-the-lossaccuracy-curves-setup">Plot the loss/accuracy curves (setup)</h2>
<div id="e4dbfb72" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_history(hist):</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>    epochs <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(hist.history[<span class="st">"loss"</span>]))</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    plt.plot(epochs, hist.history[<span class="st">"accuracy"</span>], label<span class="op">=</span><span class="st">"Train"</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    plt.plot(epochs, hist.history[<span class="st">"val_accuracy"</span>], label<span class="op">=</span><span class="st">"Val"</span>)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    plt.legend(loc<span class="op">=</span><span class="st">"lower right"</span>)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"Accuracy"</span>)</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>    plt.plot(epochs, hist.history[<span class="st">"loss"</span>], label<span class="op">=</span><span class="st">"Train"</span>)</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>    plt.plot(epochs, hist.history[<span class="st">"val_loss"</span>], label<span class="op">=</span><span class="st">"Val"</span>)</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>    plt.legend(loc<span class="op">=</span><span class="st">"upper right"</span>)</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"Loss"</span>)</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plot-the-lossaccuracy-curves" class="level2">
<h2 class="anchored" data-anchor-id="plot-the-lossaccuracy-curves">Plot the loss/accuracy curves</h2>
<div id="ae7dd56a" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>plot_history(hist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-42-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="look-at-the-metrics" class="level2">
<h2 class="anchored" data-anchor-id="look-at-the-metrics">Look at the metrics</h2>
<div id="05986668" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.evaluate(train_ds, verbose<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.evaluate(val_ds, verbose<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.evaluate(test_ds, verbose<span class="op">=</span><span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[0.009564659558236599, 1.0, 1.0]
[0.6313576698303223, 0.8245614171028137, 0.9824561476707458]
[0.4097440540790558, 0.9122806787490845, 0.9824561476707458]</code></pre>
</div>
</div>
</section>
<section id="predict-on-the-test-set" class="level2">
<h2 class="anchored" data-anchor-id="predict-on-the-test-set">Predict on the test set</h2>
<div id="c42ce29b" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>model.predict(X_test[<span class="dv">17</span>], verbose<span class="op">=</span><span class="dv">0</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="a0663b00" class="cell" data-execution_count="44">
<div class="cell-output cell-output-stdout">
<pre><code>WARNING:tensorflow:Model was constructed with shape (None, 80, 80, 1) for input KerasTensor(type_spec=TensorSpec(shape=(None, 80, 80, 1), dtype=tf.float32, name='rescaling_input'), name='rescaling_input', description="created by layer 'rescaling_input'"), but it was called on an input with incompatible shape (None, 80, 1, 1).</code></pre>
</div>
</div>
<div id="eb6c3ab2" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>X_test[<span class="dv">17</span>].shape, X_test[<span class="dv">17</span>][np.newaxis, :].shape, X_test[[<span class="dv">17</span>]].shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>((80, 80, 1), (1, 80, 80, 1), (1, 80, 80, 1))</code></pre>
</div>
</div>
<div id="871bfd14" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>model.predict(X_test[[<span class="dv">17</span>]], verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>array([[ -1.12, -19.32,  -5.97,  -6.93,   3.49,  -4.36, -29.57,   1.64,
         -9.7 ,   1.11,  -9.43,  -0.83,  -8.08,  -5.06,   2.95,  -9.71,
         -7.79,   9.11,  -3.85,  -6.81,  -5.35,  -3.  ,   0.9 , -12.59,
          0.56,   4.4 , -14.07,  -2.07,  -3.77,  -0.29, -14.97,  -5.24,
         -6.34, -18.72, -17.86,   0.93,  -2.31,  -2.88,   1.95,   1.7 ,
        -10.32, -13.69, -11.29,  -7.79,  -3.7 ,  -6.9 ,   3.02,   2.55,
         -3.09,   5.07,  -9.64,  -2.55,   3.15,  -7.51,  -2.29,  -7.77,
         -5.33]], dtype=float32)</code></pre>
</div>
</div>
</section>
<section id="predict-on-the-test-set-ii" class="level2">
<h2 class="anchored" data-anchor-id="predict-on-the-test-set-ii">Predict on the test set II</h2>
<div id="4c9a7acc" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>model.predict(X_test[[<span class="dv">17</span>]], verbose<span class="op">=</span><span class="dv">0</span>).argmax()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>17</code></pre>
</div>
</div>
<div id="59b535cf" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>test_ds.class_names[model.predict(X_test[[<span class="dv">17</span>]], verbose<span class="op">=</span><span class="dv">0</span>).argmax()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>'kou'</code></pre>
</div>
</div>
<div id="da8edd56" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>plt.imshow(X_test[<span class="dv">17</span>], cmap<span class="op">=</span><span class="st">"gray"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-50-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="section-1" class="level1">
<h1></h1>
<h2 class="anchored" data-anchor-id="section-1">
Error analysis (setup)
</h2>
<div id="5748adc9" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_error_analysis(X_train, y_train, X_test, y_test, y_pred, class_names):</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  plt.figure(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">10</span>))</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  num_errors <span class="op">=</span> np.<span class="bu">sum</span>(y_pred <span class="op">!=</span> y_test)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  err_num <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(X_test.shape[<span class="dv">0</span>]):</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> y_pred[i] <span class="op">!=</span> y_test[i]:</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>          ax <span class="op">=</span> plt.subplot(num_errors, <span class="dv">2</span>, <span class="dv">2</span><span class="op">*</span>err_num <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>          plt.imshow(X_test[i].astype(<span class="st">"uint8"</span>), cmap<span class="op">=</span><span class="st">"gray"</span>)</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>          plt.title(<span class="ss">f"Guessed '</span><span class="sc">{</span>class_names[y_pred[i]]<span class="sc">}</span><span class="ss">' True '</span><span class="sc">{</span>class_names[y_test[i]]<span class="sc">}</span><span class="ss">'"</span>)</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>          plt.axis(<span class="st">"off"</span>)</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>          actual_pred_char_ind <span class="op">=</span> np.argmax(y_test <span class="op">==</span> y_pred[i])</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>          ax <span class="op">=</span> plt.subplot(num_errors, <span class="dv">2</span>, <span class="dv">2</span><span class="op">*</span>err_num <span class="op">+</span> <span class="dv">2</span>)</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>          plt.imshow(X_val[actual_pred_char_ind].astype(<span class="st">"uint8"</span>), cmap<span class="op">=</span><span class="st">"gray"</span>)</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>          plt.title(<span class="ss">f"A real '</span><span class="sc">{</span>class_names[y_pred[i]]<span class="sc">}</span><span class="ss">'"</span>)</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>          plt.axis(<span class="st">"off"</span>)</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>          err_num <span class="op">+=</span> <span class="dv">1</span>     </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="error-analysis-i" class="level2">
<h2 class="anchored" data-anchor-id="error-analysis-i">Error analysis I</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="error-analysis-found-data-problem.png" class="img-fluid figure-img"></p>
<figcaption>Extract from first assessment of test errors.</figcaption>
</figure>
</div>
</section>
<section id="error-analysis-ii" class="level2">
<h2 class="anchored" data-anchor-id="error-analysis-ii">Error analysis II</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="error-analysis-found-another-data-problem.png" class="img-fluid figure-img"></p>
<figcaption>Extract from second assessment of test errors.</figcaption>
</figure>
</div>
</section>
<section id="error-analysis-iii" class="level2">
<h2 class="anchored" data-anchor-id="error-analysis-iii">Error analysis III</h2>
<div id="0e244a3b" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_val, verbose<span class="op">=</span><span class="dv">0</span>).argmax(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>plot_error_analysis(X_train, y_train, X_val, y_val, y_pred, val_ds.class_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-52-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="error-analysis-iv" class="level2">
<h2 class="anchored" data-anchor-id="error-analysis-iv">Error analysis IV</h2>
<div id="2804279e" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_test, verbose<span class="op">=</span><span class="dv">0</span>).argmax(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>plot_error_analysis(X_train, y_train, X_test, y_test, y_pred, test_ds.class_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-53-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="confidence-of-predictions" class="level2">
<h2 class="anchored" data-anchor-id="confidence-of-predictions">Confidence of predictions</h2>
<div id="4c8fbee6" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> tf.keras.activations.softmax(model(X_test)).numpy()</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>y_pred_class <span class="op">=</span> y_pred.argmax(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>y_pred_prob <span class="op">=</span> y_pred[np.arange(y_pred.shape[<span class="dv">0</span>]), y_pred_class]</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>confidence_when_correct <span class="op">=</span> y_pred_prob[y_pred_class <span class="op">==</span> y_test]</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>confidence_when_wrong <span class="op">=</span> y_pred_prob[y_pred_class <span class="op">!=</span> y_test]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="columns">
<div class="column">
<div id="9d63fee6" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>plt.hist(confidence_when_correct)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-55-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div><div class="column">
<div id="fc26900e" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>plt.hist(confidence_when_wrong)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-56-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="hyperparameter-tuning" class="level1" data-visibility="uncounted">
<h1 data-visibility="uncounted">Hyperparameter tuning</h1>
<section id="trial-error" class="level2">
<h2 class="anchored" data-anchor-id="trial-error">Trial &amp; error</h2>
<div class="columns">
<div class="column">
<p><br> <br></p>
<p>Frankly, a lot of this is just ‘enlightened’ trial and error.</p>
</div><div class="column">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="twitter-advice.png" class="img-fluid figure-img"></p>
<figcaption>Or ‘received wisdom’ from experts…</figcaption>
</figure>
</div>
</div>
</div>
<div class="footer">
<p>Source: <a href="https://twitter.com/tetraduzione/status/1525501171221274627?s=20&amp;t=ulVFesw-f7hCuG9KyaoYbQ">Twitter</a>.</p>
</div>
</section>
<section id="keras-tuner" class="level2">
<h2 class="anchored" data-anchor-id="keras-tuner">Keras Tuner</h2>
<div id="f13b1b89" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install keras<span class="op">-</span>tuner</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="a1b13294" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> keras_tuner <span class="im">as</span> kt</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_model(hp):</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> Sequential()</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>    model.add(</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>        Dense(</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>            hp.Choice(<span class="st">"neurons"</span>, [<span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">16</span>, <span class="dv">32</span>, <span class="dv">64</span>, <span class="dv">128</span>, <span class="dv">256</span>]),</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>            activation<span class="op">=</span>hp.Choice(<span class="st">"activation"</span>,</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>                [<span class="st">"relu"</span>, <span class="st">"leaky_relu"</span>, <span class="st">"tanh"</span>]),</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>    model.add(Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"exponential"</span>))</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>    learning_rate <span class="op">=</span> hp.Float(<span class="st">"lr"</span>,</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>        min_value<span class="op">=</span><span class="fl">1e-4</span>, max_value<span class="op">=</span><span class="fl">1e-2</span>, sampling<span class="op">=</span><span class="st">"log"</span>)</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>    opt <span class="op">=</span> tf.keras.optimizers.Adam(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span><span class="st">"poisson"</span>)</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="do-a-random-search" class="level2">
<h2 class="anchored" data-anchor-id="do-a-random-search">Do a random search</h2>
<div class="columns">
<div class="column" style="width:60%;">
<div id="eda676c4" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>tuner <span class="op">=</span> kt.RandomSearch(</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  build_model,</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  objective<span class="op">=</span><span class="st">"val_loss"</span>,</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  max_trials<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  directory<span class="op">=</span><span class="st">"random-search"</span>)</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>es <span class="op">=</span> EarlyStopping(patience<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  restore_best_weights<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>tuner.search(X_train_sc, y_train,</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>  epochs<span class="op">=</span><span class="dv">100</span>, callbacks <span class="op">=</span> [es],</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>  validation_data<span class="op">=</span>(X_val_sc, y_val))</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>best_model <span class="op">=</span> tuner.get_best_models()[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Trial 10 Complete [00h 00m 05s]
val_loss: 0.33390817046165466

Best val_loss So Far: 0.32481735944747925
Total elapsed time: 00h 00m 39s</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>WARNING:absl:At this time, the v2.11+ optimizer `tf.keras.optimizers.Adam` runs slowly on M1/M2 Macs, please use the legacy Keras optimizer instead, located at `tf.keras.optimizers.legacy.Adam`.
WARNING:absl:There is a known slowdown when using v2.11+ Keras optimizers on M1/M2 Macs. Falling back to the legacy Keras optimizer, i.e., `tf.keras.optimizers.legacy.Adam`.</code></pre>
</div>
</div>
</div><div class="column" style="width:40%;">
<div id="66a2041d" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>tuner.results_summary(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Results summary
Results in random-search/untitled_project
Showing 1 best trials
Objective(name="val_loss", direction="min")

Trial 02 summary
Hyperparameters:
neurons: 8
activation: tanh
lr: 0.0021043482724264983
Score: 0.32481735944747925</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="tune-layers-separately" class="level2">
<h2 class="anchored" data-anchor-id="tune-layers-separately">Tune layers separately</h2>
<div id="8ef106d3" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_model(hp):</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> Sequential()</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(hp.Int(<span class="st">"numHiddenLayers"</span>, <span class="dv">1</span>, <span class="dv">3</span>)):</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Tune number of units in each layer separately.</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>      model.add(</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>          Dense(</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>              hp.Choice(<span class="ss">f"neurons_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>, [<span class="dv">8</span>, <span class="dv">16</span>, <span class="dv">32</span>, <span class="dv">64</span>]),</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>              activation<span class="op">=</span><span class="st">"relu"</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>    model.add(Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"exponential"</span>))</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>    opt <span class="op">=</span> tf.keras.optimizers.Adam(learning_rate<span class="op">=</span><span class="fl">0.0005</span>)</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span><span class="st">"poisson"</span>)</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="do-a-bayesian-search" class="level2">
<h2 class="anchored" data-anchor-id="do-a-bayesian-search">Do a Bayesian search</h2>
<div class="columns">
<div class="column" style="width:60%;">
<div id="56b52aa9" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>tuner <span class="op">=</span> kt.BayesianOptimization(</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  build_model,</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  objective<span class="op">=</span><span class="st">"val_loss"</span>,</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  directory<span class="op">=</span><span class="st">"bayesian-search"</span>,</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>  max_trials<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>es <span class="op">=</span> EarlyStopping(patience<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>  restore_best_weights<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>tuner.search(X_train_sc, y_train,</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>  epochs<span class="op">=</span><span class="dv">100</span>, callbacks <span class="op">=</span> [es],</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>  validation_data<span class="op">=</span>(X_val_sc, y_val))</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>best_model <span class="op">=</span> tuner.get_best_models()[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Trial 10 Complete [00h 00m 08s]
val_loss: 0.3177475035190582

Best val_loss So Far: 0.3177475035190582
Total elapsed time: 00h 01m 35s</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>WARNING:absl:At this time, the v2.11+ optimizer `tf.keras.optimizers.Adam` runs slowly on M1/M2 Macs, please use the legacy Keras optimizer instead, located at `tf.keras.optimizers.legacy.Adam`.
WARNING:absl:There is a known slowdown when using v2.11+ Keras optimizers on M1/M2 Macs. Falling back to the legacy Keras optimizer, i.e., `tf.keras.optimizers.legacy.Adam`.</code></pre>
</div>
</div>
</div><div class="column" style="width:40%;">
<div id="a1fdb892" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>tuner.results_summary(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Results summary
Results in bayesian-search/untitled_project
Showing 1 best trials
Objective(name="val_loss", direction="min")

Trial 09 summary
Hyperparameters:
numHiddenLayers: 3
neurons_0: 32
neurons_1: 8
neurons_2: 8
Score: 0.3177475035190582</code></pre>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="leveraging-solutions-from-benchmark-problems" class="level1" data-visibility="uncounted">
<h1 data-visibility="uncounted">Leveraging Solutions From Benchmark Problems</h1>
<section id="demo-object-classification" class="level2">
<h2 class="anchored" data-anchor-id="demo-object-classification">Demo: Object classification</h2>
<div class="columns">
<div class="column">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="teach-images.png" class="img-fluid figure-img"></p>
<figcaption>Example object classification run.</figcaption>
</figure>
</div>
</div><div class="column">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://info.deeplearning.ai/hs-fs/hubfs/NOCODE.gif?width=1199&amp;upscale=true&amp;name=NOCODE.gif" class="img-fluid figure-img"></p>
<figcaption>Example of object classification.</figcaption>
</figure>
</div>
</div>
</div>
<div class="footer">
<p>Source: Teachable Machine, <a href="https://teachablemachine.withgoogle.com/">https://teachablemachine.withgoogle.com/</a>.</p>
</div>
</section>
<section id="how-does-that-work" class="level2">
<h2 class="anchored" data-anchor-id="how-does-that-work">How does that work?</h2>
<blockquote class="blockquote">
<p>… these models use a technique called transfer learning. There’s a pretrained neural network, and when you create your own classes, you can sort of picture that your classes are becoming the last layer or step of the neural net. Specifically, both the image and pose models are learning off of pretrained mobilenet models …</p>
</blockquote>
<p><a href="https://teachablemachine.withgoogle.com/faq#Diving-Deeper">Teachable Machine FAQ</a></p>
</section>
<section id="benchmarks" class="level2">
<h2 class="anchored" data-anchor-id="benchmarks">Benchmarks</h2>
<p><a href="https://www.cs.toronto.edu/~kriz/cifar.html">CIFAR-11 / CIFAR-100 dataset</a> from Canadian Institute for Advanced Research</p>
<ul>
<li>9 classes: 60000 32x32 colour images</li>
<li>99 classes: 60000 32x32 colour images</li>
</ul>
<p><a href="https://www.image-net.org/index.php">ImageNet</a> and the <em>ImageNet Large Scale Visual Recognition Challenge (ILSVRC)</em>; originally <a href="https://image-net.org/challenges/LSVRC/2014/browse-synsets">1,000 synsets</a>.</p>
<ul>
<li>In 2021: 14,197,122 labelled images from 21,841 synsets.</li>
<li>See <a href="https://keras.io/api/applications/">Keras applications</a> for downloadable models.</li>
</ul>
</section>
<section id="lenet-6-1998" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="lenet-6-1998">LeNet-6 (1998)</h2>
<table class="table">
<colgroup>
<col style="width: 9%">
<col style="width: 23%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 18%">
<col style="width: 11%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th>Layer</th>
<th>Type</th>
<th>Channels</th>
<th>Size</th>
<th>Kernel size</th>
<th>Stride</th>
<th>Activation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>In</td>
<td>Input</td>
<td>0</td>
<td>32×32</td>
<td>–</td>
<td>–</td>
<td>–</td>
</tr>
<tr class="even">
<td>C0</td>
<td>Convolution</td>
<td>6</td>
<td>28×28</td>
<td>5×5</td>
<td>1</td>
<td>tanh</td>
</tr>
<tr class="odd">
<td>S1</td>
<td>Avg pooling</td>
<td>6</td>
<td>14×14</td>
<td>2×2</td>
<td>2</td>
<td>tanh</td>
</tr>
<tr class="even">
<td>C2</td>
<td>Convolution</td>
<td>16</td>
<td>10×10</td>
<td>5×5</td>
<td>1</td>
<td>tanh</td>
</tr>
<tr class="odd">
<td>S3</td>
<td>Avg pooling</td>
<td>16</td>
<td>5×5</td>
<td>2×2</td>
<td>2</td>
<td>tanh</td>
</tr>
<tr class="even">
<td>C4</td>
<td>Convolution</td>
<td>120</td>
<td>1×1</td>
<td>5×5</td>
<td>1</td>
<td>tanh</td>
</tr>
<tr class="odd">
<td>F5</td>
<td>Fully connected</td>
<td>–</td>
<td>84</td>
<td>–</td>
<td>–</td>
<td>tanh</td>
</tr>
<tr class="even">
<td>Out</td>
<td>Fully connected</td>
<td>–</td>
<td>9</td>
<td>–</td>
<td>–</td>
<td>RBF</td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>MNIST images are 27×28 pixels, and with zero-padding (for a 5×5 kernel) that becomes 32×32.</p>
</div>
</div>
<div class="footer">
<p>Source: Aurélien Géron (2018), <em>Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</em>, 2nd Edition, Chapter 14.</p>
</div>
</section>
<section id="alexnet-2011" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="alexnet-2011">AlexNet (2011)</h2>
<table class="table">
<colgroup>
<col style="width: 8%">
<col style="width: 19%">
<col style="width: 10%">
<col style="width: 12%">
<col style="width: 15%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th>Layer</th>
<th>Type</th>
<th>Channels</th>
<th>Size</th>
<th>Kernel</th>
<th>Stride</th>
<th>Padding</th>
<th>Activation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>In</td>
<td>Input</td>
<td>2</td>
<td>227×227</td>
<td>–</td>
<td>–</td>
<td>–</td>
<td>–</td>
</tr>
<tr class="even">
<td>C0</td>
<td>Convolution</td>
<td>96</td>
<td>55×55</td>
<td>11×11</td>
<td>4</td>
<td>valid</td>
<td>ReLU</td>
</tr>
<tr class="odd">
<td>S1</td>
<td>Max pool</td>
<td>96</td>
<td>27×27</td>
<td>3×3</td>
<td>2</td>
<td>valid</td>
<td>–</td>
</tr>
<tr class="even">
<td>C2</td>
<td>Convolution</td>
<td>256</td>
<td>27×27</td>
<td>5×5</td>
<td>1</td>
<td>same</td>
<td>ReLU</td>
</tr>
<tr class="odd">
<td>S3</td>
<td>Max pool</td>
<td>256</td>
<td>13×13</td>
<td>3×3</td>
<td>2</td>
<td>valid</td>
<td>–</td>
</tr>
<tr class="even">
<td>C4</td>
<td>Convolution</td>
<td>384</td>
<td>13×13</td>
<td>3×3</td>
<td>1</td>
<td>same</td>
<td>ReLU</td>
</tr>
<tr class="odd">
<td>C5</td>
<td>Convolution</td>
<td>384</td>
<td>13×13</td>
<td>3×3</td>
<td>1</td>
<td>same</td>
<td>ReLU</td>
</tr>
<tr class="even">
<td>C6</td>
<td>Convolution</td>
<td>256</td>
<td>13×13</td>
<td>3×3</td>
<td>1</td>
<td>same</td>
<td>ReLU</td>
</tr>
<tr class="odd">
<td>S7</td>
<td>Max pool</td>
<td>256</td>
<td>6×6</td>
<td>3×3</td>
<td>2</td>
<td>valid</td>
<td>–</td>
</tr>
<tr class="even">
<td>F8</td>
<td>Fully conn.</td>
<td>–</td>
<td>4,096</td>
<td>–</td>
<td>–</td>
<td>–</td>
<td>ReLU</td>
</tr>
<tr class="odd">
<td>F9</td>
<td>Fully conn.</td>
<td>–</td>
<td>4,096</td>
<td>–</td>
<td>–</td>
<td>–</td>
<td>ReLU</td>
</tr>
<tr class="even">
<td>Out</td>
<td>Fully conn.</td>
<td>–</td>
<td>0,000</td>
<td>–</td>
<td>–</td>
<td>–</td>
<td>Softmax</td>
</tr>
</tbody>
</table>
<div class="footer">
<p>Winner of the ILSVRC 2011 challenge (top-five error 17%), developed by Alex Krizhevsky, Ilya Sutskever, and Geoffrey Hinton.</p>
</div>
</section>
<section id="data-augmentation" class="level2">
<h2 class="anchored" data-anchor-id="data-augmentation">Data Augmentation</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data-augmentation.png" class="img-fluid figure-img"></p>
<figcaption>Examples of data augmentation.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Buah et al.&nbsp;(2019), <em>Can Artificial Intelligence Assist Project Developers in Long-Term Management of Energy Projects? The Case of CO2 Capture and Storage</em>.</p>
</div>
</section>
<section id="inception-module-2013" class="level2">
<h2 class="anchored" data-anchor-id="inception-module-2013">Inception module (2013)</h2>
<p>Used in ILSVRC 2013 winning solution (top-5 error &lt; 7%).</p>
<div class="columns">
<div class="column" style="width:59%;">
<p><img src="inception-module-fig-2b.png" class="img-fluid"></p>
</div><div class="column" style="width:39%;">
<p><br></p>
<p><img src="inception-meme.jpeg" class="img-fluid"></p>
</div>
</div>
<p>VGGNet was the runner-up.</p>
<div class="footer">
<p>Source: Szegedy, C. et al.&nbsp;(2014), <a href="https://arxiv.org/pdf/1409.4842.pdf"><em>Going deeper with convolutions</em></a>. and <a href="https://knowyourmeme.com/memes/we-need-to-go-deeper">KnowYourMeme.com</a></p>
</div>
</section>
<section id="googlenet-inception_v0-2014" class="level2">
<h2 class="anchored" data-anchor-id="googlenet-inception_v0-2014">GoogLeNet / Inception_v0 (2014)</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Geron-mls2_1414.png" class="img-fluid figure-img"></p>
<figcaption>Schematic of the GoogLeNet architecture.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Aurélien Géron (2018), <em>Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</em>, 2nd Edition, Figure 14-14.</p>
</div>
</section>
<section id="depth-is-important-for-image-tasks" class="level2">
<h2 class="anchored" data-anchor-id="depth-is-important-for-image-tasks">Depth is important for image tasks</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="goodfellow-depth-matters.png" class="img-fluid figure-img"></p>
<figcaption>Deeper models aren’t just better because they have more parameters. Model depth given in the legend. Accuracy is on the Street View House Numbers dataset.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Goodfellow et al.&nbsp;(2015), <a href="http://www.deeplearningbook.org">Deep Learning</a>, Figure 6.7.</p>
</div>
</section>
<section id="residual-connection" class="level2">
<h2 class="anchored" data-anchor-id="residual-connection">Residual connection</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Geron-mls2_1415.png" class="img-fluid figure-img"></p>
<figcaption>Illustration of a residual connection.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Aurélien Géron (2018), <em>Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</em>, 2nd Edition, Figure 14-15.</p>
</div>
</section>
<section id="resnet-2014" class="level2">
<h2 class="anchored" data-anchor-id="resnet-2014">ResNet (2014)</h2>
<p>ResNet won the ILSVRC 2014 challenge (top-5 error 3.6%), developed by <a href="https://arxiv.org/abs/1512.03385">Kaiming He et al.</a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Geron-mls2_1417.png" class="img-fluid figure-img"></p>
<figcaption>Diagram of the ResNet architecture.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Aurélien Géron (2018), <em>Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</em>, 2nd Edition, Figure 14-17.</p>
</div>
</section>
</section>
<section id="transfer-learning" class="level1" data-visibility="uncounted">
<h1 data-visibility="uncounted">Transfer learning</h1>
<section id="pretrained-model" class="level2">
<h2 class="anchored" data-anchor-id="pretrained-model">Pretrained model</h2>
<div id="3a4893b4" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.applications <span class="im">import</span> mobilenet</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> mobilenet.MobileNet(weights<span class="op">=</span><span class="st">"imagenet"</span>)</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>imageFilenames <span class="op">=</span> [<span class="st">"patrick-0.jpg"</span>, <span class="st">"umbrella-0.jpg"</span>, <span class="st">"hand-15.jpg"</span>]</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>images <span class="op">=</span> [np.asarray(Image.<span class="bu">open</span>(name)) <span class="cf">for</span> name <span class="kw">in</span> imageFilenames]</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>images_resized <span class="op">=</span> tf.image.resize(images, [<span class="dv">224</span>, <span class="dv">224</span>])</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>inputs <span class="op">=</span> mobilenet.preprocess_input(images_resized)</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>Y_proba <span class="op">=</span> model.predict(inputs, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>top_K <span class="op">=</span> mobilenet.decode_predictions(Y_proba, top<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> image_index <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(images)):</span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Image #</span><span class="sc">{</span>image_index<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> class_id, name, y_proba <span class="kw">in</span> top_K[image_index]:</span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f" </span><span class="sc">{</span>class_id<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span><span class="bu">int</span>(y_proba<span class="op">*</span><span class="dv">100</span>)<span class="sc">}</span><span class="ss">%"</span>)</span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="predicted-classes-mobilenet-1" class="level2">
<h2 class="anchored" data-anchor-id="predicted-classes-mobilenet-1">Predicted classes (MobileNet)</h2>
<div class="columns">
<div class="column" style="width:15%;">

</div><div class="column" style="width:50%;">
<p><br><br></p>
<div id="0cb0ef15" class="cell" data-execution_count="70">
<div class="cell-output cell-output-stdout">
<pre><code>Image #0:
 n03483316 - hand_blower 21%
 n03271574 - electric_fan 8%
 n07579787 - plate 4%

Image #1:
 n03942813 - ping-pong_ball 88%
 n02782093 - balloon 3%
 n04023962 - punching_bag 1%

Image #2:
 n04557648 - water_bottle 31%
 n04336792 - stretcher 14%
 n03868863 - oxygen_mask 7%
</code></pre>
</div>
</div>
</div><div class="column" style="width:20%;">
<p><img src="charger-4.jpg" data-lazy-loaded="" style="padding: 0px; margin: 0px"> <img src="table-tennis-17.jpg" data-lazy-loaded="" style="padding: 0px; margin: 0px"> <img src="water-bottle-15.jpg" data-lazy-loaded="" style="padding: 0px; margin=0px"></p>
</div><div class="column" style="width:15%;">

</div>
</div>
</section>
<section id="predicted-classes-mobilenetv2-1" class="level2">
<h2 class="anchored" data-anchor-id="predicted-classes-mobilenetv2-1">Predicted classes (MobileNetV2)</h2>
<div class="columns">
<div class="column" style="width:15%;">

</div><div class="column" style="width:50%;">
<p><br><br></p>
<div id="53da3822" class="cell" data-execution_count="71">
<div class="cell-output cell-output-stdout">
<pre><code>Image #0:
 n03868863 - oxygen_mask 37%
 n03483316 - hand_blower 7%
 n03271574 - electric_fan 7%

Image #1:
 n03942813 - ping-pong_ball 29%
 n04270147 - spatula 12%
 n03970156 - plunger 8%

Image #2:
 n02815834 - beaker 40%
 n03868863 - oxygen_mask 16%
 n04557648 - water_bottle 4%
</code></pre>
</div>
</div>
</div><div class="column" style="width:20%;">
<p><img src="charger-4.jpg" data-lazy-loaded="" style="padding: 0px; margin: 0px"> <img src="table-tennis-17.jpg" data-lazy-loaded="" style="padding: 0px; margin: 0px"> <img src="water-bottle-15.jpg" data-lazy-loaded="" style="padding: 0px; margin=0px"></p>
</div><div class="column" style="width:15%;">

</div>
</div>
</section>
<section id="predicted-classes-inceptionv3-1" class="level2">
<h2 class="anchored" data-anchor-id="predicted-classes-inceptionv3-1">Predicted classes (InceptionV3)</h2>
<div class="columns">
<div class="column" style="width:15%;">

</div><div class="column" style="width:50%;">
<p><br><br></p>
<div id="139abef6" class="cell" data-execution_count="72">
<div class="cell-output cell-output-stdout">
<pre><code>Image #0:
 n02815834 - beaker 41%
 n03630383 - lab_coat 6%
 n03179701 - desk 6%

Image #1:
 n03942813 - ping-pong_ball 82%
 n02782093 - balloon 10%
 n03447721 - gong 0%

Image #2:
 n04557648 - water_bottle 72%
 n03983396 - pop_bottle 10%
 n03868863 - oxygen_mask 1%
</code></pre>
</div>
</div>
</div><div class="column" style="width:20%;">
<p><img src="charger-4.jpg" data-lazy-loaded="" style="padding: 0px; margin: 0px"> <img src="table-tennis-17.jpg" data-lazy-loaded="" style="padding: 0px; margin: 0px"> <img src="water-bottle-15.jpg" data-lazy-loaded="" style="padding: 0px; margin=0px"></p>
</div><div class="column" style="width:15%;">

</div>
</div>
</section>
<section id="transfer-learned-model" class="level2">
<h2 class="anchored" data-anchor-id="transfer-learned-model">Transfer learned model</h2>
<div class="columns">
<div class="column" style="width:65%;">
<div id="56e4a80f" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>modelFile <span class="op">=</span> <span class="st">"teachable-machine-model-3143.h5"</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.models.load_model(modelFile)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>model.layers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="71">
<pre><code>[&lt;keras.engine.sequential.Sequential at 0x2bdbad240&gt;,
 &lt;keras.engine.sequential.Sequential at 0x29a23d630&gt;]</code></pre>
</div>
</div>
<div id="8d073529" class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>model.layers[<span class="dv">0</span>].layers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="72">
<pre><code>[&lt;keras.engine.functional.Functional at 0x29a23fbb0&gt;,
 &lt;keras.layers.pooling.global_average_pooling2d.GlobalAveragePooling2D at 0x2be4387c0&gt;]</code></pre>
</div>
</div>
<div id="2efa5a03" class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>model.layers[<span class="dv">1</span>].layers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="73">
<pre><code>[&lt;keras.layers.core.dense.Dense at 0x2bdfb7dc0&gt;,
 &lt;keras.layers.core.dense.Dense at 0x2bdcfbdf0&gt;]</code></pre>
</div>
</div>
</div><div class="column" style="width:35%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="turtles-all-the-way-down.jpeg" class="img-fluid figure-img"></p>
<figcaption>Models inside of models…</figcaption>
</figure>
</div>
</div>
</div>
<div class="footer">
<p>Source: <a href="https://www.behance.net/gallery/66946885/Turtles-All-the-Way-Down">Behance</a></p>
</div>
</section>
<section id="transfer-learned-model-ii" class="level2">
<h2 class="anchored" data-anchor-id="transfer-learned-model-ii">Transfer learned model II</h2>
<div id="38f3c8a8" class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>model.layers[<span class="dv">0</span>].layers[<span class="dv">0</span>].layers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="74">
<pre><code>[&lt;keras.engine.input_layer.InputLayer at 0x2bfe1bb80&gt;,
 &lt;keras.layers.reshaping.zero_padding2d.ZeroPadding2D at 0x2d0f11930&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2d0f11c00&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2d0f11db0&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2d0f12380&gt;,
 &lt;keras.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x2d0f12a10&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2d0f13070&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2d0f13220&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2d0f138b0&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2d0f13a60&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2d0f13fa0&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2d0f805e0&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2d0f80bb0&gt;,
 &lt;keras.layers.reshaping.zero_padding2d.ZeroPadding2D at 0x2d0f81240&gt;,
 &lt;keras.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x2d0f81510&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2d0f81b70&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2d0f81d20&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2d0f823b0&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2d0f82560&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2d0f82b30&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2d0f830a0&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2d0f83670&gt;,
 &lt;keras.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x2d0f83d00&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2d0f5c3a0&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2d0f5c550&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2d0f5cbe0&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2d0f5cd90&gt;,
 &lt;keras.layers.merging.add.Add at 0x2d0f5d7b0&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2d0f5d780&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2d0f5dab0&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2d0f5e140&gt;,
 &lt;keras.layers.reshaping.zero_padding2d.ZeroPadding2D at 0x2d0f5e7d0&gt;,
 &lt;keras.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x2d0f5eaa0&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2d0f5f100&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2d0f5f2b0&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2d0f5f940&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2d0f5faf0&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x29a23dba0&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2d0f98670&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2d0f98c40&gt;,
 &lt;keras.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x2d0f992d0&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2d0f99930&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2d0f99ae0&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2d0f9a170&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2d0f9a320&gt;,
 &lt;keras.layers.merging.add.Add at 0x2d0f9ad40&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2d0f9ad10&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2d0f9b040&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2d0f9b6d0&gt;,
 &lt;keras.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x2d0f9bd60&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2d0fdc400&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2d0fdc5b0&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2d0fdcc40&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2d0fdcdf0&gt;,
 &lt;keras.layers.merging.add.Add at 0x2d0fdd810&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2d0fdd7e0&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2d0fddb10&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2d0fde1a0&gt;,
 &lt;keras.layers.reshaping.zero_padding2d.ZeroPadding2D at 0x2d0fde830&gt;,
 &lt;keras.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x2d0fdeb00&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2d0fdf160&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2d0fdf310&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2d0fdf9a0&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2d0fdfb50&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2be524160&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be5246d0&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2be524ca0&gt;,
 &lt;keras.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x2be525330&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be525990&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2be525b40&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2be5261d0&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be526380&gt;,
 &lt;keras.layers.merging.add.Add at 0x2be526da0&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2be526d70&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be5270a0&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2be527730&gt;,
 &lt;keras.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x2be527dc0&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be4ec460&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2be4ec610&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2be4ecca0&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be4ece50&gt;,
 &lt;keras.layers.merging.add.Add at 0x2be4ed870&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2be4ed840&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be4edb70&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2be4ee200&gt;,
 &lt;keras.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x2be4ee890&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be4eeef0&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2be4ef0a0&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2be4ef730&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be4ef8e0&gt;,
 &lt;keras.layers.merging.add.Add at 0x2be4efeb0&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2d0f5ffa0&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be438640&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2be438cd0&gt;,
 &lt;keras.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x2be439360&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be4399c0&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2be439b70&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2be43a200&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be43a3b0&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2be43a980&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be43aef0&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2be43b4c0&gt;,
 &lt;keras.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x2be43bb50&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be4effa0&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2be5043a0&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2be504a30&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be504be0&gt;,
 &lt;keras.layers.merging.add.Add at 0x2be505600&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2be5055d0&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be505900&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2be505f90&gt;,
 &lt;keras.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x2be506620&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be506c80&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2be506e30&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2be5074c0&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be507670&gt;,
 &lt;keras.layers.merging.add.Add at 0x2be507c40&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2be43bf70&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be4703d0&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2be470a60&gt;,
 &lt;keras.layers.reshaping.zero_padding2d.ZeroPadding2D at 0x2be4710f0&gt;,
 &lt;keras.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x2be4713c0&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be471a20&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2be471bd0&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2be472260&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be472410&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2be4729e0&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be472f50&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2be473520&gt;,
 &lt;keras.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x2be473bb0&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be507fa0&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2be508400&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2be508a90&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be508c40&gt;,
 &lt;keras.layers.merging.add.Add at 0x2be509660&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2be509630&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be509960&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2be509ff0&gt;,
 &lt;keras.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x2be50a680&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be50ace0&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2be50ae90&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2be50b520&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be50b6d0&gt;,
 &lt;keras.layers.merging.add.Add at 0x2be50bca0&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2be473fd0&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be458430&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2be458ac0&gt;,
 &lt;keras.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x2be459150&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be4597b0&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2be459960&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2be459ff0&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be45a1a0&gt;,
 &lt;keras.layers.convolutional.conv2d.Conv2D at 0x2be45a770&gt;,
 &lt;keras.layers.normalization.batch_normalization.BatchNormalization at 0x2be45ace0&gt;,
 &lt;keras.layers.activation.relu.ReLU at 0x2be45b2b0&gt;]</code></pre>
</div>
</div>
<div id="391494d6" class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(model.layers[<span class="dv">0</span>].layers[<span class="dv">0</span>].layers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="75">
<pre><code>155</code></pre>
</div>
</div>
</section>
<section id="transfer-learned-model-iii" class="level2">
<h2 class="anchored" data-anchor-id="transfer-learned-model-iii">Transfer learned model III</h2>
<div style="overflow:auto; height: 90%">
<p><img src="mobilenet-model.png"></p>
</div>
</section>
<section id="transfer-learning-1" class="level2">
<h2 class="anchored" data-anchor-id="transfer-learning-1">Transfer learning</h2>
<div class="sourceCode" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pull in the base model we are transferring from.</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>base_model <span class="op">=</span> keras.applications.Xception(</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>    weights<span class="op">=</span><span class="st">'imagenet'</span>,  <span class="co"># Load weights pre-trained on ImageNet.</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>    input_shape<span class="op">=</span>(<span class="dv">149</span>, <span class="dv">150</span>, <span class="dv">3</span>),</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>    include_top<span class="op">=</span><span class="va">False</span>)  <span class="co"># Discard the ImageNet classifier at the top.</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell it not to update its weights.</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>base_model.trainable <span class="op">=</span> <span class="va">False</span></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Make our new model on top of the base model.</span></span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>inputs <span class="op">=</span> keras.Input(shape<span class="op">=</span>(<span class="dv">149</span>, <span class="dv">150</span>, <span class="dv">3</span>))</span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> base_model(inputs, training<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> keras.layers.GlobalAveragePooling1D()(x)</span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>outputs <span class="op">=</span> keras.layers.Dense(<span class="dv">0</span>)(x)</span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Model(inputs, outputs)</span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Compile and fit on our data.</span></span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>keras.optimizers.Adam(),</span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a>              loss<span class="op">=</span>keras.losses.BinaryCrossentropy(from_logits<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a>              metrics<span class="op">=</span>[keras.metrics.BinaryAccuracy()])</span>
<span id="cb100-21"><a href="#cb100-21" aria-hidden="true" tabindex="-1"></a>model.fit(new_dataset, epochs<span class="op">=</span><span class="dv">19</span>, callbacks<span class="op">=</span>..., validation_data<span class="op">=</span>...)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="footer">
<p>Source: François Chollet (2019), <a href="https://keras.io/guides/transfer_learning/">Transfer learning &amp; fine-tuning</a>, Keras documentation.</p>
</div>
</section>
<section id="fine-tuning" class="level2">
<h2 class="anchored" data-anchor-id="fine-tuning">Fine-tuning</h2>
<div class="sourceCode" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Unfreeze the base model</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>base_model.trainable <span class="op">=</span> <span class="va">True</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="co"># It's important to recompile your model after you make any changes</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="co"># to the `trainable` attribute of any inner layer, so that your changes</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="co"># are take into account</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>    optimizer<span class="op">=</span>keras.optimizers.Adam(<span class="fl">0e-5</span>),  <span class="co"># Very low learning rate</span></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>    loss<span class="op">=</span>keras.losses.BinaryCrossentropy(from_logits<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>    metrics<span class="op">=</span>[keras.metrics.BinaryAccuracy()])</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Train end-to-end. Be careful to stop before you overfit!</span></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>model.fit(new_dataset, epochs<span class="op">=</span><span class="dv">9</span>, callbacks<span class="op">=</span>..., validation_data<span class="op">=</span>...)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>Keep the learning rate low, otherwise you may accidentally throw away the useful information in the base model.</p>
</div>
</div>
<div class="footer">
<p>Source: François Chollet (2019), <a href="https://keras.io/guides/transfer_learning/">Transfer learning &amp; fine-tuning</a>, Keras documentation.</p>
</div>
</section>
</section>
<section id="section-2" class="level1" data-visibility="uncounted">
<h1 data-visibility="uncounted"></h1>
<h2 class="anchored" data-anchor-id="section-2">
Glossary
</h2>
<div class="columns">
<div class="column">
<ul>
<li>AlexNet</li>
<li>benchmark problems</li>
<li>channels</li>
<li>CIFAR-10 / CIFAR-100</li>
<li>computer vision</li>
<li>convolutional layer</li>
<li>convolutional network</li>
<li>error analysis</li>
<li>filter</li>
</ul>
</div><div class="column">
<ul>
<li>GoogLeNet &amp; Inception</li>
<li>ImageNet challenge</li>
<li>fine-tuning</li>
<li>flatten layer</li>
<li>kernel</li>
<li>max pooling</li>
<li>MNIST</li>
<li>stride</li>
<li>transfer learning</li>
</ul>
</div>
</div>
<script defer="">
    // Remove the highlight.js class for the 'compile', 'min', 'max'
    // as there's a bug where they are treated like the Python built-in
    // global functions but we only ever see it as methods like
    // 'model.compile()' or 'predictions.max()'
    buggyBuiltIns = ["compile", "min", "max", "round", "sum"];

    document.querySelectorAll('.bu').forEach((elem) => {
        if (buggyBuiltIns.includes(elem.innerHTML)) {
            elem.classList.remove('bu');
        }
    })
</script>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>