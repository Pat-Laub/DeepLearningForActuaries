<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.13">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Patrick Laub">

<title>Computer Vision – AI for Actuaries</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../Labs/latex-lab.html" rel="next">
<link href="../Exercises/french-motor-frequency.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dc6cd09e1b25ae810b0d2454ed436d57.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-7544caf6f2c77b3bda3e758cfdaf0e5f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../Computer-Vision/computer-vision.html">Module 3</a></li><li class="breadcrumb-item"><a href="../Computer-Vision/computer-vision.html">Computer Vision</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">AI for Actuaries</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Module 1</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Artificial-Intelligence/course-overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Artificial-Intelligence/artificial-intelligence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Artificial Intelligence</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Artificial-Intelligence/python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Labs/python-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab: Intro Python</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Labs/python-for-data-science-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab: Python for Data Science</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Exercises/chess-ai.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise: Chess AI</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Module 2</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Tabular-Data/deep-learning-keras.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Deep Learning with Keras</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Tabular-Data/categorical-variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Categorical Variables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Tabular-Data/classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Classification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Tabular-Data/project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Project Details</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Labs/matplotlib-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab: Matplotlib</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Exercises/victorian-crash-severity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise: Victorian Car Crash Severity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Exercises/french-motor-frequency.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise: French Motor Claim Frequency</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Module 3</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Computer-Vision/computer-vision.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Computer Vision</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Labs/latex-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab: Markdown</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Exercises/hurricane-damage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise: Aerial Photos of Hurricane Damage</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Module 4</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Natural-Language-Processing/natural-language-processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Natural Language Processing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Exercises/police-reports.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise: Police Reports of US Car Crashes</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Module 5</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Time-Series-And-Recurrent-Neural-Networks/time-series-and-rnns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Time Series &amp; Recurrent Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Exercises/sydney-airport-temperature.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise: Sydney Temperature Forecasting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Module 6</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Advanced-Tabular-Data/entity-embedding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Entity Embedding</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Advanced-Tabular-Data/optimisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Optimisation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Labs/forward-pass-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab: Forward Pass</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Labs/optimisation-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab: Optimisation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Labs/backpropagation-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab: Backpropagation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Module 7</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Distributional-Regression/distributional-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributional Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Advanced-Topics/interpretability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interpretability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Labs/distributional-regression-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab: Distributional Regression</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">Module 8</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Generative-Networks/generative-networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generative Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Generative-Networks/gans.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generative Adversarial Networks</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#images" id="toc-images" class="nav-link active" data-scroll-target="#images">Images</a>
  <ul class="collapse">
  <li><a href="#shapes-of-data" id="toc-shapes-of-data" class="nav-link" data-scroll-target="#shapes-of-data">Shapes of data</a></li>
  <li><a href="#shapes-of-photos" id="toc-shapes-of-photos" class="nav-link" data-scroll-target="#shapes-of-photos">Shapes of photos</a></li>
  <li><a href="#how-the-computer-sees-them" id="toc-how-the-computer-sees-them" class="nav-link" data-scroll-target="#how-the-computer-sees-them">How the computer sees them</a></li>
  <li><a href="#how-we-see-them" id="toc-how-we-see-them" class="nav-link" data-scroll-target="#how-we-see-them">How we see them</a></li>
  <li><a href="#why-is-255-special" id="toc-why-is-255-special" class="nav-link" data-scroll-target="#why-is-255-special">Why is 255 special?</a></li>
  <li><a href="#image-editing-with-kernels" id="toc-image-editing-with-kernels" class="nav-link" data-scroll-target="#image-editing-with-kernels">Image editing with kernels</a></li>
  </ul></li>
  <li><a href="#convolutional-layers" id="toc-convolutional-layers" class="nav-link" data-scroll-target="#convolutional-layers">Convolutional Layers</a>
  <ul class="collapse">
  <li><a href="#convolution-not-complicated" id="toc-convolution-not-complicated" class="nav-link" data-scroll-target="#convolution-not-complicated">‘Convolution’ not ‘complicated’</a></li>
  <li><a href="#images-are-rank-3-tensors" id="toc-images-are-rank-3-tensors" class="nav-link" data-scroll-target="#images-are-rank-3-tensors">Images are rank 3 tensors</a></li>
  <li><a href="#example-detecting-yellow" id="toc-example-detecting-yellow" class="nav-link" data-scroll-target="#example-detecting-yellow">Example: Detecting yellow</a></li>
  <li><a href="#example-detecting-yellow-ii" id="toc-example-detecting-yellow-ii" class="nav-link" data-scroll-target="#example-detecting-yellow-ii">Example: Detecting yellow II</a></li>
  <li><a href="#example-detecting-yellow-iii" id="toc-example-detecting-yellow-iii" class="nav-link" data-scroll-target="#example-detecting-yellow-iii">Example: Detecting yellow III</a></li>
  <li><a href="#terminology" id="toc-terminology" class="nav-link" data-scroll-target="#terminology">Terminology</a></li>
  <li><a href="#spatial-filter" id="toc-spatial-filter" class="nav-link" data-scroll-target="#spatial-filter">Spatial filter</a></li>
  <li><a href="#multidimensional-convolution" id="toc-multidimensional-convolution" class="nav-link" data-scroll-target="#multidimensional-convolution">Multidimensional convolution</a></li>
  <li><a href="#example-3x3-filter-over-rgb-input" id="toc-example-3x3-filter-over-rgb-input" class="nav-link" data-scroll-target="#example-3x3-filter-over-rgb-input">Example: 3x3 filter over RGB input</a></li>
  <li><a href="#input-output-relationship" id="toc-input-output-relationship" class="nav-link" data-scroll-target="#input-output-relationship">Input-output relationship</a></li>
  </ul></li>
  <li><a href="#convolutional-layer-options" id="toc-convolutional-layer-options" class="nav-link" data-scroll-target="#convolutional-layer-options">Convolutional Layer Options</a>
  <ul class="collapse">
  <li><a href="#padding" id="toc-padding" class="nav-link" data-scroll-target="#padding">Padding</a></li>
  <li><a href="#padding-1" id="toc-padding-1" class="nav-link" data-scroll-target="#padding-1">Padding</a></li>
  <li><a href="#convolution-layer" id="toc-convolution-layer" class="nav-link" data-scroll-target="#convolution-layer">Convolution layer</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example">Example</a></li>
  <li><a href="#x1-convolution" id="toc-x1-convolution" class="nav-link" data-scroll-target="#x1-convolution">1x1 convolution</a></li>
  <li><a href="#example-of-1x1-convolution" id="toc-example-of-1x1-convolution" class="nav-link" data-scroll-target="#example-of-1x1-convolution">Example of 1x1 convolution</a></li>
  <li><a href="#striding" id="toc-striding" class="nav-link" data-scroll-target="#striding">Striding</a></li>
  <li><a href="#choosing-strides" id="toc-choosing-strides" class="nav-link" data-scroll-target="#choosing-strides">Choosing strides</a></li>
  <li><a href="#specifying-a-convolutional-layer" id="toc-specifying-a-convolutional-layer" class="nav-link" data-scroll-target="#specifying-a-convolutional-layer">Specifying a convolutional layer</a></li>
  </ul></li>
  <li><a href="#convolutional-neural-networks" id="toc-convolutional-neural-networks" class="nav-link" data-scroll-target="#convolutional-neural-networks">Convolutional Neural Networks</a>
  <ul class="collapse">
  <li><a href="#definition-of-cnn" id="toc-definition-of-cnn" class="nav-link" data-scroll-target="#definition-of-cnn">Definition of CNN</a></li>
  <li><a href="#architecture" id="toc-architecture" class="nav-link" data-scroll-target="#architecture">Architecture</a></li>
  <li><a href="#architecture-2" id="toc-architecture-2" class="nav-link" data-scroll-target="#architecture-2">Architecture #2</a></li>
  <li><a href="#pooling" id="toc-pooling" class="nav-link" data-scroll-target="#pooling">Pooling</a></li>
  <li><a href="#pooling-for-multiple-channels" id="toc-pooling-for-multiple-channels" class="nav-link" data-scroll-target="#pooling-for-multiple-channels">Pooling for multiple channels</a></li>
  <li><a href="#whywhy-not-use-pooling" id="toc-whywhy-not-use-pooling" class="nav-link" data-scroll-target="#whywhy-not-use-pooling">Why/why not use pooling?</a></li>
  <li><a href="#what-do-the-cnn-layers-learn" id="toc-what-do-the-cnn-layers-learn" class="nav-link" data-scroll-target="#what-do-the-cnn-layers-learn">What do the CNN layers learn?</a></li>
  </ul></li>
  <li><a href="#chinese-character-recognition-dataset" id="toc-chinese-character-recognition-dataset" class="nav-link" data-scroll-target="#chinese-character-recognition-dataset">Chinese Character Recognition Dataset</a>
  <ul class="collapse">
  <li><a href="#mnist-dataset" id="toc-mnist-dataset" class="nav-link" data-scroll-target="#mnist-dataset">MNIST Dataset</a></li>
  <li><a href="#casia-chinese-handwriting-database" id="toc-casia-chinese-handwriting-database" class="nav-link" data-scroll-target="#casia-chinese-handwriting-database">CASIA Chinese handwriting database</a></li>
  <li><a href="#inspect-a-subset-of-characters" id="toc-inspect-a-subset-of-characters" class="nav-link" data-scroll-target="#inspect-a-subset-of-characters">Inspect a subset of characters</a></li>
  <li><a href="#count-number-of-images-for-each-character" id="toc-count-number-of-images-for-each-character" class="nav-link" data-scroll-target="#count-number-of-images-for-each-character">Count number of images for each character</a></li>
  <li><a href="#number-of-images-for-each-character" id="toc-number-of-images-for-each-character" class="nav-link" data-scroll-target="#number-of-images-for-each-character">Number of images for each character</a></li>
  <li><a href="#checking-the-dimensions" id="toc-checking-the-dimensions" class="nav-link" data-scroll-target="#checking-the-dimensions">Checking the dimensions</a></li>
  <li><a href="#checking-the-dimensions-ii" id="toc-checking-the-dimensions-ii" class="nav-link" data-scroll-target="#checking-the-dimensions-ii">Checking the dimensions II</a></li>
  <li><a href="#checking-the-dimensions-iii" id="toc-checking-the-dimensions-iii" class="nav-link" data-scroll-target="#checking-the-dimensions-iii">Checking the dimensions III</a></li>
  <li><a href="#checking-the-dimensions-iv" id="toc-checking-the-dimensions-iv" class="nav-link" data-scroll-target="#checking-the-dimensions-iv">Checking the dimensions IV</a></li>
  <li><a href="#keras-image-dataset-loading" id="toc-keras-image-dataset-loading" class="nav-link" data-scroll-target="#keras-image-dataset-loading">Keras image dataset loading</a></li>
  <li><a href="#some-setup" id="toc-some-setup" class="nav-link" data-scroll-target="#some-setup">Some setup</a></li>
  <li><a href="#plotting-some-training-characters" id="toc-plotting-some-training-characters" class="nav-link" data-scroll-target="#plotting-some-training-characters">Plotting some training characters</a></li>
  <li><a href="#without-the-colourmap.." id="toc-without-the-colourmap.." class="nav-link" data-scroll-target="#without-the-colourmap..">Without the colourmap..</a></li>
  </ul></li>
  <li><a href="#fitting-a-multinomial-logistic-regression" id="toc-fitting-a-multinomial-logistic-regression" class="nav-link" data-scroll-target="#fitting-a-multinomial-logistic-regression">Fitting a (multinomial) logistic regression</a>
  <ul class="collapse">
  <li><a href="#make-a-logistic-regression" id="toc-make-a-logistic-regression" class="nav-link" data-scroll-target="#make-a-logistic-regression">Make a logistic regression</a></li>
  <li><a href="#inspecting-the-model" id="toc-inspecting-the-model" class="nav-link" data-scroll-target="#inspecting-the-model">Inspecting the model</a></li>
  <li><a href="#plot-the-model" id="toc-plot-the-model" class="nav-link" data-scroll-target="#plot-the-model">Plot the model</a></li>
  <li><a href="#fitting-the-model" id="toc-fitting-the-model" class="nav-link" data-scroll-target="#fitting-the-model">Fitting the model</a></li>
  <li><a href="#plot-the-lossaccuracy-curves" id="toc-plot-the-lossaccuracy-curves" class="nav-link" data-scroll-target="#plot-the-lossaccuracy-curves">Plot the loss/accuracy curves</a></li>
  <li><a href="#look-at-the-metrics" id="toc-look-at-the-metrics" class="nav-link" data-scroll-target="#look-at-the-metrics">Look at the metrics</a></li>
  </ul></li>
  <li><a href="#fitting-a-cnn" id="toc-fitting-a-cnn" class="nav-link" data-scroll-target="#fitting-a-cnn">Fitting a CNN</a>
  <ul class="collapse">
  <li><a href="#make-a-cnn" id="toc-make-a-cnn" class="nav-link" data-scroll-target="#make-a-cnn">Make a CNN</a></li>
  <li><a href="#inspect-the-model" id="toc-inspect-the-model" class="nav-link" data-scroll-target="#inspect-the-model">Inspect the model</a></li>
  <li><a href="#plot-the-cnn" id="toc-plot-the-cnn" class="nav-link" data-scroll-target="#plot-the-cnn">Plot the CNN</a></li>
  <li><a href="#fit-the-cnn" id="toc-fit-the-cnn" class="nav-link" data-scroll-target="#fit-the-cnn">Fit the CNN</a></li>
  <li><a href="#plot-the-lossaccuracy-curves-1" id="toc-plot-the-lossaccuracy-curves-1" class="nav-link" data-scroll-target="#plot-the-lossaccuracy-curves-1">Plot the loss/accuracy curves</a></li>
  <li><a href="#look-at-the-metrics-1" id="toc-look-at-the-metrics-1" class="nav-link" data-scroll-target="#look-at-the-metrics-1">Look at the metrics</a></li>
  <li><a href="#make-a-prediction" id="toc-make-a-prediction" class="nav-link" data-scroll-target="#make-a-prediction">Make a prediction</a></li>
  <li><a href="#predict-on-the-test-set-ii" id="toc-predict-on-the-test-set-ii" class="nav-link" data-scroll-target="#predict-on-the-test-set-ii">Predict on the test set II</a></li>
  </ul></li>
  <li><a href="#error-analysis" id="toc-error-analysis" class="nav-link" data-scroll-target="#error-analysis">Error Analysis</a>
  <ul class="collapse">
  <li><a href="#take-a-look-at-the-failure-cases" id="toc-take-a-look-at-the-failure-cases" class="nav-link" data-scroll-target="#take-a-look-at-the-failure-cases">Take a look at the failure cases</a></li>
  <li><a href="#confidence-of-predictions" id="toc-confidence-of-predictions" class="nav-link" data-scroll-target="#confidence-of-predictions">Confidence of predictions</a></li>
  <li><a href="#another-test-set" id="toc-another-test-set" class="nav-link" data-scroll-target="#another-test-set">Another test set</a></li>
  <li><a href="#evaluate-on-the-new-test-set" id="toc-evaluate-on-the-new-test-set" class="nav-link" data-scroll-target="#evaluate-on-the-new-test-set">Evaluate on the new test set</a></li>
  <li><a href="#errors" id="toc-errors" class="nav-link" data-scroll-target="#errors">Errors</a></li>
  <li><a href="#which-is-worst" id="toc-which-is-worst" class="nav-link" data-scroll-target="#which-is-worst">Which is worst…</a></li>
  <li><a href="#least-ai--legible-characters" id="toc-least-ai--legible-characters" class="nav-link" data-scroll-target="#least-ai--legible-characters">Least (AI-) legible characters</a></li>
  </ul></li>
  <li><a href="#hyperparameter-tuning" id="toc-hyperparameter-tuning" class="nav-link" data-scroll-target="#hyperparameter-tuning">Hyperparameter tuning</a>
  <ul class="collapse">
  <li><a href="#trial-error" id="toc-trial-error" class="nav-link" data-scroll-target="#trial-error">Trial &amp; error</a></li>
  <li><a href="#keras-tuner" id="toc-keras-tuner" class="nav-link" data-scroll-target="#keras-tuner">Keras Tuner</a></li>
  <li><a href="#do-a-random-search" id="toc-do-a-random-search" class="nav-link" data-scroll-target="#do-a-random-search">Do a random search</a></li>
  <li><a href="#tune-layers-separately" id="toc-tune-layers-separately" class="nav-link" data-scroll-target="#tune-layers-separately">Tune layers separately</a></li>
  <li><a href="#do-a-bayesian-search" id="toc-do-a-bayesian-search" class="nav-link" data-scroll-target="#do-a-bayesian-search">Do a Bayesian search</a></li>
  </ul></li>
  <li><a href="#benchmark-problems" id="toc-benchmark-problems" class="nav-link" data-scroll-target="#benchmark-problems">Benchmark Problems</a>
  <ul class="collapse">
  <li><a href="#demo-object-classification" id="toc-demo-object-classification" class="nav-link" data-scroll-target="#demo-object-classification">Demo: Object classification</a></li>
  <li><a href="#how-does-that-work" id="toc-how-does-that-work" class="nav-link" data-scroll-target="#how-does-that-work">How does that work?</a></li>
  <li><a href="#benchmarks" id="toc-benchmarks" class="nav-link" data-scroll-target="#benchmarks">Benchmarks</a></li>
  <li><a href="#lenet-6-1998" id="toc-lenet-6-1998" class="nav-link" data-scroll-target="#lenet-6-1998">LeNet-6 (1998)</a></li>
  <li><a href="#alexnet-2011" id="toc-alexnet-2011" class="nav-link" data-scroll-target="#alexnet-2011">AlexNet (2011)</a></li>
  <li><a href="#data-augmentation" id="toc-data-augmentation" class="nav-link" data-scroll-target="#data-augmentation">Data Augmentation</a></li>
  <li><a href="#inception-module-2013" id="toc-inception-module-2013" class="nav-link" data-scroll-target="#inception-module-2013">Inception module (2013)</a></li>
  <li><a href="#googlenet-inception_v0-2014" id="toc-googlenet-inception_v0-2014" class="nav-link" data-scroll-target="#googlenet-inception_v0-2014">GoogLeNet / Inception_v0 (2014)</a></li>
  <li><a href="#depth-is-important-for-image-tasks" id="toc-depth-is-important-for-image-tasks" class="nav-link" data-scroll-target="#depth-is-important-for-image-tasks">Depth is important for image tasks</a></li>
  <li><a href="#residual-connection" id="toc-residual-connection" class="nav-link" data-scroll-target="#residual-connection">Residual connection</a></li>
  <li><a href="#resnet-2014" id="toc-resnet-2014" class="nav-link" data-scroll-target="#resnet-2014">ResNet (2014)</a></li>
  </ul></li>
  <li><a href="#transfer-learning" id="toc-transfer-learning" class="nav-link" data-scroll-target="#transfer-learning">Transfer Learning</a>
  <ul class="collapse">
  <li><a href="#transfer-learning-1" id="toc-transfer-learning-1" class="nav-link" data-scroll-target="#transfer-learning-1">Transfer learning</a></li>
  <li><a href="#fine-tuning" id="toc-fine-tuning" class="nav-link" data-scroll-target="#fine-tuning">Fine-tuning</a></li>
  
  
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="computer-vision.slides.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../Computer-Vision/computer-vision.html">Module 3</a></li><li class="breadcrumb-item"><a href="../Computer-Vision/computer-vision.html">Computer Vision</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Computer Vision</h1>
<p class="subtitle lead">ACTL3143 &amp; ACTL5111 Deep Learning for Actuaries</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Patrick Laub </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div id="8c9fa842" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Show the package imports</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> keras</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.models <span class="im">import</span> Sequential</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.layers <span class="im">import</span> Dense, Input</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.callbacks <span class="im">import</span> EarlyStopping</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.utils <span class="im">import</span> plot_model</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Computer vision is a field of Artificial Intelligence (AI) that focuses on extracting meaningful information from visual data (images and videos). One of the primary goals of computer vision is to correctly identify and classify visual data. Convolution Neural Networks (CNNs) are the most commonly used neural network architectures for computer vision related tasks.</p>
<section id="images" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="images">Images</h2>
<section id="shapes-of-data" class="level3">
<h3 class="anchored" data-anchor-id="shapes-of-data">Shapes of data</h3>
<p>A special attention to shapes of data are important in CNN architectures, because CNNs have special types of layers (e.g.&nbsp;convolution and pooling) which require explicit specifications of array dimensions.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="medium-tensor-rank.png" class="img-fluid figure-img"></p>
<figcaption>Illustration of tensors of different rank.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Paras Patidar (2019), <a href="https://medium.com/mlait/tensors-representation-of-data-in-neural-networks-bbe8a711b93b">Tensors — Representation of Data In Neural Networks</a>, Medium article.</p>
</div>
</section>
<section id="shapes-of-photos" class="level3">
<h3 class="anchored" data-anchor-id="shapes-of-photos">Shapes of photos</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="rgb-channels.png" class="img-fluid figure-img"></p>
<figcaption>A photo is a rank 3 tensor.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Kim et al (2021), <a href="https://www.mdpi.com/applsci/applsci-11-03418/article_deploy/html/images/applsci-11-03418-g001.png">Data Hiding Method for Color AMBTC Compressed Images Using Color Difference</a>, Applied Sciences.</p>
</div>
<p>Since the position of a pixel(one small sqaure) in a photo can be represented using 3 positional values, we call it a rank 3 tensor.</p>
</section>
<section id="how-the-computer-sees-them" class="level3 smaller">
<h3 class="smaller anchored" data-anchor-id="how-the-computer-sees-them">How the computer sees them</h3>
<div id="1d708341" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.image <span class="im">import</span> imread</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>img1 <span class="op">=</span> imread(<span class="st">'pu.gif'</span>)<span class="op">;</span> img2 <span class="op">=</span> imread(<span class="st">'pl.gif'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>img3 <span class="op">=</span> imread(<span class="st">'pr.gif'</span>)<span class="op">;</span> img4 <span class="op">=</span> imread(<span class="st">'pg.bmp'</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="ss">f"Shapes are: </span><span class="sc">{</span>img1<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>img2<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>img3<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>img4<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">."</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="4589b7f4" class="cell" data-execution_count="4">
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>'Shapes are: (16, 16, 3), (16, 16, 3), (16, 16, 3), (16, 16, 3).'</code></pre>
</div>
</div>
<div class="columns">
<div class="column" style="width:25%;">
<div id="f4dc1872" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>img1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>array([[[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0]],

       [[255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0]],

       [[255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0]],

       [[255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0]],

       [[255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0]],

       [[  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]]], dtype=uint8)</code></pre>
</div>
</div>
</div><div class="column" style="width:25%;">
<div id="bdfccbe1" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>img2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>array([[[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]]], dtype=uint8)</code></pre>
</div>
</div>
</div><div class="column" style="width:25%;">
<div id="95fb9f0b" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>img3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>array([[[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]]], dtype=uint8)</code></pre>
</div>
</div>
</div><div class="column" style="width:25%;">
<div id="b83871ef" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>img4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>array([[[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [255, 163, 177],
        [255, 163, 177],
        [255, 255, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [255, 255, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0]],

       [[255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 255, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [255, 255, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177]],

       [[255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [ 51,   0, 255],
        [ 51,   0, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [ 51,   0, 255],
        [ 51,   0, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177]],

       [[255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [ 51,   0, 255],
        [ 51,   0, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [ 51,   0, 255],
        [ 51,   0, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177]],

       [[255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177]],

       [[255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177]],

       [[255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177]],

       [[255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177]],

       [[255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177]],

       [[255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0]],

       [[255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[255, 163, 177],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 163, 177],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 163, 177],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]]], dtype=uint8)</code></pre>
</div>
</div>
</div>
</div>
<p>The above code reads 4 images and then shows how computers read those images. Each image is read by the computer as a rank 3 tensor. Each image is of (16,16,3) dimensions.</p>
</section>
<section id="how-we-see-them" class="level3">
<h3 class="anchored" data-anchor-id="how-we-see-them">How we see them</h3>
<div id="615c0c50" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.pyplot <span class="im">import</span> imshow</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="columns">
<div class="column" style="width:25%;">
<div id="307d61d9" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>imshow(img1)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-11-output-1.png" width="704" height="691" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:25%;">
<div id="b3ce3855" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>imshow(img2)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-12-output-1.png" width="704" height="691" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:25%;">
<div id="292f33ac" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>imshow(img3)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-13-output-1.png" width="704" height="691" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:25%;">
<div id="78b2421c" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>imshow(img4)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-14-output-1.png" width="704" height="691" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="why-is-255-special" class="level3">
<h3 class="anchored" data-anchor-id="why-is-255-special">Why is 255 special?</h3>
<p>Each pixel’s colour intensity is stored in one byte.</p>
<p>One byte is 8 bits, so in binary that is 00000000 to 11111111.</p>
<p>The largest <em>unsigned</em> number this can be is <span class="math inline">2^8-1 = 255</span>.</p>
<div id="f78bd1d3" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>np.array([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">255</span>, <span class="dv">256</span>]).astype(np.uint8)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>array([  0,   1, 255,   0], dtype=uint8)</code></pre>
</div>
</div>
<p>If you had <em>signed</em> numbers, this would go from -128 to 127.</p>
<div id="a37ce0b1" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>np.array([<span class="op">-</span><span class="dv">128</span>, <span class="dv">1</span>, <span class="dv">127</span>, <span class="dv">128</span>]).astype(np.int8)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>array([-128,    1,  127, -128], dtype=int8)</code></pre>
</div>
</div>
<p>Alternatively, <em>hexidecimal</em> numbers are used. E.g. 10100001 is split into 1010 0001, and 1010=A, 0001=1, so combined it is 0xA1.</p>
</section>
<section id="image-editing-with-kernels" class="level3">
<h3 class="anchored" data-anchor-id="image-editing-with-kernels">Image editing with kernels</h3>
<p>Take a look at <a href="https://setosa.io/ev/image-kernels/">https://setosa.io/ev/image-kernels/</a>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="convolution.gif" class="img-fluid figure-img"></p>
<figcaption>An example of an image kernel in action.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: <a href="http://deeplearning.stanford.edu/wiki/index.php/Feature_extraction_using_convolution">Stanford’s deep learning tutorial</a> via <a href="https://stats.stackexchange.com/a/188216">Stack Exchange</a>.</p>
</div>
</section>
</section>
<section id="convolutional-layers" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="convolutional-layers">Convolutional Layers</h2>
<section id="convolution-not-complicated" class="level3">
<h3 class="anchored" data-anchor-id="convolution-not-complicated">‘Convolution’ not ‘complicated’</h3>
<p>Say <span class="math inline">X_1, X_2 \sim f_X</span> are i.i.d., and we look at <span class="math inline">S = X_1 + X_2</span>.</p>
<p>The density for <span class="math inline">S</span> is then</p>
<p><span class="math display">
f_S(s) = \int_{x_1=-\infty}^{\infty} f_X(x_1) \, f_X(s-x_1) \,\mathrm{d}s .
</span></p>
<p>This is the <em>convolution</em> operation, <span class="math inline">f_S = f_X \star f_X</span>.</p>
</section>
<section id="images-are-rank-3-tensors" class="level3">
<h3 class="anchored" data-anchor-id="images-are-rank-3-tensors">Images are rank 3 tensors</h3>
<p>Height, width, and number of channels.</p>
<p>An image can be represented using a rank 3 tensor, since it has 3 dimensions; height, width, and number of channels. The number of channels is also known as the ‘depth’. The left hand side of the picture shown below is tensor with height =5, width =5 and depth =3.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Glassner/16-1.png" class="img-fluid figure-img"></p>
<figcaption>Examples of rank 3 tensors.</figcaption>
</figure>
</div>
<p>Grayscale image has 1 channel. RGB image has 3 channels.</p>
<p>Each colour can be represented as a combination of three primary colours; red, green and blue.</p>
<p>Example: Yellow = Red + Green.</p>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="example-detecting-yellow" class="level3">
<h3 class="anchored" data-anchor-id="example-detecting-yellow">Example: Detecting yellow</h3>
<p>Suppose we wish to detect if a picture has yellow colour in it. One option would be to apply a neuron over each pixel and see if it detects the colour yellow. We know that each pixel is represented by 3 numerical values that correspond to red, green and blue. Higher numeric values for red and green indicate higher chances of detecting yellow. Higher values for blue indicate lower chances of detecting yellow. Utilising this information, we can assign RGB weights to be 1, 1, -1 respectively.</p>
<p>Next, a standard multiplication between numeric values and weights is carried out, and the weighted sum is passed through the neuron.</p>
<div class="columns">
<div class="column">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Glassner/16-3.png" class="img-fluid figure-img"></p>
<figcaption>Applying a neuron to an image pixel.</figcaption>
</figure>
</div>
</div><div class="column">
<p><br></p>
<p>Apply a neuron to each pixel in the image.</p>
<p><br></p>
<p>If red/green <span class="math inline">\nearrow</span> or blue <span class="math inline">\searrow</span> then yellowness <span class="math inline">\nearrow</span>.</p>
<p><br></p>
<p>Set RGB weights to 1, 1, -1.</p>
</div>
</div>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="example-detecting-yellow-ii" class="level3">
<h3 class="anchored" data-anchor-id="example-detecting-yellow-ii">Example: Detecting yellow II</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Glassner/16-4.png" class="img-fluid figure-img"></p>
<figcaption>Scan the 3-channel input (colour image) with the neuron to produce a 1-channel output (grayscale image).</figcaption>
</figure>
</div>
<p>The output is produced by <em>sweeping</em> the neuron over the input. This is called <strong>convolution</strong>.</p>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="example-detecting-yellow-iii" class="level3" data-visibility="uncounted">
<h3 data-visibility="uncounted" class="anchored" data-anchor-id="example-detecting-yellow-iii">Example: Detecting yellow III</h3>
<p>The following picture demonstrates how yellow-coloured areas (in the colour picture) are transformed into a white colour (in the greyscale picture). This is a result of the way we assigned the weights. Since we assigned +1 weights to red and green, and -1 to blue, it ended up resulting in large positive values (for the weighted sum) for the pixels in the yellow-coloured areas. Large positive values in the greyscale correspond to white colour. Therefore, the areas which were yellow in the colour picture converted to white in the greyscale. In practice, we do not manually assign weights, instead, we let the neural network decide the optimal weights during training.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Glassner/16-5.png" class="img-fluid figure-img"></p>
<figcaption>The more yellow the pixel in the colour image (left), the more white it is in the grayscale image.</figcaption>
</figure>
</div>
<p>The neuron or its weights is called a <strong>filter</strong>. We <em>convolve</em> the image with a filter, i.e.&nbsp;a <strong>convolutional filter</strong>.</p>
</section>
<section id="terminology" class="level3">
<h3 class="anchored" data-anchor-id="terminology">Terminology</h3>
<ul>
<li>The same neuron is used to sweep over the image, so we can store the weights in some shared memory and process the pixels in parallel. We say that the neurons are <em>weight sharing</em>.</li>
<li>In the previous example, the neuron only takes one pixel as input. Usually a larger filter containing a <em>block of weights</em> is used to process not only a pixel but also its neighboring pixels all at once.</li>
<li>The weights are called the filter <strong>kernels</strong>.</li>
<li>The cluster of pixels that forms the input of a filter is called its <em>footprint</em>.</li>
</ul>
</section>
<section id="spatial-filter" class="level3">
<h3 class="anchored" data-anchor-id="spatial-filter">Spatial filter</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Glassner/16-9.png" class="img-fluid figure-img"></p>
<figcaption>Example 3x3 filter</figcaption>
</figure>
</div>
<p>When a filter’s footprint is &gt; 1 pixel, it is a <strong>spatial filter</strong>.</p>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
<p>The above spatial filter is a 3x3 filter. Hence, there are 9 weights to learn.</p>
</section>
<section id="multidimensional-convolution" class="level3">
<h3 class="anchored" data-anchor-id="multidimensional-convolution">Multidimensional convolution</h3>
<p>In a multidimensional filter, the number of channels of the input must be equal to the number of channels in the filter (depths must be the same).</p>
<p>Need <span class="math inline">\# \text{ Channels in Input} = \# \text{ Channels in Filter}</span>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Glassner/16-18.png" class="img-fluid figure-img"></p>
<figcaption>Example: a 3x3 filter with 3 channels, containing 27 weights.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="example-3x3-filter-over-rgb-input" class="level3">
<h3 class="anchored" data-anchor-id="example-3x3-filter-over-rgb-input">Example: 3x3 filter over RGB input</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Glassner/16-19.png" class="img-fluid figure-img"></p>
<figcaption>Each channel is multipled separately &amp; then added together.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
<p>The above figure shows how we pick a 3x3x3 block from the image, and then apply the 3x3 filter. The multiplication is carried out channel-wise, i.e.&nbsp;we select the first channel of the filter and the first channel of the image and carry out the element wise multiplation. Once the elementwise multiplications for the three pairs of channels are completed, we sum them all, and pass through the neuron.</p>
</section>
<section id="input-output-relationship" class="level3">
<h3 class="anchored" data-anchor-id="input-output-relationship">Input-output relationship</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Glassner/16-10.png" class="img-fluid figure-img"></p>
<figcaption>Matching the original image footprints against the output location.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
<p>The above figure shows how 9 inputs transform in to one output. As a result, dimensions of the output matrix is smaller than the dimensions of the input matrix. There are some options we can use if we wish to keep the size of input and output matrices same.</p>
</section>
</section>
<section id="convolutional-layer-options" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="convolutional-layer-options">Convolutional Layer Options</h2>
<section id="padding" class="level3">
<h3 class="anchored" data-anchor-id="padding">Padding</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Glassner/16-15.png" class="img-fluid figure-img"></p>
<figcaption>What happens when filters go off the edge of the input?</figcaption>
</figure>
</div>
<ul>
<li>How to avoid the filter’s receptive field falling off the side of the input.</li>
<li>If we only scan the filter over places of the input where the filter can fit perfectly, it will lead to loss of information, especially after many filters.</li>
</ul>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="padding-1" class="level3">
<h3 class="anchored" data-anchor-id="padding-1">Padding</h3>
<p>Add a border of extra elements around the input, called <strong>padding</strong>. Normally we place zeros in all the new elements, called <strong>zero padding</strong>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Glassner/16-17.png" class="img-fluid figure-img"></p>
<figcaption>Padded values can be added to the outside of the input.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="convolution-layer" class="level3">
<h3 class="anchored" data-anchor-id="convolution-layer">Convolution layer</h3>
<ul>
<li>Multiple filters are bundled together in one layer.</li>
<li>The filters are applied <em>simultaneously</em> and <em>independently</em> to the input.</li>
<li>Filters can have different footprints, but in practice we almost always use the same footprint for every filter in a convolution layer.</li>
<li>Number of channels in the output will be the same as the number of filters.</li>
</ul>
<p>The motivation behind applying filters <em>simultaneously</em> and <em>independently</em> is to let the filters learn different patterns in the input-output relationship. The idea is quite similar to using many neurons in one <code>Dense</code> layer (in a <code>Dense</code> layer, we would use multiple neurons so that different neurons can capture different patterns in the input-output relationship).</p>
</section>
<section id="example" class="level3">
<h3 class="anchored" data-anchor-id="example">Example</h3>
<div class="columns">
<div class="column">
<p>In the image:</p>
<ul>
<li>6-channel input tensor</li>
<li>input pixels</li>
<li>four 3x3 filters</li>
<li>four output tensors</li>
<li>final output tensor.</li>
</ul>
</div><div class="column">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Glassner/16-21.png" class="img-fluid figure-img"></p>
<figcaption>Example network highlighting that the number of output channels equals the number of filters.</figcaption>
</figure>
</div>
</div>
</div>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
<p>The above picture shows how we take in an image with 6 channels, select a 3x3 block (in pink colour), apply 4 different filters of same dimensions (in pink, green, blue and yellow), retrieve the output with 1 channel (1 output for each filter) and finally stack them together to create 1 output tensor. Note that the number of channels in the output tensor is 4, which is equal to the number of spatial filters used.</p>
</section>
<section id="x1-convolution" class="level3">
<h3 class="anchored" data-anchor-id="x1-convolution">1x1 convolution</h3>
<ul>
<li>Feature reduction: Reduce the number of channels in the input tensor (removing correlated features) by using fewer filters than the number of channels in the input. This is because the number of channels in the output is always the same as number of filters.</li>
<li>1x1 convolution: Convolution using 1x1 filters.</li>
<li>When the channels are correlated, 1x1 convolution is very effective at reducing channels without loss of information.</li>
</ul>
</section>
<section id="example-of-1x1-convolution" class="level3 smaller">
<h3 class="smaller anchored" data-anchor-id="example-of-1x1-convolution">Example of 1x1 convolution</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Glassner/16-23.png" class="img-fluid figure-img"></p>
<figcaption>Example network with 1x1 convolution.</figcaption>
</figure>
</div>
<ul>
<li>Input tensor contains 300 channels.</li>
<li>Use 175 1x1 filters in the convolution layer (300 weights each).</li>
<li>Each filter produces a 1-channel output.</li>
<li>Final output tensor has 175 channels.</li>
</ul>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="striding" class="level3">
<h3 class="anchored" data-anchor-id="striding">Striding</h3>
<p>Striding options allows to modify the movement of the filter across the image. Instead moving one step at a time (either horizontally or vertically), we can increase the number of steps using the <em>striding</em> option.</p>
<p>We don’t have to go one pixel across/down at a time.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Glassner/16-29.png" class="img-fluid figure-img"></p>
<figcaption>Example: Use a stride of three horizontally and two vertically.</figcaption>
</figure>
</div>
<p>Dimension of output will be smaller than input.</p>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="choosing-strides" class="level3 smaller">
<h3 class="smaller anchored" data-anchor-id="choosing-strides">Choosing strides</h3>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Glassner/16-31.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Glassner/16-32.png" class="img-fluid"></p>
</div>
</div>
</div>
<p>When a filter scans the input step by step, it processes the same input elements multiple times. Even with larger strides, this can still happen (left image).</p>
<p><strong>If</strong> we want to save time, we can choose strides that prevents input elements from being used more than once. Example (right image): 3x3 filter, stride 3 in both directions.</p>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="specifying-a-convolutional-layer" class="level3">
<h3 class="anchored" data-anchor-id="specifying-a-convolutional-layer">Specifying a convolutional layer</h3>
<p>Need to choose:</p>
<ul>
<li>number of filters,</li>
<li>their footprints (e.g.&nbsp;3x3, 5x5, etc.),</li>
<li>activation functions,</li>
<li>padding &amp; striding (optional).</li>
</ul>
<p>All the filter weights are learned during training.</p>
</section>
</section>
<section id="convolutional-neural-networks" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="convolutional-neural-networks">Convolutional Neural Networks</h2>
<section id="definition-of-cnn" class="level3">
<h3 class="anchored" data-anchor-id="definition-of-cnn">Definition of CNN</h3>
<div class="columns">
<div class="column" style="width:60%;">
<p><br> <br></p>
<p>A neural network that uses <em>convolution layers</em> is called a <em>convolutional neural network</em>.</p>
</div><div class="column" style="width:40%;">
<p><img src="xkcd-trained_a_neural_net_2x.png" class="img-fluid"></p>
</div>
</div>
<div class="footer">
<p>Source: Randall Munroe (2019), <a href="https://xkcd.com/2173/">xkcd #2173: Trained a Neural Net</a>.</p>
</div>
</section>
<section id="architecture" class="level3">
<h3 class="anchored" data-anchor-id="architecture">Architecture</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Geron-mls2_1411.png" class="img-fluid figure-img"></p>
<figcaption>Typical CNN architecture.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Aurélien Géron (2019), <em>Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</em>, 2nd Edition, Figure 14-11.</p>
</div>
<p>A standard CNN architecture has the following components: an input layer, a sequence of feature extraction layers (which combine convolution and pooling operations sequentially), a sequence of classification layers (which include flattening and fully connected layers) and a final output layer. Convolution layers are used to extract meaningful patterns from the input using spatial filters. Pooling layers are used to reduce the spatial dimensions of the feature maps generated from convolutional layers. The purpose of the feature extraction layers is to learn complex but meaningful, high levels patterns in data. The aim of classification layers is to receive the learned patterns and make decisions more closely related to the classification task at hand.</p>
</section>
<section id="architecture-2" class="level3">
<h3 class="anchored" data-anchor-id="architecture-2">Architecture #2</h3>
<p><img src="mathworks-typical-cnn.svg" class="img-fluid"></p>
<div class="footer">
<p>Source: MathWorks, <a href="https://au.mathworks.com/campaigns/offers/next/deep-learning-ebook.html"><em>Introducing Deep Learning with MATLAB</em></a>, Ebook.</p>
</div>
<p>On a high level, the idea would be to keep on increasing the number of channels (depth) and decrease the dimensions of the feature map. We can see how the depth increases, and spatial dimensions reduce from first convolution layer to the second pooling layer.</p>
</section>
<section id="pooling" class="level3">
<h3 class="anchored" data-anchor-id="pooling">Pooling</h3>
<p><strong>Pooling</strong>, or <strong>downsampling</strong>, is a technique to blur a tensor.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Glassner/16-27.png" class="img-fluid figure-img"></p>
<figcaption>Illustration of pool operations.</figcaption>
</figure>
</div>
<p>(a): Input tensor (b): Subdivide input tensor into 2x2 blocks (c): Average pooling (d): Max pooling (e): Icon for a pooling layer</p>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="pooling-for-multiple-channels" class="level3 smaller">
<h3 class="smaller anchored" data-anchor-id="pooling-for-multiple-channels">Pooling for multiple channels</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Glassner/16-28.png" class="img-fluid figure-img"></p>
<figcaption>Pooling a multichannel input.</figcaption>
</figure>
</div>
<ul>
<li>Input tensor: 6x6 with 1 channel, zero padding.</li>
<li>Convolution layer: Three 3x3 filters.</li>
<li>Convolution layer output: 6x6 with 3 channels.</li>
<li>Pooling layer: apply max pooling to each channel.</li>
<li>Pooling layer output: 3x3, 3 channels.</li>
</ul>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="whywhy-not-use-pooling" class="level3">
<h3 class="anchored" data-anchor-id="whywhy-not-use-pooling">Why/why not use pooling?</h3>
<p><strong>Why?</strong> Pooling <em>reduces the size</em> of tensors, therefore reduces memory usage and execution time (recall that 1x1 convolution <em>reduces the number of channels</em> in a tensor).</p>
<p><strong>Why not?</strong></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="reddit-hinton-pooling.png" class="img-fluid figure-img"></p>
<figcaption>Geoffrey Hinton</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Hinton, <a href="https://www.reddit.com/r/MachineLearning/comments/2lmo0l/comment/clyj4jv/?utm_source=share&amp;utm_medium=web2x&amp;context=3">Reddit AMA</a>.</p>
</div>
</section>
<section id="what-do-the-cnn-layers-learn" class="level3">
<h3 class="anchored" data-anchor-id="what-do-the-cnn-layers-learn">What do the CNN layers learn?</h3>
<p><img src="distill-feature-visualisation.png" class="img-fluid"></p>
<div class="footer">
<p>Source: Distill article, <a href="https://distill.pub/2017/feature-visualization/">Feature Visualization</a>.</p>
</div>
</section>
</section>
<section id="chinese-character-recognition-dataset" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="chinese-character-recognition-dataset">Chinese Character Recognition Dataset</h2>
<section id="mnist-dataset" class="level3">
<h3 class="anchored" data-anchor-id="mnist-dataset">MNIST Dataset</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="wiki-MnistExamples.png" class="img-fluid figure-img"></p>
<figcaption>The MNIST dataset.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Wikipedia, <a href="https://en.wikipedia.org/wiki/MNIST_database">MNIST database</a>.</p>
</div>
</section>
<section id="casia-chinese-handwriting-database" class="level3">
<h3 class="anchored" data-anchor-id="casia-chinese-handwriting-database">CASIA Chinese handwriting database</h3>
<p>Dataset source: <a href="https://nlpr.ia.ac.cn/databases/handwriting/Home.html">Institute of Automation of Chinese Academy of Sciences (CASIA)</a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Offlin1.jpg" class="img-fluid figure-img"></p>
<figcaption>A 13 GB dataset of 3,999,571 handwritten characters.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Liu et al.&nbsp;(2011), <a href="https://nlpr.ia.ac.cn/databases/handwriting/Home.html">CASIA online and offline Chinese handwriting databases</a>, 2011 International Conference on Document Analysis and Recognition.</p>
</div>
</section>
<section id="inspect-a-subset-of-characters" class="level3">
<h3 class="anchored" data-anchor-id="inspect-a-subset-of-characters">Inspect a subset of characters</h3>
<div class="columns">
<div class="column">
<p>Pulling out 55 characters to experiment with.</p>
<p>人从众大夫天口太因鱼犬吠哭火炎啖木林森本竹羊美羔山出女囡鸟日东月朋明肉肤工白虎门闪问闲水牛马吗妈玉王国主川舟虫</p>
</div><div class="column">
<p>Inspect directory structure</p>
<div id="0a3a725d" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install directory_tree</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="e4bb402c" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> directory_tree <span class="im">import</span> display_tree</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>display_tree(<span class="st">"CASIA-Dataset"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="d165b43f" class="cell" data-execution_count="18">
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/sq/__n07d014s3gvhj5fy8b61zr0000gn/T/ipykernel_40710/1538839654.py:2: DeprecationWarning: The `display_tree` Function is Deprecated and will be Removed in a Future Release. Please use `DirectoryTree` Instead. End of Life Date is "31st December 2024".
  tree = display_tree("CASIA-Dataset", string_rep=True).split("\n")</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>CASIA-Dataset/
├── Test/
│   ├── 东/
│   │   ├── 1.png
│   │   ├── 10.png
│   │   ├── 100.png
│   │   ├── 101.png
│   │   ├── 102.png
│   │   ├── 103.png
│   │   ├── 104.png
│   │   ├── 105.png
│   │   ├── 106.png
...
        ├── 97.png
        ├── 98.png
        └── 99.png
</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="count-number-of-images-for-each-character" class="level3">
<h3 class="anchored" data-anchor-id="count-number-of-images-for-each-character">Count number of images for each character</h3>
<div id="e75efc10" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_images_in_folders(root_folder):</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    counts <span class="op">=</span> {}</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> folder <span class="kw">in</span> root_folder.iterdir():</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>        counts[folder.name] <span class="op">=</span> <span class="bu">len</span>(<span class="bu">list</span>(folder.glob(<span class="st">"*.png"</span>)))</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> counts</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>train_counts <span class="op">=</span> count_images_in_folders(Path(<span class="st">"CASIA-Dataset/Train"</span>))</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>test_counts <span class="op">=</span> count_images_in_folders(Path(<span class="st">"CASIA-Dataset/Test"</span>))</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(train_counts)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(test_counts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'哭': 584, '闪': 597, '马': 597, '啖': 240, '囡': 240, '明': 596, '.DS_Store': 0, '太': 596, '森': 598, '国': 600, '女': 597, '本': 604, '夫': 599, '因': 603, '林': 598, '月': 604, '川': 593, '牛': 599, '鱼': 602, '玉': 602, '工': 600, '水': 597, '犬': 598, '肤': 601, '从': 598, '美': 591, '羔': 597, '鸟': 598, '肉': 598, '东': 601, '人': 597, '问': 601, '闲': 598, '日': 597, '竹': 600, '吠': 601, '门': 597, '吗': 596, '木': 598, '虎': 597, '大': 603, '天': 598, '妈': 595, '虫': 602, '白': 604, '朋': 595, '口': 597, '舟': 601, '山': 598, '王': 601, '众': 600, '羊': 600, '炎': 602, '出': 602, '主': 599, '火': 599}
{'哭': 138, '闪': 143, '马': 144, '啖': 60, '囡': 59, '明': 144, '.DS_Store': 0, '太': 143, '森': 144, '国': 142, '女': 144, '本': 143, '夫': 141, '因': 144, '林': 143, '月': 144, '川': 142, '牛': 144, '鱼': 143, '玉': 142, '工': 141, '水': 143, '犬': 141, '肤': 140, '从': 142, '美': 144, '羔': 141, '鸟': 143, '肉': 143, '东': 142, '人': 144, '问': 143, '闲': 142, '日': 143, '竹': 142, '吠': 141, '门': 144, '吗': 143, '木': 144, '虎': 143, '大': 144, '天': 143, '妈': 142, '虫': 144, '白': 141, '朋': 144, '口': 143, '舟': 143, '山': 144, '王': 145, '众': 143, '羊': 144, '炎': 143, '出': 142, '主': 141, '火': 142}</code></pre>
</div>
</div>
</section>
<section id="number-of-images-for-each-character" class="level3">
<h3 class="anchored" data-anchor-id="number-of-images-for-each-character">Number of images for each character</h3>
<div id="288dd18e" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>plt.hist(train_counts.values(), bins<span class="op">=</span><span class="dv">30</span>, label<span class="op">=</span><span class="st">"Train"</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>plt.hist(test_counts.values(), bins<span class="op">=</span><span class="dv">30</span>, label<span class="op">=</span><span class="st">"Test"</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-21-output-1.png" width="1522" height="690" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>It differs, but basically ~600 training and ~140 test images per character. A couple of characters have a lot less of both though.</p>
</section>
<section id="checking-the-dimensions" class="level3">
<h3 class="anchored" data-anchor-id="checking-the-dimensions">Checking the dimensions</h3>
<div id="70a189aa" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_image_dimensions(root_folder):</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    dimensions <span class="op">=</span> []</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> folder <span class="kw">in</span> root_folder.iterdir():</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> image <span class="kw">in</span> folder.glob(<span class="st">"*.png"</span>):</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>            img <span class="op">=</span> imread(image)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>            dimensions.append(img.shape)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dimensions</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>train_dimensions <span class="op">=</span> get_image_dimensions(Path(<span class="st">"CASIA-Dataset/Train"</span>))</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>test_dimensions <span class="op">=</span> get_image_dimensions(Path(<span class="st">"CASIA-Dataset/Test"</span>))</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>train_heights <span class="op">=</span> [d[<span class="dv">0</span>] <span class="cf">for</span> d <span class="kw">in</span> train_dimensions]</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>train_widths <span class="op">=</span> [d[<span class="dv">1</span>] <span class="cf">for</span> d <span class="kw">in</span> train_dimensions]</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>test_heights <span class="op">=</span> [d[<span class="dv">0</span>] <span class="cf">for</span> d <span class="kw">in</span> test_dimensions]</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>test_widths <span class="op">=</span> [d[<span class="dv">1</span>] <span class="cf">for</span> d <span class="kw">in</span> test_dimensions]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="checking-the-dimensions-ii" class="level3">
<h3 class="anchored" data-anchor-id="checking-the-dimensions-ii">Checking the dimensions II</h3>
<div id="71d6b374" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>plt.hist(train_heights, bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Train Heights"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>plt.hist(train_widths, bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Train Widths"</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>plt.hist(test_heights, bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Test Heights"</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>plt.hist(test_widths, bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Test Widths"</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-23-output-1.png" width="1584" height="690" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The images are taller than they are wide. We have more training images than test images.</p>
</section>
<section id="checking-the-dimensions-iii" class="level3">
<h3 class="anchored" data-anchor-id="checking-the-dimensions-iii">Checking the dimensions III</h3>
<div id="0a2b4c27" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>plt.hist(train_heights, bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Train Heights"</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>plt.hist(train_widths, bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Train Widths"</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>plt.hist(test_heights, bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Test Heights"</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>plt.hist(test_widths, bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Test Widths"</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-24-output-1.png" width="1568" height="690" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="checking-the-dimensions-iv" class="level3">
<h3 class="anchored" data-anchor-id="checking-the-dimensions-iv">Checking the dimensions IV</h3>
<div class="columns">
<div class="column">
<div id="48aea8e8" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>plt.hist(train_heights, bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Train Heights"</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>plt.hist(test_heights, bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Test Heights"</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-25-output-1.png" width="1568" height="690" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div><div class="column">
<div id="41172622" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>plt.hist(train_widths, bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Train Widths"</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>plt.hist(test_widths, bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Test Widths"</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-26-output-1.png" width="1568" height="690" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>The distribution of dimensions are pretty similar between training and test sets.</p>
</section>
<section id="keras-image-dataset-loading" class="level3">
<h3 class="anchored" data-anchor-id="keras-image-dataset-loading">Keras image dataset loading</h3>
<p>Normally we’d used <a href="https://keras.io/api/data_loading/image/"><code>keras.utils.image_dataset_from_directory</code></a> but the Chinese characters breaks it on Windows. I made an image loading function just for this demo.</p>
<div id="e047529e" class="cell" data-execution_count="26">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> preprocess_image(img_path, img_height<span class="op">=</span><span class="dv">80</span>, img_width<span class="op">=</span><span class="dv">60</span>):</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Loads and preprocesses an image:</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co">    - Converts to grayscale</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co">    - Resizes to (img_height, img_width) using anti-aliasing</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co">    - Returns a NumPy array normalized to [0,1]</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> Image.<span class="bu">open</span>(img_path).convert(<span class="st">"L"</span>)  <span class="co"># Open image and convert to grayscale</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> img.resize((img_width, img_height), Image.LANCZOS)  <span class="co"># Resize with anti-aliasing</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array(img, dtype<span class="op">=</span>np.float32)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_images_from_directory(directory, img_height<span class="op">=</span><span class="dv">80</span>, img_width<span class="op">=</span><span class="dv">60</span>):</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Loads images and labels from a directory where each subfolder represents a class.</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="co">        X (numpy array): Image data of shape (num_samples, img_height, img_width, 1).</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="co">        y (numpy array): Labels as integer indices.</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="co">        class_names (list): List of class names in sorted order.</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>    directory <span class="op">=</span> Path(directory)  <span class="co"># Ensure it's a Path object</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>    class_names <span class="op">=</span> <span class="bu">sorted</span>([d.name <span class="cf">for</span> d <span class="kw">in</span> directory.iterdir() <span class="cf">if</span> d.is_dir()])  <span class="co"># Sorted UTF-8 class names</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    class_name_to_index <span class="op">=</span> {name: i <span class="cf">for</span> i, name <span class="kw">in</span> <span class="bu">enumerate</span>(class_names)}</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>    image_paths, labels <span class="op">=</span> [], []</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> class_name <span class="kw">in</span> class_names:</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>        class_dir <span class="op">=</span> directory <span class="op">/</span> class_name</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> img_path <span class="kw">in</span> <span class="bu">sorted</span>(class_dir.glob(<span class="st">"*.png"</span>)):</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>            image_paths.append(img_path)</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>            labels.append(class_name_to_index[class_name])</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load and preprocess images</span></span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> np.array([preprocess_image(img, img_height, img_width) <span class="cf">for</span> img <span class="kw">in</span> image_paths])</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> X[..., np.newaxis]  <span class="co"># Add channel dimension</span></span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> np.array(labels, dtype<span class="op">=</span>np.int32)</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> X, y, class_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="856cf635" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>data_dir <span class="op">=</span> Path(<span class="st">"CASIA-Dataset"</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>img_height, img_width <span class="op">=</span> <span class="dv">80</span>, <span class="dv">60</span>  <span class="co"># Target image size</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load 'training' and test datasets</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>X_main, y_main, class_names <span class="op">=</span> load_images_from_directory(data_dir <span class="op">/</span> <span class="st">"Train"</span>, img_height, img_width)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>X_test, y_test, _ <span class="op">=</span> load_images_from_directory(data_dir <span class="op">/</span> <span class="st">"Test"</span>, img_height, img_width)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify dataset shape</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Train: X=</span><span class="sc">{</span>X_main<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">, y=</span><span class="sc">{</span>y_main<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test: X=</span><span class="sc">{</span>X_test<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">, y=</span><span class="sc">{</span>y_test<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Class Names:"</span>, class_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train: X=(32206, 80, 60, 1), y=(32206,)
Test: X=(7684, 80, 60, 1), y=(7684,)
Class Names: ['东', '主', '人', '从', '众', '出', '口', '吗', '吠', '哭', '啖', '因', '囡', '国', '大', '天', '太', '夫', '女', '妈', '山', '川', '工', '日', '明', '月', '朋', '木', '本', '林', '森', '水', '火', '炎', '牛', '犬', '玉', '王', '白', '竹', '羊', '美', '羔', '肉', '肤', '舟', '虎', '虫', '门', '闪', '问', '闲', '马', '鱼', '鸟']</code></pre>
</div>
</div>
</section>
<section id="some-setup" class="level3">
<h3 class="anchored" data-anchor-id="some-setup">Some setup</h3>
<div id="920f1ac2" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>X_train, X_val, y_train, y_val <span class="op">=</span> train_test_split(X_main, y_main, test_size<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_train.shape, y_train.shape, X_val.shape, y_val.shape, X_test.shape, y_test.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(25764, 80, 60, 1) (25764,) (6442, 80, 60, 1) (6442,) (7684, 80, 60, 1) (7684,)</code></pre>
</div>
</div>
<div id="dbae64b0" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.font_manager <span class="im">as</span> fm</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>CHINESE_FONT <span class="op">=</span> fm.FontProperties(fname<span class="op">=</span><span class="st">"STHeitiTC-Medium-01.ttf"</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_mandarin_characters(X, y, class_names, n<span class="op">=</span><span class="dv">5</span>, title_font<span class="op">=</span>CHINESE_FONT):</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the first n images in X</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>        plt.subplot(<span class="dv">1</span>, n, i <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>        plt.imshow(X[i], cmap<span class="op">=</span><span class="st">"gray"</span>)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>        plt.title(class_names[y[i]], fontproperties<span class="op">=</span>title_font)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>        plt.axis(<span class="st">"off"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="001e0144" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>class_names[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>['东', '主', '人', '从', '众']</code></pre>
</div>
</div>
<div id="a80a63e4" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>X_dong <span class="op">=</span> X_train[y_train <span class="op">==</span> <span class="dv">0</span>]<span class="op">;</span> y_dong <span class="op">=</span> y_train[y_train <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>X_ren <span class="op">=</span> X_train[y_train <span class="op">==</span> <span class="dv">2</span>]<span class="op">;</span> y_ren <span class="op">=</span> y_train[y_train <span class="op">==</span> <span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plotting-some-training-characters" class="level3 smaller">
<h3 class="smaller anchored" data-anchor-id="plotting-some-training-characters">Plotting some training characters</h3>
<div id="39184bbe" class="cell" data-execution_count="32">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>plot_mandarin_characters(X_dong, y_dong, class_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-33-output-1.png" width="2782" height="762" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="42d18553" class="cell" data-execution_count="33">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>plot_mandarin_characters(X_ren, y_ren, class_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-34-output-1.png" width="2782" height="762" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="without-the-colourmap.." class="level3">
<h3 class="anchored" data-anchor-id="without-the-colourmap..">Without the colourmap..</h3>
<div class="columns">
<div class="column" style="width:5%;">

</div><div class="column" style="width:45%;">
<div id="9becdaf2" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>dong <span class="op">=</span> X_test[y_test <span class="op">==</span> <span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>plt.imshow(dong, cmap<span class="op">=</span><span class="st">"gray"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-35-output-1.png" width="570" height="705" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:45%;">
<div id="79330382" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>dong <span class="op">=</span> X_test[y_test <span class="op">==</span> <span class="dv">0</span>][<span class="dv">1</span>]</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>plt.imshow(dong)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-36-output-1.png" width="570" height="705" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:5%;">

</div>
</div>
</section>
</section>
<section id="fitting-a-multinomial-logistic-regression" class="level2">
<h2 class="anchored" data-anchor-id="fitting-a-multinomial-logistic-regression">Fitting a (multinomial) logistic regression</h2>
<section id="make-a-logistic-regression" class="level3">
<h3 class="anchored" data-anchor-id="make-a-logistic-regression">Make a logistic regression</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="flattening-image-to-vector.png" class="img-fluid figure-img"></p>
<figcaption>Basically pretend it’s not an image</figcaption>
</figure>
</div>
<div id="5450c24b" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="annotated-cell-18"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-18" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-18-1" class="code-annotation-target"><a href="#annotated-cell-18-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.layers <span class="im">import</span> Rescaling, Flatten</span>
<span id="annotated-cell-18-2"><a href="#annotated-cell-18-2" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-18" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-18-3" class="code-annotation-target"><a href="#annotated-cell-18-3" aria-hidden="true" tabindex="-1"></a>num_classes <span class="op">=</span> np.unique(y_train).shape[<span class="dv">0</span>]</span>
<span id="annotated-cell-18-4"><a href="#annotated-cell-18-4" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">123</span>)</span>
<span id="annotated-cell-18-5"><a href="#annotated-cell-18-5" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential([</span>
<span id="annotated-cell-18-6"><a href="#annotated-cell-18-6" aria-hidden="true" tabindex="-1"></a>  Input((img_height, img_width, <span class="dv">1</span>)), Flatten(), Rescaling(<span class="fl">1.</span><span class="op">/</span><span class="dv">255</span>),</span>
<span id="annotated-cell-18-7"><a href="#annotated-cell-18-7" aria-hidden="true" tabindex="-1"></a>  Dense(num_classes, activation<span class="op">=</span><span class="st">"softmax"</span>)</span>
<span id="annotated-cell-18-8"><a href="#annotated-cell-18-8" aria-hidden="true" tabindex="-1"></a>])</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-18" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-18" data-code-lines="1" data-code-annotation="1">Imports preprocessing layers from <code>keras.layers</code> useful for image data</span>
</dd>
<dt data-target-cell="annotated-cell-18" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-18" data-code-lines="3" data-code-annotation="2">Specifies the number of unique categories in the train set</span>
</dd>
</dl>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>Rescaling</code> layer will rescale the intensities to [0, 1].</p>
</div>
</div>
</section>
<section id="inspecting-the-model" class="level3">
<h3 class="anchored" data-anchor-id="inspecting-the-model">Inspecting the model</h3>
<div id="e2b86d16" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>model.summary()                            </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Model: "sequential"</span>
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> Layer (type)                    </span>┃<span style="font-weight: bold"> Output Shape           </span>┃<span style="font-weight: bold">       Param # </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ flatten (<span style="color: #0087ff; text-decoration-color: #0087ff">Flatten</span>)               │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">4800</span>)           │             <span style="color: #00af00; text-decoration-color: #00af00">0</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ rescaling (<span style="color: #0087ff; text-decoration-color: #0087ff">Rescaling</span>)           │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">4800</span>)           │             <span style="color: #00af00; text-decoration-color: #00af00">0</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                   │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">55</span>)             │       <span style="color: #00af00; text-decoration-color: #00af00">264,055</span> │
└─────────────────────────────────┴────────────────────────┴───────────────┘
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Total params: </span><span style="color: #00af00; text-decoration-color: #00af00">264,055</span> (1.01 MB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">264,055</span> (1.01 MB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Non-trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">0</span> (0.00 B)
</pre>
</div>
</div>
</section>
<section id="plot-the-model" class="level3">
<h3 class="anchored" data-anchor-id="plot-the-model">Plot the model</h3>
<div id="004a1985" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>plot_model(model, show_shapes<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-39-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="fitting-the-model" class="level3">
<h3 class="anchored" data-anchor-id="fitting-the-model">Fitting the model</h3>
<div id="c6a5884a" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1"></a>loss <span class="op">=</span> keras.losses.SparseCategoricalCrossentropy()</span>
<span id="cb48-2"><a href="#cb48-2"></a>topk <span class="op">=</span> keras.metrics.SparseTopKCategoricalAccuracy(k<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb48-3"><a href="#cb48-3"></a>model.compile(optimizer<span class="op">=</span><span class="st">'adam'</span>, loss<span class="op">=</span>loss, metrics<span class="op">=</span>[<span class="st">'accuracy'</span>, topk])</span>
<span id="cb48-4"><a href="#cb48-4"></a></span>
<span id="cb48-5"><a href="#cb48-5"></a>epochs <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb48-6"><a href="#cb48-6"></a>es <span class="op">=</span> EarlyStopping(patience<span class="op">=</span><span class="dv">15</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb48-7"><a href="#cb48-7"></a>    monitor<span class="op">=</span><span class="st">"val_accuracy"</span>, verbose<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb48-8"><a href="#cb48-8"></a></span>
<span id="cb48-9"><a href="#cb48-9"></a><span class="cf">if</span> Path(<span class="st">"logistic.keras"</span>).exists():</span>
<span id="cb48-10"><a href="#cb48-10"></a>    model <span class="op">=</span> keras.models.load_model(<span class="st">"logistic.keras"</span>)</span>
<span id="cb48-11"><a href="#cb48-11"></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">"logistic_history.json"</span>, <span class="st">"r"</span>) <span class="im">as</span> json_file:</span>
<span id="cb48-12"><a href="#cb48-12"></a>        history <span class="op">=</span> json.load(json_file)</span>
<span id="cb48-13"><a href="#cb48-13"></a><span class="cf">else</span>:</span>
<span id="cb48-14"><a href="#cb48-14"></a>    hist <span class="op">=</span> model.fit(X_train, y_train, validation_data<span class="op">=</span>(X_val, y_val),</span>
<span id="cb48-15"><a href="#cb48-15"></a>      epochs<span class="op">=</span>epochs, callbacks<span class="op">=</span>[es], verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb48-16"><a href="#cb48-16"></a>    model.save(<span class="st">"logistic.keras"</span>)</span>
<span id="cb48-17"><a href="#cb48-17"></a>    history <span class="op">=</span> hist.history</span>
<span id="cb48-18"><a href="#cb48-18"></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">"logistic_history.json"</span>, <span class="st">"w"</span>) <span class="im">as</span> json_file:</span>
<span id="cb48-19"><a href="#cb48-19"></a>        json.dump(history, json_file)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Most of this last part is just to save time rendering this slides, you don’t need it.</p>
</section>
<section id="plot-the-lossaccuracy-curves" class="level3">
<h3 class="anchored" data-anchor-id="plot-the-lossaccuracy-curves">Plot the loss/accuracy curves</h3>
<div id="b9274799" class="cell" data-execution_count="41">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_history(history):</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    epochs <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(history[<span class="st">"loss"</span>]))</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    plt.plot(epochs, history[<span class="st">"accuracy"</span>], label<span class="op">=</span><span class="st">"Train"</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>    plt.plot(epochs, history[<span class="st">"val_accuracy"</span>], label<span class="op">=</span><span class="st">"Val"</span>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>    plt.legend(loc<span class="op">=</span><span class="st">"lower right"</span>)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"Accuracy"</span>)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>    plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>    plt.plot(epochs, history[<span class="st">"loss"</span>], label<span class="op">=</span><span class="st">"Train"</span>)</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>    plt.plot(epochs, history[<span class="st">"val_loss"</span>], label<span class="op">=</span><span class="st">"Val"</span>)</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>    plt.legend(loc<span class="op">=</span><span class="st">"upper right"</span>)</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"Loss"</span>)</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="b7096114" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>plot_history(history)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-43-output-1.png" width="1537" height="764" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="look-at-the-metrics" class="level3">
<h3 class="anchored" data-anchor-id="look-at-the-metrics">Look at the metrics</h3>
<div id="b65f7129" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.evaluate(X_train, y_train, verbose<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.evaluate(X_val, y_val, verbose<span class="op">=</span><span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1.6995151042938232, 0.6173730492591858, 0.8565052151679993]
[2.194162130355835, 0.5515367984771729, 0.8146538138389587]</code></pre>
</div>
</div>
<div id="e5d93919" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>loss_value, accuracy, top5_accuracy <span class="op">=</span> model.evaluate(X_val, y_val, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Validation Loss: </span><span class="sc">{</span>loss_value<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Validation Accuracy: </span><span class="sc">{</span>accuracy<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Validation Top 5 Accuracy: </span><span class="sc">{</span>top5_accuracy<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Validation Loss: 2.1942
Validation Accuracy: 0.5515
Validation Top 5 Accuracy: 0.8147</code></pre>
</div>
</div>
</section>
</section>
<section id="fitting-a-cnn" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="fitting-a-cnn">Fitting a CNN</h2>
<section id="make-a-cnn" class="level3">
<h3 class="anchored" data-anchor-id="make-a-cnn">Make a CNN</h3>
<div id="a5e72923" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="annotated-cell-26"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-26" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-26-1" class="code-annotation-target"><a href="#annotated-cell-26-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.layers <span class="im">import</span> Conv2D, MaxPooling2D</span>
<span id="annotated-cell-26-2"><a href="#annotated-cell-26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-26-3"><a href="#annotated-cell-26-3" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">123</span>)</span>
<span id="annotated-cell-26-4"><a href="#annotated-cell-26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-26-5"><a href="#annotated-cell-26-5" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential([</span>
<span id="annotated-cell-26-6"><a href="#annotated-cell-26-6" aria-hidden="true" tabindex="-1"></a>  Input((img_height, img_width, <span class="dv">1</span>)),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-26" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-26-7" class="code-annotation-target"><a href="#annotated-cell-26-7" aria-hidden="true" tabindex="-1"></a>  Rescaling(<span class="fl">1.</span><span class="op">/</span><span class="dv">255</span>),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-26" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-26-8" class="code-annotation-target"><a href="#annotated-cell-26-8" aria-hidden="true" tabindex="-1"></a>  Conv2D(<span class="dv">16</span>, <span class="dv">3</span>, padding<span class="op">=</span><span class="st">"same"</span>, activation<span class="op">=</span><span class="st">"relu"</span>, name<span class="op">=</span><span class="st">"conv1"</span>),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-26" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-26-9" class="code-annotation-target"><a href="#annotated-cell-26-9" aria-hidden="true" tabindex="-1"></a>  MaxPooling2D(name<span class="op">=</span><span class="st">"pool1"</span>),</span>
<span id="annotated-cell-26-10"><a href="#annotated-cell-26-10" aria-hidden="true" tabindex="-1"></a>  Conv2D(<span class="dv">32</span>, <span class="dv">3</span>, padding<span class="op">=</span><span class="st">"same"</span>, activation<span class="op">=</span><span class="st">"relu"</span>, name<span class="op">=</span><span class="st">"conv2"</span>),</span>
<span id="annotated-cell-26-11"><a href="#annotated-cell-26-11" aria-hidden="true" tabindex="-1"></a>  MaxPooling2D(name<span class="op">=</span><span class="st">"pool2"</span>),</span>
<span id="annotated-cell-26-12"><a href="#annotated-cell-26-12" aria-hidden="true" tabindex="-1"></a>  Conv2D(<span class="dv">64</span>, <span class="dv">3</span>, padding<span class="op">=</span><span class="st">"same"</span>, activation<span class="op">=</span><span class="st">"relu"</span>, name<span class="op">=</span><span class="st">"conv3"</span>),</span>
<span id="annotated-cell-26-13"><a href="#annotated-cell-26-13" aria-hidden="true" tabindex="-1"></a>  MaxPooling2D(name<span class="op">=</span><span class="st">"pool3"</span>, pool_size<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>)),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-26" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-26-14" class="code-annotation-target"><a href="#annotated-cell-26-14" aria-hidden="true" tabindex="-1"></a>  Flatten(), Dense(<span class="dv">64</span>, activation<span class="op">=</span><span class="st">"relu"</span>), Dense(num_classes)</span>
<span id="annotated-cell-26-15"><a href="#annotated-cell-26-15" aria-hidden="true" tabindex="-1"></a>])</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-26" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-26" data-code-lines="1" data-code-annotation="1">Imports CNN specific preprocessing layers from <code>keras.layers</code></span>
</dd>
<dt data-target-cell="annotated-cell-26" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-26" data-code-lines="7" data-code-annotation="2">Rescales the numeric representations of data which ranges from [0,255] in to [0, 1] range</span>
</dd>
<dt data-target-cell="annotated-cell-26" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-26" data-code-lines="8" data-code-annotation="3">Applies the convolution layer. Here <code>padding="same"</code> ensures that the dimensions of the input and output matrices remain same</span>
</dd>
<dt data-target-cell="annotated-cell-26" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-26" data-code-lines="9" data-code-annotation="4">Applies <code>MaxPooling</code>, which reduces the spatial dimensions by carrying forward the maximum value over an input window</span>
</dd>
<dt data-target-cell="annotated-cell-26" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-26" data-code-lines="14" data-code-annotation="5">Applies the <code>Flatten</code> layer to convert the 2D array (from pooling) in to a single column vector, and passes through couple of <code>Dense</code> layers to train the neural network for the specific classification problem. Note that the output layer has number of neurons equal to <code>num_classes</code>, which corresponds to the number of unique classes in the output.</span>
</dd>
</dl>
</div>
</div>
<div class="footer">
<p>Architecture inspired by <a href="https://www.tensorflow.org/tutorials/images/classification">https://www.tensorflow.org/tutorials/images/classification</a>.</p>
</div>
</section>
<section id="inspect-the-model" class="level3">
<h3 class="anchored" data-anchor-id="inspect-the-model">Inspect the model</h3>
<div id="4ae53acf" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>model.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Model: "sequential_1"</span>
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> Layer (type)                    </span>┃<span style="font-weight: bold"> Output Shape           </span>┃<span style="font-weight: bold">       Param # </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ rescaling_1 (<span style="color: #0087ff; text-decoration-color: #0087ff">Rescaling</span>)         │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">80</span>, <span style="color: #00af00; text-decoration-color: #00af00">60</span>, <span style="color: #00af00; text-decoration-color: #00af00">1</span>)      │             <span style="color: #00af00; text-decoration-color: #00af00">0</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ conv1 (<span style="color: #0087ff; text-decoration-color: #0087ff">Conv2D</span>)                  │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">80</span>, <span style="color: #00af00; text-decoration-color: #00af00">60</span>, <span style="color: #00af00; text-decoration-color: #00af00">16</span>)     │           <span style="color: #00af00; text-decoration-color: #00af00">160</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ pool1 (<span style="color: #0087ff; text-decoration-color: #0087ff">MaxPooling2D</span>)            │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">40</span>, <span style="color: #00af00; text-decoration-color: #00af00">30</span>, <span style="color: #00af00; text-decoration-color: #00af00">16</span>)     │             <span style="color: #00af00; text-decoration-color: #00af00">0</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ conv2 (<span style="color: #0087ff; text-decoration-color: #0087ff">Conv2D</span>)                  │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">40</span>, <span style="color: #00af00; text-decoration-color: #00af00">30</span>, <span style="color: #00af00; text-decoration-color: #00af00">32</span>)     │         <span style="color: #00af00; text-decoration-color: #00af00">4,640</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ pool2 (<span style="color: #0087ff; text-decoration-color: #0087ff">MaxPooling2D</span>)            │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">20</span>, <span style="color: #00af00; text-decoration-color: #00af00">15</span>, <span style="color: #00af00; text-decoration-color: #00af00">32</span>)     │             <span style="color: #00af00; text-decoration-color: #00af00">0</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ conv3 (<span style="color: #0087ff; text-decoration-color: #0087ff">Conv2D</span>)                  │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">20</span>, <span style="color: #00af00; text-decoration-color: #00af00">15</span>, <span style="color: #00af00; text-decoration-color: #00af00">64</span>)     │        <span style="color: #00af00; text-decoration-color: #00af00">18,496</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ pool3 (<span style="color: #0087ff; text-decoration-color: #0087ff">MaxPooling2D</span>)            │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">5</span>, <span style="color: #00af00; text-decoration-color: #00af00">3</span>, <span style="color: #00af00; text-decoration-color: #00af00">64</span>)       │             <span style="color: #00af00; text-decoration-color: #00af00">0</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ flatten_1 (<span style="color: #0087ff; text-decoration-color: #0087ff">Flatten</span>)             │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">960</span>)            │             <span style="color: #00af00; text-decoration-color: #00af00">0</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense_1 (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                 │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">64</span>)             │        <span style="color: #00af00; text-decoration-color: #00af00">61,504</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense_2 (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                 │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">55</span>)             │         <span style="color: #00af00; text-decoration-color: #00af00">3,575</span> │
└─────────────────────────────────┴────────────────────────┴───────────────┘
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Total params: </span><span style="color: #00af00; text-decoration-color: #00af00">88,375</span> (345.21 KB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">88,375</span> (345.21 KB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Non-trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">0</span> (0.00 B)
</pre>
</div>
</div>
</section>
<section id="plot-the-cnn" class="level3">
<h3 class="anchored" data-anchor-id="plot-the-cnn">Plot the CNN</h3>
<div id="517ea4c5" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>plot_model(model, show_shapes<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-48-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="fit-the-cnn" class="level3">
<h3 class="anchored" data-anchor-id="fit-the-cnn">Fit the CNN</h3>
<div id="5ba5c99e" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="annotated-cell-29"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-29" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-29-1" class="code-annotation-target"><a href="#annotated-cell-29-1" aria-hidden="true" tabindex="-1"></a>loss <span class="op">=</span> keras.losses.SparseCategoricalCrossentropy(from_logits<span class="op">=</span><span class="va">True</span>)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-29" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-29-2" class="code-annotation-target"><a href="#annotated-cell-29-2" aria-hidden="true" tabindex="-1"></a>topk <span class="op">=</span> keras.metrics.SparseTopKCategoricalAccuracy(k<span class="op">=</span><span class="dv">5</span>)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-29" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-29-3" class="code-annotation-target"><a href="#annotated-cell-29-3" aria-hidden="true" tabindex="-1"></a>model.compile(optimizer<span class="op">=</span><span class="st">'adam'</span>, loss<span class="op">=</span>loss, metrics<span class="op">=</span>[<span class="st">'accuracy'</span>, topk])</span>
<span id="annotated-cell-29-4"><a href="#annotated-cell-29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-29-5"><a href="#annotated-cell-29-5" aria-hidden="true" tabindex="-1"></a>epochs <span class="op">=</span> <span class="dv">100</span></span>
<span id="annotated-cell-29-6"><a href="#annotated-cell-29-6" aria-hidden="true" tabindex="-1"></a>es <span class="op">=</span> EarlyStopping(patience<span class="op">=</span><span class="dv">15</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>,</span>
<span id="annotated-cell-29-7"><a href="#annotated-cell-29-7" aria-hidden="true" tabindex="-1"></a>    monitor<span class="op">=</span><span class="st">"val_accuracy"</span>, verbose<span class="op">=</span><span class="dv">2</span>)</span>
<span id="annotated-cell-29-8"><a href="#annotated-cell-29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-29-9"><a href="#annotated-cell-29-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> Path(<span class="st">"cnn.keras"</span>).exists():</span>
<span id="annotated-cell-29-10"><a href="#annotated-cell-29-10" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> keras.models.load_model(<span class="st">"cnn.keras"</span>)</span>
<span id="annotated-cell-29-11"><a href="#annotated-cell-29-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">"cnn_history.json"</span>, <span class="st">"r"</span>) <span class="im">as</span> json_file:</span>
<span id="annotated-cell-29-12"><a href="#annotated-cell-29-12" aria-hidden="true" tabindex="-1"></a>        history <span class="op">=</span> json.load(json_file)</span>
<span id="annotated-cell-29-13"><a href="#annotated-cell-29-13" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="annotated-cell-29-14"><a href="#annotated-cell-29-14" aria-hidden="true" tabindex="-1"></a>    hist <span class="op">=</span> model.fit(X_train, y_train, validation_data<span class="op">=</span>(X_val, y_val),</span>
<span id="annotated-cell-29-15"><a href="#annotated-cell-29-15" aria-hidden="true" tabindex="-1"></a>      epochs<span class="op">=</span>epochs, callbacks<span class="op">=</span>[es], verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="annotated-cell-29-16"><a href="#annotated-cell-29-16" aria-hidden="true" tabindex="-1"></a>    model.save(<span class="st">"cnn.keras"</span>)</span>
<span id="annotated-cell-29-17"><a href="#annotated-cell-29-17" aria-hidden="true" tabindex="-1"></a>    history <span class="op">=</span> hist.history</span>
<span id="annotated-cell-29-18"><a href="#annotated-cell-29-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">"cnn_history.json"</span>, <span class="st">"w"</span>) <span class="im">as</span> json_file:</span>
<span id="annotated-cell-29-19"><a href="#annotated-cell-29-19" aria-hidden="true" tabindex="-1"></a>        json.dump(history, json_file)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-29" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-29" data-code-lines="1" data-code-annotation="1">Defines the loss function with an added command <code>from_logits=True</code>. Doing this instead of defining a <code>softmax</code> function at the output <code>Dense</code> layer of the neural network is expected to be more numerically stable</span>
</dd>
<dt data-target-cell="annotated-cell-29" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-29" data-code-lines="2" data-code-annotation="2">Specifies a new metric to keep track of accuracy of the top 5 predicted classes. This means that, for each input image, the metric will consider whether the true class is among the top 5 predicted classes by the model</span>
</dd>
<dt data-target-cell="annotated-cell-29" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-29" data-code-lines="3" data-code-annotation="3">Compiles the model as usual with an optimizer, a loss function and metrics to monitor</span>
</dd>
</dl>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Instead of using softmax activation, just added <code>from_logits=True</code> to the loss function; this is more numerically stable.</p>
</div>
</div>
</section>
<section id="plot-the-lossaccuracy-curves-1" class="level3">
<h3 class="anchored" data-anchor-id="plot-the-lossaccuracy-curves-1">Plot the loss/accuracy curves</h3>
<div id="4a6aa9ef" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>plot_history(history)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-51-output-1.png" width="1561" height="764" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="look-at-the-metrics-1" class="level3">
<h3 class="anchored" data-anchor-id="look-at-the-metrics-1">Look at the metrics</h3>
<div id="13e28c16" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.evaluate(X_train, y_train, verbose<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.evaluate(X_val, y_val, verbose<span class="op">=</span><span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[0.006793997250497341, 0.9979816675186157, 1.0]
[0.6403203010559082, 0.9344924092292786, 0.9920831918716431]</code></pre>
</div>
</div>
<div id="c70f1735" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>loss_value, accuracy, top5_accuracy <span class="op">=</span> model.evaluate(X_test, y_test, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test Loss: </span><span class="sc">{</span>loss_value<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test Accuracy: </span><span class="sc">{</span>accuracy<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test Top 5 Accuracy: </span><span class="sc">{</span>top5_accuracy<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test Loss: 1.1658
Test Accuracy: 0.8856
Test Top 5 Accuracy: 0.9862</code></pre>
</div>
</div>
</section>
<section id="make-a-prediction" class="level3">
<h3 class="anchored" data-anchor-id="make-a-prediction">Make a prediction</h3>
<div id="5d7440e8" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>model.predict(X_test[<span class="dv">0</span>], verbose<span class="op">=</span><span class="dv">0</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[51], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> <span class="ansi-yellow-bg">model</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">predict</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">X_test</span><span class="ansi-yellow-bg">[</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">0</span><span class="ansi-yellow-bg">]</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">verbose</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">0</span><span class="ansi-yellow-bg">)</span>;

File <span class="ansi-green-fg">~/miniconda3/envs/ai2025/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py:122</span>, in <span class="ansi-cyan-fg">filter_traceback.&lt;locals&gt;.error_handler</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-fg ansi-bold">    119</span>     filtered_tb <span style="color:rgb(98,98,98)">=</span> _process_traceback_frames(e<span style="color:rgb(98,98,98)">.</span>__traceback__)
<span class="ansi-green-fg ansi-bold">    120</span>     <span style="font-style:italic;color:rgb(95,135,135)"># To get the full stack trace, call:</span>
<span class="ansi-green-fg ansi-bold">    121</span>     <span style="font-style:italic;color:rgb(95,135,135)"># `keras.config.disable_traceback_filtering()`</span>
<span class="ansi-green-fg">--&gt; 122</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> e<span style="color:rgb(98,98,98)">.</span>with_traceback(filtered_tb) <span style="font-weight:bold;color:rgb(0,135,0)">from</span><span style="color:rgb(188,188,188)"> </span><span style="font-weight:bold;color:rgb(0,135,0)">None</span>
<span class="ansi-green-fg ansi-bold">    123</span> <span style="font-weight:bold;color:rgb(0,135,0)">finally</span>:
<span class="ansi-green-fg ansi-bold">    124</span>     <span style="font-weight:bold;color:rgb(0,135,0)">del</span> filtered_tb

File <span class="ansi-green-fg">~/miniconda3/envs/ai2025/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py:122</span>, in <span class="ansi-cyan-fg">filter_traceback.&lt;locals&gt;.error_handler</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-fg ansi-bold">    119</span>     filtered_tb <span style="color:rgb(98,98,98)">=</span> _process_traceback_frames(e<span style="color:rgb(98,98,98)">.</span>__traceback__)
<span class="ansi-green-fg ansi-bold">    120</span>     <span style="font-style:italic;color:rgb(95,135,135)"># To get the full stack trace, call:</span>
<span class="ansi-green-fg ansi-bold">    121</span>     <span style="font-style:italic;color:rgb(95,135,135)"># `keras.config.disable_traceback_filtering()`</span>
<span class="ansi-green-fg">--&gt; 122</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> e<span style="color:rgb(98,98,98)">.</span>with_traceback(filtered_tb) <span style="font-weight:bold;color:rgb(0,135,0)">from</span><span style="color:rgb(188,188,188)"> </span><span style="font-weight:bold;color:rgb(0,135,0)">None</span>
<span class="ansi-green-fg ansi-bold">    123</span> <span style="font-weight:bold;color:rgb(0,135,0)">finally</span>:
<span class="ansi-green-fg ansi-bold">    124</span>     <span style="font-weight:bold;color:rgb(0,135,0)">del</span> filtered_tb

<span class="ansi-red-fg">ValueError</span>: Exception encountered when calling MaxPooling2D.call().

<span class="ansi-bold">Negative dimension size caused by subtracting 2 from 1 for '{{node sequential_2_1/pool1_1/MaxPool2d}} = MaxPool[T=DT_FLOAT, data_format="NHWC", explicit_paddings=[], ksize=[1, 2, 2, 1], padding="VALID", strides=[1, 2, 2, 1]](sequential_2_1/conv1_1/Relu)' with input shapes: [32,60,1,16].</span>

Arguments received by MaxPooling2D.call():
  • inputs=tf.Tensor(shape=(32, 60, 1, 16), dtype=float32)</pre>
</div>
</div>
</div>
<div id="0e06c70b" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>X_val[<span class="dv">0</span>].shape, X_val[<span class="dv">0</span>][np.newaxis, :].shape, X_val[[<span class="dv">0</span>]].shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>((80, 60, 1), (1, 80, 60, 1), (1, 80, 60, 1))</code></pre>
</div>
</div>
<div id="2c4952ec" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>model.predict(X_val[[<span class="dv">0</span>]], verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>array([[-30.  , -46.01, -76.85, -74.39, -13.04, -21.11, -34.9 , -25.02,
        -45.43, -34.09, -29.34,  -3.66, -53.57, -66.41, -44.05, -41.37,
        -10.  , -31.52, -18.08,  -2.66, -61.44, -97.62, -84.54, -46.23,
        -44.52, -36.72, -80.16, -46.72, -10.52, -20.02, -33.99, -40.47,
        -36.44, -11.15, -50.59, -67.15, -42.65, -70.5 ,  -5.37, -24.98,
        -56.64, -63.09, -62.04,  30.84, -47.55, -35.19,   7.02, -11.23,
        -54.49, -14.22, -42.53, -17.99, -29.21, -56.19, -27.29]],
      dtype=float32)</code></pre>
</div>
</div>
</section>
<section id="predict-on-the-test-set-ii" class="level3">
<h3 class="anchored" data-anchor-id="predict-on-the-test-set-ii">Predict on the test set II</h3>
<div id="8f2632bc" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>model.predict(X_test[[<span class="dv">0</span>]], verbose<span class="op">=</span><span class="dv">0</span>).argmax()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>0</code></pre>
</div>
</div>
<div id="ff71eb3b" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>class_names[model.predict(X_test[[<span class="dv">0</span>]], verbose<span class="op">=</span><span class="dv">0</span>).argmax()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>'东'</code></pre>
</div>
</div>
<div id="ae151385" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>plt.imshow(X_test[<span class="dv">0</span>], cmap<span class="op">=</span><span class="st">"gray"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-59-output-1.png" width="570" height="705" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="error-analysis" class="level2">
<h2 class="anchored" data-anchor-id="error-analysis">Error Analysis</h2>
<section id="take-a-look-at-the-failure-cases" class="level3">
<h3 class="anchored" data-anchor-id="take-a-look-at-the-failure-cases">Take a look at the failure cases</h3>
<div id="fd4c7540" class="cell" data-execution_count="59">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_failed_predictions(X, y, class_names, max_errors <span class="op">=</span> <span class="dv">20</span>,</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>            num_rows <span class="op">=</span> <span class="dv">4</span>, num_cols <span class="op">=</span> <span class="dv">5</span>, title_font<span class="op">=</span>CHINESE_FONT):</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(num_cols <span class="op">*</span> <span class="dv">2</span>, num_rows <span class="op">*</span> <span class="dv">2</span>))</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>    errors <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> model.predict(X, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>    y_pred_classes <span class="op">=</span> y_pred.argmax(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>    y_pred_probs <span class="op">=</span> keras.ops.softmax(y_pred).numpy().max(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(y_pred)):</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> errors <span class="op">&gt;=</span> max_errors:</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> y_pred_classes[i] <span class="op">!=</span> y[i]:</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>            plt.subplot(num_rows, num_cols, errors <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>            plt.imshow(X[i], cmap<span class="op">=</span><span class="st">"gray"</span>)</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>            true_class <span class="op">=</span> class_names[y[i]]</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>            pred_class <span class="op">=</span> class_names[y_pred_classes[i]]</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>            conf <span class="op">=</span> y_pred_probs[i]</span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>            msg <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>true_class<span class="sc">}</span><span class="ss"> not </span><span class="sc">{</span>pred_class<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>conf<span class="op">*</span><span class="dv">100</span><span class="sc">:.0f}</span><span class="ss">%)"</span></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>            plt.title(msg, fontproperties<span class="op">=</span>title_font)</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>            plt.axis(<span class="st">"off"</span>)</span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>            errors <span class="op">+=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="8d0a8f9f" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>plot_failed_predictions(X_test, y_test, class_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-61-output-1.png" width="2681" height="2297" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="confidence-of-predictions" class="level3">
<h3 class="anchored" data-anchor-id="confidence-of-predictions">Confidence of predictions</h3>
<div id="cbb66e24" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>y_log <span class="op">=</span> model.predict(X_test, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> keras.ops.convert_to_numpy(keras.activations.softmax(y_log))</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>y_pred_class <span class="op">=</span> np.argmax(y_pred, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>y_pred_prob <span class="op">=</span> y_pred[np.arange(y_pred.shape[<span class="dv">0</span>]), y_pred_class]</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>confidence_when_correct <span class="op">=</span> y_pred_prob[y_pred_class <span class="op">==</span> y_test]</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>confidence_when_wrong <span class="op">=</span> y_pred_prob[y_pred_class <span class="op">!=</span> y_test]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="columns">
<div class="column">
<div id="315cdb57" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>plt.hist(confidence_when_correct)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-63-output-1.png" width="1584" height="690" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div><div class="column">
<div id="cf5e67c8" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>plt.hist(confidence_when_wrong)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-64-output-1.png" width="1553" height="690" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="another-test-set" class="level3">
<h3 class="anchored" data-anchor-id="another-test-set">Another test set</h3>
<p>55 poorly written Mandarin characters (<span class="math inline">55 \times 7 = 385</span>).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="mandarin-practice-notebook3.png" class="img-fluid figure-img"></p>
<figcaption>Dataset of notes when learning/practising basic characters.</figcaption>
</figure>
</div>
</section>
<section id="evaluate-on-the-new-test-set" class="level3">
<h3 class="anchored" data-anchor-id="evaluate-on-the-new-test-set">Evaluate on the new test set</h3>
<div id="338f74f8" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>X_pat, y_pat, pat_class_names <span class="op">=</span> load_images_from_directory(Path(<span class="st">"mandarin"</span>), img_height, img_width)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> pat_class_names <span class="op">==</span> class_names, <span class="st">"Class names do not match!"</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Mandarin: X=</span><span class="sc">{</span>X_pat<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">, y=</span><span class="sc">{</span>y_pat<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mandarin: X=(385, 80, 60, 1), y=(385,)</code></pre>
</div>
</div>
<div id="2b1a0562" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>pat_metrics <span class="op">=</span> model.evaluate(X_pat, y_pat, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>pat_metrics</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="63">
<pre><code>[3.211982011795044, 0.8025974035263062, 0.9636363387107849]</code></pre>
</div>
</div>
<div id="cd8e741a" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>correct <span class="op">=</span> model.predict(X_pat, verbose<span class="op">=</span><span class="dv">0</span>).argmax(axis<span class="op">=</span><span class="dv">1</span>) <span class="op">==</span> y_pat</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>np.sum(<span class="op">~</span>correct)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<pre><code>76</code></pre>
</div>
</div>
</section>
<section id="errors" class="level3">
<h3 class="anchored" data-anchor-id="errors">Errors</h3>
<div id="c9e6fdd9" class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>plot_failed_predictions(X_pat, y_pat, class_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-68-output-1.png" width="2681" height="2297" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="which-is-worst" class="level3">
<h3 class="anchored" data-anchor-id="which-is-worst">Which is worst…</h3>
<div id="f8a7f2a7" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>class_accuracies <span class="op">=</span> []</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_classes):</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>    class_indices <span class="op">=</span> y_pat <span class="op">==</span> i</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> model.predict(X_pat[class_indices], verbose<span class="op">=</span><span class="dv">0</span>).argmax(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>    class_correct <span class="op">=</span> y_pred <span class="op">==</span> y_pat[class_indices]</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    class_accuracies.append(np.mean(class_correct))</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>class_accuracies <span class="op">=</span> pd.DataFrame({<span class="st">"Class"</span>: class_names, <span class="st">"Accuracy"</span>: class_accuracies})</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>class_accuracies.sort_values(<span class="st">"Accuracy"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="66">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Class</th>
<th data-quarto-table-cell-role="th">Accuracy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>吠</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12</td>
<td>囡</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>吗</td>
<td>0.142857</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">14</td>
<td>大</td>
<td>0.142857</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>林</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>森</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>川</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">27</td>
<td>木</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

<p>55 rows × 2 columns</p>
</div>
</div>
</div>
</section>
<section id="least-ai--legible-characters" class="level3">
<h3 class="anchored" data-anchor-id="least-ai--legible-characters">Least (AI-) legible characters</h3>
<div id="d40ee7bf" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>fails <span class="op">=</span> class_accuracies[class_accuracies[<span class="st">"Accuracy"</span>] <span class="op">&lt;</span> <span class="fl">0.5</span>]</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>fails.sort_values(<span class="st">"Accuracy"</span>).plot(kind<span class="op">=</span><span class="st">"bar"</span>, x<span class="op">=</span><span class="st">"Class"</span>)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>plt.xticks(fontproperties<span class="op">=</span>CHINESE_FONT, rotation<span class="op">=</span><span class="dv">0</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="computer-vision_files/figure-html/cell-70-output-1.png" width="1537" height="755" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="hyperparameter-tuning" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="hyperparameter-tuning">Hyperparameter tuning</h2>
<section id="trial-error" class="level3">
<h3 class="anchored" data-anchor-id="trial-error">Trial &amp; error</h3>
<div class="columns">
<div class="column">
<p><br> <br></p>
<p>Frankly, a lot of this is just ‘enlightened’ trial and error.</p>
</div><div class="column">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="twitter-advice.png" class="img-fluid figure-img"></p>
<figcaption>Or ‘received wisdom’ from experts…</figcaption>
</figure>
</div>
</div>
</div>
<div class="footer">
<p>Source: <a href="https://twitter.com/tetraduzione/status/1525501171221274627?s=20&amp;t=ulVFesw-f7hCuG9KyaoYbQ">Twitter</a>.</p>
</div>
</section>
<section id="keras-tuner" class="level3">
<h3 class="anchored" data-anchor-id="keras-tuner">Keras Tuner</h3>
<div id="f89829a2" class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install keras<span class="op">-</span>tuner</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="9707db66" class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> keras_tuner <span class="im">as</span> kt</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_model(hp):</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> Sequential()</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>    model.add(</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>        Dense(</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>            hp.Choice(<span class="st">"neurons"</span>, [<span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">16</span>, <span class="dv">32</span>, <span class="dv">64</span>, <span class="dv">128</span>, <span class="dv">256</span>]),</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>            activation<span class="op">=</span>hp.Choice(<span class="st">"activation"</span>,</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>                [<span class="st">"relu"</span>, <span class="st">"leaky_relu"</span>, <span class="st">"tanh"</span>]),</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>    model.add(Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"exponential"</span>))</span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>    learning_rate <span class="op">=</span> hp.Float(<span class="st">"lr"</span>,</span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>        min_value<span class="op">=</span><span class="fl">1e-4</span>, max_value<span class="op">=</span><span class="fl">1e-2</span>, sampling<span class="op">=</span><span class="st">"log"</span>)</span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>    opt <span class="op">=</span> keras.optimizers.Adam(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>    model.compile(optimizer<span class="op">=</span>opt, loss<span class="op">=</span><span class="st">"poisson"</span>)</span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="do-a-random-search" class="level3">
<h3 class="anchored" data-anchor-id="do-a-random-search">Do a random search</h3>
<div class="columns">
<div class="column" style="width:60%;">
<div id="5efb93d9" class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>tuner <span class="op">=</span> kt.RandomSearch(</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  build_model,</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  objective<span class="op">=</span><span class="st">"val_loss"</span>,</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  max_trials<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>  directory<span class="op">=</span><span class="st">"random-search"</span>)</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>es <span class="op">=</span> EarlyStopping(patience<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>  restore_best_weights<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>tuner.search(X_train_sc, y_train,</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>  epochs<span class="op">=</span><span class="dv">100</span>, callbacks <span class="op">=</span> [es],</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>  validation_data<span class="op">=</span>(X_val_sc, y_val))</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>best_model <span class="op">=</span> tuner.get_best_models()[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reloading Tuner from random-search/untitled_project/tuner0.json</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/plaub/miniconda3/envs/ai2025/lib/python3.11/site-packages/keras/src/saving/saving_lib.py:757: UserWarning: Skipping variable loading for optimizer 'adam', because it has 2 variables whereas the saved optimizer has 10 variables. 
  saveable.load_own_variables(weights_store.get(inner_path))</code></pre>
</div>
</div>
</div><div class="column" style="width:40%;">
<div id="9417e37c" class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>tuner.results_summary(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Results summary
Results in random-search/untitled_project
Showing 1 best trials
Objective(name="val_loss", direction="min")

Trial 02 summary
Hyperparameters:
neurons: 8
activation: tanh
lr: 0.0021043482724264983
Score: 0.3167361915111542</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="tune-layers-separately" class="level3">
<h3 class="anchored" data-anchor-id="tune-layers-separately">Tune layers separately</h3>
<div id="777c3b04" class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_model(hp):</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> Sequential()</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(hp.Int(<span class="st">"numHiddenLayers"</span>, <span class="dv">1</span>, <span class="dv">3</span>)):</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Tune number of units in each layer separately.</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>      model.add(</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>          Dense(</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>              hp.Choice(<span class="ss">f"neurons_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>, [<span class="dv">8</span>, <span class="dv">16</span>, <span class="dv">32</span>, <span class="dv">64</span>]),</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>              activation<span class="op">=</span><span class="st">"relu"</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>    model.add(Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"exponential"</span>))</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>    opt <span class="op">=</span> keras.optimizers.Adam(learning_rate<span class="op">=</span><span class="fl">0.0005</span>)</span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>    model.compile(optimizer<span class="op">=</span>opt, loss<span class="op">=</span><span class="st">"poisson"</span>)</span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="do-a-bayesian-search" class="level3">
<h3 class="anchored" data-anchor-id="do-a-bayesian-search">Do a Bayesian search</h3>
<div class="columns">
<div class="column" style="width:60%;">
<div id="712722a2" class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>tuner <span class="op">=</span> kt.BayesianOptimization(</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  build_model,</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  objective<span class="op">=</span><span class="st">"val_loss"</span>,</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>  directory<span class="op">=</span><span class="st">"bayesian-search"</span>,</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>  max_trials<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>es <span class="op">=</span> EarlyStopping(patience<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>  restore_best_weights<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>tuner.search(X_train_sc, y_train,</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>  epochs<span class="op">=</span><span class="dv">100</span>, callbacks <span class="op">=</span> [es],</span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>  validation_data<span class="op">=</span>(X_val_sc, y_val))</span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>best_model <span class="op">=</span> tuner.get_best_models()[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reloading Tuner from bayesian-search/untitled_project/tuner0.json</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/plaub/miniconda3/envs/ai2025/lib/python3.11/site-packages/keras/src/saving/saving_lib.py:757: UserWarning: Skipping variable loading for optimizer 'adam', because it has 2 variables whereas the saved optimizer has 18 variables. 
  saveable.load_own_variables(weights_store.get(inner_path))</code></pre>
</div>
</div>
</div><div class="column" style="width:40%;">
<div id="56166041" class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>tuner.results_summary(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Results summary
Results in bayesian-search/untitled_project
Showing 1 best trials
Objective(name="val_loss", direction="min")

Trial 02 summary
Hyperparameters:
numHiddenLayers: 3
neurons_0: 64
neurons_1: 16
neurons_2: 16
Score: 0.3142806887626648</code></pre>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="benchmark-problems" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="benchmark-problems">Benchmark Problems</h2>
<section id="demo-object-classification" class="level3">
<h3 class="anchored" data-anchor-id="demo-object-classification">Demo: Object classification</h3>
<div class="columns">
<div class="column">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="teach-images.png" class="img-fluid figure-img"></p>
<figcaption>Example object classification run.</figcaption>
</figure>
</div>
</div><div class="column">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://info.deeplearning.ai/hs-fs/hubfs/NOCODE.gif?width=1199&amp;upscale=true&amp;name=NOCODE.gif" class="img-fluid figure-img"></p>
<figcaption>Example of object classification.</figcaption>
</figure>
</div>
</div>
</div>
<div class="footer">
<p>Source: Teachable Machine, <a href="https://teachablemachine.withgoogle.com/">https://teachablemachine.withgoogle.com/</a>.</p>
</div>
</section>
<section id="how-does-that-work" class="level3">
<h3 class="anchored" data-anchor-id="how-does-that-work">How does that work?</h3>
<blockquote class="blockquote">
<p>… these models use a technique called transfer learning. There’s a pretrained neural network, and when you create your own classes, you can sort of picture that your classes are becoming the last layer or step of the neural net. Specifically, both the image and pose models are learning off of pretrained mobilenet models …</p>
</blockquote>
<p><a href="https://teachablemachine.withgoogle.com/faq#Diving-Deeper">Teachable Machine FAQ</a></p>
</section>
<section id="benchmarks" class="level3">
<h3 class="anchored" data-anchor-id="benchmarks">Benchmarks</h3>
<p><a href="https://www.cs.toronto.edu/~kriz/cifar.html">CIFAR-11 / CIFAR-100 dataset</a> from Canadian Institute for Advanced Research</p>
<ul>
<li>9 classes: 60000 32x32 colour images</li>
<li>99 classes: 60000 32x32 colour images</li>
</ul>
<p><a href="https://www.image-net.org/index.php">ImageNet</a> and the <em>ImageNet Large Scale Visual Recognition Challenge (ILSVRC)</em>; originally <a href="https://image-net.org/challenges/LSVRC/2014/browse-synsets">1,000 synsets</a>.</p>
<ul>
<li>In 2021: 14,197,122 labelled images from 21,841 synsets.</li>
<li>See <a href="https://keras.io/api/applications/">Keras applications</a> for downloadable models.</li>
</ul>
</section>
<section id="lenet-6-1998" class="level3 smaller">
<h3 class="smaller anchored" data-anchor-id="lenet-6-1998">LeNet-6 (1998)</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 9%">
<col style="width: 23%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 18%">
<col style="width: 11%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th>Layer</th>
<th>Type</th>
<th>Channels</th>
<th>Size</th>
<th>Kernel size</th>
<th>Stride</th>
<th>Activation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>In</td>
<td>Input</td>
<td>0</td>
<td>32×32</td>
<td>–</td>
<td>–</td>
<td>–</td>
</tr>
<tr class="even">
<td>C0</td>
<td>Convolution</td>
<td>6</td>
<td>28×28</td>
<td>5×5</td>
<td>1</td>
<td>tanh</td>
</tr>
<tr class="odd">
<td>S1</td>
<td>Avg pooling</td>
<td>6</td>
<td>14×14</td>
<td>2×2</td>
<td>2</td>
<td>tanh</td>
</tr>
<tr class="even">
<td>C2</td>
<td>Convolution</td>
<td>16</td>
<td>10×10</td>
<td>5×5</td>
<td>1</td>
<td>tanh</td>
</tr>
<tr class="odd">
<td>S3</td>
<td>Avg pooling</td>
<td>16</td>
<td>5×5</td>
<td>2×2</td>
<td>2</td>
<td>tanh</td>
</tr>
<tr class="even">
<td>C4</td>
<td>Convolution</td>
<td>120</td>
<td>1×1</td>
<td>5×5</td>
<td>1</td>
<td>tanh</td>
</tr>
<tr class="odd">
<td>F5</td>
<td>Fully connected</td>
<td>–</td>
<td>84</td>
<td>–</td>
<td>–</td>
<td>tanh</td>
</tr>
<tr class="even">
<td>Out</td>
<td>Fully connected</td>
<td>–</td>
<td>9</td>
<td>–</td>
<td>–</td>
<td>RBF</td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>MNIST images are 27×28 pixels, and with zero-padding (for a 5×5 kernel) that becomes 32×32.</p>
</div>
</div>
<div class="footer">
<p>Source: Aurélien Géron (2018), <em>Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</em>, 2nd Edition, Chapter 14.</p>
</div>
</section>
<section id="alexnet-2011" class="level3 smaller">
<h3 class="smaller anchored" data-anchor-id="alexnet-2011">AlexNet (2011)</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 8%">
<col style="width: 19%">
<col style="width: 10%">
<col style="width: 12%">
<col style="width: 15%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th>Layer</th>
<th>Type</th>
<th>Channels</th>
<th>Size</th>
<th>Kernel</th>
<th>Stride</th>
<th>Padding</th>
<th>Activation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>In</td>
<td>Input</td>
<td>2</td>
<td>227×227</td>
<td>–</td>
<td>–</td>
<td>–</td>
<td>–</td>
</tr>
<tr class="even">
<td>C0</td>
<td>Convolution</td>
<td>96</td>
<td>55×55</td>
<td>11×11</td>
<td>4</td>
<td>valid</td>
<td>ReLU</td>
</tr>
<tr class="odd">
<td>S1</td>
<td>Max pool</td>
<td>96</td>
<td>27×27</td>
<td>3×3</td>
<td>2</td>
<td>valid</td>
<td>–</td>
</tr>
<tr class="even">
<td>C2</td>
<td>Convolution</td>
<td>256</td>
<td>27×27</td>
<td>5×5</td>
<td>1</td>
<td>same</td>
<td>ReLU</td>
</tr>
<tr class="odd">
<td>S3</td>
<td>Max pool</td>
<td>256</td>
<td>13×13</td>
<td>3×3</td>
<td>2</td>
<td>valid</td>
<td>–</td>
</tr>
<tr class="even">
<td>C4</td>
<td>Convolution</td>
<td>384</td>
<td>13×13</td>
<td>3×3</td>
<td>1</td>
<td>same</td>
<td>ReLU</td>
</tr>
<tr class="odd">
<td>C5</td>
<td>Convolution</td>
<td>384</td>
<td>13×13</td>
<td>3×3</td>
<td>1</td>
<td>same</td>
<td>ReLU</td>
</tr>
<tr class="even">
<td>C6</td>
<td>Convolution</td>
<td>256</td>
<td>13×13</td>
<td>3×3</td>
<td>1</td>
<td>same</td>
<td>ReLU</td>
</tr>
<tr class="odd">
<td>S7</td>
<td>Max pool</td>
<td>256</td>
<td>6×6</td>
<td>3×3</td>
<td>2</td>
<td>valid</td>
<td>–</td>
</tr>
<tr class="even">
<td>F8</td>
<td>Fully conn.</td>
<td>–</td>
<td>4,096</td>
<td>–</td>
<td>–</td>
<td>–</td>
<td>ReLU</td>
</tr>
<tr class="odd">
<td>F9</td>
<td>Fully conn.</td>
<td>–</td>
<td>4,096</td>
<td>–</td>
<td>–</td>
<td>–</td>
<td>ReLU</td>
</tr>
<tr class="even">
<td>Out</td>
<td>Fully conn.</td>
<td>–</td>
<td>0,000</td>
<td>–</td>
<td>–</td>
<td>–</td>
<td>Softmax</td>
</tr>
</tbody>
</table>
<div class="footer">
<p>Winner of the ILSVRC 2012 challenge (top-five error 17%), developed by Alex Krizhevsky, Ilya Sutskever, and Geoffrey Hinton.</p>
</div>
</section>
<section id="data-augmentation" class="level3">
<h3 class="anchored" data-anchor-id="data-augmentation">Data Augmentation</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data-augmentation.png" class="img-fluid figure-img"></p>
<figcaption>Examples of data augmentation.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Buah et al.&nbsp;(2019), <em>Can Artificial Intelligence Assist Project Developers in Long-Term Management of Energy Projects? The Case of CO2 Capture and Storage</em>.</p>
</div>
</section>
<section id="inception-module-2013" class="level3">
<h3 class="anchored" data-anchor-id="inception-module-2013">Inception module (2013)</h3>
<p>Used in ILSVRC 2013 winning solution (top-5 error &lt; 7%).</p>
<div class="columns">
<div class="column" style="width:59%;">
<p><img src="inception-module-fig-2b.png" class="img-fluid"></p>
</div><div class="column" style="width:39%;">
<p><br></p>
<p><img src="inception-meme.jpeg" class="img-fluid"></p>
</div>
</div>
<p>VGGNet was the runner-up.</p>
<div class="footer">
<p>Source: Szegedy, C. et al.&nbsp;(2014), <a href="https://arxiv.org/pdf/1409.4842.pdf"><em>Going deeper with convolutions</em></a>. and <a href="https://knowyourmeme.com/memes/we-need-to-go-deeper">KnowYourMeme.com</a></p>
</div>
</section>
<section id="googlenet-inception_v0-2014" class="level3">
<h3 class="anchored" data-anchor-id="googlenet-inception_v0-2014">GoogLeNet / Inception_v0 (2014)</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Geron-mls2_1414.png" class="img-fluid figure-img"></p>
<figcaption>Schematic of the GoogLeNet architecture.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Aurélien Géron (2018), <em>Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</em>, 2nd Edition, Figure 14-14.</p>
</div>
</section>
<section id="depth-is-important-for-image-tasks" class="level3">
<h3 class="anchored" data-anchor-id="depth-is-important-for-image-tasks">Depth is important for image tasks</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="goodfellow-depth-matters.png" class="img-fluid figure-img"></p>
<figcaption>Deeper models aren’t just better because they have more parameters. Model depth given in the legend. Accuracy is on the Street View House Numbers dataset.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Goodfellow et al.&nbsp;(2015), <a href="http://www.deeplearningbook.org">Deep Learning</a>, Figure 6.7.</p>
</div>
</section>
<section id="residual-connection" class="level3">
<h3 class="anchored" data-anchor-id="residual-connection">Residual connection</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Geron-mls2_1415.png" class="img-fluid figure-img"></p>
<figcaption>Illustration of a residual connection.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Aurélien Géron (2018), <em>Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</em>, 2nd Edition, Figure 14-15.</p>
</div>
</section>
<section id="resnet-2014" class="level3">
<h3 class="anchored" data-anchor-id="resnet-2014">ResNet (2014)</h3>
<p>ResNet won the ILSVRC 2014 challenge (top-5 error 3.6%), developed by <a href="https://arxiv.org/abs/1512.03385">Kaiming He et al.</a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Geron-mls2_1417.png" class="img-fluid figure-img"></p>
<figcaption>Diagram of the ResNet architecture.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Aurélien Géron (2018), <em>Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</em>, 2nd Edition, Figure 14-17.</p>
</div>
</section>
</section>
<section id="transfer-learning" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="transfer-learning">Transfer Learning</h2>
<section id="transfer-learning-1" class="level3">
<h3 class="anchored" data-anchor-id="transfer-learning-1">Transfer learning</h3>
<div class="sourceCode" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pull in the base model we are transferring from.</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>base_model <span class="op">=</span> keras.applications.Xception(</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>    weights<span class="op">=</span><span class="st">"imagenet"</span>,  <span class="co"># Load weights pre-trained on ImageNet.</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>    input_shape<span class="op">=</span>(<span class="dv">149</span>, <span class="dv">150</span>, <span class="dv">3</span>),</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>    include_top<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>)  <span class="co"># Discard the ImageNet classifier at the top.</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell it not to update its weights.</span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>base_model.trainable <span class="op">=</span> <span class="va">False</span></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Make our new model on top of the base model.</span></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>inputs <span class="op">=</span> keras.Input(shape<span class="op">=</span>(<span class="dv">149</span>, <span class="dv">150</span>, <span class="dv">3</span>))</span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> base_model(inputs, training<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> keras.layers.GlobalAveragePooling1D()(x)</span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a>outputs <span class="op">=</span> keras.layers.Dense(<span class="dv">0</span>)(x)</span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Model(inputs, outputs)</span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Compile and fit on our data.</span></span>
<span id="cb99-19"><a href="#cb99-19" aria-hidden="true" tabindex="-1"></a>model.compile(</span>
<span id="cb99-20"><a href="#cb99-20" aria-hidden="true" tabindex="-1"></a>    optimizer<span class="op">=</span>keras.optimizers.Adam(),</span>
<span id="cb99-21"><a href="#cb99-21" aria-hidden="true" tabindex="-1"></a>    loss<span class="op">=</span>keras.losses.BinaryCrossentropy(from_logits<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb99-22"><a href="#cb99-22" aria-hidden="true" tabindex="-1"></a>    metrics<span class="op">=</span>[keras.metrics.BinaryAccuracy()],</span>
<span id="cb99-23"><a href="#cb99-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb99-24"><a href="#cb99-24" aria-hidden="true" tabindex="-1"></a>model.fit(new_dataset, epochs<span class="op">=</span><span class="dv">19</span>, callbacks<span class="op">=</span>..., validation_data<span class="op">=</span>...)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="footer">
<p>Source: François Chollet (2019), <a href="https://keras.io/guides/transfer_learning/">Transfer learning &amp; fine-tuning</a>, Keras documentation.</p>
</div>
</section>
<section id="fine-tuning" class="level3">
<h3 class="anchored" data-anchor-id="fine-tuning">Fine-tuning</h3>
<div class="sourceCode" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Unfreeze the base model</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>base_model.trainable <span class="op">=</span> <span class="va">True</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="co"># It's important to recompile your model after you make any changes</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="co"># to the `trainable` attribute of any inner layer, so that your changes</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a><span class="co"># are take into account</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>model.compile(</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>    optimizer<span class="op">=</span>keras.optimizers.Adam(<span class="fl">0e-5</span>),  <span class="co"># Very low learning rate</span></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>    loss<span class="op">=</span>keras.losses.BinaryCrossentropy(from_logits<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>    metrics<span class="op">=</span>[keras.metrics.BinaryAccuracy()],</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Train end-to-end. Be careful to stop before you overfit!</span></span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>model.fit(new_dataset, epochs<span class="op">=</span><span class="dv">9</span>, callbacks<span class="op">=</span>..., validation_data<span class="op">=</span>...)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>Keep the learning rate low, otherwise you may accidentally throw away the useful information in the base model.</p>
</div>
</div>
<div class="footer">
<p>Source: François Chollet (2019), <a href="https://keras.io/guides/transfer_learning/">Transfer learning &amp; fine-tuning</a>, Keras documentation.</p>
</div>
</section>


</section>

<div id="quarto-appendix" class="default"><section id="package-versions" class="level3 appendix" data-visibility="uncounted"><h2 class="anchored quarto-appendix-heading">Package Versions</h2><div class="quarto-appendix-contents">

<div id="093b04c4" class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> watermark <span class="im">import</span> watermark</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(watermark(python<span class="op">=</span><span class="va">True</span>, packages<span class="op">=</span><span class="st">"keras,matplotlib,numpy,pandas,seaborn,scipy,torch,tensorflow,tf_keras"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Python implementation: CPython
Python version       : 3.11.11
IPython version      : 8.32.0

keras     : 3.8.0
matplotlib: 3.10.0
numpy     : 1.26.4
pandas    : 2.2.3
seaborn   : 0.13.2
scipy     : 1.13.1
torch     : 2.5.1
tensorflow: 2.18.0
tf_keras  : 2.18.0
</code></pre>
</div>
</div>
</div></section><section id="glossary" class="level3 appendix" data-visibility="uncounted"><h2 class="anchored quarto-appendix-heading">Glossary</h2><div class="quarto-appendix-contents">

<div class="columns">
<div class="column">
<ul>
<li>AlexNet</li>
<li>benchmark problems</li>
<li>channels</li>
<li>CIFAR-10 / CIFAR-100</li>
<li>computer vision</li>
<li>convolutional layer</li>
<li>convolutional network</li>
<li>error analysis</li>
<li>filter</li>
<li>GoogLeNet &amp; Inception</li>
</ul>
</div><div class="column">
<ul>
<li>ImageNet challenge</li>
<li>fine-tuning</li>
<li>flatten layer</li>
<li>kernel</li>
<li>max pooling</li>
<li>MNIST</li>
<li>stride</li>
<li>tensor (rank)</li>
<li>transfer learning</li>
</ul>
</div>
</div>


</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../Exercises/french-motor-frequency.html" class="pagination-link" aria-label="Exercise: French Motor Claim Frequency">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Exercise: French Motor Claim Frequency</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../Labs/latex-lab.html" class="pagination-link" aria-label="Lab: Markdown">
        <span class="nav-page-text">Lab: Markdown</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>