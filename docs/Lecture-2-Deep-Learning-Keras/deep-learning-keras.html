<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Patrick Laub">

<title>AI for Actuaries - Deep Learning with Keras</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../Lecture-2-Deep-Learning-Keras/project.html" rel="next">
<link href="../Exercises/chess-ai.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../Lecture-2-Deep-Learning-Keras/deep-learning-keras.html">Module 2</a></li><li class="breadcrumb-item"><a href="../Lecture-2-Deep-Learning-Keras/deep-learning-keras.html">Deep Learning with Keras</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">AI for Actuaries</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Module 1</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-1-Artificial-Intelligence/course-overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-1-Artificial-Intelligence/artificial-intelligence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Artificial Intelligence</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-1-Artificial-Intelligence/python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Labs/python-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab: Intro Python</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Labs/python-for-data-science-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab: Python for Data Science</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Exercises/chess-ai.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise: Chess AI</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Module 2</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-2-Deep-Learning-Keras/deep-learning-keras.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Deep Learning with Keras</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-2-Deep-Learning-Keras/project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Project Details</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-3-Tabular-Data/categorical-variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Categorical Variables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-3-Tabular-Data/classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Classification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Labs/matplotlib-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab: Matplotlib</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Labs/forward-pass-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab: Forward Pass</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Exercises/victorian-crash-severity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise: Victorian Car Crash Severity</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Module 3</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-4-Computer-Vision/computer-vision.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Computer Vision</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Labs/latex-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab: LaTeX</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Labs/optimisation-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab: Optimisation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Exercises/hurricane-damage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise: Aerial Photos of Hurricane Damage</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Module 4</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-5-Natural-Language-Processing/natural-language-processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Natural Language Processing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Exercises/police-reports.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise: Police Reports of US Car Crashes</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Module 5</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-7-Recurrent-Neural-Networks-And-Time-Series/rnns-and-time-series.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Recurrent Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Exercises/sydney-airport-temperature.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise: Sydney Temperature Forecasting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Module 6</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-6-Distributional-Regression/distributional-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributional Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Labs/backpropagation-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab: Backpropagation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Labs/distributional-regression-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab: Distributional Regression</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Module 7</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-9-Advanced-Topics/interpretability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interpretability</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">
 <span class="menu-text">Module 8</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-8-Generative-Networks/generative-networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generative Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-8-Generative-Networks/gans.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generative Adversarial Networks</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true">
 <span class="menu-text">Module 9</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-9-Advanced-Topics/next-steps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Next Steps</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#california-house-price-prediction" id="toc-california-house-price-prediction" class="nav-link active" data-scroll-target="#california-house-price-prediction">California House Price Prediction</a>
  <ul class="collapse">
  <li><a href="#data-science-always-starts-with-the-data" id="toc-data-science-always-starts-with-the-data" class="nav-link" data-scroll-target="#data-science-always-starts-with-the-data">Data science always starts with the data!</a></li>
  <li><a href="#columns" id="toc-columns" class="nav-link" data-scroll-target="#columns">Columns</a></li>
  <li><a href="#import-the-data" id="toc-import-the-data" class="nav-link" data-scroll-target="#import-the-data">Import the data</a></li>
  <li><a href="#what-is-the-target" id="toc-what-is-the-target" class="nav-link" data-scroll-target="#what-is-the-target">What is the target?</a></li>
  <li><a href="#an-entire-ml-project" id="toc-an-entire-ml-project" class="nav-link" data-scroll-target="#an-entire-ml-project">An entire ML project</a></li>
  <li><a href="#questions-to-answer-in-ml-project" id="toc-questions-to-answer-in-ml-project" class="nav-link" data-scroll-target="#questions-to-answer-in-ml-project">Questions to answer in ML project</a></li>
  <li><a href="#set-aside-a-fraction-for-a-test-set" id="toc-set-aside-a-fraction-for-a-test-set" class="nav-link" data-scroll-target="#set-aside-a-fraction-for-a-test-set">Set aside a fraction for a test set</a></li>
  <li><a href="#basic-ml-workflow" id="toc-basic-ml-workflow" class="nav-link" data-scroll-target="#basic-ml-workflow">Basic ML workflow</a></li>
  <li><a href="#split-three-ways" id="toc-split-three-ways" class="nav-link" data-scroll-target="#split-three-ways">Split three ways</a></li>
  <li><a href="#why-not-use-test-set-for-both" id="toc-why-not-use-test-set-for-both" class="nav-link" data-scroll-target="#why-not-use-test-set-for-both">Why not use test set for both?</a></li>
  </ul></li>
  <li><a href="#eda-baseline-model" id="toc-eda-baseline-model" class="nav-link" data-scroll-target="#eda-baseline-model">EDA &amp; Baseline Model</a>
  <ul class="collapse">
  <li><a href="#the-training-set" id="toc-the-training-set" class="nav-link" data-scroll-target="#the-training-set">The training set</a></li>
  <li><a href="#location" id="toc-location" class="nav-link" data-scroll-target="#location">Location</a></li>
  <li><a href="#location-eda" id="toc-location-eda" class="nav-link" data-scroll-target="#location-eda">Location EDA</a></li>
  <li><a href="#pandas-can-make-plots-directly" id="toc-pandas-can-make-plots-directly" class="nav-link" data-scroll-target="#pandas-can-make-plots-directly">Pandas can make plots directly</a></li>
  <li><a href="#features" id="toc-features" class="nav-link" data-scroll-target="#features">Features</a></li>
  <li><a href="#linear-regression" id="toc-linear-regression" class="nav-link" data-scroll-target="#linear-regression">Linear Regression</a></li>
  <li><a href="#make-some-predictions" id="toc-make-some-predictions" class="nav-link" data-scroll-target="#make-some-predictions">Make some predictions</a></li>
  <li><a href="#plot-the-predictions" id="toc-plot-the-predictions" class="nav-link" data-scroll-target="#plot-the-predictions">Plot the predictions</a></li>
  <li><a href="#calculate-mean-squared-error" id="toc-calculate-mean-squared-error" class="nav-link" data-scroll-target="#calculate-mean-squared-error">Calculate mean squared error</a></li>
  <li><a href="#using-mean_squared_error" id="toc-using-mean_squared_error" class="nav-link" data-scroll-target="#using-mean_squared_error">Using <code>mean_squared_error</code></a></li>
  </ul></li>
  <li><a href="#our-first-neural-network" id="toc-our-first-neural-network" class="nav-link" data-scroll-target="#our-first-neural-network">Our First Neural Network</a>
  <ul class="collapse">
  <li><a href="#what-are-keras-and-tensorflow" id="toc-what-are-keras-and-tensorflow" class="nav-link" data-scroll-target="#what-are-keras-and-tensorflow">What are Keras and TensorFlow?</a></li>
  <li><a href="#create-a-keras-ann-model" id="toc-create-a-keras-ann-model" class="nav-link" data-scroll-target="#create-a-keras-ann-model">Create a Keras ANN model</a></li>
  <li><a href="#inspect-the-model" id="toc-inspect-the-model" class="nav-link" data-scroll-target="#inspect-the-model">Inspect the model</a></li>
  <li><a href="#the-model-is-initialised-randomly" id="toc-the-model-is-initialised-randomly" class="nav-link" data-scroll-target="#the-model-is-initialised-randomly">The model is initialised randomly</a></li>
  <li><a href="#controlling-the-randomness" id="toc-controlling-the-randomness" class="nav-link" data-scroll-target="#controlling-the-randomness">Controlling the randomness</a></li>
  <li><a href="#fit-the-model" id="toc-fit-the-model" class="nav-link" data-scroll-target="#fit-the-model">Fit the model</a></li>
  <li><a href="#make-predictions" id="toc-make-predictions" class="nav-link" data-scroll-target="#make-predictions">Make predictions</a></li>
  <li><a href="#plot-the-predictions-1" id="toc-plot-the-predictions-1" class="nav-link" data-scroll-target="#plot-the-predictions-1">Plot the predictions</a></li>
  <li><a href="#assess-the-model" id="toc-assess-the-model" class="nav-link" data-scroll-target="#assess-the-model">Assess the model</a></li>
  </ul></li>
  <li><a href="#force-positive-predictions" id="toc-force-positive-predictions" class="nav-link" data-scroll-target="#force-positive-predictions">Force positive predictions</a>
  <ul class="collapse">
  <li><a href="#try-running-for-longer" id="toc-try-running-for-longer" class="nav-link" data-scroll-target="#try-running-for-longer">Try running for longer</a></li>
  <li><a href="#loss-curve" id="toc-loss-curve" class="nav-link" data-scroll-target="#loss-curve">Loss curve</a></li>
  <li><a href="#loss-curve-1" id="toc-loss-curve-1" class="nav-link" data-scroll-target="#loss-curve-1">Loss curve</a></li>
  <li><a href="#predictions" id="toc-predictions" class="nav-link" data-scroll-target="#predictions">Predictions</a></li>
  <li><a href="#try-different-activation-functions" id="toc-try-different-activation-functions" class="nav-link" data-scroll-target="#try-different-activation-functions">Try different activation functions</a></li>
  <li><a href="#enforce-positive-outputs-softplus" id="toc-enforce-positive-outputs-softplus" class="nav-link" data-scroll-target="#enforce-positive-outputs-softplus">Enforce positive outputs (softplus)</a></li>
  <li><a href="#plot-the-predictions-2" id="toc-plot-the-predictions-2" class="nav-link" data-scroll-target="#plot-the-predictions-2">Plot the predictions</a></li>
  <li><a href="#enforce-positive-outputs-mathrmex" id="toc-enforce-positive-outputs-mathrmex" class="nav-link" data-scroll-target="#enforce-positive-outputs-mathrmex">Enforce positive outputs (<span class="math inline">\mathrm{e}^{\,x}</span>)</a></li>
  <li><a href="#same-as-transforming-the-target" id="toc-same-as-transforming-the-target" class="nav-link" data-scroll-target="#same-as-transforming-the-target">Same as transforming the target</a></li>
  <li><a href="#good-to-know-others-results" id="toc-good-to-know-others-results" class="nav-link" data-scroll-target="#good-to-know-others-results">Good to know others results</a></li>
  <li><a href="#gpt-can-double-check-these-results" id="toc-gpt-can-double-check-these-results" class="nav-link" data-scroll-target="#gpt-can-double-check-these-results">GPT can double-check these results</a></li>
  </ul></li>
  <li><a href="#preprocessing" id="toc-preprocessing" class="nav-link" data-scroll-target="#preprocessing">Preprocessing</a>
  <ul class="collapse">
  <li><a href="#re-scaling-the-inputs" id="toc-re-scaling-the-inputs" class="nav-link" data-scroll-target="#re-scaling-the-inputs">Re-scaling the inputs</a></li>
  <li><a href="#same-model-with-scaled-inputs" id="toc-same-model-with-scaled-inputs" class="nav-link" data-scroll-target="#same-model-with-scaled-inputs">Same model with scaled inputs</a></li>
  <li><a href="#loss-curve-2" id="toc-loss-curve-2" class="nav-link" data-scroll-target="#loss-curve-2">Loss curve</a></li>
  <li><a href="#loss-curve-3" id="toc-loss-curve-3" class="nav-link" data-scroll-target="#loss-curve-3">Loss curve</a></li>
  <li><a href="#predictions-1" id="toc-predictions-1" class="nav-link" data-scroll-target="#predictions-1">Predictions</a></li>
  <li><a href="#comparing-mse-smaller-is-better" id="toc-comparing-mse-smaller-is-better" class="nav-link" data-scroll-target="#comparing-mse-smaller-is-better">Comparing MSE (smaller is better)</a></li>
  <li><a href="#comparing-models-train" id="toc-comparing-models-train" class="nav-link" data-scroll-target="#comparing-models-train">Comparing models (train)</a></li>
  <li><a href="#comparing-models-validation" id="toc-comparing-models-validation" class="nav-link" data-scroll-target="#comparing-models-validation">Comparing models (validation)</a></li>
  </ul></li>
  <li><a href="#early-stopping" id="toc-early-stopping" class="nav-link" data-scroll-target="#early-stopping">Early Stopping</a>
  <ul class="collapse">
  <li><a href="#choosing-when-to-stop-training" id="toc-choosing-when-to-stop-training" class="nav-link" data-scroll-target="#choosing-when-to-stop-training">Choosing when to stop training</a></li>
  <li><a href="#try-early-stopping" id="toc-try-early-stopping" class="nav-link" data-scroll-target="#try-early-stopping">Try early stopping</a></li>
  <li><a href="#loss-curve-4" id="toc-loss-curve-4" class="nav-link" data-scroll-target="#loss-curve-4">Loss curve</a></li>
  <li><a href="#loss-curve-ii" id="toc-loss-curve-ii" class="nav-link" data-scroll-target="#loss-curve-ii">Loss curve II</a></li>
  <li><a href="#predictions-2" id="toc-predictions-2" class="nav-link" data-scroll-target="#predictions-2">Predictions</a></li>
  <li><a href="#comparing-models-validation-1" id="toc-comparing-models-validation-1" class="nav-link" data-scroll-target="#comparing-models-validation-1">Comparing models (validation)</a></li>
  <li><a href="#the-test-set" id="toc-the-test-set" class="nav-link" data-scroll-target="#the-test-set">The test set</a></li>
  <li><a href="#another-useful-callback" id="toc-another-useful-callback" class="nav-link" data-scroll-target="#another-useful-callback">Another useful callback</a></li>
  
  
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="deep-learning-keras.slides.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../Lecture-2-Deep-Learning-Keras/deep-learning-keras.html">Module 2</a></li><li class="breadcrumb-item"><a href="../Lecture-2-Deep-Learning-Keras/deep-learning-keras.html">Deep Learning with Keras</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Deep Learning with Keras</h1>
<p class="subtitle lead">ACTL3143 &amp; ACTL5111 Deep Learning for Actuaries</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Patrick Laub </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div id="2160722f" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Show the package imports</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="california-house-price-prediction" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="california-house-price-prediction">California House Price Prediction</h2>
<section id="data-science-always-starts-with-the-data" class="level3">
<h3 class="anchored" data-anchor-id="data-science-always-starts-with-the-data">Data science always starts with the data!</h3>
<div class="columns">
<div class="column">
<blockquote class="blockquote">
<p>The target variable is the median house value for California districts, expressed in $100,000’s. This dataset was derived from the 1990 U.S. census, using one row per census block group. A block group is the smallest geographical unit for which the U.S. Census Bureau publishes sample data (a block group typically has a population of 600 to 3,000 people).</p>
</blockquote>
</div><div class="column">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="dalle-california-housing.jpeg" class="img-fluid figure-img"></p>
<figcaption>Dall-E’s rendition of the this dataset.</figcaption>
</figure>
</div>
</div>
</div>
<div class="footer">
<p>Source: <a href="https://scikit-learn.org/stable/datasets/real_world.html#california-housing-dataset">Scikit-learn documentation</a>.</p>
</div>
</section>
<section id="columns" class="level3">
<h3 class="anchored" data-anchor-id="columns">Columns</h3>
<ul>
<li><code>MedInc</code> median income in block group</li>
<li><code>HouseAge</code> median house age in block group</li>
<li><code>AveRooms</code> average number of rooms per household</li>
<li><code>AveBedrms</code> average # of bedrooms per household</li>
<li><code>Population</code> block group population</li>
<li><code>AveOccup</code> average number of household members</li>
<li><code>Latitude</code> block group latitude</li>
<li><code>Longitude</code> block group longitude</li>
<li><code>MedHouseVal</code> median house value (<strong>target</strong>)</li>
</ul>
<div class="footer">
<p>Source: <a href="https://scikit-learn.org/stable/datasets/real_world.html#california-housing-dataset">Scikit-learn documentation</a>.</p>
</div>
</section>
<section id="import-the-data" class="level3 smaller">
<h3 class="smaller anchored" data-anchor-id="import-the-data">Import the data</h3>
<div id="91d61c83" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="annotated-cell-1"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-1-1" class="code-annotation-target"><a href="#annotated-cell-1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.datasets <span class="im">import</span> fetch_california_housing</span>
<span id="annotated-cell-1-2"><a href="#annotated-cell-1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-1-3"><a href="#annotated-cell-1-3" aria-hidden="true" tabindex="-1"></a>features, target <span class="op">=</span> fetch_california_housing(</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-1-4" class="code-annotation-target"><a href="#annotated-cell-1-4" aria-hidden="true" tabindex="-1"></a>    as_frame<span class="op">=</span><span class="va">True</span>, return_X_y<span class="op">=</span><span class="va">True</span>)</span>
<span id="annotated-cell-1-5"><a href="#annotated-cell-1-5" aria-hidden="true" tabindex="-1"></a>features                                                                        </span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-1" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="1" data-code-annotation="1">Imports California house prices from <code>sklearn.datasets</code> library</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="4" data-code-annotation="2">Assigns features and target from the dataset to two variables ‘features’ and ‘target’ and returns two separate data frames. The command <code>return_X_y=True</code> ensures that there will be two separate data frames, one for the features and the other for the target</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">MedInc</th>
<th data-quarto-table-cell-role="th">HouseAge</th>
<th data-quarto-table-cell-role="th">AveRooms</th>
<th data-quarto-table-cell-role="th">AveBedrms</th>
<th data-quarto-table-cell-role="th">Population</th>
<th data-quarto-table-cell-role="th">AveOccup</th>
<th data-quarto-table-cell-role="th">Latitude</th>
<th data-quarto-table-cell-role="th">Longitude</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>8.3252</td>
<td>41.0</td>
<td>6.984127</td>
<td>1.023810</td>
<td>322.0</td>
<td>2.555556</td>
<td>37.88</td>
<td>-122.23</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>8.3014</td>
<td>21.0</td>
<td>6.238137</td>
<td>0.971880</td>
<td>2401.0</td>
<td>2.109842</td>
<td>37.86</td>
<td>-122.22</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>7.2574</td>
<td>52.0</td>
<td>8.288136</td>
<td>1.073446</td>
<td>496.0</td>
<td>2.802260</td>
<td>37.85</td>
<td>-122.24</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20637</td>
<td>1.7000</td>
<td>17.0</td>
<td>5.205543</td>
<td>1.120092</td>
<td>1007.0</td>
<td>2.325635</td>
<td>39.43</td>
<td>-121.22</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20638</td>
<td>1.8672</td>
<td>18.0</td>
<td>5.329513</td>
<td>1.171920</td>
<td>741.0</td>
<td>2.123209</td>
<td>39.43</td>
<td>-121.32</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20639</td>
<td>2.3886</td>
<td>16.0</td>
<td>5.254717</td>
<td>1.162264</td>
<td>1387.0</td>
<td>2.616981</td>
<td>39.37</td>
<td>-121.24</td>
</tr>
</tbody>
</table>

<p>20640 rows × 8 columns</p>
</div>
</div>
</div>
</div>
</section>
<section id="what-is-the-target" class="level3">
<h3 class="anchored" data-anchor-id="what-is-the-target">What is the target?</h3>
<div class="columns">
<div class="column">
<div id="48c541ba" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>target</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>0        4.526
1        3.585
2        3.521
         ...  
20637    0.923
20638    0.847
20639    0.894
Name: MedHouseVal, Length: 20640, dtype: float64</code></pre>
</div>
</div>
<p>Why predict this? Let’s pretend we are these guys.</p>
</div><div class="column">
<p><img src="nytimes-silicon-valley-new-city.png" class="img-fluid"></p>
</div>
</div>
<div class="footer">
<p>Source: Dougherty and Griffith (2023), <a href="https://www.nytimes.com/2023/08/25/business/land-purchases-solano-county.html">The Silicon Valley Elite Who Want to Build a City From Scratch</a>, New York Times.</p>
</div>
</section>
<section id="an-entire-ml-project" class="level3">
<h3 class="anchored" data-anchor-id="an-entire-ml-project">An entire ML project</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ml-lifecycle.png" class="img-fluid figure-img"></p>
<figcaption>ML life cycle</figcaption>
</figure>
</div>
<p>The course focuses more on the modelling part of the life cycle.</p>
<div class="footer">
<p>Source: Actuaries Institute, <a href="https://dodatabetter.com.au/wp-content/uploads/2023/02/Advantage-Graph_1.mp4">Do Data Better</a>.</p>
</div>
</section>
<section id="questions-to-answer-in-ml-project" class="level3">
<h3 class="anchored" data-anchor-id="questions-to-answer-in-ml-project">Questions to answer in ML project</h3>
<p>You fit a few models to the training set, then ask:</p>
<ol type="1">
<li><strong>(Selection)</strong> Which of these models is the best?</li>
<li><strong>(Future Performance)</strong> How good should we expect the final model to be on unseen data?</li>
</ol>
</section>
<section id="set-aside-a-fraction-for-a-test-set" class="level3">
<h3 class="anchored" data-anchor-id="set-aside-a-fraction-for-a-test-set">Set aside a fraction for a test set</h3>
<div id="541ff1fb" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="annotated-cell-2"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-2-1" class="code-annotation-target"><a href="#annotated-cell-2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="annotated-cell-2-2"><a href="#annotated-cell-2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-2-3"><a href="#annotated-cell-2-3" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="annotated-cell-2-4"><a href="#annotated-cell-2-4" aria-hidden="true" tabindex="-1"></a>    features, target, random_state<span class="op">=</span><span class="dv">42</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-2-5" class="code-annotation-target"><a href="#annotated-cell-2-5" aria-hidden="true" tabindex="-1"></a>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-2" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="1" data-code-annotation="1">Imports <code>train_test_split</code> class from <code>sklearn.model_selection</code> library</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="5" data-code-annotation="2">Splits the dataset into train and the test sets</span>
</dd>
</dl>
</div>
</div>
<p>First, we split the data into the train set and the test set using a random selection. By defining the random state, using the <code>random_state=42</code> command, we can ensure that the split is reproducible. We set aside the test data, assuming it represents new, unseen data. Then, we fit many models on the train data and select the one with the lowest train error. Thereafter we assess the performance of that model using the unseen test data.</p>
<div class="columns">
<div class="column" style="width:70%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heaton-train-test-split.png" class="img-fluid figure-img"></p>
<figcaption>Illustration of a typical training/test split.</figcaption>
</figure>
</div>
<div class="smaller">
<p>Note: Compare <code>X_</code>/<code>y_</code> names, capitals &amp; lowercase.</p>
</div>
</div><div class="column" style="width:30%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="scikit-learn-what-is-my-purpose.png" class="img-fluid figure-img"></p>
<figcaption>Our use of sklearn.</figcaption>
</figure>
</div>
</div>
</div>
<div class="footer">
<p>Adapted from: Heaton (2022), <a href="https://github.com/jeffheaton/t81_558_deep_learning/blob/e4bdc124b0c45b592d9bdbed0d2ef6c63c0245d6/t81_558_class_02_1_python_pandas.ipynb">Applications of Deep Learning</a>, Part 2.1: Introduction to Pandas, and <a href="https://journeys.dartmouth.edu/folklorearchive/2020/06/03/purpose-of-scikit-learn-is-to-split-the-data/">this random site</a>.</p>
</div>
</section>
<section id="basic-ml-workflow" class="level3">
<h3 class="anchored" data-anchor-id="basic-ml-workflow">Basic ML workflow</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="wiki-ML_dataset_training_validation_test_sets.png" class="img-fluid figure-img"></p>
<figcaption>Splitting the data.</figcaption>
</figure>
</div>
<ol type="1">
<li>For each model, fit it to the <em>training set</em>.</li>
<li>Compute the error for each model on the <em>validation set</em>.</li>
<li>Select the model with the lowest validation error.</li>
<li>Compute the error of the final model on the <em>test set</em>.</li>
</ol>
<div class="footer">
<p>Source: <a href="https://commons.wikimedia.org/wiki/File:ML_dataset_training_validation_test_sets.png#filelinks">Wikipedia</a>.</p>
</div>
</section>
<section id="split-three-ways" class="level3">
<h3 class="anchored" data-anchor-id="split-three-ways">Split three ways</h3>
<div id="b96979d8" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="annotated-cell-3"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-3-1"><a href="#annotated-cell-3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Thanks https://datascience.stackexchange.com/a/15136</span></span>
<span id="annotated-cell-3-2"><a href="#annotated-cell-3-2" aria-hidden="true" tabindex="-1"></a>X_main, X_test, y_main, y_test <span class="op">=</span> train_test_split(</span>
<span id="annotated-cell-3-3"><a href="#annotated-cell-3-3" aria-hidden="true" tabindex="-1"></a>    features, target, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">1</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-3-4" class="code-annotation-target"><a href="#annotated-cell-3-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="annotated-cell-3-5"><a href="#annotated-cell-3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-3-6"><a href="#annotated-cell-3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># As 0.25 x 0.8 = 0.2</span></span>
<span id="annotated-cell-3-7"><a href="#annotated-cell-3-7" aria-hidden="true" tabindex="-1"></a>X_train, X_val, y_train, y_val <span class="op">=</span> train_test_split(</span>
<span id="annotated-cell-3-8"><a href="#annotated-cell-3-8" aria-hidden="true" tabindex="-1"></a>    X_main, y_main, test_size<span class="op">=</span><span class="fl">0.25</span>, random_state<span class="op">=</span><span class="dv">1</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-3-9" class="code-annotation-target"><a href="#annotated-cell-3-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="annotated-cell-3-10"><a href="#annotated-cell-3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-3-11"><a href="#annotated-cell-3-11" aria-hidden="true" tabindex="-1"></a>X_train.shape, X_val.shape, X_test.shape</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-3" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="4" data-code-annotation="1">Splits the entire dataset into two parts. Sets aside <span class="math inline">20\%</span> of the data as the test set.</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="9" data-code-annotation="2">Splits the first <span class="math inline">80\%</span> of the data (<code>X_main</code> and <code>y_main</code>) further into train and validation sets. Sets aside <span class="math inline">25\%</span> as the validation set</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>((12384, 8), (4128, 8), (4128, 8))</code></pre>
</div>
</div>
<p>This results in <span class="math inline">60:20:20</span> three way split. While this is not a strict rule, it is widely used.</p>
</section>
<section id="why-not-use-test-set-for-both" class="level3">
<h3 class="anchored" data-anchor-id="why-not-use-test-set-for-both">Why not use test set for both?</h3>
<p><em>Thought experiment</em>: have <span class="math inline">m</span> classifiers: <span class="math inline">f_1(\mathbf{x})</span>, <span class="math inline">\dots</span>, <span class="math inline">f_m(\mathbf{x})</span>.</p>
<p>They are just as good as each other in the long run <span class="math display">
\mathbb{P}(\, f_i(\mathbf{X}) = Y \,)\ =\ 90\% , \quad \text{for } i=1,\dots,m .
</span></p>
<div class="columns">
<div class="column" style="width:40%;">
<p>Evaluate each model on the test set, some will be better than others.</p>
</div><div class="column" style="width:60%;">
<div id="05541172" class="cell" data-execution_count="7">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-8-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>Take the best, you’d think it has <span class="math inline">\approx 98\%</span> accuracy!</p>
<p>Using the same dataset for both validating and testing purposes can result in a data leakage. The information from supposedly ‘unseen’ data is now used by the model during its tuning. This results in a situation where the model is now ‘learning’ from the test data, and it could lead to overly optimistic results in the model evaluation stage.</p>
</section>
</section>
<section id="eda-baseline-model" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="eda-baseline-model">EDA &amp; Baseline Model</h2>
<section id="the-training-set" class="level3 smaller">
<h3 class="smaller anchored" data-anchor-id="the-training-set">The training set</h3>
<div id="17917373" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>X_train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">MedInc</th>
<th data-quarto-table-cell-role="th">HouseAge</th>
<th data-quarto-table-cell-role="th">AveRooms</th>
<th data-quarto-table-cell-role="th">AveBedrms</th>
<th data-quarto-table-cell-role="th">Population</th>
<th data-quarto-table-cell-role="th">AveOccup</th>
<th data-quarto-table-cell-role="th">Latitude</th>
<th data-quarto-table-cell-role="th">Longitude</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">9107</td>
<td>4.1573</td>
<td>19.0</td>
<td>6.162630</td>
<td>1.048443</td>
<td>1677.0</td>
<td>2.901384</td>
<td>34.63</td>
<td>-118.18</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13999</td>
<td>0.4999</td>
<td>10.0</td>
<td>6.740000</td>
<td>2.040000</td>
<td>108.0</td>
<td>2.160000</td>
<td>34.69</td>
<td>-116.90</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5610</td>
<td>2.0458</td>
<td>27.0</td>
<td>3.619048</td>
<td>1.062771</td>
<td>1723.0</td>
<td>3.729437</td>
<td>33.78</td>
<td>-118.26</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8539</td>
<td>4.0727</td>
<td>18.0</td>
<td>3.957845</td>
<td>1.079625</td>
<td>2276.0</td>
<td>2.665105</td>
<td>33.90</td>
<td>-118.36</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2155</td>
<td>2.3190</td>
<td>41.0</td>
<td>5.366265</td>
<td>1.113253</td>
<td>1129.0</td>
<td>2.720482</td>
<td>36.78</td>
<td>-119.79</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13351</td>
<td>5.5632</td>
<td>9.0</td>
<td>7.241087</td>
<td>0.996604</td>
<td>2280.0</td>
<td>3.870968</td>
<td>34.02</td>
<td>-117.62</td>
</tr>
</tbody>
</table>

<p>12384 rows × 8 columns</p>
</div>
</div>
</div>
</div>
</section>
<section id="location" class="level3">
<h3 class="anchored" data-anchor-id="location">Location</h3>
<p>Python’s <code>matplotlib</code> package <span class="math inline">\approx</span> R’s basic <code>plot</code>s.</p>
<div id="77ffd4b5" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(features[<span class="st">"Longitude"</span>], features[<span class="st">"Latitude"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="fragment callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>There’s no <em>analysis</em> is this EDA.</p>
</div>
</div>
</section>
<section id="location-eda" class="level3">
<h3 class="anchored" data-anchor-id="location-eda">Location EDA</h3>
<div id="900da84c" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>plt.scatter(features[<span class="st">"Longitude"</span>], features[<span class="st">"Latitude"</span>], c<span class="op">=</span>target, cmap<span class="op">=</span><span class="st">"coolwarm"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>plt.colorbar()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-11-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>“We observe that the median house prices are higher closer to the coastline.”</p>
</section>
<section id="pandas-can-make-plots-directly" class="level3">
<h3 class="anchored" data-anchor-id="pandas-can-make-plots-directly">Pandas can make plots directly</h3>
<div id="af5100cb" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>both <span class="op">=</span> pd.concat([features, target], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>both.plot(kind<span class="op">=</span><span class="st">"scatter"</span>, x<span class="op">=</span><span class="st">"Longitude"</span>, y<span class="op">=</span><span class="st">"Latitude"</span>, c<span class="op">=</span><span class="st">"MedHouseVal"</span>, cmap<span class="op">=</span><span class="st">"coolwarm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="features" class="level3">
<h3 class="anchored" data-anchor-id="features">Features</h3>
<div id="8f5e3087" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">list</span>(features.columns))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['MedInc', 'HouseAge', 'AveRooms', 'AveBedrms', 'Population', 'AveOccup', 'Latitude', 'Longitude']</code></pre>
</div>
</div>
<p>How many?</p>
<div id="a041d597" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>num_features <span class="op">=</span> <span class="bu">len</span>(features.columns)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>num_features</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>8</code></pre>
</div>
</div>
<p>Or</p>
<div id="676a7911" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>num_features <span class="op">=</span> features.shape[<span class="dv">1</span>]</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>features.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>(20640, 8)</code></pre>
</div>
</div>
</section>
<section id="linear-regression" class="level3">
<h3 class="anchored" data-anchor-id="linear-regression">Linear Regression</h3>
<p><span class="math display"> \hat{y}_i = w_0 + \sum_{j=1}^p w_j x_{ij} .</span></p>
<div id="b1917ca2" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="annotated-cell-11"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-11-1" class="code-annotation-target"><a href="#annotated-cell-11-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="annotated-cell-11-2"><a href="#annotated-cell-11-2" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-11-3" class="code-annotation-target"><a href="#annotated-cell-11-3" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span> LinearRegression()</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-11-4" class="code-annotation-target"><a href="#annotated-cell-11-4" aria-hidden="true" tabindex="-1"></a>lr.fit(X_train, y_train)<span class="op">;</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-11" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="1" data-code-annotation="1">Imports the <code>LinearRegression</code> class from the <code>sklearn.linear_model</code> module</span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="3" data-code-annotation="2">Defines the object <code>lr</code> which represents the linear regression function</span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="4" data-code-annotation="3">Fits a linear regression model using train data. <code>lr.fit</code> computes the coefficients of the regression model</span>
</dd>
</dl>
</div>
</div>
<p>The <span class="math inline">w_0</span> is in <code>lr.intercept_</code> and the others are in</p>
<div id="9147c3bb" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lr.coef_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[ 4.34267965e-01  9.88284781e-03 -9.39592954e-02  5.86373944e-01
 -1.58360948e-06 -3.59968968e-03 -4.26013498e-01 -4.41779336e-01]</code></pre>
</div>
</div>
</section>
<section id="make-some-predictions" class="level3">
<h3 class="anchored" data-anchor-id="make-some-predictions">Make some predictions</h3>
<div id="8c4d1d42" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>X_train.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">MedInc</th>
<th data-quarto-table-cell-role="th">HouseAge</th>
<th data-quarto-table-cell-role="th">AveRooms</th>
<th data-quarto-table-cell-role="th">AveBedrms</th>
<th data-quarto-table-cell-role="th">Population</th>
<th data-quarto-table-cell-role="th">AveOccup</th>
<th data-quarto-table-cell-role="th">Latitude</th>
<th data-quarto-table-cell-role="th">Longitude</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">9107</td>
<td>4.1573</td>
<td>19.0</td>
<td>6.162630</td>
<td>1.048443</td>
<td>1677.0</td>
<td>2.901384</td>
<td>34.63</td>
<td>-118.18</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13999</td>
<td>0.4999</td>
<td>10.0</td>
<td>6.740000</td>
<td>2.040000</td>
<td>108.0</td>
<td>2.160000</td>
<td>34.69</td>
<td>-116.90</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5610</td>
<td>2.0458</td>
<td>27.0</td>
<td>3.619048</td>
<td>1.062771</td>
<td>1723.0</td>
<td>3.729437</td>
<td>33.78</td>
<td>-118.26</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p><code>X_train.head(3)</code> returns the first three rows of the dataset <code>X_train</code>.</p>
<div id="77456c02" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> lr.predict(X_train.head(<span class="dv">3</span>))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>y_pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>array([1.81699287, 0.0810446 , 1.62089363])</code></pre>
</div>
</div>
<p><code>lr.predict(X_train.head(3))</code> returns the predictions for the first three rows of the dataset <code>X_train</code>.</p>
<p>We can manually calculate predictions using the linear regression model to verify the output of the <code>lr.predict()</code> function. In the following code, we first define <span class="math inline">w_0</span> as the intercept of the <code>lr</code> function (initial value for the prediction calculation), and then keep on adding the <span class="math inline">w_j \times x_j</span> terms</p>
<div id="2d9147c5" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="annotated-cell-15"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-15-1" class="code-annotation-target"><a href="#annotated-cell-15-1" aria-hidden="true" tabindex="-1"></a>prediction <span class="op">=</span> lr.intercept_</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-15-2" class="code-annotation-target"><a href="#annotated-cell-15-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> w_j, x_0j <span class="kw">in</span> <span class="bu">zip</span>(lr.coef_, X_train.iloc[<span class="dv">0</span>]):</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-15-3" class="code-annotation-target"><a href="#annotated-cell-15-3" aria-hidden="true" tabindex="-1"></a>    prediction <span class="op">+=</span> w_j <span class="op">*</span> x_0j</span>
<span id="annotated-cell-15-4"><a href="#annotated-cell-15-4" aria-hidden="true" tabindex="-1"></a>prediction                                              </span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-15" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="1" data-code-annotation="1">Specifies the value of the intercept from the fitted regression as <code>prediction</code></span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="2" data-code-annotation="2">Iterates over the first observation from the train data (<code>X_train</code>) and the corresponding weight coefficients from the fitted linear regression</span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="3" data-code-annotation="3">Updates the prediction value</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>1.8169928680677785</code></pre>
</div>
</div>
</section>
<section id="plot-the-predictions" class="level3">
<h3 class="anchored" data-anchor-id="plot-the-predictions">Plot the predictions</h3>
<div class="columns">
<div class="column">
<div id="d58e599d" class="cell" data-execution_count="21">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-22-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div><div class="column">
<div id="2d63e0f2" class="cell" data-execution_count="22">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-23-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>We can see how both plots have a dispersion to either sides of the fitted line.</p>
</section>
<section id="calculate-mean-squared-error" class="level3">
<h3 class="anchored" data-anchor-id="calculate-mean-squared-error">Calculate mean squared error</h3>
<div id="d99d5886" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> lr.predict(X_train)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">"Predictions"</span>: y_pred, <span class="st">"True values"</span>: y_train})</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"Squared Error"</span>] <span class="op">=</span> (df[<span class="st">"Predictions"</span>] <span class="op">-</span> df[<span class="st">"True values"</span>]) <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Predictions</th>
<th data-quarto-table-cell-role="th">True values</th>
<th data-quarto-table-cell-role="th">Squared Error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">9107</td>
<td>1.816993</td>
<td>2.281</td>
<td>0.215303</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13999</td>
<td>0.081045</td>
<td>0.550</td>
<td>0.219919</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5610</td>
<td>1.620894</td>
<td>1.745</td>
<td>0.015402</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13533</td>
<td>1.168949</td>
<td>1.199</td>
<td>0.000903</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="03ba4275" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"Squared Error"</span>].mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>0.5291948207479792</code></pre>
</div>
</div>
</section>
<section id="using-mean_squared_error" class="level3">
<h3 class="anchored" data-anchor-id="using-mean_squared_error">Using <code>mean_squared_error</code></h3>
<div id="6fa983b3" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"Squared Error"</span>].mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>0.5291948207479792</code></pre>
</div>
</div>
<p>We can compute the mean squared error to evaluate, on average, the accuracy of the predictions. To do this, we first create a data frame using pandas <code>DataFrame</code> function. It will have two columns, one with the predicted values and the other with the actual values. Next, we add another column to the same data frame using <code>df["Squared Error"]</code> that computes and stores the squared error for each row. Using the function <code>df["Squared Error"].mean()</code>, we extract the column ‘Squared Error’ from the data frame ‘df’ and calculate the ‘mean’.</p>
<div id="de5fa63a" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error <span class="im">as</span> mse</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>mse(y_train, y_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>0.5291948207479792</code></pre>
</div>
</div>
<p>We can also use the function <code>mean_squared_error</code> from <code>sklearn.metrics</code> library to calculate the same.</p>
<p>Store the results in a dictionary:</p>
<div id="1ea9a655" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>mse_lr_train <span class="op">=</span> mse(y_train, lr.predict(X_train))</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>mse_lr_val <span class="op">=</span> mse(y_val, lr.predict(X_val))</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>mse_train <span class="op">=</span> {<span class="st">"Linear Regression"</span>: mse_lr_train}</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>mse_val <span class="op">=</span> {<span class="st">"Linear Regression"</span>: mse_lr_val}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Thank about the units of the mean squared error. Is there a variation which is more interpretable?</p>
</div>
</div>
<p>Storing results in data structures like dictionaries is a good practice that can help in managing and handling data efficiently.</p>
</section>
</section>
<section id="our-first-neural-network" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="our-first-neural-network">Our First Neural Network</h2>
<section id="what-are-keras-and-tensorflow" class="level3">
<h3 class="anchored" data-anchor-id="what-are-keras-and-tensorflow">What are Keras and TensorFlow?</h3>
<p>Keras is common way of specifying, training, and using neural networks. It gives a simple interface to <em>various backend</em> libraries, including Tensorflow.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Geron-mls2_1010.png" class="img-fluid figure-img"></p>
<figcaption>Keras as a independent interface, and Keras as part of Tensorflow.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Aurélien Géron (2019), <em>Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</em>, 2nd Edition, Figure 10-10.</p>
</div>
</section>
<section id="create-a-keras-ann-model" class="level3">
<h3 class="anchored" data-anchor-id="create-a-keras-ann-model">Create a Keras ANN model</h3>
<p>Decide on the architecture: a simple fully-connected network with one hidden layer with 30 neurons.</p>
<p>Create the model:</p>
<div id="a627f35d" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="annotated-cell-21"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-21" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-21-1" class="code-annotation-target"><a href="#annotated-cell-21-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.models <span class="im">import</span> Sequential</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-21" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-21-2" class="code-annotation-target"><a href="#annotated-cell-21-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.layers <span class="im">import</span> Dense, Input</span>
<span id="annotated-cell-21-3"><a href="#annotated-cell-21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-21-4"><a href="#annotated-cell-21-4" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential(</span>
<span id="annotated-cell-21-5"><a href="#annotated-cell-21-5" aria-hidden="true" tabindex="-1"></a>    [Input((num_features,)),</span>
<span id="annotated-cell-21-6"><a href="#annotated-cell-21-6" aria-hidden="true" tabindex="-1"></a>     Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"leaky_relu"</span>),</span>
<span id="annotated-cell-21-7"><a href="#annotated-cell-21-7" aria-hidden="true" tabindex="-1"></a>     Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"leaky_relu"</span>)]</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-21" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-21-8" class="code-annotation-target"><a href="#annotated-cell-21-8" aria-hidden="true" tabindex="-1"></a>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-21" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-21" data-code-lines="1" data-code-annotation="1">Imports <code>Sequential</code> from <code>keras.models</code></span>
</dd>
<dt data-target-cell="annotated-cell-21" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-21" data-code-lines="2" data-code-annotation="2">Imports <code>Dense</code> from <code>keras.layers</code></span>
</dd>
<dt data-target-cell="annotated-cell-21" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-21" data-code-lines="8" data-code-annotation="3">Defines the model architecture using <code>Sequential()</code> function</span>
</dd>
</dl>
</div>
</div>
<p>This neural network architecture includes one hidden layer with 30 neurons and an output layer with 1 neuron. While there is an activation function specified (<code>leaky_relu</code>) for the hidden layer, there is no activation function specified for the output layer. In situations where there is no specification, the output layer assumes a <code>linear</code> activation.</p>
</section>
<section id="inspect-the-model" class="level3">
<h3 class="anchored" data-anchor-id="inspect-the-model">Inspect the model</h3>
<div id="c4d6b37b" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>model.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Model: "sequential"</span>
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> Layer (type)                    </span>┃<span style="font-weight: bold"> Output Shape           </span>┃<span style="font-weight: bold">       Param # </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ dense (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                   │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">30</span>)             │           <span style="color: #00af00; text-decoration-color: #00af00">270</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense_1 (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                 │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">1</span>)              │            <span style="color: #00af00; text-decoration-color: #00af00">31</span> │
└─────────────────────────────────┴────────────────────────┴───────────────┘
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Total params: </span><span style="color: #00af00; text-decoration-color: #00af00">301</span> (1.18 KB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">301</span> (1.18 KB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Non-trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">0</span> (0.00 B)
</pre>
</div>
</div>
</section>
<section id="the-model-is-initialised-randomly" class="level3">
<h3 class="anchored" data-anchor-id="the-model-is-initialised-randomly">The model is initialised randomly</h3>
<div id="7c98048d" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential([Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"leaky_relu"</span>), Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"leaky_relu"</span>)])</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>model.predict(X_val.head(<span class="dv">3</span>), verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>array([[-91.88699  ],
       [-57.336792 ],
       [ -1.2164348]], dtype=float32)</code></pre>
</div>
</div>
<div id="b85d38fc" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential([Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"leaky_relu"</span>), Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"leaky_relu"</span>)])</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>model.predict(X_val.head(<span class="dv">3</span>), verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>array([[-63.595753],
       [-34.14082 ],
       [ 17.690414]], dtype=float32)</code></pre>
</div>
</div>
<p>We can see how rerunning the same code with the same input data results in significantly different predictions. This is due to the random initialization.</p>
</section>
<section id="controlling-the-randomness" class="level3">
<h3 class="anchored" data-anchor-id="controlling-the-randomness">Controlling the randomness</h3>
<div id="3d579bbb" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1"></a><span class="im">import</span> random</span>
<span id="cb34-2"><a href="#cb34-2"></a></span>
<span id="cb34-3"><a href="#cb34-3"></a>random.seed(<span class="dv">123</span>)</span>
<span id="cb34-4"><a href="#cb34-4"></a></span>
<span id="cb34-5"><a href="#cb34-5"></a>model <span class="op">=</span> Sequential([Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"leaky_relu"</span>), Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"leaky_relu"</span>)])</span>
<span id="cb34-6"><a href="#cb34-6"></a></span>
<span id="cb34-7"><a href="#cb34-7"></a>display(model.predict(X_val.head(<span class="dv">3</span>), verbose<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb34-8"><a href="#cb34-8"></a></span>
<span id="cb34-9"><a href="#cb34-9"></a>random.seed(<span class="dv">123</span>)</span>
<span id="cb34-10"><a href="#cb34-10"></a>model <span class="op">=</span> Sequential([Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"leaky_relu"</span>), Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"leaky_relu"</span>)])</span>
<span id="cb34-11"><a href="#cb34-11"></a></span>
<span id="cb34-12"><a href="#cb34-12"></a>display(model.predict(X_val.head(<span class="dv">3</span>), verbose<span class="op">=</span><span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array([[ 1.3595750e+03],
       [ 8.2818079e+02],
       [-1.2993939e+00]], dtype=float32)</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>array([[ 1.3595750e+03],
       [ 8.2818079e+02],
       [-1.2993939e+00]], dtype=float32)</code></pre>
</div>
</div>
<p>By setting the seed, we can control for the randomness.</p>
</section>
<section id="fit-the-model" class="level3">
<h3 class="anchored" data-anchor-id="fit-the-model">Fit the model</h3>
<div id="0157a2ac" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">123</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential([</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"leaky_relu"</span>),</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"leaky_relu"</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>model.compile(<span class="st">"adam"</span>, <span class="st">"mse"</span>)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>time hist <span class="op">=</span> model.fit(X_train, y_train, epochs<span class="op">=</span><span class="dv">5</span>, verbose<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>hist.history[<span class="st">"loss"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 1.26 s, sys: 130 ms, total: 1.39 s
Wall time: 1.03 s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>[18765.189453125,
 178.23837280273438,
 103.30640411376953,
 48.04053497314453,
 18.110933303833008]</code></pre>
</div>
</div>
<p>The above code explains how we would fit a basic neural network. First, we define the seed for reproducibility. Next, we define the architecture of the model. Thereafter, we compile the model. Compiling involves giving instructions on how we want the model to be trained. At the least, we must define the optimizer and loss function. The optimizer explains how the model should learn (how the model should update the weights), and the loss function states the objective that the model needs to optimize. In the above code, we use <code>adam</code> as the optimizer and <code>mse</code> (mean squared error) as the loss function. After compilation, we fit the model. The <code>fit()</code> function takes in the training data, and runs the entire dataset through 5 epochs before training completes. What this means is that the model is run through the entire dataset 5 times. Suppose we start the training process with the random initialization, run the model through the entire data, calculate the <code>mse</code> (after 1 epoch), and update the weights using the <code>adam</code> optimizer. Then we run the model through the entire dataset once again with the updated weights, to calculate the <code>mse</code> at the end of the second epoch. Likewise, we would run the model 5 times before the training completes. <code>hist.history()</code> function returns the calculate <code>mse</code> at each step.</p>
<p><br></p>
<p><code>%time</code> command computes and prints the amount of time spend on training. By setting <code>verbose=False</code> we can avoid printing of intermediate results during training. Setting <code>verbose=True</code> is useful when we want to observe how the neural network is training.</p>
</section>
<section id="make-predictions" class="level3">
<h3 class="anchored" data-anchor-id="make-predictions">Make predictions</h3>
<div id="dbf0ccdc" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_train[:<span class="dv">3</span>], verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>y_pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>array([[ 0.5477159 ],
       [-1.525452  ],
       [-0.25848356]], dtype=float32)</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>.predict</code> gives us a ‘matrix’ not a ‘vector’. Calling <code>.flatten()</code> will convert it to a ‘vector’.</p>
<div id="634ec41f" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Original shape: </span><span class="sc">{</span>y_pred<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> y_pred.flatten()</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Flattened shape: </span><span class="sc">{</span>y_pred<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>y_pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Original shape: (3, 1)
Flattened shape: (3,)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>array([ 0.5477159 , -1.525452  , -0.25848356], dtype=float32)</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="plot-the-predictions-1" class="level3">
<h3 class="anchored" data-anchor-id="plot-the-predictions-1">Plot the predictions</h3>
<div class="columns">
<div class="column">
<div id="edb1a8c4" class="cell" data-execution_count="38">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-39-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div><div class="column">
<div id="732702a5" class="cell" data-execution_count="39">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-40-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>One problem with the predictions is that lots of predictions include negative values, which is unrealistic for house prices. We might have to rethink the activation function in the output layer.</p>
</section>
<section id="assess-the-model" class="level3">
<h3 class="anchored" data-anchor-id="assess-the-model">Assess the model</h3>
<div id="685579f1" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_val, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>mse(y_val, y_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>8.391657291598232</code></pre>
</div>
</div>
<div id="4e829807" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>mse_train[<span class="st">"Basic ANN"</span>] <span class="op">=</span> mse(</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    y_train, model.predict(X_train, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>mse_val[<span class="st">"Basic ANN"</span>] <span class="op">=</span> mse(y_val, model.predict(X_val, verbose<span class="op">=</span><span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Some predictions are negative:</p>
<div id="c662619e" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_val, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>y_pred.min(), y_pred.max()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>(-5.371005, 16.863848)</code></pre>
</div>
</div>
<div id="2f1f6d7e" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>y_val.min(), y_val.max()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>(0.225, 5.00001)</code></pre>
</div>
</div>
</section>
</section>
<section id="force-positive-predictions" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="force-positive-predictions">Force positive predictions</h2>
<section id="try-running-for-longer" class="level3">
<h3 class="anchored" data-anchor-id="try-running-for-longer">Try running for longer</h3>
<div id="dd186699" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">123</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential([</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"leaky_relu"</span>),</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"leaky_relu"</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>model.compile(<span class="st">"adam"</span>, <span class="st">"mse"</span>)</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>time hist <span class="op">=</span> model.fit(X_train, y_train, epochs<span class="op">=</span><span class="dv">50</span>, verbose<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 9.19 s, sys: 709 ms, total: 9.9 s
Wall time: 6.92 s</code></pre>
</div>
</div>
<p>We will train the same neural network architecture with more epochs (<code>epochs=50</code>) to see if the results improve.</p>
</section>
<section id="loss-curve" class="level3">
<h3 class="anchored" data-anchor-id="loss-curve">Loss curve</h3>
<div id="d77122cd" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>plt.plot(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">51</span>), hist.history[<span class="st">"loss"</span>])</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Epoch"</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"MSE"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-47-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The loss curve experiences a sudden drop even before finishing 5 epochs and remains consistently low. This indicates that increasing the number of epochs from 5 to 50 does not significantly increase the accuracy.</p>
</section>
<section id="loss-curve-1" class="level3" data-visibility="uncounted">
<h3 data-visibility="uncounted" class="anchored" data-anchor-id="loss-curve-1">Loss curve</h3>
<div id="1cb662ac" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>plt.plot(<span class="bu">range</span>(<span class="dv">2</span>, <span class="dv">51</span>), hist.history[<span class="st">"loss"</span>][<span class="dv">1</span>:])</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Epoch"</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"MSE"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-48-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The above code filters out the MSE value from the first epoch. It plots the vector of MSE values starting from the 2nd epoch. By doing so, we can observe the fluctuations in the MSE values across different epochs more clearly. Results show that the model does not benefit from increasing the epochs.</p>
</section>
<section id="predictions" class="level3">
<h3 class="anchored" data-anchor-id="predictions">Predictions</h3>
<div id="29cde8cd" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_val, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Min prediction: </span><span class="sc">{</span>y_pred<span class="sc">.</span>min()<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Max prediction: </span><span class="sc">{</span>y_pred<span class="sc">.</span>max()<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Min prediction: -0.79
Max prediction: 12.92</code></pre>
</div>
</div>
<div class="columns">
<div class="column">
<div id="2f3ecb78" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>plt.scatter(y_pred, y_val)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Predictions"</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"True values"</span>)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>add_diagonal_line()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="b08bcd0d" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>mse_train[<span class="st">"Long run ANN"</span>] <span class="op">=</span> mse(</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>    y_train, model.predict(X_train, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>mse_val[<span class="st">"Long run ANN"</span>] <span class="op">=</span> mse(y_val, model.predict(X_val, verbose<span class="op">=</span><span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column">
<div style="position: relative; top: -2em;">
<div id="28fb18ae" class="cell" data-execution_count="51">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-52-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="try-different-activation-functions" class="level3">
<h3 class="anchored" data-anchor-id="try-different-activation-functions">Try different activation functions</h3>
<div id="4e9c3709" class="cell" data-execution_count="52">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-53-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We should be mindful when selecting the activation function. Both <code>tanh</code> and <code>sigmoid</code> functions restrict the output values to the range of [0,1]. This is not sensible for house price modelling. <code>softplus</code> does not have that problem. Also, <code>softplus</code> ensures the output is positive which is realistic for house prices.</p>
</section>
<section id="enforce-positive-outputs-softplus" class="level3">
<h3 class="anchored" data-anchor-id="enforce-positive-outputs-softplus">Enforce positive outputs (softplus)</h3>
<div id="33282458" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">123</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential([</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"leaky_relu"</span>),</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"softplus"</span>)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>model.compile(<span class="st">"adam"</span>, <span class="st">"mse"</span>)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>time hist <span class="op">=</span> model.fit(X_train, y_train, epochs<span class="op">=</span><span class="dv">50</span>, <span class="op">\</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>losses <span class="op">=</span> np.round(hist.history[<span class="st">"loss"</span>], <span class="dv">2</span>)</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(losses[:<span class="dv">5</span>], <span class="st">"..."</span>, losses[<span class="op">-</span><span class="dv">5</span>:])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 9.01 s, sys: 593 ms, total: 9.61 s
Wall time: 6.67 s
[1.856457e+04 5.640000e+00 5.640000e+00 5.640000e+00 5.640000e+00] ... [5.64 5.64 5.64 5.64 5.64]</code></pre>
</div>
</div>
</section>
<section id="plot-the-predictions-2" class="level3">
<h3 class="anchored" data-anchor-id="plot-the-predictions-2">Plot the predictions</h3>
<div class="columns">
<div class="column">
<div id="ba83b326" class="cell" data-execution_count="55">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-56-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div><div class="column">
<div id="cd2f8931" class="cell" data-execution_count="56">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-57-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>Plots illustrate how all the outputs were stuck at zero. Irrespective of how many epochs we run, the output would always be zero.</p>
</section>
<section id="enforce-positive-outputs-mathrmex" class="level3">
<h3 class="anchored" data-anchor-id="enforce-positive-outputs-mathrmex">Enforce positive outputs (<span class="math inline">\mathrm{e}^{\,x}</span>)</h3>
<div id="11c67917" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1"></a>random.seed(<span class="dv">123</span>)</span>
<span id="cb62-2"><a href="#cb62-2"></a></span>
<span id="cb62-3"><a href="#cb62-3"></a>model <span class="op">=</span> Sequential([</span>
<span id="cb62-4"><a href="#cb62-4"></a>    Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"leaky_relu"</span>),</span>
<span id="cb62-5"><a href="#cb62-5"></a>    Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"exponential"</span>)</span>
<span id="cb62-6"><a href="#cb62-6"></a>])</span>
<span id="cb62-7"><a href="#cb62-7"></a></span>
<span id="cb62-8"><a href="#cb62-8"></a>model.compile(<span class="st">"adam"</span>, <span class="st">"mse"</span>)</span>
<span id="cb62-9"><a href="#cb62-9"></a></span>
<span id="cb62-10"><a href="#cb62-10"></a><span class="op">%</span>time hist <span class="op">=</span> model.fit(X_train, y_train, epochs<span class="op">=</span><span class="dv">5</span>, verbose<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb62-11"><a href="#cb62-11"></a></span>
<span id="cb62-12"><a href="#cb62-12"></a>losses <span class="op">=</span> hist.history[<span class="st">"loss"</span>]</span>
<span id="cb62-13"><a href="#cb62-13"></a><span class="bu">print</span>(losses)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 1.02 s, sys: 76.8 ms, total: 1.1 s
Wall time: 845 ms
[nan, nan, nan, nan, nan]</code></pre>
</div>
</div>
<p>Training the model again with an exponential activation function will give <code>nan</code> values. This is because the results then can explode easily.</p>
</section>
<section id="same-as-transforming-the-target" class="level3">
<h3 class="anchored" data-anchor-id="same-as-transforming-the-target">Same as transforming the target</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="california-housing-linear-model.png" class="img-fluid figure-img"></p>
<figcaption>The polynomial regression used by researchers who first studied this dataset.</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Fitting <span class="math inline">\ln(\text{Median Value})</span> is mathematically identical to the <code>exponential</code> activation function in the final layer (but metrics are in different units).</p>
</div>
</div>
<div class="footer">
<p>Source: Pace and Barry (1997), <a href="http://www.sciencedirect.com/science/article/pii/S0167-7152(96)00140-X">Sparse Spatial Autoregressions</a>, Statistics &amp; Probability Letters.</p>
</div>
</section>
<section id="good-to-know-others-results" class="level3">
<h3 class="anchored" data-anchor-id="good-to-know-others-results">Good to know others results</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="california-housing-linear-model-results.png" class="img-fluid figure-img"></p>
<figcaption>That basic model gets <span class="math inline">R^2</span> of 0.61, but their fancy model gets 0.86.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Pace and Barry (1997), <a href="http://www.sciencedirect.com/science/article/pii/S0167-7152(96)00140-X">Sparse Spatial Autoregressions</a>, Statistics &amp; Probability Letters.</p>
</div>
</section>
<section id="gpt-can-double-check-these-results" class="level3">
<h3 class="anchored" data-anchor-id="gpt-can-double-check-these-results">GPT can double-check these results</h3>
<div class="columns">
<div class="column">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="gpt-validating-cali-housing-regression.png" class="img-fluid figure-img"></p>
<figcaption>Asking GPT to check it.</figcaption>
</figure>
</div>
<p>I’d previously given it the CSV of the data.</p>
</div><div class="column">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="gpt-cali-housing-code.png" class="img-fluid figure-img"></p>
<figcaption>The code it wrote &amp; ran.</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="preprocessing" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="preprocessing">Preprocessing</h2>
<section id="re-scaling-the-inputs" class="level3">
<h3 class="anchored" data-anchor-id="re-scaling-the-inputs">Re-scaling the inputs</h3>
<div id="c4a9813d" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, MinMaxScaler</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>scaler.fit(X_train)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>X_train_sc <span class="op">=</span> scaler.transform(X_train)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>X_val_sc <span class="op">=</span> scaler.transform(X_val)</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>X_test_sc <span class="op">=</span> scaler.transform(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note: We apply both the <code>fit</code> and <code>transform</code> operations on the train data. However, we only apply <code>transform</code> on the validation and test data.</p>
<div class="columns">
<div class="column">
<div id="e11c2216" class="cell" data-output-location="default" data-execution_count="60">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>plt.hist(X_train.iloc[:, <span class="dv">0</span>])</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>plt.hist(X_train_sc[:, <span class="dv">0</span>])</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">"Original"</span>, <span class="st">"Scaled"</span>])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column">
<div id="bc934cd4" class="cell" data-execution_count="61">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-62-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>We can see how the original values for the input varied between 0 and 10, and how the scaled input values are now between -2 and 2.5. Neural networks prefer if the inputs range between -1 and 1.</p>
</section>
<section id="same-model-with-scaled-inputs" class="level3">
<h3 class="anchored" data-anchor-id="same-model-with-scaled-inputs">Same model with scaled inputs</h3>
<div id="d22f47f6" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1"></a>random.seed(<span class="dv">123</span>)</span>
<span id="cb66-2"><a href="#cb66-2"></a></span>
<span id="cb66-3"><a href="#cb66-3"></a>model <span class="op">=</span> Sequential([</span>
<span id="cb66-4"><a href="#cb66-4"></a>    Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"leaky_relu"</span>),</span>
<span id="cb66-5"><a href="#cb66-5"></a>    Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"exponential"</span>)</span>
<span id="cb66-6"><a href="#cb66-6"></a>])</span>
<span id="cb66-7"><a href="#cb66-7"></a></span>
<span id="cb66-8"><a href="#cb66-8"></a>model.compile(<span class="st">"adam"</span>, <span class="st">"mse"</span>)</span>
<span id="cb66-9"><a href="#cb66-9"></a></span>
<span id="cb66-10"><a href="#cb66-10"></a><span class="op">%</span>time hist <span class="op">=</span> model.fit( <span class="op">\</span></span>
<span id="cb66-11"><a href="#cb66-11"></a>    X_train_sc, <span class="op">\</span></span>
<span id="cb66-12"><a href="#cb66-12"></a>    y_train, <span class="op">\</span></span>
<span id="cb66-13"><a href="#cb66-13"></a>    epochs<span class="op">=</span><span class="dv">50</span>, <span class="op">\</span></span>
<span id="cb66-14"><a href="#cb66-14"></a>    verbose<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 8.29 s, sys: 594 ms, total: 8.89 s
Wall time: 6.29 s</code></pre>
</div>
</div>
</section>
<section id="loss-curve-2" class="level3">
<h3 class="anchored" data-anchor-id="loss-curve-2">Loss curve</h3>
<div id="9e9a3180" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>plt.plot(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">51</span>), hist.history[<span class="st">"loss"</span>])</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Epoch"</span>)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"MSE"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-64-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="loss-curve-3" class="level3" data-visibility="uncounted">
<h3 data-visibility="uncounted" class="anchored" data-anchor-id="loss-curve-3">Loss curve</h3>
<div id="db7fe48b" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>plt.plot(<span class="bu">range</span>(<span class="dv">2</span>, <span class="dv">51</span>), hist.history[<span class="st">"loss"</span>][<span class="dv">1</span>:])</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Epoch"</span>)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"MSE"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-65-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="predictions-1" class="level3">
<h3 class="anchored" data-anchor-id="predictions-1">Predictions</h3>
<div id="95b0527f" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_val_sc, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Min prediction: </span><span class="sc">{</span>y_pred<span class="sc">.</span>min()<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Max prediction: </span><span class="sc">{</span>y_pred<span class="sc">.</span>max()<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Min prediction: 0.00
Max prediction: 18.45</code></pre>
</div>
</div>
<div class="columns">
<div class="column">
<div id="2dd17083" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>plt.scatter(y_pred, y_val)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Predictions"</span>)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"True values"</span>)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>add_diagonal_line()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="e7a65ada" class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>mse_train[<span class="st">"Exp ANN"</span>] <span class="op">=</span> mse(</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>    y_train, model.predict(X_train_sc, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>mse_val[<span class="st">"Exp ANN"</span>] <span class="op">=</span> mse(y_val, model.predict(X_val_sc, verbose<span class="op">=</span><span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column">
<div style="position: relative; top: -2em;">
<div id="12d54389" class="cell" data-execution_count="68">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-69-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Now the predictions are always non-negative.</p>
</section>
<section id="comparing-mse-smaller-is-better" class="level3">
<h3 class="anchored" data-anchor-id="comparing-mse-smaller-is-better">Comparing MSE (smaller is better)</h3>
<p>On training data:</p>
<div id="9c38ec3e" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>mse_train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="66">
<pre><code>{'Linear Regression': 0.5291948207479792,
 'Basic ANN': 8.374382131620425,
 'Long run ANN': 0.9770473035600079,
 'Exp ANN': 0.3182808342909683}</code></pre>
</div>
</div>
<p>On validation data (expect <em>worse</em>, i.e.&nbsp;bigger):</p>
<div id="6ce5e247" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>mse_val</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">
<pre><code>{'Linear Regression': 0.5059420205381367,
 'Basic ANN': 8.391657291598232,
 'Long run ANN': 0.9279673788287134,
 'Exp ANN': 0.36969620817676596}</code></pre>
</div>
</div>
<p>Note: The error on the validation set is usually higher than the training set.</p>
</section>
<section id="comparing-models-train" class="level3" data-visibility="uncounted">
<h3 data-visibility="uncounted" class="anchored" data-anchor-id="comparing-models-train">Comparing models (train)</h3>
<div id="b7b7c86f" class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>train_results <span class="op">=</span> pd.DataFrame(</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"Model"</span>: mse_train.keys(), <span class="st">"MSE"</span>: mse_train.values()}</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>train_results.sort_values(<span class="st">"MSE"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="68">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Model</th>
<th data-quarto-table-cell-role="th">MSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>Basic ANN</td>
<td>8.374382</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>Long run ANN</td>
<td>0.977047</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Linear Regression</td>
<td>0.529195</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Exp ANN</td>
<td>0.318281</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</section>
<section id="comparing-models-validation" class="level3" data-visibility="uncounted">
<h3 data-visibility="uncounted" class="anchored" data-anchor-id="comparing-models-validation">Comparing models (validation)</h3>
<div id="0f9ecd06" class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>val_results <span class="op">=</span> pd.DataFrame(</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"Model"</span>: mse_val.keys(), <span class="st">"MSE"</span>: mse_val.values()}</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>val_results.sort_values(<span class="st">"MSE"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="69">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Model</th>
<th data-quarto-table-cell-role="th">MSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>Basic ANN</td>
<td>8.391657</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>Long run ANN</td>
<td>0.927967</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Linear Regression</td>
<td>0.505942</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Exp ANN</td>
<td>0.369696</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</section>
</section>
<section id="early-stopping" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="early-stopping">Early Stopping</h2>
<section id="choosing-when-to-stop-training" class="level3">
<h3 class="anchored" data-anchor-id="choosing-when-to-stop-training">Choosing when to stop training</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heaton-error-over-time.png" class="img-fluid figure-img"></p>
<figcaption>Illustrative loss curves over time.</figcaption>
</figure>
</div>
<p>Early stopping can be seen as a regularization technique to avoid overfitting. The plot shows that both training error and validation error decrease at the beginning of training process. However, after a while, validation error starts to increase while training error keeps on decreasing. This is an indication of overfitting. Overfitting leads to poor performance on the unseen data, which is seen here through the gradual increase of validation error. Early stopping can track the model’s performance through the training process and stop the training at the right time.</p>
<div class="footer">
<p>Source: Heaton (2022), <a href="https://github.com/jeffheaton/t81_558_deep_learning/blob/master/t81_558_class_03_4_early_stop.ipynb">Applications of Deep Learning</a>, Part 3.4: Early Stopping.</p>
</div>
</section>
<section id="try-early-stopping" class="level3">
<h3 class="anchored" data-anchor-id="try-early-stopping">Try early stopping</h3>
<p>Hinton calls it a “beautiful free lunch”</p>
<div id="799103a1" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="annotated-cell-47"><pre class="sourceCode numberSource python code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-47" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-47-1" class="code-annotation-target"><a href="#annotated-cell-47-1"></a><span class="im">from</span> keras.callbacks <span class="im">import</span> EarlyStopping</span>
<span id="annotated-cell-47-2"><a href="#annotated-cell-47-2"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-47" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-47-3" class="code-annotation-target"><a href="#annotated-cell-47-3"></a>random.seed(<span class="dv">123</span>)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-47" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-47-4" class="code-annotation-target"><a href="#annotated-cell-47-4"></a>model <span class="op">=</span> Sequential([</span>
<span id="annotated-cell-47-5"><a href="#annotated-cell-47-5"></a>    Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"leaky_relu"</span>),</span>
<span id="annotated-cell-47-6"><a href="#annotated-cell-47-6"></a>    Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"exponential"</span>)</span>
<span id="annotated-cell-47-7"><a href="#annotated-cell-47-7"></a>])</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-47" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-47-8" class="code-annotation-target"><a href="#annotated-cell-47-8"></a>model.compile(<span class="st">"adam"</span>, <span class="st">"mse"</span>)</span>
<span id="annotated-cell-47-9"><a href="#annotated-cell-47-9"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-47" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-47-10" class="code-annotation-target"><a href="#annotated-cell-47-10"></a>es <span class="op">=</span> EarlyStopping(restore_best_weights<span class="op">=</span><span class="va">True</span>, patience<span class="op">=</span><span class="dv">15</span>)</span>
<span id="annotated-cell-47-11"><a href="#annotated-cell-47-11"></a></span>
<span id="annotated-cell-47-12"><a href="#annotated-cell-47-12"></a><span class="op">%</span>time hist <span class="op">=</span> model.fit(X_train_sc, y_train, epochs<span class="op">=</span><span class="dv">1_000</span>, <span class="op">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-47" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-47-13" class="code-annotation-target"><a href="#annotated-cell-47-13"></a>    callbacks<span class="op">=</span>[es], validation_data<span class="op">=</span>(X_val_sc, y_val), verbose<span class="op">=</span><span class="va">False</span>)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-47" data-target-annotation="7" onclick="event.preventDefault();">7</a><span id="annotated-cell-47-14" class="code-annotation-target"><a href="#annotated-cell-47-14"></a><span class="bu">print</span>(<span class="ss">f"Keeping model at epoch #</span><span class="sc">{</span><span class="bu">len</span>(hist.history[<span class="st">'loss'</span>])<span class="op">-</span><span class="dv">10</span><span class="sc">}</span><span class="ss">."</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-47" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-47" data-code-lines="1" data-code-annotation="1">Imports <code>EarlyStopping</code> from <code>keras.callbacks</code></span>
</dd>
<dt data-target-cell="annotated-cell-47" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-47" data-code-lines="3" data-code-annotation="2">Sets the random seed</span>
</dd>
<dt data-target-cell="annotated-cell-47" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-47" data-code-lines="4,5,6,7" data-code-annotation="3">Constructs the sequential model</span>
</dd>
<dt data-target-cell="annotated-cell-47" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-47" data-code-lines="8" data-code-annotation="4">Configures the training process with optimiser and loss function</span>
</dd>
<dt data-target-cell="annotated-cell-47" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-47" data-code-lines="10" data-code-annotation="5">Defines the early stopping object. Here, the <code>patience</code> parameter tells how many epochs the neural network has to wait without no improvement before the process stops. <code>patience=15</code> indicates that the neural network will wait for 15 epochs without any improvement before it stops training. <code>restore_best_weights=True</code> ensures that model’s weights will be restored to the best model, i.e., the model we saw before 15 epochs</span>
</dd>
<dt data-target-cell="annotated-cell-47" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-47" data-code-lines="13" data-code-annotation="6">Fits the model with early stopping object passed in</span>
</dd>
<dt data-target-cell="annotated-cell-47" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-47" data-code-lines="14" data-code-annotation="7">Prints the outs</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 5.67 s, sys: 466 ms, total: 6.14 s
Wall time: 4.39 s
Keeping model at epoch #14.</code></pre>
</div>
</div>
</section>
<section id="loss-curve-4" class="level3">
<h3 class="anchored" data-anchor-id="loss-curve-4">Loss curve</h3>
<div id="291fc763" class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>plt.plot(hist.history[<span class="st">"loss"</span>])</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>plt.plot(hist.history[<span class="st">"val_loss"</span>])</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">"Training"</span>, <span class="st">"Validation"</span>])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-75-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="loss-curve-ii" class="level3">
<h3 class="anchored" data-anchor-id="loss-curve-ii">Loss curve II</h3>
<div id="9eefd6d3" class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>plt.plot(hist.history[<span class="st">"loss"</span>])</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>plt.plot(hist.history[<span class="st">"val_loss"</span>])</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="dv">8</span>])</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">"Training"</span>, <span class="st">"Validation"</span>])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-76-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="predictions-2" class="level3">
<h3 class="anchored" data-anchor-id="predictions-2">Predictions</h3>
<div class="columns">
<div class="column">
<div id="e2efad60" class="cell" data-execution_count="77">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-78-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div><div class="column">
<div id="a48ce5d2" class="cell" data-execution_count="78">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-79-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="comparing-models-validation-1" class="level3" data-visibility="uncounted">
<h3 data-visibility="uncounted" class="anchored" data-anchor-id="comparing-models-validation-1">Comparing models (validation)</h3>
<div id="fe0a501f" class="cell" data-execution_count="81">
<div class="cell-output cell-output-display" data-execution_count="78">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Model</th>
<th data-quarto-table-cell-role="th">MSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>Basic ANN</td>
<td>8.391657</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>Long run ANN</td>
<td>0.927967</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Linear Regression</td>
<td>0.505942</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>Early stop ANN</td>
<td>0.386975</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>Exp ANN</td>
<td>0.369696</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>MSE error on the validation set has improved from the ANN model without early stopping (0.354653) to the one with early stopping (0.326440).</p>
</section>
<section id="the-test-set" class="level3">
<h3 class="anchored" data-anchor-id="the-test-set">The test set</h3>
<p>Evaluate <em>only the final/selected model</em> on the test set.</p>
<div id="9593bd75" class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>mse(y_test, model.predict(X_test_sc, verbose<span class="op">=</span><span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="79">
<pre><code>0.4026048522207643</code></pre>
</div>
</div>
<div id="99c6ecec" class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>model.evaluate(X_test_sc, y_test, verbose<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="80">
<pre><code>0.4026048183441162</code></pre>
</div>
</div>
<p>Evaluating the model on the unseen test set provides an unbiased view on how the model will perform. Since we configured the model to track ‘mse’ as the loss function, we can simply use <code>model.evaluate()</code> function on the test set and get the same answer.</p>
</section>
<section id="another-useful-callback" class="level3">
<h3 class="anchored" data-anchor-id="another-useful-callback">Another useful callback</h3>
<div id="2e3cb12b" class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="annotated-cell-52"><pre class="sourceCode python code-annotation-code code-with-copy"><code class="sourceCode python"><span id="annotated-cell-52-1"><a href="#annotated-cell-52-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="annotated-cell-52-2"><a href="#annotated-cell-52-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.callbacks <span class="im">import</span> ModelCheckpoint</span>
<span id="annotated-cell-52-3"><a href="#annotated-cell-52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-52-4"><a href="#annotated-cell-52-4" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">123</span>)</span>
<span id="annotated-cell-52-5"><a href="#annotated-cell-52-5" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential(</span>
<span id="annotated-cell-52-6"><a href="#annotated-cell-52-6" aria-hidden="true" tabindex="-1"></a>    [Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"leaky_relu"</span>), Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"exponential"</span>)]</span>
<span id="annotated-cell-52-7"><a href="#annotated-cell-52-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="annotated-cell-52-8"><a href="#annotated-cell-52-8" aria-hidden="true" tabindex="-1"></a>model.compile(<span class="st">"adam"</span>, <span class="st">"mse"</span>)</span>
<span id="annotated-cell-52-9"><a href="#annotated-cell-52-9" aria-hidden="true" tabindex="-1"></a>mc <span class="op">=</span> ModelCheckpoint(</span>
<span id="annotated-cell-52-10"><a href="#annotated-cell-52-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"best-model.keras"</span>, monitor<span class="op">=</span><span class="st">"val_loss"</span>, save_best_only<span class="op">=</span><span class="va">True</span></span>
<span id="annotated-cell-52-11"><a href="#annotated-cell-52-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="annotated-cell-52-12"><a href="#annotated-cell-52-12" aria-hidden="true" tabindex="-1"></a>es <span class="op">=</span> EarlyStopping(restore_best_weights<span class="op">=</span><span class="va">True</span>, patience<span class="op">=</span><span class="dv">5</span>)</span>
<span id="annotated-cell-52-13"><a href="#annotated-cell-52-13" aria-hidden="true" tabindex="-1"></a>hist <span class="op">=</span> model.fit(</span>
<span id="annotated-cell-52-14"><a href="#annotated-cell-52-14" aria-hidden="true" tabindex="-1"></a>    X_train_sc,</span>
<span id="annotated-cell-52-15"><a href="#annotated-cell-52-15" aria-hidden="true" tabindex="-1"></a>    y_train,</span>
<span id="annotated-cell-52-16"><a href="#annotated-cell-52-16" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span><span class="dv">100</span>,</span>
<span id="annotated-cell-52-17"><a href="#annotated-cell-52-17" aria-hidden="true" tabindex="-1"></a>    validation_split<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="annotated-cell-52-18"><a href="#annotated-cell-52-18" aria-hidden="true" tabindex="-1"></a>    callbacks<span class="op">=</span>[mc, es],</span>
<span id="annotated-cell-52-19"><a href="#annotated-cell-52-19" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="annotated-cell-52-20"><a href="#annotated-cell-52-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="annotated-cell-52-21"><a href="#annotated-cell-52-21" aria-hidden="true" tabindex="-1"></a>Path(<span class="st">"best-model.keras"</span>).stat().st_size</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="81">
<pre><code>19215</code></pre>
</div>
</div>
<p><code>ModelCheckpoint</code> is also another useful <code>callback</code> function that can be used to save the model at some intervals during training. This is useful when training large datasets. If the training process gets interrupted at some point, last saved set of weights from model checkpoints can be used to resume the training process instead of starting from the beginning.</p>
</section>


</section>

<div id="quarto-appendix" class="default"><section id="package-versions" class="level3 appendix" data-visibility="uncounted"><h2 class="anchored quarto-appendix-heading">Package Versions</h2><div class="quarto-appendix-contents">

<div id="e1d92e9e" class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> watermark <span class="im">import</span> watermark</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(watermark(python<span class="op">=</span><span class="va">True</span>, packages<span class="op">=</span><span class="st">"keras,matplotlib,numpy,pandas,seaborn,scipy,torch,tensorflow,tf_keras"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Python implementation: CPython
Python version       : 3.11.9
IPython version      : 8.24.0

keras     : 3.3.3
matplotlib: 3.9.0
numpy     : 1.26.4
pandas    : 2.2.2
seaborn   : 0.13.2
scipy     : 1.11.0
torch     : 2.0.1
tensorflow: 2.16.1
tf_keras  : 2.16.0
</code></pre>
</div>
</div>
</div></section><section id="glossary" class="level3 appendix" data-visibility="uncounted"><h2 class="anchored quarto-appendix-heading">Glossary</h2><div class="quarto-appendix-contents">

<div class="columns">
<div class="column">
<ul>
<li>callbacks</li>
<li>cost/loss function</li>
<li>early stopping</li>
<li>epoch</li>
<li>Keras, Tensorflow, PyTorch</li>
</ul>
</div><div class="column">
<ul>
<li>matplotlib</li>
<li>targets</li>
<li>training/test split</li>
<li>validation set</li>
</ul>
</div>
</div>


</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../Exercises/chess-ai.html" class="pagination-link" aria-label="Exercise: Chess AI">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Exercise: Chess AI</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../Lecture-2-Deep-Learning-Keras/project.html" class="pagination-link" aria-label="Project Details">
        <span class="nav-page-text">Project Details</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>