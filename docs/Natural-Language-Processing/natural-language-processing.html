<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.13">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Patrick Laub">

<title>Natural Language Processing – AI for Actuaries</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../Exercises/police-reports.html" rel="next">
<link href="../Exercises/hurricane-damage.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dc6cd09e1b25ae810b0d2454ed436d57.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-f347febcba4b1905c2dab7170c436fa0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../Natural-Language-Processing/natural-language-processing.html">Module 4</a></li><li class="breadcrumb-item"><a href="../Natural-Language-Processing/natural-language-processing.html">Natural Language Processing</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">AI for Actuaries</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Module 1</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Artificial-Intelligence/course-overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Artificial-Intelligence/artificial-intelligence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Artificial Intelligence</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Artificial-Intelligence/python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Labs/python-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab: Intro Python</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Labs/python-for-data-science-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab: Python for Data Science</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Exercises/chess-ai.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise: Chess AI</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Module 2</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Tabular-Data/deep-learning-keras.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Deep Learning with Keras</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Tabular-Data/categorical-variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Categorical Variables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Tabular-Data/classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Classification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Tabular-Data/project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Project Details</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Labs/matplotlib-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab: Matplotlib</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Exercises/victorian-crash-severity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise: Victorian Car Crash Severity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Exercises/french-motor-frequency.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise: French Motor Claim Frequency</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Module 3</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Computer-Vision/computer-vision.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Computer Vision</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Labs/latex-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab: Markdown</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Exercises/hurricane-damage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise: Aerial Photos of Hurricane Damage</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Module 4</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Natural-Language-Processing/natural-language-processing.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Natural Language Processing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Exercises/police-reports.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise: Police Reports of US Car Crashes</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Module 5</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Time-Series-And-Recurrent-Neural-Networks/time-series-and-rnns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Time Series &amp; Recurrent Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Exercises/sydney-airport-temperature.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise: Sydney Temperature Forecasting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Module 6</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Advanced-Tabular-Data/entity-embedding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Entity Embedding</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Advanced-Tabular-Data/optimisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Optimisation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Labs/forward-pass-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab: Forward Pass</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Labs/optimisation-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab: Optimisation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Labs/backpropagation-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab: Backpropagation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Module 7</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Distributional-Regression/distributional-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributional Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Advanced-Topics/interpretability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interpretability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Labs/distributional-regression-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab: Distributional Regression</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">Module 8</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Generative-Networks/generative-networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generative Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Generative-Networks/gans.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generative Adversarial Networks</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#natural-language-processing" id="toc-natural-language-processing" class="nav-link active" data-scroll-target="#natural-language-processing">Natural Language Processing</a>
  <ul class="collapse">
  <li><a href="#what-is-nlp" id="toc-what-is-nlp" class="nav-link" data-scroll-target="#what-is-nlp">What is NLP?</a></li>
  <li><a href="#how-the-computer-sees-text" id="toc-how-the-computer-sees-text" class="nav-link" data-scroll-target="#how-the-computer-sees-text">How the computer sees text</a></li>
  <li><a href="#ascii" id="toc-ascii" class="nav-link" data-scroll-target="#ascii">ASCII</a></li>
  <li><a href="#random-strings" id="toc-random-strings" class="nav-link" data-scroll-target="#random-strings">Random strings</a></li>
  <li><a href="#escape-characters" id="toc-escape-characters" class="nav-link" data-scroll-target="#escape-characters">Escape characters</a></li>
  <li><a href="#non-natural-language-processing-i" id="toc-non-natural-language-processing-i" class="nav-link" data-scroll-target="#non-natural-language-processing-i">Non-natural language processing I</a></li>
  <li><a href="#non-natural-language-processing-ii" id="toc-non-natural-language-processing-ii" class="nav-link" data-scroll-target="#non-natural-language-processing-ii">Non-natural language processing II</a></li>
  <li><a href="#non-natural-language-processing-iii" id="toc-non-natural-language-processing-iii" class="nav-link" data-scroll-target="#non-natural-language-processing-iii">Non-natural language processing III</a></li>
  <li><a href="#non-natural-language-processing-iv" id="toc-non-natural-language-processing-iv" class="nav-link" data-scroll-target="#non-natural-language-processing-iv">Non-natural language processing IV</a></li>
  <li><a href="#chatgpt-tokenization" id="toc-chatgpt-tokenization" class="nav-link" data-scroll-target="#chatgpt-tokenization">ChatGPT tokenization</a></li>
  <li><a href="#applications-of-nlp-in-industry" id="toc-applications-of-nlp-in-industry" class="nav-link" data-scroll-target="#applications-of-nlp-in-industry">Applications of NLP in Industry</a></li>
  <li><a href="#applications-of-nlp-in-industry-1" id="toc-applications-of-nlp-in-industry-1" class="nav-link" data-scroll-target="#applications-of-nlp-in-industry-1">Applications of NLP in Industry</a></li>
  <li><a href="#deep-learning-nlp" id="toc-deep-learning-nlp" class="nav-link" data-scroll-target="#deep-learning-nlp">Deep learning &amp; NLP?</a></li>
  <li><a href="#nlp-in-1966-1973-1" id="toc-nlp-in-1966-1973-1" class="nav-link" data-scroll-target="#nlp-in-1966-1973-1">NLP in 1966-1973 #1</a></li>
  <li><a href="#nlp-in-1966-1973-2" id="toc-nlp-in-1966-1973-2" class="nav-link" data-scroll-target="#nlp-in-1966-1973-2">NLP in 1966-1973 #2</a></li>
  <li><a href="#high-level-history-of-deep-learning" id="toc-high-level-history-of-deep-learning" class="nav-link" data-scroll-target="#high-level-history-of-deep-learning">High-level history of deep learning</a></li>
  </ul></li>
  <li><a href="#car-crash-police-reports" id="toc-car-crash-police-reports" class="nav-link" data-scroll-target="#car-crash-police-reports">Car Crash Police Reports</a>
  <ul class="collapse">
  <li><a href="#downloading-the-dataset" id="toc-downloading-the-dataset" class="nav-link" data-scroll-target="#downloading-the-dataset">Downloading the dataset</a></li>
  <li><a href="#features" id="toc-features" class="nav-link" data-scroll-target="#features">Features</a></li>
  <li><a href="#crash-summaries" id="toc-crash-summaries" class="nav-link" data-scroll-target="#crash-summaries">Crash summaries</a></li>
  <li><a href="#a-crash-summary" id="toc-a-crash-summary" class="nav-link" data-scroll-target="#a-crash-summary">A crash summary</a></li>
  <li><a href="#carriage-returns" id="toc-carriage-returns" class="nav-link" data-scroll-target="#carriage-returns">Carriage returns</a></li>
  <li><a href="#target" id="toc-target" class="nav-link" data-scroll-target="#target">Target</a></li>
  <li><a href="#just-ignore-this-for-now" id="toc-just-ignore-this-for-now" class="nav-link" data-scroll-target="#just-ignore-this-for-now">Just ignore this for now…</a></li>
  <li><a href="#convert-y-to-integers-split-the-data" id="toc-convert-y-to-integers-split-the-data" class="nav-link" data-scroll-target="#convert-y-to-integers-split-the-data">Convert <span class="math inline">y</span> to integers &amp; split the data</a></li>
  </ul></li>
  <li><a href="#text-vectorisation" id="toc-text-vectorisation" class="nav-link" data-scroll-target="#text-vectorisation">Text Vectorisation</a>
  <ul class="collapse">
  <li><a href="#grab-the-start-of-a-few-summaries" id="toc-grab-the-start-of-a-few-summaries" class="nav-link" data-scroll-target="#grab-the-start-of-a-few-summaries">Grab the start of a few summaries</a></li>
  <li><a href="#count-words-in-the-first-summaries" id="toc-count-words-in-the-first-summaries" class="nav-link" data-scroll-target="#count-words-in-the-first-summaries">Count words in the first summaries</a></li>
  <li><a href="#encode-new-sentences-to-bow" id="toc-encode-new-sentences-to-bow" class="nav-link" data-scroll-target="#encode-new-sentences-to-bow">Encode new sentences to BoW</a></li>
  <li><a href="#bag-of-n-grams" id="toc-bag-of-n-grams" class="nav-link" data-scroll-target="#bag-of-n-grams">Bag of <span class="math inline">n</span>-grams</a></li>
  <li><a href="#tf-idf" id="toc-tf-idf" class="nav-link" data-scroll-target="#tf-idf">TF-IDF</a></li>
  </ul></li>
  <li><a href="#bag-of-words" id="toc-bag-of-words" class="nav-link" data-scroll-target="#bag-of-words">Bag Of Words</a>
  <ul class="collapse">
  <li><a href="#count-words-in-all-the-summaries" id="toc-count-words-in-all-the-summaries" class="nav-link" data-scroll-target="#count-words-in-all-the-summaries">Count words in all the summaries</a></li>
  <li><a href="#create-the-x-matrices" id="toc-create-the-x-matrices" class="nav-link" data-scroll-target="#create-the-x-matrices">Create the <span class="math inline">X</span> matrices</a></li>
  <li><a href="#check-the-input-matrix" id="toc-check-the-input-matrix" class="nav-link" data-scroll-target="#check-the-input-matrix">Check the input matrix</a></li>
  <li><a href="#make-a-simple-dense-model" id="toc-make-a-simple-dense-model" class="nav-link" data-scroll-target="#make-a-simple-dense-model">Make a simple dense model</a></li>
  <li><a href="#inspect-the-model" id="toc-inspect-the-model" class="nav-link" data-scroll-target="#inspect-the-model">Inspect the model</a></li>
  <li><a href="#fit-evaluate-the-model" id="toc-fit-evaluate-the-model" class="nav-link" data-scroll-target="#fit-evaluate-the-model">Fit &amp; evaluate the model</a></li>
  </ul></li>
  <li><a href="#limiting-the-vocabulary" id="toc-limiting-the-vocabulary" class="nav-link" data-scroll-target="#limiting-the-vocabulary">Limiting The Vocabulary</a>
  <ul class="collapse">
  <li><a href="#the-max_features-value" id="toc-the-max_features-value" class="nav-link" data-scroll-target="#the-max_features-value">The <code>max_features</code> value</a></li>
  <li><a href="#what-is-left" id="toc-what-is-left" class="nav-link" data-scroll-target="#what-is-left">What is left?</a></li>
  <li><a href="#remove-stop-words" id="toc-remove-stop-words" class="nav-link" data-scroll-target="#remove-stop-words">Remove stop words</a></li>
  <li><a href="#keep-1000-most-frequent-words" id="toc-keep-1000-most-frequent-words" class="nav-link" data-scroll-target="#keep-1000-most-frequent-words">Keep 1,000 most frequent words</a></li>
  <li><a href="#what-is-left-1" id="toc-what-is-left-1" class="nav-link" data-scroll-target="#what-is-left-1">What is left?</a></li>
  <li><a href="#check-the-input-matrix-1" id="toc-check-the-input-matrix-1" class="nav-link" data-scroll-target="#check-the-input-matrix-1">Check the input matrix</a></li>
  <li><a href="#make-inspect-the-model" id="toc-make-inspect-the-model" class="nav-link" data-scroll-target="#make-inspect-the-model">Make &amp; inspect the model</a></li>
  <li><a href="#fit-evaluate-the-model-1" id="toc-fit-evaluate-the-model-1" class="nav-link" data-scroll-target="#fit-evaluate-the-model-1">Fit &amp; evaluate the model</a></li>
  </ul></li>
  <li><a href="#intelligently-limit-the-vocabulary" id="toc-intelligently-limit-the-vocabulary" class="nav-link" data-scroll-target="#intelligently-limit-the-vocabulary">Intelligently Limit The Vocabulary</a>
  <ul class="collapse">
  <li><a href="#keep-1000-most-frequent-words-1" id="toc-keep-1000-most-frequent-words-1" class="nav-link" data-scroll-target="#keep-1000-most-frequent-words-1">Keep 1,000 most frequent words</a></li>
  <li><a href="#install-spacy" id="toc-install-spacy" class="nav-link" data-scroll-target="#install-spacy">Install spacy</a></li>
  <li><a href="#stemming" id="toc-stemming" class="nav-link" data-scroll-target="#stemming">Stemming</a></li>
  <li><a href="#lemmatization" id="toc-lemmatization" class="nav-link" data-scroll-target="#lemmatization">Lemmatization</a></li>
  <li><a href="#stemming-and-lemmatizing" id="toc-stemming-and-lemmatizing" class="nav-link" data-scroll-target="#stemming-and-lemmatizing">Stemming and lemmatizing</a></li>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples">Examples</a></li>
  <li><a href="#lemmatize-the-text" id="toc-lemmatize-the-text" class="nav-link" data-scroll-target="#lemmatize-the-text">Lemmatize the text</a></li>
  <li><a href="#apply-to-the-whole-dataset" id="toc-apply-to-the-whole-dataset" class="nav-link" data-scroll-target="#apply-to-the-whole-dataset">Apply to the whole dataset</a></li>
  <li><a href="#what-is-left-2" id="toc-what-is-left-2" class="nav-link" data-scroll-target="#what-is-left-2">What is left?</a></li>
  <li><a href="#keep-1000-most-frequent-lemmas" id="toc-keep-1000-most-frequent-lemmas" class="nav-link" data-scroll-target="#keep-1000-most-frequent-lemmas">Keep 1,000 most frequent lemmas</a></li>
  <li><a href="#check-the-input-matrix-2" id="toc-check-the-input-matrix-2" class="nav-link" data-scroll-target="#check-the-input-matrix-2">Check the input matrix</a></li>
  <li><a href="#make-inspect-the-model-1" id="toc-make-inspect-the-model-1" class="nav-link" data-scroll-target="#make-inspect-the-model-1">Make &amp; inspect the model</a></li>
  <li><a href="#fit-evaluate-the-model-2" id="toc-fit-evaluate-the-model-2" class="nav-link" data-scroll-target="#fit-evaluate-the-model-2">Fit &amp; evaluate the model</a></li>
  </ul></li>
  <li><a href="#word-embeddings" id="toc-word-embeddings" class="nav-link" data-scroll-target="#word-embeddings">Word Embeddings</a>
  <ul class="collapse">
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#word-vectors" id="toc-word-vectors" class="nav-link" data-scroll-target="#word-vectors">Word Vectors</a></li>
  <li><a href="#word-vectors-1" id="toc-word-vectors-1" class="nav-link" data-scroll-target="#word-vectors-1">Word Vectors</a></li>
  <li><a href="#remember-this-diagram" id="toc-remember-this-diagram" class="nav-link" data-scroll-target="#remember-this-diagram">Remember this diagram?</a></li>
  <li><a href="#word2vec" id="toc-word2vec" class="nav-link" data-scroll-target="#word2vec">Word2Vec</a></li>
  <li><a href="#word2vec-training-methods" id="toc-word2vec-training-methods" class="nav-link" data-scroll-target="#word2vec-training-methods">Word2Vec training methods</a></li>
  <li><a href="#the-skip-gram-network" id="toc-the-skip-gram-network" class="nav-link" data-scroll-target="#the-skip-gram-network">The skip-gram network</a></li>
  <li><a href="#word-vector-arithmetic" id="toc-word-vector-arithmetic" class="nav-link" data-scroll-target="#word-vector-arithmetic">Word Vector Arithmetic</a></li>
  </ul></li>
  <li><a href="#word-embeddings-ii" id="toc-word-embeddings-ii" class="nav-link" data-scroll-target="#word-embeddings-ii">Word Embeddings II</a>
  <ul class="collapse">
  <li><a href="#pretrained-word-embeddings" id="toc-pretrained-word-embeddings" class="nav-link" data-scroll-target="#pretrained-word-embeddings">Pretrained word embeddings</a></li>
  <li><a href="#treat-wv-like-a-dictionary" id="toc-treat-wv-like-a-dictionary" class="nav-link" data-scroll-target="#treat-wv-like-a-dictionary">Treat <code>wv</code> like a dictionary</a></li>
  <li><a href="#find-nearby-word-vectors" id="toc-find-nearby-word-vectors" class="nav-link" data-scroll-target="#find-nearby-word-vectors">Find nearby word vectors</a></li>
  <li><a href="#what-does-similarity-mean" id="toc-what-does-similarity-mean" class="nav-link" data-scroll-target="#what-does-similarity-mean">What does ‘similarity’ mean?</a></li>
  <li><a href="#wengs-got-word2vec" id="toc-wengs-got-word2vec" class="nav-link" data-scroll-target="#wengs-got-word2vec">Weng’s GoT Word2Vec</a></li>
  <li><a href="#combining-word-vectors" id="toc-combining-word-vectors" class="nav-link" data-scroll-target="#combining-word-vectors">Combining word vectors</a></li>
  <li><a href="#recipe-recommender" id="toc-recipe-recommender" class="nav-link" data-scroll-target="#recipe-recommender">Recipe recommender</a></li>
  <li><a href="#analogies-with-word-vectors" id="toc-analogies-with-word-vectors" class="nav-link" data-scroll-target="#analogies-with-word-vectors">Analogies with word vectors</a></li>
  <li><a href="#testing-more-associations" id="toc-testing-more-associations" class="nav-link" data-scroll-target="#testing-more-associations">Testing more associations</a></li>
  <li><a href="#quickly-get-to-bad-associations" id="toc-quickly-get-to-bad-associations" class="nav-link" data-scroll-target="#quickly-get-to-bad-associations">Quickly get to bad associations</a></li>
  <li><a href="#bias-in-nlp-models" id="toc-bias-in-nlp-models" class="nav-link" data-scroll-target="#bias-in-nlp-models">Bias in NLP models</a></li>
  <li><a href="#the-library-cheats-a-little-bit" id="toc-the-library-cheats-a-little-bit" class="nav-link" data-scroll-target="#the-library-cheats-a-little-bit">The library cheats a little bit</a></li>
  </ul></li>
  <li><a href="#car-crash-nlp-part-ii" id="toc-car-crash-nlp-part-ii" class="nav-link" data-scroll-target="#car-crash-nlp-part-ii">Car Crash NLP Part II</a>
  <ul class="collapse">
  <li><a href="#predict-injury-severity" id="toc-predict-injury-severity" class="nav-link" data-scroll-target="#predict-injury-severity">Predict injury severity</a></li>
  <li><a href="#using-keras-textvectorization" id="toc-using-keras-textvectorization" class="nav-link" data-scroll-target="#using-keras-textvectorization">Using Keras <code>TextVectorization</code></a></li>
  <li><a href="#the-tf-idf-vectors" id="toc-the-tf-idf-vectors" class="nav-link" data-scroll-target="#the-tf-idf-vectors">The TF-IDF vectors</a></li>
  <li><a href="#feed-tf-idf-into-an-ann" id="toc-feed-tf-idf-into-an-ann" class="nav-link" data-scroll-target="#feed-tf-idf-into-an-ann">Feed TF-IDF into an ANN</a></li>
  <li><a href="#fit-evaluate" id="toc-fit-evaluate" class="nav-link" data-scroll-target="#fit-evaluate">Fit &amp; evaluate</a></li>
  <li><a href="#keep-text-as-sequence-of-tokens" id="toc-keep-text-as-sequence-of-tokens" class="nav-link" data-scroll-target="#keep-text-as-sequence-of-tokens">Keep text as sequence of tokens</a></li>
  <li><a href="#a-sequence-of-integers" id="toc-a-sequence-of-integers" class="nav-link" data-scroll-target="#a-sequence-of-integers">A sequence of integers</a></li>
  <li><a href="#feed-lstm-a-sequence-of-one-hots" id="toc-feed-lstm-a-sequence-of-one-hots" class="nav-link" data-scroll-target="#feed-lstm-a-sequence-of-one-hots">Feed LSTM a sequence of one-hots</a></li>
  <li><a href="#fit-evaluate-1" id="toc-fit-evaluate-1" class="nav-link" data-scroll-target="#fit-evaluate-1">Fit &amp; evaluate</a></li>
  <li><a href="#custom-embeddings" id="toc-custom-embeddings" class="nav-link" data-scroll-target="#custom-embeddings">Custom embeddings</a></li>
  <li><a href="#fit-evaluate-2" id="toc-fit-evaluate-2" class="nav-link" data-scroll-target="#fit-evaluate-2">Fit &amp; evaluate</a></li>
  
  
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="natural-language-processing.slides.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../Natural-Language-Processing/natural-language-processing.html">Module 4</a></li><li class="breadcrumb-item"><a href="../Natural-Language-Processing/natural-language-processing.html">Natural Language Processing</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Natural Language Processing</h1>
<p class="subtitle lead">ACTL3143 &amp; ACTL5111 Deep Learning for Actuaries</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Patrick Laub </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div id="c47b0dfe" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Show the package imports</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy.random <span class="im">as</span> rnd</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> keras</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras <span class="im">import</span> layers</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.callbacks <span class="im">import</span> EarlyStopping</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.layers <span class="im">import</span> Dense, Input</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.metrics <span class="im">import</span> SparseTopKCategoricalAccuracy</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.models <span class="im">import</span> Sequential</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="natural-language-processing" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="natural-language-processing">Natural Language Processing</h2>
<section id="what-is-nlp" class="level3">
<h3 class="anchored" data-anchor-id="what-is-nlp">What is NLP?</h3>
<p>A field of research at the intersection of computer science, linguistics, and artificial intelligence that takes the <strong>naturally spoken or written language</strong> of humans and <strong>processes it with machines</strong> to automate or help in certain tasks</p>
</section>
<section id="how-the-computer-sees-text" class="level3">
<h3 class="anchored" data-anchor-id="how-the-computer-sees-text">How the computer sees text</h3>
<p>Spot the odd one out:</p>
<div id="1a6c408f" class="cell" data-execution_count="3">
<div class="cell-output cell-output-stdout">
<pre><code>[112, 97, 116, 114, 105, 99, 107, 32, 108, 97, 117, 98]</code></pre>
</div>
</div>
<div id="df99b259" class="cell" data-execution_count="4">
<div class="cell-output cell-output-stdout">
<pre><code>[80, 65, 84, 82, 73, 67, 75, 32, 76, 65, 85, 66]</code></pre>
</div>
</div>
<div id="9674f2f3" class="cell" data-execution_count="5">
<div class="cell-output cell-output-stdout">
<pre><code>[76, 101, 118, 105, 32, 65, 99, 107, 101, 114, 109, 97, 110]</code></pre>
</div>
</div>
<div class="fragment">
<p>Generated by:</p>
<div id="fbd3091e" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>([<span class="bu">ord</span>(x) <span class="cf">for</span> x <span class="kw">in</span> <span class="st">"patrick laub"</span>])</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>([<span class="bu">ord</span>(x) <span class="cf">for</span> x <span class="kw">in</span> <span class="st">"PATRICK LAUB"</span>])</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>([<span class="bu">ord</span>(x) <span class="cf">for</span> x <span class="kw">in</span> <span class="st">"Levi Ackerman"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>ord</code> built-in turns characters into their ASCII form.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question
</div>
</div>
<div class="callout-body-container callout-body">
<p>The largest value for a character is 127, can you guess why?</p>
</div>
</div>
</div>
</section>
<section id="ascii" class="level3">
<h3 class="anchored" data-anchor-id="ascii">ASCII</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="wiki-ASCII-Table-wide.png" class="img-fluid figure-img"></p>
<figcaption>American Standard Code for Information Interchange</figcaption>
</figure>
</div>
<p>Unicode is the new standard.</p>
<div class="footer">
<p>Source: <a href="https://commons.wikimedia.org/wiki/File:ASCII-Table-wide.svg">Wikipedia</a></p>
</div>
</section>
<section id="random-strings" class="level3">
<h3 class="anchored" data-anchor-id="random-strings">Random strings</h3>
<p>The built-in <code>chr</code> function turns numbers into characters.</p>
<div id="c3bbabb1" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>rnd.seed(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="15eebdf8" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>chars <span class="op">=</span> [<span class="bu">chr</span>(rnd.randint(<span class="dv">32</span>, <span class="dv">127</span>)) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>)]</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>chars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>['E', ',', 'h', ')', 'k', '%', 'o', '`', '0', '!']</code></pre>
</div>
</div>
<div id="104111ed" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">" "</span>.join(chars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>'E , h ) k % o ` 0 !'</code></pre>
</div>
</div>
<div id="d769daa5" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">""</span>.join([<span class="bu">chr</span>(rnd.randint(<span class="dv">32</span>, <span class="dv">127</span>)) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">50</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>"lg&amp;9R42t+&lt;=.Rdww~v-)'_]6Y! \\q(x-Oh&gt;g#f5QY#d8Kl:TpI"</code></pre>
</div>
</div>
<div id="21bc97b6" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">""</span>.join([<span class="bu">chr</span>(rnd.randint(<span class="dv">0</span>, <span class="dv">128</span>)) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">50</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>'R\x0f@D\x19obW\x07\x1a\x19h\x16\tCg~\x17}d\x1b%9S&amp;\x08 "\n\x17\x0foW\x19Gs\\J&gt;. X\x177AqM\x03\x00x'</code></pre>
</div>
</div>
</section>
<section id="escape-characters" class="level3">
<h3 class="anchored" data-anchor-id="escape-characters">Escape characters</h3>
<div class="columns">
<div class="column">
<div id="43b35784" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Hello,</span><span class="ch">\t</span><span class="st">world!"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Hello,  world!</code></pre>
</div>
</div>
<div id="b0186525" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Line 1</span><span class="ch">\n</span><span class="st">Line 2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Line 1
Line 2</code></pre>
</div>
</div>
<div id="ae19d7b6" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Patrick</span><span class="ch">\r</span><span class="st">Laub"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="a247b632" class="cell" data-execution_count="15">
<div class="cell-output cell-output-stdout">
<pre><code>Laubick</code></pre>
</div>
</div>
</div><div class="column">
<div id="bc6fe0b6" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"C:</span><span class="ch">\t</span><span class="st">om</span><span class="ch">\n</span><span class="st">ew folder"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>C:  om
ew folder</code></pre>
</div>
</div>
<p>Escape the backslash:</p>
<div id="3f5689e6" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"C:</span><span class="ch">\\</span><span class="st">tom</span><span class="ch">\\</span><span class="st">new folder"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>C:\tom\new folder</code></pre>
</div>
</div>
<div id="b083279c" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="bu">repr</span>(<span class="st">"Hello,</span><span class="ch">\r</span><span class="st">world!"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>"'Hello,\\rworld!'"</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="non-natural-language-processing-i" class="level3">
<h3 class="anchored" data-anchor-id="non-natural-language-processing-i">Non-natural language processing I</h3>
<p>How would you evaluate</p>
<blockquote class="blockquote">
<p>10 + 2 * -3</p>
</blockquote>
<div class="fragment">
<p>All that Python sees is a string of characters.</p>
<div id="b007ee74" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>[<span class="bu">ord</span>(c) <span class="cf">for</span> c <span class="kw">in</span> <span class="st">"10 + 2 * -3"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>[49, 48, 32, 43, 32, 50, 32, 42, 32, 45, 51]</code></pre>
</div>
</div>
</div>
<div class="fragment">
<div id="1ca7055c" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span> <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> <span class="op">-</span><span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>4</code></pre>
</div>
</div>
</div>
</section>
<section id="non-natural-language-processing-ii" class="level3">
<h3 class="anchored" data-anchor-id="non-natural-language-processing-ii">Non-natural language processing II</h3>
<p>Python first tokenizes the string:</p>
<div id="f3d717ec" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tokenize</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> io</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>code <span class="op">=</span> <span class="st">"10 + 2 * -3"</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>tokens <span class="op">=</span> tokenize.tokenize(io.BytesIO(code.encode(<span class="st">"utf-8"</span>)).readline)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> token <span class="kw">in</span> tokens:</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(token)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>TokenInfo(type=63 (ENCODING), string='utf-8', start=(0, 0), end=(0, 0), line='')
TokenInfo(type=2 (NUMBER), string='10', start=(1, 0), end=(1, 2), line='10 + 2 * -3')
TokenInfo(type=54 (OP), string='+', start=(1, 3), end=(1, 4), line='10 + 2 * -3')
TokenInfo(type=2 (NUMBER), string='2', start=(1, 5), end=(1, 6), line='10 + 2 * -3')
TokenInfo(type=54 (OP), string='*', start=(1, 7), end=(1, 8), line='10 + 2 * -3')
TokenInfo(type=54 (OP), string='-', start=(1, 9), end=(1, 10), line='10 + 2 * -3')
TokenInfo(type=2 (NUMBER), string='3', start=(1, 10), end=(1, 11), line='10 + 2 * -3')
TokenInfo(type=4 (NEWLINE), string='', start=(1, 11), end=(1, 12), line='')
TokenInfo(type=0 (ENDMARKER), string='', start=(2, 0), end=(2, 0), line='')</code></pre>
</div>
</div>
</section>
<section id="non-natural-language-processing-iii" class="level3">
<h3 class="anchored" data-anchor-id="non-natural-language-processing-iii">Non-natural language processing III</h3>
<p>Python needs to <em>parse</em> the tokens into an abstract syntax tree.</p>
<div class="columns">
<div class="column" style="width:70%;">
<div id="932f31b2" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ast</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ast.dump(ast.parse(<span class="st">"10 + 2 * -3"</span>), indent<span class="op">=</span><span class="st">"  "</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Module(
  body=[
    Expr(
      value=BinOp(
        left=Constant(value=10),
        op=Add(),
        right=BinOp(
          left=Constant(value=2),
          op=Mult(),
          right=UnaryOp(
            op=USub(),
            operand=Constant(value=3)))))],
  type_ignores=[])</code></pre>
</div>
</div>
</div><div class="column" style="width:30%;">
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">graph TD;
    Expr --&gt; C[Add]
    C --&gt; D[10]
    C --&gt; E[Mult]
    E --&gt; F[2]
    E --&gt; G[USub]
    G --&gt; H[3]

</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="non-natural-language-processing-iv" class="level3">
<h3 class="anchored" data-anchor-id="non-natural-language-processing-iv">Non-natural language processing IV</h3>
<p>The abstract syntax tree is then compiled into bytecode.</p>
<div class="columns">
<div class="column" style="width:60%;">
<div id="22c66db4" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dis</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> expression(a, b, c):</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">+</span> b <span class="op">*</span> <span class="op">-</span>c</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>dis.dis(expression)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  3           0 RESUME                   0

  4           2 LOAD_FAST                0 (a)
              4 LOAD_FAST                1 (b)
              6 LOAD_FAST                2 (c)
              8 UNARY_NEGATIVE
             10 BINARY_OP                5 (*)
             14 BINARY_OP                0 (+)
             18 RETURN_VALUE</code></pre>
</div>
</div>
</div><div class="column" style="width:40%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="stack-anim.gif" class="img-fluid figure-img"></p>
<figcaption>Running the bytecode</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="chatgpt-tokenization" class="level3">
<h3 class="anchored" data-anchor-id="chatgpt-tokenization">ChatGPT tokenization</h3>
<p><a href="https://platform.openai.com/tokenizer">https://platform.openai.com/tokenizer</a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="gpt-tokens.png" class="img-fluid figure-img"></p>
<figcaption>Example of GPT 3.5/4’s tokenization</figcaption>
</figure>
</div>
</section>
<section id="applications-of-nlp-in-industry" class="level3">
<h3 class="anchored" data-anchor-id="applications-of-nlp-in-industry">Applications of NLP in Industry</h3>
<p><strong>1) Classifying documents</strong>: Using the language within a body of text to classify it into a particular category, e.g.:</p>
<ul>
<li>Grouping emails into high and low urgency</li>
<li>Movie reviews into positive and negative sentiment (i.e.&nbsp;<em>sentiment analysis</em>)</li>
<li>Company news into bullish (positive) and bearish (negative) statements</li>
</ul>
<p><strong>2) Machine translation</strong>: Assisting language translators with machine-generated suggestions from a source language (e.g.&nbsp;English) to a target language</p>
</section>
<section id="applications-of-nlp-in-industry-1" class="level3">
<h3 class="anchored" data-anchor-id="applications-of-nlp-in-industry-1">Applications of NLP in Industry</h3>
<p><strong>3) Search engine</strong> functions, including:</p>
<ul>
<li>Autocomplete</li>
<li>Predicting what information or website user is seeking</li>
</ul>
<p><strong>4) Speech recognition</strong>: Interpreting voice commands to provide information or take action. Used in virtual assistants such as Alexa, Siri, and Cortana</p>
</section>
<section id="deep-learning-nlp" class="level3">
<h3 class="anchored" data-anchor-id="deep-learning-nlp">Deep learning &amp; NLP?</h3>
<p>Simple NLP applications such as spell checkers and synonym suggesters <strong>do not require deep learning</strong> and can be solved with <strong>deterministic, rules-based code</strong> with a dictionary/thesaurus.</p>
<p>More complex NLP applications such as classifying documents, search engine word prediction, and chatbots are complex enough to be solved using deep learning methods.</p>
</section>
<section id="nlp-in-1966-1973-1" class="level3">
<h3 class="anchored" data-anchor-id="nlp-in-1966-1973-1">NLP in 1966-1973 #1</h3>
<blockquote class="blockquote">
<p>A typical story occurred in early machine translation efforts, which were generously funded by the U.S. National Research Council in an attempt to speed up the translation of Russian scientific papers in the wake of the Sputnik launch in 1957. It was thought initially that simple syntactic transformations, based on the grammars of Russian and English, and word replacement from an electronic dictionary, would suffice to preserve the exact meanings of sentences.</p>
</blockquote>
<div class="footer">
<p>Source: Russell and Norvig (2016), <em>Artificial Intelligence: A Modern Approach</em>, Third Edition, p.&nbsp;21.</p>
</div>
</section>
<section id="nlp-in-1966-1973-2" class="level3">
<h3 class="anchored" data-anchor-id="nlp-in-1966-1973-2">NLP in 1966-1973 #2</h3>
<blockquote class="blockquote">
<p>The fact is that accurate translation requires background knowledge in order to resolve ambiguity and establish the content of the sentence. The famous retranslation of <strong>“the spirit is willing but the flesh is weak”</strong> as <strong>“the vodka is good but the meat is rotten”</strong> illustrates the difficulties encountered. In 1966, a report by an advisory committee found that “there has been no machine translation of general scientific text, and none is in immediate prospect.” All U.S. government funding for academic translation projects was canceled.</p>
</blockquote>
<div class="footer">
<p>Source: Russell and Norvig (2016), <em>Artificial Intelligence: A Modern Approach</em>, Third Edition, p.&nbsp;21.</p>
</div>
</section>
<section id="high-level-history-of-deep-learning" class="level3">
<h3 class="anchored" data-anchor-id="high-level-history-of-deep-learning">High-level history of deep learning</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="krohn_f02_03.jpeg" class="img-fluid figure-img"></p>
<figcaption>A brief history of deep learning.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Krohn (2019), <em>Deep Learning Illustrated</em>, Figure 2-3.</p>
</div>
</section>
</section>
<section id="car-crash-police-reports" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="car-crash-police-reports">Car Crash Police Reports</h2>
<section id="downloading-the-dataset" class="level3">
<h3 class="anchored" data-anchor-id="downloading-the-dataset">Downloading the dataset</h3>
<p>Look at the (U.S.) National Highway Traffic Safety Administration’s (NHTSA) <a href="https://crashstats.nhtsa.dot.gov/Api/Public/ViewPublication/812506">National Motor Vehicle Crash Causation Survey</a> (NMVCCS) dataset.</p>
<div id="2b545182" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="annotated-cell-7"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-7-1" class="code-annotation-target"><a href="#annotated-cell-7-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="annotated-cell-7-2"><a href="#annotated-cell-7-2" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-7-3" class="code-annotation-target"><a href="#annotated-cell-7-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> Path(<span class="st">"NHTSA_NMVCCS_extract.parquet.gzip"</span>).exists():</span>
<span id="annotated-cell-7-4"><a href="#annotated-cell-7-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Downloading dataset"</span>)                                    </span>
<span id="annotated-cell-7-5"><a href="#annotated-cell-7-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>wget https:<span class="op">//</span>github.com<span class="op">/</span>JSchelldorfer<span class="op">/</span>ActuarialDataScience<span class="op">/</span>raw<span class="op">/</span>master<span class="op">/</span><span class="dv">12</span><span class="op">%</span><span class="dv">20</span><span class="op">-%</span><span class="dv">20</span><span class="er">NLP</span><span class="op">%</span><span class="dv">20</span><span class="er">Using</span><span class="op">%</span><span class="dv">20</span><span class="er">Transformers</span><span class="op">/</span>NHTSA_NMVCCS_extract.parquet.gzip</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-7-6" class="code-annotation-target"><a href="#annotated-cell-7-6" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-7-7" class="code-annotation-target"><a href="#annotated-cell-7-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_parquet(<span class="st">"NHTSA_NMVCCS_extract.parquet.gzip"</span>)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-7-8" class="code-annotation-target"><a href="#annotated-cell-7-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"shape of DataFrame: </span><span class="sc">{</span>df<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-7" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="1" data-code-annotation="1">Imports <code>Path</code> class from <code>pathlib</code> library</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="3" data-code-annotation="2">Checks whether the zip folder already exists</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="6" data-code-annotation="3">If it doesn’t, gets the folder from the given location</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="7" data-code-annotation="4">Reads the zipped <code>parquet</code> file and stores it as a data frame. <code>parquet</code> is an efficient data storage format, similar to <code>.csv</code></span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="8" data-code-annotation="5">Prints the shape of the data frame</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>shape of DataFrame: (6949, 16)</code></pre>
</div>
</div>
</section>
<section id="features" class="level3 smaller">
<h3 class="smaller anchored" data-anchor-id="features">Features</h3>
<ul>
<li><code>level_0</code>, <code>index</code>, <code>SCASEID</code>: all useless row numbers</li>
<li><code>SUMMARY_EN</code> and <code>SUMMARY_GE</code>: summaries of the accident</li>
<li><code>NUMTOTV</code>: total number of vehicles involved in the accident</li>
<li><code>WEATHER1</code> to <code>WEATHER8</code> (<strong>not one-hot</strong>):
<ul>
<li><code>WEATHER1</code>: cloudy</li>
<li><code>WEATHER2</code>: snow</li>
<li><code>WEATHER3</code>: fog, smog, smoke</li>
<li><code>WEATHER4</code>: rain</li>
<li><code>WEATHER5</code>: sleet, hail (freezing drizzle or rain)</li>
<li><code>WEATHER6</code>: blowing snow</li>
<li><code>WEATHER7</code>: severe crosswinds</li>
<li><code>WEATHER8</code>: other</li>
</ul></li>
<li><code>INJSEVA</code> and <code>INJSEVB</code>: injury severity &amp; (binary) presence of bodily injury</li>
</ul>
<div class="footer">
<p>Source: <a href="https://github.com/JSchelldorfer/ActuarialDataScience/blob/master/12%20-%20NLP%20Using%20Transformers/Actuarial_Applications_of_NLP_Part_1.ipynb">JSchelldorfer’s GitHub</a>.</p>
</div>
<p>The analysis will ignore variables <code>level_0</code>, <code>index</code>, <code>SCASEID</code>, <code>SUMMARY_GE</code> and <code>INJSEVA</code>.</p>
</section>
<section id="crash-summaries" class="level3">
<h3 class="anchored" data-anchor-id="crash-summaries">Crash summaries</h3>
<div id="cfc98272" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"SUMMARY_EN"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>0       V1, a 2000 Pontiac Montana minivan, made a lef...
1       The crash occurred in the eastbound lane of a ...
2       This crash occurred just after the noon time h...
                              ...                        
6946    The crash occurred in the eastbound lanes of a...
6947    This single-vehicle crash occurred in a rural ...
6948    This two vehicle daytime collision occurred mi...
Name: SUMMARY_EN, Length: 6949, dtype: object</code></pre>
</div>
</div>
<p>The <code>SUMMARY_EN</code> column contains summary of the accidents. There are 6949 rows corresponding to 6949 accidents. The data type is <code>object</code>, therefore, it will perform string (not mathematical) operations on the data. The following code shows how to generate a histogram for the length of the string. It looks at each entry of the column <code>SUMMARY_EN</code>, computes the length of the string (number of letters in the string), and create a histogram. The histogram shows that summaries are 2000 characters long on average.</p>
<div id="9c0bd442" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"SUMMARY_EN"</span>].<span class="bu">map</span>(<span class="kw">lambda</span> summary: <span class="bu">len</span>(summary)).hist(grid<span class="op">=</span><span class="va">False</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="natural-language-processing_files/figure-html/cell-28-output-1.png" width="1617" height="690" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="a-crash-summary" class="level3">
<h3 class="anchored" data-anchor-id="a-crash-summary">A crash summary</h3>
<p>The following code looks at the data entry for integer location 1 from the <code>SUMMARY_EN</code> data column in the dataframe <code>df</code>.</p>
<div id="ddc5753a" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"SUMMARY_EN"</span>].iloc[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>"The crash occurred in the eastbound lane of a two-lane, two-way asphalt roadway on level grade.  The conditions were daylight and wet with cloudy skies in the early afternoon on a weekday.\t\r \r V1, a 1995 Chevrolet Lumina was traveling eastbound.  V2, a 2004 Chevrolet Trailblazer was also traveling eastbound on the same roadway.  V2, was attempting to make a left-hand turn into a private drive on the North side of the roadway.  While turning V1 attempted to pass V2 on the left-hand side contacting it's front to the left side of V2.  Both vehicles came to final rest on the roadway at impact.\r \r The driver of V1 fled the scene and was not identified, so no further information could be obtained from him.  The Driver of V2 stated that the driver was a male and had hit his head and was bleeding.  She did not pursue the driver because she thought she saw a gun. The officer said that the car had been reported stolen.\r \r The Critical Precrash Event for the driver of V1 was this vehicle traveling over left lane line on the left side of travel.  The Critical Reason for the Critical Event was coded as unknown reason for the critical event because the driver was not available. \r \r The driver of V2 was a 41-year old female who had reported that she had stopped prior to turning to make sure she was at the right house.  She was going to show a house for a client.  She had no health related problems.  She had taken amoxicillin.  She does not wear corrective lenses and felt rested.  She was not injured in the crash.\r \r The Critical Precrash Event for the driver of V2 was other vehicle encroachment from adjacent lane over left lane line.  The Critical Reason for the Critical Event was not coded for this vehicle and the driver of V2 was not thought to have contributed to the crash."</code></pre>
</div>
</div>
<p>Note that the output is with in double quotations. Further, we can see characters like <code>\r</code> <code>\t</code> in the output. This allows us to copy the entire output, and insert it in any python code for running codes. It is different from printing the output.</p>
</section>
<section id="carriage-returns" class="level3">
<h3 class="anchored" data-anchor-id="carriage-returns">Carriage returns</h3>
<div id="5fa88fbe" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">"SUMMARY_EN"</span>].iloc[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Passing the <code>print</code> command for <code>df["SUMMARY_EN"].iloc[1]</code> returns an output without the double quotations. Furthermore, the characters like <code>\r</code> <code>\t</code> are now activated in to ‘carriage return’ and ‘tab’ controls respectively. If ‘carriage return’ characters are activated (without newline character <code>\n</code> following it), then it can write next text over the previous lines and create confusion in the text processing.</p>
<div id="3608288b" class="cell" data-execution_count="30">
<div class="cell-output cell-output-stdout">
<pre><code>The Critical Precrash Event for the driver of V2 was other vehicle encroachment from adjacent lane over left lane line.  The Critical Reason for the Critical Event was not coded for this vehicle and the driver of V2 was not thought to have contributed to the crash.r corrective lenses and felt rested.  She was not injured in the crash. of V2.  Both vehicles came to final rest on the roadway at impact.</code></pre>
</div>
</div>
<p>To avoid such confusions in text processing, we can write a function to replace <code>\r</code> character with <code>\n</code> in the following manner, and apply the function to the entire <code>SUMMARY_EN</code> column using the <code>map</code> function.</p>
<div id="e027cfc8" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace every \r with \n</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> replace_carriage_return(summary):</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> summary.replace(<span class="st">"</span><span class="ch">\r</span><span class="st">"</span>, <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"SUMMARY_EN"</span>] <span class="op">=</span> df[<span class="st">"SUMMARY_EN"</span>].<span class="bu">map</span>(replace_carriage_return)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">"SUMMARY_EN"</span>].iloc[<span class="dv">1</span>][:<span class="dv">500</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The crash occurred in the eastbound lane of a two-lane, two-way asphalt roadway on level grade.  The conditions were daylight and wet with cloudy skies in the early afternoon on a weekday.    
 
 V1, a 1995 Chevrolet Lumina was traveling eastbound.  V2, a 2004 Chevrolet Trailblazer was also traveling eastbound on the same roadway.  V2, was attempting to make a left-hand turn into a private drive on the North side of the roadway.  While turning V1 attempted to pass V2 on the left-hand side contactin</code></pre>
</div>
</div>
</section>
<section id="target" class="level3">
<h3 class="anchored" data-anchor-id="target">Target</h3>
<div class="columns">
<div class="column">
<p>Predict number of vehicles in the crash.</p>
<div id="5e606fc8" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="annotated-cell-150"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-150-1"><a href="#annotated-cell-150-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"NUMTOTV"</span>].value_counts()<span class="op">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-150" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-150-2" class="code-annotation-target"><a href="#annotated-cell-150-2" aria-hidden="true" tabindex="-1"></a>    .sort_index()</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-150" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-150" data-code-lines="2" data-code-annotation="1">The code selects the column with total number of vehicles <code>NUMTOTV</code>, obtain the value counts for each categories, returns the sorted vector.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>NUMTOTV
1    1822
2    4151
3     783
4     150
5      34
6       5
7       2
8       1
9       1
Name: count, dtype: int64</code></pre>
</div>
</div>
<div id="98f9e86f" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>np.sum(df[<span class="st">"NUMTOTV"</span>] <span class="op">&gt;</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>193</code></pre>
</div>
</div>
</div><div class="column">
<p>Simplify the target to just:</p>
<ul>
<li>1 vehicle</li>
<li>2 vehicles</li>
<li>3+ vehicles</li>
</ul>
<div id="0d81034c" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="annotated-cell-154"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-154-1"><a href="#annotated-cell-154-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"NUM_VEHICLES"</span>] <span class="op">=</span> <span class="op">\</span></span>
<span id="annotated-cell-154-2"><a href="#annotated-cell-154-2" aria-hidden="true" tabindex="-1"></a>  df[<span class="st">"NUMTOTV"</span>].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="op">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-154" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-154-3" class="code-annotation-target"><a href="#annotated-cell-154-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">str</span>(x) <span class="cf">if</span> x <span class="op">&lt;=</span> <span class="dv">2</span> <span class="cf">else</span> <span class="st">"3+"</span>)</span>
<span id="annotated-cell-154-4"><a href="#annotated-cell-154-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"NUM_VEHICLES"</span>].value_counts()<span class="op">\</span></span>
<span id="annotated-cell-154-5"><a href="#annotated-cell-154-5" aria-hidden="true" tabindex="-1"></a>  .sort_index()</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-154" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-154" data-code-lines="3" data-code-annotation="1">Writes a function to reduce categories to 3, by combining all categories with 3 or more vehicles into one category</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>NUM_VEHICLES
1     1822
2     4151
3+     976
Name: count, dtype: int64</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="just-ignore-this-for-now" class="level3">
<h3 class="anchored" data-anchor-id="just-ignore-this-for-now">Just ignore this for now…</h3>
<div id="0fa5448c" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>rnd.seed(<span class="dv">123</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, summary <span class="kw">in</span> <span class="bu">enumerate</span>(df[<span class="st">"SUMMARY_EN"</span>]):</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    word_numbers <span class="op">=</span> [<span class="st">"one"</span>, <span class="st">"two"</span>, <span class="st">"three"</span>, <span class="st">"four"</span>, <span class="st">"five"</span>, <span class="st">"six"</span>, <span class="st">"seven"</span>, <span class="st">"eight"</span>, <span class="st">"nine"</span>, <span class="st">"ten"</span>]</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    num_cars <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    new_car_nums <span class="op">=</span> [<span class="ss">f"V</span><span class="sc">{</span>rnd<span class="sc">.</span>randint(<span class="dv">100</span>, <span class="dv">10000</span>)<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(num_cars)]</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    num_spaces <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> car <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, num_cars<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>        new_num <span class="op">=</span> new_car_nums[car<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>        summary <span class="op">=</span> summary.replace(<span class="ss">f"V-</span><span class="sc">{</span>car<span class="sc">}</span><span class="ss">"</span>, new_num)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>        summary <span class="op">=</span> summary.replace(<span class="ss">f"Vehicle </span><span class="sc">{</span>word_numbers[car<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>, new_num).replace(<span class="ss">f"vehicle </span><span class="sc">{</span>word_numbers[car<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>, new_num)</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>        summary <span class="op">=</span> summary.replace(<span class="ss">f"Vehicle #</span><span class="sc">{</span>word_numbers[car<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>, new_num).replace(<span class="ss">f"vehicle #</span><span class="sc">{</span>word_numbers[car<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>, new_num)</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>        summary <span class="op">=</span> summary.replace(<span class="ss">f"Vehicle </span><span class="sc">{</span>car<span class="sc">}</span><span class="ss">"</span>, new_num).replace(<span class="ss">f"vehicle </span><span class="sc">{</span>car<span class="sc">}</span><span class="ss">"</span>, new_num)</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>        summary <span class="op">=</span> summary.replace(<span class="ss">f"Vehicle #</span><span class="sc">{</span>car<span class="sc">}</span><span class="ss">"</span>, new_num).replace(<span class="ss">f"vehicle #</span><span class="sc">{</span>car<span class="sc">}</span><span class="ss">"</span>, new_num)</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>        summary <span class="op">=</span> summary.replace(<span class="ss">f"Vehicle # </span><span class="sc">{</span>car<span class="sc">}</span><span class="ss">"</span>, new_num).replace(<span class="ss">f"vehicle # </span><span class="sc">{</span>car<span class="sc">}</span><span class="ss">"</span>, new_num)</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(num_spaces<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>            summary <span class="op">=</span> summary.replace(<span class="ss">f"V</span><span class="sc">{</span><span class="st">' '</span><span class="op">*</span>j<span class="sc">}{</span>car<span class="sc">}</span><span class="ss">"</span>, new_num).replace(<span class="ss">f"V</span><span class="sc">{</span><span class="st">' '</span><span class="op">*</span>j<span class="sc">}</span><span class="ss">#</span><span class="sc">{</span>car<span class="sc">}</span><span class="ss">"</span>, new_num).replace(<span class="ss">f"V</span><span class="sc">{</span><span class="st">' '</span><span class="op">*</span>j<span class="sc">}</span><span class="ss"># </span><span class="sc">{</span>car<span class="sc">}</span><span class="ss">"</span>, new_num)</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>            summary <span class="op">=</span> summary.replace(<span class="ss">f"v</span><span class="sc">{</span><span class="st">' '</span><span class="op">*</span>j<span class="sc">}{</span>car<span class="sc">}</span><span class="ss">"</span>, new_num).replace(<span class="ss">f"v</span><span class="sc">{</span><span class="st">' '</span><span class="op">*</span>j<span class="sc">}</span><span class="ss">#</span><span class="sc">{</span>car<span class="sc">}</span><span class="ss">"</span>, new_num).replace(<span class="ss">f"v</span><span class="sc">{</span><span class="st">' '</span><span class="op">*</span>j<span class="sc">}</span><span class="ss"># </span><span class="sc">{</span>car<span class="sc">}</span><span class="ss">"</span>, new_num)</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>    df.loc[i, <span class="st">"SUMMARY_EN"</span>] <span class="op">=</span> summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="convert-y-to-integers-split-the-data" class="level3">
<h3 class="anchored" data-anchor-id="convert-y-to-integers-split-the-data">Convert <span class="math inline">y</span> to integers &amp; split the data</h3>
<div id="a5c64880" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="annotated-cell-14"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-14" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-14-1" class="code-annotation-target"><a href="#annotated-cell-14-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-14" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-14-2" class="code-annotation-target"><a href="#annotated-cell-14-2" aria-hidden="true" tabindex="-1"></a>target_labels <span class="op">=</span> df[<span class="st">"NUM_VEHICLES"</span>]</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-14" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-14-3" class="code-annotation-target"><a href="#annotated-cell-14-3" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> LabelEncoder().fit_transform(target_labels)</span>
<span id="annotated-cell-14-4"><a href="#annotated-cell-14-4" aria-hidden="true" tabindex="-1"></a>target</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-14" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-lines="1" data-code-annotation="1">Imports the <code>LabelEncoder</code> from <code>sklearn.preprocessing</code> library</span>
</dd>
<dt data-target-cell="annotated-cell-14" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-lines="2" data-code-annotation="2">Defines the target variable</span>
</dd>
<dt data-target-cell="annotated-cell-14" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-lines="3" data-code-annotation="3">Fit and transform the target variable using LabelEncoder</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>array([1, 1, 1, ..., 2, 0, 1])</code></pre>
</div>
</div>
<div id="3096abae" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="annotated-cell-15"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-15-1" class="code-annotation-target"><a href="#annotated-cell-15-1" aria-hidden="true" tabindex="-1"></a>weather_cols <span class="op">=</span> [<span class="ss">f"WEATHER</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">9</span>)]</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-15-2" class="code-annotation-target"><a href="#annotated-cell-15-2" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> df[[<span class="st">"SUMMARY_EN"</span>] <span class="op">+</span> weather_cols]</span>
<span id="annotated-cell-15-3"><a href="#annotated-cell-15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-15-4"><a href="#annotated-cell-15-4" aria-hidden="true" tabindex="-1"></a>X_main, X_test, y_main, y_test <span class="op">=</span> <span class="op">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-15-5" class="code-annotation-target"><a href="#annotated-cell-15-5" aria-hidden="true" tabindex="-1"></a>    train_test_split(features, target, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="annotated-cell-15-6"><a href="#annotated-cell-15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-15-7"><a href="#annotated-cell-15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># As 0.25 x 0.8 = 0.2</span></span>
<span id="annotated-cell-15-8"><a href="#annotated-cell-15-8" aria-hidden="true" tabindex="-1"></a>X_train, X_val, y_train, y_val <span class="op">=</span> <span class="op">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-15-9" class="code-annotation-target"><a href="#annotated-cell-15-9" aria-hidden="true" tabindex="-1"></a>    train_test_split(X_main, y_main, test_size<span class="op">=</span><span class="fl">0.25</span>, random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="annotated-cell-15-10"><a href="#annotated-cell-15-10" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-15-11" class="code-annotation-target"><a href="#annotated-cell-15-11" aria-hidden="true" tabindex="-1"></a>X_train.shape, X_val.shape, X_test.shape</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-15" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="1" data-code-annotation="1">Creates a list that returns column names of weather conditions, i.e.&nbsp;<code>['WEATHER1', 'WEATHER2', 'WEATHER3', 'WEATHER4', 'WEATHER5', 'WEATHER6', 'WEATHER7', 'WEATHER8']</code></span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="2" data-code-annotation="2">Defines the feature vector by selecting relevant columns from the data frame <code>df</code></span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="5" data-code-annotation="3">Splits the data into train and validation sets</span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="9" data-code-annotation="4">Further divides the validation set into validation set and test set</span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="11" data-code-annotation="5">Prints the dimensions of the data frames</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>((4169, 9), (1390, 9), (1390, 9))</code></pre>
</div>
</div>
<div id="1d9c3cb1" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>([np.mean(y_train <span class="op">==</span> y) <span class="cf">for</span> y <span class="kw">in</span> [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[0.25833533221396016, 0.6032621731830176, 0.1384024946030223]</code></pre>
</div>
</div>
</section>
</section>
<section id="text-vectorisation" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="text-vectorisation">Text Vectorisation</h2>
<p>Text vectorisation is a method to convert text into a numerical representation.</p>
<section id="grab-the-start-of-a-few-summaries" class="level3">
<h3 class="anchored" data-anchor-id="grab-the-start-of-a-few-summaries">Grab the start of a few summaries</h3>
<div id="df84e4ec" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>first_summaries <span class="op">=</span> X_train[<span class="st">"SUMMARY_EN"</span>].iloc[:<span class="dv">3</span>]</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>first_summaries</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>2532    This crash occurred in the early afternoon of ...
6209    This two-vehicle crash occurred in a four-legg...
2561    The crash occurred in the eastbound direction ...
Name: SUMMARY_EN, dtype: object</code></pre>
</div>
</div>
<div id="73b1e12e" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="annotated-cell-18"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-18" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-18-1" class="code-annotation-target"><a href="#annotated-cell-18-1" aria-hidden="true" tabindex="-1"></a>first_words <span class="op">=</span> first_summaries.<span class="bu">map</span>(<span class="kw">lambda</span> txt: txt.split(<span class="st">" "</span>)[:<span class="dv">7</span>])</span>
<span id="annotated-cell-18-2"><a href="#annotated-cell-18-2" aria-hidden="true" tabindex="-1"></a>first_words</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-18" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-18" data-code-lines="1" data-code-annotation="1">Takes the <code>first_summaries</code>, converts the string of words in to a list of words by breaking the string at spaces and returns the first 7 words</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>2532    [This, crash, occurred, in, the, early, aftern...
6209    [This, two-vehicle, crash, occurred, in, a, fo...
2561    [The, crash, occurred, in, the, eastbound, dir...
Name: SUMMARY_EN, dtype: object</code></pre>
</div>
</div>
<div id="184193cc" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="annotated-cell-19"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-19" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-19-1" class="code-annotation-target"><a href="#annotated-cell-19-1" aria-hidden="true" tabindex="-1"></a>start_of_summaries <span class="op">=</span> first_words.<span class="bu">map</span>(<span class="kw">lambda</span> txt: <span class="st">" "</span>.join(txt))</span>
<span id="annotated-cell-19-2"><a href="#annotated-cell-19-2" aria-hidden="true" tabindex="-1"></a>start_of_summaries</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-19" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-19" data-code-lines="1" data-code-annotation="1">Joint the words in the list with a space in between to return a string</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>2532          This crash occurred in the early afternoon
6209    This two-vehicle crash occurred in a four-legged
2561       The crash occurred in the eastbound direction
Name: SUMMARY_EN, dtype: object</code></pre>
</div>
</div>
</section>
<section id="count-words-in-the-first-summaries" class="level3">
<h3 class="anchored" data-anchor-id="count-words-in-the-first-summaries">Count words in the first summaries</h3>
<div id="f28f2bb3" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="annotated-cell-20"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-20" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-20-1" class="code-annotation-target"><a href="#annotated-cell-20-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> CountVectorizer</span>
<span id="annotated-cell-20-2"><a href="#annotated-cell-20-2" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-20" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-20-3" class="code-annotation-target"><a href="#annotated-cell-20-3" aria-hidden="true" tabindex="-1"></a>vect <span class="op">=</span> CountVectorizer()</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-20" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-20-4" class="code-annotation-target"><a href="#annotated-cell-20-4" aria-hidden="true" tabindex="-1"></a>counts <span class="op">=</span> vect.fit_transform(start_of_summaries)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-20" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-20-5" class="code-annotation-target"><a href="#annotated-cell-20-5" aria-hidden="true" tabindex="-1"></a>vocab <span class="op">=</span> vect.get_feature_names_out()</span>
<span id="annotated-cell-20-6"><a href="#annotated-cell-20-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(vocab), vocab)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-20" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-20" data-code-lines="1" data-code-annotation="1">Imports the <code>CountVectorizer</code> class from the <code>sklearn.feature_extraction.text</code> library. <code>CountVectorizer</code> goes through a text document, identifies distinct words in it, and returns a sparse matrix.</span>
</dd>
<dt data-target-cell="annotated-cell-20" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-20" data-code-lines="3" data-code-annotation="2">Applies <code>fit_transform</code> function to the <code>start_of_summaries</code></span>
</dd>
<dt data-target-cell="annotated-cell-20" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-20" data-code-lines="4" data-code-annotation="3">Stores the distinct words in the vector <code>vocab</code></span>
</dd>
<dt data-target-cell="annotated-cell-20" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-20" data-code-lines="5,6" data-code-annotation="4">Returns the number of distinct words, and the words themselves</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>13 ['afternoon' 'crash' 'direction' 'early' 'eastbound' 'four' 'in' 'legged'
 'occurred' 'the' 'this' 'two' 'vehicle']</code></pre>
</div>
</div>
<div id="474a1e4f" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>counts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>&lt;3x13 sparse matrix of type '&lt;class 'numpy.int64'&gt;'
    with 21 stored elements in Compressed Sparse Row format&gt;</code></pre>
</div>
</div>
<p>Giving the command to return <code>counts</code> does not return the matrix in full form. Since python saves the matrix in a Therefore, we use the following code.</p>
<div id="8a8ed6c9" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>counts.toarray()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>array([[1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 0],
       [0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 1, 1, 1],
       [0, 1, 1, 0, 1, 0, 1, 0, 1, 2, 0, 0, 0]])</code></pre>
</div>
</div>
<p>In the above matrix, rows correspond to the data entries (strings), columns correspond to distinct words, and cell entries correspond to the frequencies of distinct words in each row</p>
</section>
<section id="encode-new-sentences-to-bow" class="level3">
<h3 class="anchored" data-anchor-id="encode-new-sentences-to-bow">Encode new sentences to BoW</h3>
<div id="52b4a8a0" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="annotated-cell-23"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-23-1"><a href="#annotated-cell-23-1" aria-hidden="true" tabindex="-1"></a>vect.transform([</span>
<span id="annotated-cell-23-2"><a href="#annotated-cell-23-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"first car hit second car in a crash"</span>,</span>
<span id="annotated-cell-23-3"><a href="#annotated-cell-23-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ipad os 16 beta released"</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-23" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-23-4" class="code-annotation-target"><a href="#annotated-cell-23-4" aria-hidden="true" tabindex="-1"></a>])</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-23" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-23" data-code-lines="4" data-code-annotation="1">Applies <code>transform</code> to two new lines of data. <code>vect.transform</code> applies the already fitted transformation to the new data. It goes through the new data entries, identifies words that were seen during <code>fit_transform</code> stage, and returns a matrix containing the counts of distinct words (identified during fitting stage).</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>&lt;2x13 sparse matrix of type '&lt;class 'numpy.int64'&gt;'
    with 2 stored elements in Compressed Sparse Row format&gt;</code></pre>
</div>
</div>
<p>Note that the matrix is stored in a special format in python, hence, we must pass the command to convert it to an array using the following code.</p>
<div id="0255a270" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>vect.transform([</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"first car hit second car in a crash"</span>,</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ipad os 18 beta released"</span>,</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>]).toarray()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>array([[0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0],
       [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]])</code></pre>
</div>
</div>
<p>There are couple issues with the output. Since the <code>transform</code> function, will identify only the words trained during the <code>fit_transform</code> stage, it will not recognize the new words. The returned matrix can only say whether new data contains words seen during the fitting stage or not. We can see how the matrix returns an entire row of zero values for the second line.</p>
<div id="2daca2b7" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(vocab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['afternoon' 'crash' 'direction' 'early' 'eastbound' 'four' 'in' 'legged'
 'occurred' 'the' 'this' 'two' 'vehicle']</code></pre>
</div>
</div>
</section>
<section id="bag-of-n-grams" class="level3">
<h3 class="anchored" data-anchor-id="bag-of-n-grams">Bag of <span class="math inline">n</span>-grams</h3>
<p>The same <code>CountVectorizer</code> class can be customized to look at 2 words too. This is useful in some situations. For example, the word ‘new’ and ‘york’ separately might not be meaningful, but together, it can. This motivates the <span class="math inline">n</span>-grams option. The following code <code>CountVectorizer(ngram_range=(1, 2))</code> is an example of giving instructions to look for phrases with one word and two words.</p>
<div id="010c26dd" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>vect <span class="op">=</span> CountVectorizer(ngram_range<span class="op">=</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>counts <span class="op">=</span> vect.fit_transform(start_of_summaries)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>vocab <span class="op">=</span> vect.get_feature_names_out()</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(vocab), vocab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>27 ['afternoon' 'crash' 'crash occurred' 'direction' 'early'
 'early afternoon' 'eastbound' 'eastbound direction' 'four' 'four legged'
 'in' 'in four' 'in the' 'legged' 'occurred' 'occurred in' 'the'
 'the crash' 'the early' 'the eastbound' 'this' 'this crash' 'this two'
 'two' 'two vehicle' 'vehicle' 'vehicle crash']</code></pre>
</div>
</div>
<div id="a5cdafc5" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>counts.toarray()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>array([[1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 1,
        0, 0, 0, 0, 0],
       [0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0,
        1, 1, 1, 1, 1],
       [0, 1, 1, 1, 0, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 1, 2, 1, 0, 1, 0, 0,
        0, 0, 0, 0, 0]])</code></pre>
</div>
</div>
<p>See: <a href="https://books.google.com/ngrams">Google Books Ngram Viewer</a></p>
</section>
<section id="tf-idf" class="level3">
<h3 class="anchored" data-anchor-id="tf-idf">TF-IDF</h3>
<p>Stands for <em>term frequency-inverse document frequency</em>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="tf-idf-graphic.png" class="img-fluid figure-img"></p>
<figcaption>Infographic explaining TF-IDF</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: FiloTechnologia (2014), <a href="http://filotechnologia.blogspot.com/2014/01/a-simple-java-class-for-tfidf-scoring.html">A simple Java class for TF-IDF scoring</a>, Blog post.</p>
</div>
<p><em>term frequency-inverse document frequency</em> measures the importance of a word across documents. It first computes the frequency of term <em>x</em> in the document <em>y</em> and weights it by a measure of how common it is. The intuition here is that, the more the word <em>x</em> appears across documents, the less important it becomes.</p>
</section>
</section>
<section id="bag-of-words" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="bag-of-words">Bag Of Words</h2>
<section id="count-words-in-all-the-summaries" class="level3">
<h3 class="anchored" data-anchor-id="count-words-in-all-the-summaries">Count words in all the summaries</h3>
<div id="26921636" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="annotated-cell-28"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-28" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-28-1" class="code-annotation-target"><a href="#annotated-cell-28-1" aria-hidden="true" tabindex="-1"></a>vect <span class="op">=</span> CountVectorizer()</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-28" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-28-2" class="code-annotation-target"><a href="#annotated-cell-28-2" aria-hidden="true" tabindex="-1"></a>vect.fit(X_train[<span class="st">"SUMMARY_EN"</span>])</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-28" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-28-3" class="code-annotation-target"><a href="#annotated-cell-28-3" aria-hidden="true" tabindex="-1"></a>vocab <span class="op">=</span> <span class="bu">list</span>(vect.get_feature_names_out())</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-28" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-28-4" class="code-annotation-target"><a href="#annotated-cell-28-4" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(vocab)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-28" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-28" data-code-lines="1" data-code-annotation="1">Defines the class <code>CountVectorizer()</code> as <code>vect</code></span>
</dd>
<dt data-target-cell="annotated-cell-28" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-28" data-code-lines="2" data-code-annotation="2">Fits the vectorizer to the entire column of <code>SUMMARY_EN</code></span>
</dd>
<dt data-target-cell="annotated-cell-28" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-28" data-code-lines="3" data-code-annotation="3">Stores the distinct words as a list</span>
</dd>
<dt data-target-cell="annotated-cell-28" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-28" data-code-lines="4" data-code-annotation="4">Returns the number of unique words</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>18866</code></pre>
</div>
</div>
<p>The above code returns 18866 number of unique words.</p>
<div id="8de5e8bd" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="annotated-cell-29"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-29" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-29-1" class="code-annotation-target"><a href="#annotated-cell-29-1" aria-hidden="true" tabindex="-1"></a>vocab[:<span class="dv">5</span>], vocab[<span class="bu">len</span>(vocab)<span class="op">//</span><span class="dv">2</span>:(<span class="bu">len</span>(vocab)<span class="op">//</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">5</span>)], vocab[<span class="op">-</span><span class="dv">5</span>:]</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-29" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-29" data-code-lines="1" data-code-annotation="1">Returns (i) the first five elements, (ii) the middle five elements and (iii) the last five elements of the array.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="50">
<pre><code>(['00', '000', '000lbs', '003', '005'],
 ['swinger', 'swinging', 'swipe', 'swiped', 'swiping'],
 ['zorcor', 'zotril', 'zx2', 'zx5', 'zyrtec'])</code></pre>
</div>
</div>
</section>
<section id="create-the-x-matrices" class="level3">
<h3 class="anchored" data-anchor-id="create-the-x-matrices">Create the <span class="math inline">X</span> matrices</h3>
<p>The following function is designed to select and vectorize the text column of a given dataset, and then combine it with the other non-textual columns of the same dataset.</p>
<div id="bd3682d1" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="annotated-cell-30"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-30" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-30-1" class="code-annotation-target"><a href="#annotated-cell-30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> vectorise_dataset(X, vect, txt_col<span class="op">=</span><span class="st">"SUMMARY_EN"</span>, dataframe<span class="op">=</span><span class="va">False</span>):</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-30" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-30-2" class="code-annotation-target"><a href="#annotated-cell-30-2" aria-hidden="true" tabindex="-1"></a>    X_vects <span class="op">=</span> vect.transform(X[txt_col]).toarray()</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-30" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-30-3" class="code-annotation-target"><a href="#annotated-cell-30-3" aria-hidden="true" tabindex="-1"></a>    X_other <span class="op">=</span> X.drop(txt_col, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="annotated-cell-30-4"><a href="#annotated-cell-30-4" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-30" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-30-5" class="code-annotation-target"><a href="#annotated-cell-30-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> dataframe:</span>
<span id="annotated-cell-30-6"><a href="#annotated-cell-30-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.concatenate([X_vects, X_other], axis<span class="op">=</span><span class="dv">1</span>)                           </span>
<span id="annotated-cell-30-7"><a href="#annotated-cell-30-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="annotated-cell-30-8"><a href="#annotated-cell-30-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add column names and indices to the combined dataframe.</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-30" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-30-9" class="code-annotation-target"><a href="#annotated-cell-30-9" aria-hidden="true" tabindex="-1"></a>        vocab <span class="op">=</span> <span class="bu">list</span>(vect.get_feature_names_out())</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-30" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-30-10" class="code-annotation-target"><a href="#annotated-cell-30-10" aria-hidden="true" tabindex="-1"></a>        X_vects_df <span class="op">=</span> pd.DataFrame(X_vects, columns<span class="op">=</span>vocab, index<span class="op">=</span>X.index)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-30" data-target-annotation="7" onclick="event.preventDefault();">7</a><span id="annotated-cell-30-11" class="code-annotation-target"><a href="#annotated-cell-30-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.concat([X_vects_df, X_other], axis<span class="op">=</span><span class="dv">1</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-30" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-30" data-code-lines="1" data-code-annotation="1">Defines the function <code>vectorise_dataset</code> which takes in the dataframe <em>X</em>, an instance of a fitted vectorizer, the name of the text column, a boolean function defining whether we want the output in dataframe format or numpy array format</span>
</dd>
<dt data-target-cell="annotated-cell-30" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-30" data-code-lines="2" data-code-annotation="2">Transforms the text column based on a already fitted vectorizer function</span>
</dd>
<dt data-target-cell="annotated-cell-30" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-30" data-code-lines="3" data-code-annotation="3">Drops the column containing text data from the dataframe</span>
</dd>
<dt data-target-cell="annotated-cell-30" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-30" data-code-lines="5" data-code-annotation="4">If <code>dataframe=False</code>, then returns a numpy array by concatenating non-textual data and vectorized text data</span>
</dd>
<dt data-target-cell="annotated-cell-30" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-30" data-code-lines="9" data-code-annotation="5">Otherwise, extracts the unique words as a list</span>
</dd>
<dt data-target-cell="annotated-cell-30" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-30" data-code-lines="10" data-code-annotation="6">Generates a dataframe, with columns names <code>vocab</code>, while preserving the index from the original dataset <em>X</em></span>
</dd>
<dt data-target-cell="annotated-cell-30" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-30" data-code-lines="11" data-code-annotation="7">Concatenates <code>X_vects_df</code> with the remaining non-textual data and returns the output as a dataframe</span>
</dd>
</dl>
</div>
</div>
<div id="ce85a367" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>X_train_bow <span class="op">=</span> vectorise_dataset(X_train, vect)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>X_val_bow <span class="op">=</span> vectorise_dataset(X_val, vect)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>X_test_bow <span class="op">=</span> vectorise_dataset(X_test, vect)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="check-the-input-matrix" class="level3">
<h3 class="anchored" data-anchor-id="check-the-input-matrix">Check the input matrix</h3>
<div id="8d0044c8" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>vectorise_dataset(X_train, vect, dataframe<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">00</th>
<th data-quarto-table-cell-role="th">000</th>
<th data-quarto-table-cell-role="th">000lbs</th>
<th data-quarto-table-cell-role="th">003</th>
<th data-quarto-table-cell-role="th">005</th>
<th data-quarto-table-cell-role="th">007</th>
<th data-quarto-table-cell-role="th">00am</th>
<th data-quarto-table-cell-role="th">00pm</th>
<th data-quarto-table-cell-role="th">00tydo2</th>
<th data-quarto-table-cell-role="th">01</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">zx5</th>
<th data-quarto-table-cell-role="th">zyrtec</th>
<th data-quarto-table-cell-role="th">WEATHER1</th>
<th data-quarto-table-cell-role="th">WEATHER2</th>
<th data-quarto-table-cell-role="th">WEATHER3</th>
<th data-quarto-table-cell-role="th">WEATHER4</th>
<th data-quarto-table-cell-role="th">WEATHER5</th>
<th data-quarto-table-cell-role="th">WEATHER6</th>
<th data-quarto-table-cell-role="th">WEATHER7</th>
<th data-quarto-table-cell-role="th">WEATHER8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2532</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6209</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2561</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6882</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">206</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6356</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>4169 rows × 18874 columns</p>
</div>
</div>
</div>
<p>The above code returns the output matrix and it contains 4169 rows with 18874 columns. Next, we build a simple neural network on the data, to predict the probabilities of number of vehicles involved in the accident.</p>
</section>
<section id="make-a-simple-dense-model" class="level3">
<h3 class="anchored" data-anchor-id="make-a-simple-dense-model">Make a simple dense model</h3>
<div id="7a7a9cb5" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="annotated-cell-33"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-33" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-33-1" class="code-annotation-target"><a href="#annotated-cell-33-1" aria-hidden="true" tabindex="-1"></a>num_features <span class="op">=</span> X_train_bow.shape[<span class="dv">1</span>]</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-33" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-33-2" class="code-annotation-target"><a href="#annotated-cell-33-2" aria-hidden="true" tabindex="-1"></a>num_cats <span class="op">=</span> <span class="dv">3</span> <span class="co"># 1, 2, 3+ vehicles</span></span>
<span id="annotated-cell-33-3"><a href="#annotated-cell-33-3" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-33" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-33-4" class="code-annotation-target"><a href="#annotated-cell-33-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_model(num_features, num_cats):</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-33" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-33-5" class="code-annotation-target"><a href="#annotated-cell-33-5" aria-hidden="true" tabindex="-1"></a>    random.seed(<span class="dv">42</span>)</span>
<span id="annotated-cell-33-6"><a href="#annotated-cell-33-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="annotated-cell-33-7"><a href="#annotated-cell-33-7" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> Sequential([</span>
<span id="annotated-cell-33-8"><a href="#annotated-cell-33-8" aria-hidden="true" tabindex="-1"></a>        Input((num_features,)),</span>
<span id="annotated-cell-33-9"><a href="#annotated-cell-33-9" aria-hidden="true" tabindex="-1"></a>        Dense(<span class="dv">100</span>, activation<span class="op">=</span><span class="st">"relu"</span>),</span>
<span id="annotated-cell-33-10"><a href="#annotated-cell-33-10" aria-hidden="true" tabindex="-1"></a>        Dense(num_cats, activation<span class="op">=</span><span class="st">"softmax"</span>)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-33" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-33-11" class="code-annotation-target"><a href="#annotated-cell-33-11" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="annotated-cell-33-12"><a href="#annotated-cell-33-12" aria-hidden="true" tabindex="-1"></a>    </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-33" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-33-13" class="code-annotation-target"><a href="#annotated-cell-33-13" aria-hidden="true" tabindex="-1"></a>    topk <span class="op">=</span> SparseTopKCategoricalAccuracy(k<span class="op">=</span><span class="dv">2</span>, name<span class="op">=</span><span class="st">"topk"</span>)</span>
<span id="annotated-cell-33-14"><a href="#annotated-cell-33-14" aria-hidden="true" tabindex="-1"></a>    model.compile(<span class="st">"adam"</span>, <span class="st">"sparse_categorical_crossentropy"</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-33" data-target-annotation="7" onclick="event.preventDefault();">7</a><span id="annotated-cell-33-15" class="code-annotation-target"><a href="#annotated-cell-33-15" aria-hidden="true" tabindex="-1"></a>        metrics<span class="op">=</span>[<span class="st">"accuracy"</span>, topk])</span>
<span id="annotated-cell-33-16"><a href="#annotated-cell-33-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="annotated-cell-33-17"><a href="#annotated-cell-33-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-33" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-33" data-code-lines="1" data-code-annotation="1">Stores the number of input features in <code>num_features</code></span>
</dd>
<dt data-target-cell="annotated-cell-33" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-33" data-code-lines="2" data-code-annotation="2">Stores the number of output features in <code>num_cats</code></span>
</dd>
<dt data-target-cell="annotated-cell-33" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-33" data-code-lines="4" data-code-annotation="3">Starts building the model by giving number of input and output features as parameters</span>
</dd>
<dt data-target-cell="annotated-cell-33" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-33" data-code-lines="5" data-code-annotation="4">Sets the random seed for reproducibility</span>
</dd>
<dt data-target-cell="annotated-cell-33" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-33" data-code-lines="11" data-code-annotation="5">Constructs the neural network with 2 dense layers. Since the output must be a vector of probabilities, we choose <code>softmax</code> activation in the output layer</span>
</dd>
<dt data-target-cell="annotated-cell-33" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-33" data-code-lines="13" data-code-annotation="6">Defines the a customized metric to keep track of during the training. The metric will compute the accuracy by looking at top 2 classes(the 2 classes with highest predicted probability) and checking if either of them contains the true class</span>
</dd>
<dt data-target-cell="annotated-cell-33" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-33" data-code-lines="15" data-code-annotation="7">Compiles the model with the <code>adam</code> optimizer, loss function and metrics to monitor. Here we ask the model to optimize <code>sparse_categorical_crossentropy</code> loss while keeping track of <code>sparse_categorical_crossentropy</code> for the top 2 classes</span>
</dd>
</dl>
</div>
</div>
</section>
<section id="inspect-the-model" class="level3">
<h3 class="anchored" data-anchor-id="inspect-the-model">Inspect the model</h3>
<div id="1e11d4d5" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> build_model(num_features, num_cats)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>model.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-02-26 10:51:05.448906: E external/local_xla/xla/stream_executor/cuda/cuda_driver.cc:152] failed call to cuInit: INTERNAL: CUDA error: Failed call to cuInit: CUDA_ERROR_NO_DEVICE: no CUDA-capable device is detected
2025-02-26 10:51:05.448923: I external/local_xla/xla/stream_executor/cuda/cuda_diagnostics.cc:137] retrieving CUDA diagnostic information for host: luthen
2025-02-26 10:51:05.448926: I external/local_xla/xla/stream_executor/cuda/cuda_diagnostics.cc:144] hostname: luthen
2025-02-26 10:51:05.448976: I external/local_xla/xla/stream_executor/cuda/cuda_diagnostics.cc:168] libcuda reported version is: 550.144.3
2025-02-26 10:51:05.448985: I external/local_xla/xla/stream_executor/cuda/cuda_diagnostics.cc:172] kernel reported version is: 550.144.3
2025-02-26 10:51:05.448988: I external/local_xla/xla/stream_executor/cuda/cuda_diagnostics.cc:259] kernel version seems to match DSO: 550.144.3</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Model: "sequential"</span>
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> Layer (type)                    </span>┃<span style="font-weight: bold"> Output Shape           </span>┃<span style="font-weight: bold">       Param # </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ dense (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                   │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">100</span>)            │     <span style="color: #00af00; text-decoration-color: #00af00">1,887,500</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense_1 (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                 │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">3</span>)              │           <span style="color: #00af00; text-decoration-color: #00af00">303</span> │
└─────────────────────────────────┴────────────────────────┴───────────────┘
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Total params: </span><span style="color: #00af00; text-decoration-color: #00af00">1,887,803</span> (7.20 MB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">1,887,803</span> (7.20 MB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Non-trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">0</span> (0.00 B)
</pre>
</div>
</div>
<p>The model summary shows that there are 1,887,803 parameters to learn. This is because we have 188500 (18874*100 weights + 100 biases) parameters to train in the first layer.</p>
</section>
<section id="fit-evaluate-the-model" class="level3">
<h3 class="anchored" data-anchor-id="fit-evaluate-the-model">Fit &amp; evaluate the model</h3>
<div id="a2b85293" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>es <span class="op">=</span> EarlyStopping(patience<span class="op">=</span><span class="dv">1</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>    monitor<span class="op">=</span><span class="st">"val_accuracy"</span>, verbose<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>time hist <span class="op">=</span> model.fit(X_train_bow, y_train, epochs<span class="op">=</span><span class="dv">10</span>, <span class="op">\</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>    callbacks<span class="op">=</span>[es], validation_data<span class="op">=</span>(X_val_bow, y_val), verbose<span class="op">=</span><span class="dv">0</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 5: early stopping
Restoring model weights from the end of the best epoch: 4.
CPU times: user 35.8 s, sys: 1.82 s, total: 37.6 s
Wall time: 5 s</code></pre>
</div>
</div>
<p>Results from training the neural network shows that the model performs almost perfectly for the in sample data, and with very high accuracies for both validation and test data.</p>
<div id="56c7ddc9" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>model.evaluate(X_train_bow, y_train, verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<pre><code>[0.0025415264535695314, 1.0, 1.0]</code></pre>
</div>
</div>
<div id="5781e890" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>model.evaluate(X_val_bow, y_val, verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>[2.776606321334839, 0.9453237652778625, 0.9949640035629272]</code></pre>
</div>
</div>
<p>As this happens to be the best in validation set, we can check the performance on the test set.</p>
<div id="eeb9ca95" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>model.evaluate(X_test_bow, y_test, verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>[0.19029496610164642, 0.9374100565910339, 0.9971222877502441]</code></pre>
</div>
</div>
</section>
</section>
<section id="limiting-the-vocabulary" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="limiting-the-vocabulary">Limiting The Vocabulary</h2>
<p>Although the previous model performed really well, it had a very large number of parameters to train. Therefore, it is worth checking whether there is a way to limit the vocabulary. One way would be to look at only the most frequent words occurring</p>
<section id="the-max_features-value" class="level3">
<h3 class="anchored" data-anchor-id="the-max_features-value">The <code>max_features</code> value</h3>
<p>One way would be to select the most frequent words. The following code shows how we can choose <code>max_features</code> option to select the 10 words that occur most. This simplifies the problem, however, we might miss out on important words that might add value to the task. For example, <em>and</em>, <em>for</em> and <em>of</em> are among the selected words, but they are less meaningful.</p>
<div id="29305958" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>vect <span class="op">=</span> CountVectorizer(max_features<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>vect.fit(X_train[<span class="st">"SUMMARY_EN"</span>])</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>vocab <span class="op">=</span> vect.get_feature_names_out()</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(vocab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<pre><code>10</code></pre>
</div>
</div>
<div id="2d179523" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(vocab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['and' 'driver' 'for' 'in' 'lane' 'of' 'the' 'to' 'vehicle' 'was']</code></pre>
</div>
</div>
</section>
<section id="what-is-left" class="level3">
<h3 class="anchored" data-anchor-id="what-is-left">What is left?</h3>
<div id="43d5a156" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>    sentence <span class="op">=</span> X_train[<span class="st">"SUMMARY_EN"</span>].iloc[i]</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> word <span class="kw">in</span> sentence.split(<span class="st">" "</span>)[:<span class="dv">10</span>]:</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>        word_or_qn <span class="op">=</span> word <span class="cf">if</span> word <span class="kw">in</span> vocab <span class="cf">else</span> <span class="st">"?"</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(word_or_qn, end<span class="op">=</span><span class="st">" "</span>)</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>? ? ? in the ? ? of ? ? 

? ? ? ? in ? ? ? ? ? 

? ? ? in the ? ? of ? ? 
</code></pre>
</div>
</div>
<div id="3a5dbccb" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>    sentence <span class="op">=</span> X_train[<span class="st">"SUMMARY_EN"</span>].iloc[i]</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>    num_words <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> word <span class="kw">in</span> sentence.split(<span class="st">" "</span>):</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> word <span class="kw">in</span> vocab:</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(word, end<span class="op">=</span><span class="st">" "</span>)</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>            num_words <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> num_words <span class="op">==</span> <span class="dv">10</span>:</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>in the of in the of of was and was 

in and of in and for the of the and 

in the of to was was of was was and 
</code></pre>
</div>
</div>
</section>
<section id="remove-stop-words" class="level3">
<h3 class="anchored" data-anchor-id="remove-stop-words">Remove stop words</h3>
<p>One way to overcome selecting less meaningful words would be to use the option <code>'stop_words="english'</code> option. This option checks if the set of selected words contain common words, and ignore them when selecting the most frequent words.</p>
<div id="2ddacd49" class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>vect <span class="op">=</span> CountVectorizer(max_features<span class="op">=</span><span class="dv">10</span>, stop_words<span class="op">=</span><span class="st">"english"</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>vect.fit(X_train[<span class="st">"SUMMARY_EN"</span>])</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>vocab <span class="op">=</span> vect.get_feature_names_out()</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(vocab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<pre><code>10</code></pre>
</div>
</div>
<div id="3575edec" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(vocab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['coded' 'crash' 'critical' 'driver' 'event' 'intersection' 'lane' 'left'
 'roadway' 'vehicle']</code></pre>
</div>
</div>
<div id="b3af8bdf" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>    sentence <span class="op">=</span> X_train[<span class="st">"SUMMARY_EN"</span>].iloc[i]</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>    num_words <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> word <span class="kw">in</span> sentence.split(<span class="st">" "</span>):</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> word <span class="kw">in</span> vocab:</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(word, end<span class="op">=</span><span class="st">" "</span>)</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>            num_words <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> num_words <span class="op">==</span> <span class="dv">10</span>:</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>crash intersection roadway roadway roadway intersection lane lane intersection driver 

crash roadway left roadway roadway roadway lane lane roadway crash 

crash vehicle left left vehicle driver vehicle lane lane coded 
</code></pre>
</div>
</div>
</section>
<section id="keep-1000-most-frequent-words" class="level3">
<h3 class="anchored" data-anchor-id="keep-1000-most-frequent-words">Keep 1,000 most frequent words</h3>
<div id="ff0519f1" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>vect <span class="op">=</span> CountVectorizer(max_features<span class="op">=</span><span class="dv">1_000</span>, stop_words<span class="op">=</span><span class="st">"english"</span>)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>vect.fit(X_train[<span class="st">"SUMMARY_EN"</span>])</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>vocab <span class="op">=</span> vect.get_feature_names_out()</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(vocab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">
<pre><code>1000</code></pre>
</div>
</div>
<div id="b66cf963" class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(vocab[:<span class="dv">5</span>], vocab[<span class="bu">len</span>(vocab)<span class="op">//</span><span class="dv">2</span>:(<span class="bu">len</span>(vocab)<span class="op">//</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">5</span>)], vocab[<span class="op">-</span><span class="dv">5</span>:])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['10' '105' '113' '12' '15'] ['interruption' 'intersected' 'intersecting' 'intersection' 'interstate'] ['year' 'years' 'yellow' 'yield' 'zone']</code></pre>
</div>
</div>
<p>The above output shows, how selecting just 1000 words would still contain less meaningful phrases. Also, we can see how the same word(but slightly differently spelled) are appearing together. This redundancy does not add value either. For example <em>year</em> and <em>years</em>.</p>
<p>Create the <span class="math inline">X</span> matrices:</p>
<div id="f882bae0" class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>X_train_bow <span class="op">=</span> vectorise_dataset(X_train, vect)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>X_val_bow <span class="op">=</span> vectorise_dataset(X_val, vect)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>X_test_bow <span class="op">=</span> vectorise_dataset(X_test, vect)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="what-is-left-1" class="level3">
<h3 class="anchored" data-anchor-id="what-is-left-1">What is left?</h3>
<div id="b4f421fd" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>    sentence <span class="op">=</span> X_train[<span class="st">"SUMMARY_EN"</span>].iloc[i]</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>    num_words <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> word <span class="kw">in</span> sentence.split(<span class="st">" "</span>):</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> word <span class="kw">in</span> vocab:</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(word, end<span class="op">=</span><span class="st">" "</span>)</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>            num_words <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> num_words <span class="op">==</span> <span class="dv">10</span>:</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>crash occurred early afternoon weekday middle suburban intersection consisted lanes 

crash occurred roadway level consists lanes direction center left turn 

crash occurred eastbound direction entrance ramp right curved road uphill 

crash occurred straight roadway consists lanes direction center left turn 

collision occurred evening hours crash occurred level bituminous roadway residential 

vehicle crash occurred daylight location lane undivided left curved downhill 

vehicle crash occurred early morning daylight hours roadway traffic roadway 

crash occurred northbound lanes northbound southbound slightly street curved posted 

crash occurred eastbound lanes access highway weekend roadway consisted lanes 

collision occurred intersection north south traffic controlled stop roadways left 
</code></pre>
</div>
</div>
</section>
<section id="check-the-input-matrix-1" class="level3">
<h3 class="anchored" data-anchor-id="check-the-input-matrix-1">Check the input matrix</h3>
<div id="793d940f" class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>vectorise_dataset(X_train, vect, dataframe<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="71">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">10</th>
<th data-quarto-table-cell-role="th">105</th>
<th data-quarto-table-cell-role="th">113</th>
<th data-quarto-table-cell-role="th">12</th>
<th data-quarto-table-cell-role="th">15</th>
<th data-quarto-table-cell-role="th">150</th>
<th data-quarto-table-cell-role="th">16</th>
<th data-quarto-table-cell-role="th">17</th>
<th data-quarto-table-cell-role="th">18</th>
<th data-quarto-table-cell-role="th">180</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">yield</th>
<th data-quarto-table-cell-role="th">zone</th>
<th data-quarto-table-cell-role="th">WEATHER1</th>
<th data-quarto-table-cell-role="th">WEATHER2</th>
<th data-quarto-table-cell-role="th">WEATHER3</th>
<th data-quarto-table-cell-role="th">WEATHER4</th>
<th data-quarto-table-cell-role="th">WEATHER5</th>
<th data-quarto-table-cell-role="th">WEATHER6</th>
<th data-quarto-table-cell-role="th">WEATHER7</th>
<th data-quarto-table-cell-role="th">WEATHER8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2532</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6209</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2561</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6882</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">206</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6356</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>4169 rows × 1008 columns</p>
</div>
</div>
</div>
</section>
<section id="make-inspect-the-model" class="level3">
<h3 class="anchored" data-anchor-id="make-inspect-the-model">Make &amp; inspect the model</h3>
<div id="4804ceef" class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>num_features <span class="op">=</span> X_train_bow.shape[<span class="dv">1</span>]</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> build_model(num_features, num_cats)</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>model.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Model: "sequential_1"</span>
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> Layer (type)                    </span>┃<span style="font-weight: bold"> Output Shape           </span>┃<span style="font-weight: bold">       Param # </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ dense_2 (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                 │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">100</span>)            │       <span style="color: #00af00; text-decoration-color: #00af00">100,900</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense_3 (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                 │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">3</span>)              │           <span style="color: #00af00; text-decoration-color: #00af00">303</span> │
└─────────────────────────────────┴────────────────────────┴───────────────┘
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Total params: </span><span style="color: #00af00; text-decoration-color: #00af00">101,203</span> (395.32 KB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">101,203</span> (395.32 KB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Non-trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">0</span> (0.00 B)
</pre>
</div>
</div>
<p>From the above summary, we can see how we have brought down the number of parameters to be trained down to 101,203. That is done by reducing the number of covariates, not by reducing the number of neurons.</p>
</section>
<section id="fit-evaluate-the-model-1" class="level3">
<h3 class="anchored" data-anchor-id="fit-evaluate-the-model-1">Fit &amp; evaluate the model</h3>
<div id="ac423482" class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>es <span class="op">=</span> EarlyStopping(patience<span class="op">=</span><span class="dv">1</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>    monitor<span class="op">=</span><span class="st">"val_accuracy"</span>, verbose<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>time hist <span class="op">=</span> model.fit(X_train_bow, y_train, epochs<span class="op">=</span><span class="dv">10</span>, <span class="op">\</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>    callbacks<span class="op">=</span>[es], validation_data<span class="op">=</span>(X_val_bow, y_val), verbose<span class="op">=</span><span class="dv">0</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 3: early stopping
Restoring model weights from the end of the best epoch: 2.
CPU times: user 1.91 s, sys: 325 ms, total: 2.23 s
Wall time: 1.27 s</code></pre>
</div>
</div>
<p>The following results show how despite dropping so many covariates, the trained model is still able to achieve a performance similar to the previous case.</p>
<div id="87263fca" class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>model.evaluate(X_train_bow, y_train, verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="74">
<pre><code>[0.10216847062110901, 0.9815303683280945, 0.9990405440330505]</code></pre>
</div>
</div>
<div id="1b0a0020" class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>model.evaluate(X_val_bow, y_val, verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="75">
<pre><code>[2.4335882663726807, 0.9381294846534729, 0.9942445755004883]</code></pre>
</div>
</div>
</section>
</section>
<section id="intelligently-limit-the-vocabulary" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="intelligently-limit-the-vocabulary">Intelligently Limit The Vocabulary</h2>
<p>While it is helpful to reduce complexity and redundancy in natural language processing using options like <code>max_features</code> and <code>stop_words</code>, they alone are not enough. The following code shows how despite using above commands, we still end up with similar words which do not add value for the processing task. Therefore, looking for ways to intelligently limit vocabulary is useful.</p>
<section id="keep-1000-most-frequent-words-1" class="level3">
<h3 class="anchored" data-anchor-id="keep-1000-most-frequent-words-1">Keep 1,000 most frequent words</h3>
<div id="94fd9ed9" class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>vect <span class="op">=</span> CountVectorizer(max_features<span class="op">=</span><span class="dv">1_000</span>, stop_words<span class="op">=</span><span class="st">"english"</span>)</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>vect.fit(X_train[<span class="st">"SUMMARY_EN"</span>])</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>vocab <span class="op">=</span> vect.get_feature_names_out()</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(vocab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="76">
<pre><code>1000</code></pre>
</div>
</div>
<div id="1a1c9214" class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(vocab[:<span class="dv">5</span>], vocab[<span class="bu">len</span>(vocab)<span class="op">//</span><span class="dv">2</span>:(<span class="bu">len</span>(vocab)<span class="op">//</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">5</span>)], vocab[<span class="op">-</span><span class="dv">5</span>:])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['10' '105' '113' '12' '15'] ['interruption' 'intersected' 'intersecting' 'intersection' 'interstate'] ['year' 'years' 'yellow' 'yield' 'zone']</code></pre>
</div>
</div>
<p>Spacy is a popular open-source library that is used to analyse data and carry out prediction tasks related to natural language processing.</p>
</section>
<section id="install-spacy" class="level3">
<h3 class="anchored" data-anchor-id="install-spacy">Install spacy</h3>
<div id="8199fe7d" class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="annotated-cell-57"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-57" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-57-1" class="code-annotation-target"><a href="#annotated-cell-57-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install spacy</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-57" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-57-2" class="code-annotation-target"><a href="#annotated-cell-57-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>python <span class="op">-</span>m spacy download en_core_web_sm</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-57" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-57" data-code-lines="1" data-code-annotation="1">Installs the library <code>spacy</code></span>
</dd>
<dt data-target-cell="annotated-cell-57" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-57" data-code-lines="2" data-code-annotation="2">Downloads the trained model <code>en_core_web_sm</code> which a small, efficient English language model trained using text data. It can be used for tasks like lemmatization, tokenization etc.</span>
</dd>
</dl>
</div>
</div>
<div id="611da526" class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="annotated-cell-58"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-58" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-58-1" class="code-annotation-target"><a href="#annotated-cell-58-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> spacy</span>
<span id="annotated-cell-58-2"><a href="#annotated-cell-58-2" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-58" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-58-3" class="code-annotation-target"><a href="#annotated-cell-58-3" aria-hidden="true" tabindex="-1"></a>nlp <span class="op">=</span> spacy.load(<span class="st">"en_core_web_sm"</span>)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-58" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-58-4" class="code-annotation-target"><a href="#annotated-cell-58-4" aria-hidden="true" tabindex="-1"></a>doc <span class="op">=</span> nlp(<span class="st">"Apple is looking at buying U.K. startup for $1 billion"</span>)</span>
<span id="annotated-cell-58-5"><a href="#annotated-cell-58-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> token <span class="kw">in</span> doc:</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-58" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-58-6" class="code-annotation-target"><a href="#annotated-cell-58-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(token.text, token.pos_, token.dep_, token.lemma_)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-58" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-58" data-code-lines="1" data-code-annotation="1">Imports the library</span>
</dd>
<dt data-target-cell="annotated-cell-58" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-58" data-code-lines="3" data-code-annotation="2">Loads the model and stores it as <code>nlp</code></span>
</dd>
<dt data-target-cell="annotated-cell-58" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-58" data-code-lines="4" data-code-annotation="3">Applies <code>nlp</code> model to the given string for processing. Processing involves tokenization, part-of-speech application, dependency application etc.</span>
</dd>
<dt data-target-cell="annotated-cell-58" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-58" data-code-lines="6" data-code-annotation="4">Returns information about each token(word) in the line. <code>token.text</code> returns each word in the string, <code>token.pos_</code> returns the part-of-speech; the grammatical category of the word, and <code>token.dep_</code> which provides information about the syntactic relationship of the word to the rest of the words in the string.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Apple PROPN nsubj Apple
is AUX aux be
looking VERB ROOT look
at ADP prep at
buying VERB pcomp buy
U.K. PROPN nsubj U.K.
startup VERB ccomp startup
for ADP prep for
$ SYM quantmod $
1 NUM compound 1
billion NUM pobj billion</code></pre>
</div>
</div>
</section>
<section id="stemming" class="level3">
<h3 class="anchored" data-anchor-id="stemming">Stemming</h3>
<blockquote class="blockquote">
<p>“Stemming refers to the process of removing suffixes and reducing a word to some base form such that all different variants of that word can be represented by the same form (e.g., “car” and “cars” are both reduced to “car”). This is accomplished by applying a fixed set of rules (e.g., if the word ends in “-es,” remove “-es”). More such examples are shown in Figure 2-7. Although such rules may not always end up in a linguistically correct base form, stemming is commonly used in search engines to match user queries to relevant documents and in text classification to reduce the feature space to train machine learning models.”</p>
</blockquote>
<div class="footer">
<p>Source: Vajjala et al.&nbsp;(2020), <em>Practical natural language processing: a comprehensive guide to building real-world NLP systems</em>, O’Reilly Media.</p>
</div>
</section>
<section id="lemmatization" class="level3">
<h3 class="anchored" data-anchor-id="lemmatization">Lemmatization</h3>
<blockquote class="blockquote">
<p>“Lemmatization is the process of mapping all the different forms of a word to its base word, or lemma. While this seems close to the definition of stemming, they are, in fact, different. For example, the adjective “better,” when stemmed, remains the same. However, upon lemmatization, this should become “good,” as shown in Figure 2-7. Lemmatization requires more linguistic knowledge, and modeling and developing efficient lemmatizers remains an open problem in NLP research even now.”</p>
</blockquote>
<div class="footer">
<p>Source: Vajjala et al.&nbsp;(2020), <em>Practical natural language processing: a comprehensive guide to building real-world NLP systems</em>, O’Reilly Media.</p>
</div>
</section>
<section id="stemming-and-lemmatizing" class="level3">
<h3 class="anchored" data-anchor-id="stemming-and-lemmatizing">Stemming and lemmatizing</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pnlp_0207.png" class="img-fluid figure-img"></p>
<figcaption>Examples of stemming and lemmatization</figcaption>
</figure>
</div>
<p>Original: “The striped bats are hanging on their feet for best”</p>
<p>Stemmed: “the stripe bat are hang on their feet for best”</p>
<p>Lemmatized: “the stripe bat be hang on their foot for good”</p>
<div class="footer">
<p>Source: Kushwah (2019) <a href="https://www.quora.com/What-is-difference-between-stemming-and-lemmatization">What is difference between stemming and lemmatization?</a>, Quora.</p>
</div>
</section>
<section id="examples" class="level3">
<h3 class="anchored" data-anchor-id="examples">Examples</h3>
<div class="columns">
<div class="column">
<p><strong>Stemmed</strong></p>
<p>organization -&gt; organ</p>
<p>civilization -&gt; civil</p>
<p>information -&gt; inform</p>
<p>consultant -&gt; consult</p>
</div><div class="column">
<p><strong>Lemmatized</strong></p>
<blockquote class="blockquote">
<p>[‘I’, ‘will’, ‘be’, ‘back’, ‘.’]</p>
</blockquote>
<div class="fragment">
<p>I’ll be back (Terminator)</p>
</div>
<blockquote class="blockquote">
<p>[‘here’, ‘be’, ‘look’, ‘at’, ‘you’, ‘,’, ‘kid’, ‘.’]</p>
</blockquote>
<div class="fragment">
<p>“Here’s looking at you, kid.” (Casablanca)</p>
</div>
</div>
</div>
</section>
<section id="lemmatize-the-text" class="level3">
<h3 class="anchored" data-anchor-id="lemmatize-the-text">Lemmatize the text</h3>
<p>Lemmatization refers to the act of reducing the words in to its base form. For example; reduced form of <em>looking</em> would be <em>look</em>. The following code shows how we can lemmatize the a text, by first processing it with <code>nlp</code>.</p>
<div id="cde6376f" class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="annotated-cell-59"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-59" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-59-1" class="code-annotation-target"><a href="#annotated-cell-59-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> lemmatize(txt):</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-59" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-59-2" class="code-annotation-target"><a href="#annotated-cell-59-2" aria-hidden="true" tabindex="-1"></a>    doc <span class="op">=</span> nlp(txt)</span>
<span id="annotated-cell-59-3"><a href="#annotated-cell-59-3" aria-hidden="true" tabindex="-1"></a>    good_tokens <span class="op">=</span> [token.lemma_.lower() <span class="cf">for</span> token <span class="kw">in</span> doc <span class="op">\</span></span>
<span id="annotated-cell-59-4"><a href="#annotated-cell-59-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> token.like_num <span class="kw">and</span> <span class="op">\</span></span>
<span id="annotated-cell-59-5"><a href="#annotated-cell-59-5" aria-hidden="true" tabindex="-1"></a>           <span class="kw">not</span> token.is_punct <span class="kw">and</span> <span class="op">\</span></span>
<span id="annotated-cell-59-6"><a href="#annotated-cell-59-6" aria-hidden="true" tabindex="-1"></a>           <span class="kw">not</span> token.is_space <span class="kw">and</span> <span class="op">\</span></span>
<span id="annotated-cell-59-7"><a href="#annotated-cell-59-7" aria-hidden="true" tabindex="-1"></a>           <span class="kw">not</span> token.is_currency <span class="kw">and</span> <span class="op">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-59" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-59-8" class="code-annotation-target"><a href="#annotated-cell-59-8" aria-hidden="true" tabindex="-1"></a>           <span class="kw">not</span> token.is_stop]</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-59" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-59-9" class="code-annotation-target"><a href="#annotated-cell-59-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">" "</span>.join(good_tokens)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-59" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-59" data-code-lines="1" data-code-annotation="1">Starts defining the function which taken in a string of text as input</span>
</dd>
<dt data-target-cell="annotated-cell-59" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-59" data-code-lines="2" data-code-annotation="2">Sends the text through <code>nlp</code> model</span>
</dd>
<dt data-target-cell="annotated-cell-59" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-59" data-code-lines="8" data-code-annotation="3">For each token(word) in the document, first it takes the lemma of the token, converts it to lower case and then applies several filters on the lemmatized token to select only the good tokens. The filtering process filters out numbers, punctuation marks, white spaces, currency signs and stop words like <em>the</em> and <em>and</em></span>
</dd>
<dt data-target-cell="annotated-cell-59" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-59" data-code-lines="9" data-code-annotation="4">Joins the good tokens and returns it as a string</span>
</dd>
</dl>
</div>
</div>
<div id="779730f5" class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>test_str <span class="op">=</span> <span class="st">"Incident at 100kph and '10 incidents -13.3%' are incidental?</span><span class="ch">\t</span><span class="st"> $5"</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>lemmatize(test_str)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="81">
<pre><code>'incident 100kph incident incidental'</code></pre>
</div>
</div>
<div id="d41ff84f" class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>test_str <span class="op">=</span> <span class="st">"I interviewed 5-years ago, 150 interviews every year at 10:30 are.."</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>lemmatize(test_str)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="82">
<pre><code>'interview year ago interview year 10:30'</code></pre>
</div>
</div>
<p>The output above shows how stop words, numbers and punctuation marks are removed. We can also see how <em>incident</em> and <em>incidental</em> are treated as separate words.</p>
<p>Lemmatizing data in the above manner, giving each string at a time is quite inefficient. We can use <code>map(lemmatize)</code> function to map the function to the entire column at once.</p>
</section>
<section id="apply-to-the-whole-dataset" class="level3">
<h3 class="anchored" data-anchor-id="apply-to-the-whole-dataset">Apply to the whole dataset</h3>
<div id="6c35fbd4" class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"SUMMARY_EN_LEMMA"</span>] <span class="op">=</span> df[<span class="st">"SUMMARY_EN"</span>].<span class="bu">map</span>(lemmatize)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Lemmatized version of the column is now stored in <code>SUMMARY_EN_LEMM</code>. Next we merge the non-textual columns of the dataset <code>df</code> with the lemmatized column and create the final dataset. This dataset will be split in to <em>train</em>, <em>val</em> and <em>test</em> sets for training the neural network.</p>
<div id="865ed4bd" class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="annotated-cell-63"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-63" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-63-1" class="code-annotation-target"><a href="#annotated-cell-63-1" aria-hidden="true" tabindex="-1"></a>weather_cols <span class="op">=</span> [<span class="ss">f"WEATHER</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">9</span>)]</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-63" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-63-2" class="code-annotation-target"><a href="#annotated-cell-63-2" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> df[[<span class="st">"SUMMARY_EN_LEMMA"</span>] <span class="op">+</span> weather_cols]</span>
<span id="annotated-cell-63-3"><a href="#annotated-cell-63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-63-4"><a href="#annotated-cell-63-4" aria-hidden="true" tabindex="-1"></a>X_main, X_test, y_main, y_test <span class="op">=</span> <span class="op">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-63" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-63-5" class="code-annotation-target"><a href="#annotated-cell-63-5" aria-hidden="true" tabindex="-1"></a>    train_test_split(features, target, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="annotated-cell-63-6"><a href="#annotated-cell-63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-63-7"><a href="#annotated-cell-63-7" aria-hidden="true" tabindex="-1"></a><span class="co"># As 0.25 x 0.8 = 0.2</span></span>
<span id="annotated-cell-63-8"><a href="#annotated-cell-63-8" aria-hidden="true" tabindex="-1"></a>X_train, X_val, y_train, y_val <span class="op">=</span> <span class="op">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-63" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-63-9" class="code-annotation-target"><a href="#annotated-cell-63-9" aria-hidden="true" tabindex="-1"></a>    train_test_split(X_main, y_main, test_size<span class="op">=</span><span class="fl">0.25</span>, random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="annotated-cell-63-10"><a href="#annotated-cell-63-10" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-63" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-63-11" class="code-annotation-target"><a href="#annotated-cell-63-11" aria-hidden="true" tabindex="-1"></a>X_train.shape, X_val.shape, X_test.shape</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-63" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-63" data-code-lines="1" data-code-annotation="1">Defines the names of the columns that will be used for creating the final dataset</span>
</dd>
<dt data-target-cell="annotated-cell-63" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-63" data-code-lines="2" data-code-annotation="2">Selects the relevant input feature columns and stores it in <code>features</code> column</span>
</dd>
<dt data-target-cell="annotated-cell-63" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-63" data-code-lines="5" data-code-annotation="3">Splits the data in to <em>main</em> and <em>test</em> sets</span>
</dd>
<dt data-target-cell="annotated-cell-63" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-63" data-code-lines="9" data-code-annotation="4">Further splits the <em>main</em> set in to <em>train</em> and <em>val</em> sets</span>
</dd>
<dt data-target-cell="annotated-cell-63" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-63" data-code-lines="11" data-code-annotation="5">Returns the dimensions of the datasets</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="84">
<pre><code>((4169, 9), (1390, 9), (1390, 9))</code></pre>
</div>
</div>
</section>
<section id="what-is-left-2" class="level3">
<h3 class="anchored" data-anchor-id="what-is-left-2">What is left?</h3>
<div id="200c091d" class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Original:"</span>, df[<span class="st">"SUMMARY_EN"</span>].iloc[<span class="dv">0</span>][:<span class="dv">250</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Original: V6357885318682, a 2000 Pontiac Montana minivan, made a left turn from a private driveway onto a northbound 5-lane two-way, dry asphalt roadway on a downhill grade.  The posted speed limit on this roadway was 80 kmph (50 MPH). V6357885318682 entered t</code></pre>
</div>
</div>
<div id="10a7f63c" class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Lemmatized:"</span>, df[<span class="st">"SUMMARY_EN_LEMMA"</span>].iloc[<span class="dv">0</span>][:<span class="dv">250</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Lemmatized: v6357885318682 pontiac montana minivan left turn private driveway northbound lane way dry asphalt roadway downhill grade post speed limit roadway kmph mph v6357885318682 enter roadway cross southbound lane enter northbound lane left turn lane way int</code></pre>
</div>
</div>
<div id="e8342ffe" class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Original:"</span>, df[<span class="st">"SUMMARY_EN"</span>].iloc[<span class="dv">1</span>][:<span class="dv">250</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Original: The crash occurred in the eastbound lane of a two-lane, two-way asphalt roadway on level grade.  The conditions were daylight and wet with cloudy skies in the early afternoon on a weekday.  
 
 V342542243, a 1995 Chevrolet Lumina was traveling eastbou</code></pre>
</div>
</div>
<div id="24b97b62" class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Lemmatized:"</span>, df[<span class="st">"SUMMARY_EN_LEMMA"</span>].iloc[<span class="dv">1</span>][:<span class="dv">250</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Lemmatized: crash occur eastbound lane lane way asphalt roadway level grade condition daylight wet cloudy sky early afternoon weekday v342542243 chevrolet lumina travel eastbound v342542269 chevrolet trailblazer travel eastbound roadway v342542269 attempt left h</code></pre>
</div>
</div>
</section>
<section id="keep-1000-most-frequent-lemmas" class="level3">
<h3 class="anchored" data-anchor-id="keep-1000-most-frequent-lemmas">Keep 1,000 most frequent lemmas</h3>
<div id="c3bc2564" class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>vect <span class="op">=</span> CountVectorizer(max_features<span class="op">=</span><span class="dv">1_000</span>, stop_words<span class="op">=</span><span class="st">"english"</span>)</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>vect.fit(X_train[<span class="st">"SUMMARY_EN_LEMMA"</span>])</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>vocab <span class="op">=</span> vect.get_feature_names_out()</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(vocab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="89">
<pre><code>1000</code></pre>
</div>
</div>
<p>The output after lemmatization, when compared with the previous output (with 1000 words) does not contain similar words.</p>
<div id="3e1e0e3c" class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(vocab[:<span class="dv">5</span>], vocab[<span class="bu">len</span>(vocab)<span class="op">//</span><span class="dv">2</span>:(<span class="bu">len</span>(vocab)<span class="op">//</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">5</span>)], vocab[<span class="op">-</span><span class="dv">5</span>:])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['10' '150' '48kmph' '4x4' '56kmph'] ['let' 'level' 'lexus' 'license' 'light'] ['yaw' 'year' 'yellow' 'yield' 'zone']</code></pre>
</div>
</div>
<p>The following code demonstrates the steps for training a neural network using lemmatized datasets:</p>
<ol type="1">
<li>We start by using the vectorise_dataset function to convert the text data into numerical vectors.</li>
<li>Next, we train the neural network model using the vectorized dataset.</li>
<li>Finally, we assess the model’s performance</li>
</ol>
<p>Create the <span class="math inline">X</span> matrices:</p>
<div id="659c5cef" class="cell" data-execution_count="96">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>X_train_bow <span class="op">=</span> vectorise_dataset(X_train, vect, <span class="st">"SUMMARY_EN_LEMMA"</span>)</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>X_val_bow <span class="op">=</span> vectorise_dataset(X_val, vect, <span class="st">"SUMMARY_EN_LEMMA"</span>)</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>X_test_bow <span class="op">=</span> vectorise_dataset(X_test, vect, <span class="st">"SUMMARY_EN_LEMMA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="check-the-input-matrix-2" class="level3">
<h3 class="anchored" data-anchor-id="check-the-input-matrix-2">Check the input matrix</h3>
<div id="c9ba91e0" class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>vectorise_dataset(X_train, vect, <span class="st">"SUMMARY_EN_LEMMA"</span>, dataframe<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="92">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">10</th>
<th data-quarto-table-cell-role="th">150</th>
<th data-quarto-table-cell-role="th">48kmph</th>
<th data-quarto-table-cell-role="th">4x4</th>
<th data-quarto-table-cell-role="th">56kmph</th>
<th data-quarto-table-cell-role="th">64kmph</th>
<th data-quarto-table-cell-role="th">72kmph</th>
<th data-quarto-table-cell-role="th">ability</th>
<th data-quarto-table-cell-role="th">able</th>
<th data-quarto-table-cell-role="th">accelerate</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">yield</th>
<th data-quarto-table-cell-role="th">zone</th>
<th data-quarto-table-cell-role="th">WEATHER1</th>
<th data-quarto-table-cell-role="th">WEATHER2</th>
<th data-quarto-table-cell-role="th">WEATHER3</th>
<th data-quarto-table-cell-role="th">WEATHER4</th>
<th data-quarto-table-cell-role="th">WEATHER5</th>
<th data-quarto-table-cell-role="th">WEATHER6</th>
<th data-quarto-table-cell-role="th">WEATHER7</th>
<th data-quarto-table-cell-role="th">WEATHER8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2532</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6209</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2561</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6882</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">206</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6356</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>4169 rows × 1008 columns</p>
</div>
</div>
</div>
</section>
<section id="make-inspect-the-model-1" class="level3">
<h3 class="anchored" data-anchor-id="make-inspect-the-model-1">Make &amp; inspect the model</h3>
<div id="cdcd24ac" class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>num_features <span class="op">=</span> X_train_bow.shape[<span class="dv">1</span>]</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> build_model(num_features, num_cats)</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>model.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Model: "sequential_2"</span>
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> Layer (type)                    </span>┃<span style="font-weight: bold"> Output Shape           </span>┃<span style="font-weight: bold">       Param # </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ dense_4 (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                 │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">100</span>)            │       <span style="color: #00af00; text-decoration-color: #00af00">100,900</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense_5 (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                 │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">3</span>)              │           <span style="color: #00af00; text-decoration-color: #00af00">303</span> │
└─────────────────────────────────┴────────────────────────┴───────────────┘
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Total params: </span><span style="color: #00af00; text-decoration-color: #00af00">101,203</span> (395.32 KB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">101,203</span> (395.32 KB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Non-trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">0</span> (0.00 B)
</pre>
</div>
</div>
</section>
<section id="fit-evaluate-the-model-2" class="level3">
<h3 class="anchored" data-anchor-id="fit-evaluate-the-model-2">Fit &amp; evaluate the model</h3>
<div id="06a344f9" class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>es <span class="op">=</span> EarlyStopping(patience<span class="op">=</span><span class="dv">1</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>    monitor<span class="op">=</span><span class="st">"val_accuracy"</span>, verbose<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>time hist <span class="op">=</span> model.fit(X_train_bow, y_train, epochs<span class="op">=</span><span class="dv">10</span>, <span class="op">\</span></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>    callbacks<span class="op">=</span>[es], validation_data<span class="op">=</span>(X_val_bow, y_val), verbose<span class="op">=</span><span class="dv">0</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 3: early stopping
Restoring model weights from the end of the best epoch: 2.
CPU times: user 1.74 s, sys: 280 ms, total: 2.02 s
Wall time: 1.18 s</code></pre>
</div>
</div>
<div id="c11f4d70" class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>model.evaluate(X_train_bow, y_train, verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="95">
<pre><code>[0.09055040031671524, 0.9851283431053162, 0.9990405440330505]</code></pre>
</div>
</div>
<div id="4d85c79b" class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>model.evaluate(X_val_bow, y_val, verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="96">
<pre><code>[3.840914726257324, 0.9402877688407898, 0.9928057789802551]</code></pre>
</div>
</div>
</section>
</section>
<section id="word-embeddings" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="word-embeddings">Word Embeddings</h2>
<section id="overview" class="level3">
<h3 class="anchored" data-anchor-id="overview">Overview</h3>
<div class="notes">
<p>In order for deep learning models to process language, we need to supply that language to the model in a way it can digest, i.e.&nbsp;a <strong>quantitative representation</strong> such as a 2-D matrix of numerical values.</p>
</div>
<div class="columns">
<div class="column" style="width:60%;">
<p>Popular methods for converting text into numbers include:</p>
<ul>
<li>One-hot encoding</li>
<li>Bag of words</li>
<li>TF-IDF</li>
<li>Word vectors (<em>transfer learning</em>)</li>
</ul>
</div><div class="column" style="width:40%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="xkcd-assigning_numbers_2x.png" class="img-fluid figure-img"></p>
<figcaption>Assigning Numbers</figcaption>
</figure>
</div>
</div>
</div>
<div class="footer">
<p>Source: Randall Munroe (2022), <a href="https://xkcd.com/2610/">xkcd #2610: Assigning Numbers</a>.</p>
</div>
</section>
<section id="word-vectors" class="level3">
<h3 class="anchored" data-anchor-id="word-vectors">Word Vectors</h3>
<ul>
<li>One-hot representations capture word ‘existence’ only, whereas word vectors capture information about word meaning as well as location.</li>
<li>This enables deep learning NLP models to automatically learn linguistic features.</li>
<li><strong>Word2Vec</strong> &amp; <strong>GloVe</strong> are popular algorithms for generating word embeddings (i.e.&nbsp;word vectors).</li>
</ul>
</section>
<section id="word-vectors-1" class="level3">
<h3 class="anchored" data-anchor-id="word-vectors-1">Word Vectors</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="krohn_f02_06.jpeg" class="img-fluid figure-img"></p>
<figcaption>Illustrative word vectors.</figcaption>
</figure>
</div>
<p>Word vectors are a type of word embedding which can return numerical representations of words in a continuous vector space. There representations capture semantic knowledge of the words. For example, we can see how days are positioned closer to each other in a <em>n</em>-dimensional space.</p>
<div class="notes">
<ul>
<li>Overarching concept is to assign each word within a corpus to a particular, meaningful location within a multidimensional space called the vector space.</li>
<li>Initially each word is assigned to a random location.</li>
<li>BUT by considering the words that tend to be used around a given word within the corpus, the locations of the words shift.</li>
</ul>
</div>
<div class="footer">
<p>Source: Krohn (2019), <em>Deep Learning Illustrated</em>, Figure 2-6.</p>
</div>
</section>
<section id="remember-this-diagram" class="level3">
<h3 class="anchored" data-anchor-id="remember-this-diagram">Remember this diagram?</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="entity-embeddings.png" class="img-fluid figure-img"></p>
<figcaption>Embeddings will gradually improve during training.</figcaption>
</figure>
</div>
<p>Embeddings are numerical representations of categorical data that were learned during the supervised learning process. However, numerical representations like <strong>Word2Vec</strong> &amp; <strong>GloVe</strong> are popular algorithms for generating word embeddings that were trained by others, i.e.&nbsp;they are pretrained.</p>
<div class="footer">
<p>Source: Aurélien Géron (2019), <em>Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</em>, 2nd Edition, Figure 13-4.</p>
</div>
</section>
<section id="word2vec" class="level3">
<h3 class="anchored" data-anchor-id="word2vec">Word2Vec</h3>
<p><strong>Key idea</strong>: You’re known by the company you keep.</p>
<p>Two algorithms are used to calculate embeddings:</p>
<ul>
<li><em>Continuous bag of words</em>: uses the context words to predict the target word</li>
<li><em>Skip-gram</em>: uses the target word to predict the context words</li>
</ul>
<p>Predictions are made using a neural network with one hidden layer. Through backpropagation, we update a set of “weights” which become the word vectors.</p>
<div class="footer">
<p>Paper: Mikolov et al.&nbsp;(2013), <a href="https://arxiv.org/pdf/1301.3781.pdf"><em>Efficient estimation of word representations in vector space</em></a>, arXiv:1301.3781.</p>
</div>
</section>
<section id="word2vec-training-methods" class="level3">
<h3 class="anchored" data-anchor-id="word2vec-training-methods">Word2Vec training methods</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Chaudhary-nlp-ssl-center-word-prediction.gif" class="img-fluid figure-img"></p>
<figcaption>Continuous bag of words is a <em>center word prediction</em> task</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Chaudhary-nlp-ssl-neighbor-word-prediction.gif" class="img-fluid figure-img"></p>
<figcaption>Skip-gram is a <em>neighbour word prediction</em> task</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Suggested viewing
</div>
</div>
<div class="callout-body-container callout-body">
<p>Computerphile (2019), <a href="https://youtu.be/gQddtTdmG_8">Vectoring Words (Word Embeddings)</a>, YouTube (16 mins).</p>
</div>
</div>
<div class="footer">
<p>Source: Amit Chaudhary (2020), <a href="https://amitness.com/2020/05/self-supervised-learning-nlp/">Self Supervised Representation Learning in NLP</a>.</p>
</div>
</section>
<section id="the-skip-gram-network" class="level3">
<h3 class="anchored" data-anchor-id="the-skip-gram-network">The skip-gram network</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lilianweng-word2vec-skip-gram.png" class="img-fluid figure-img"></p>
<figcaption>The skip-gram model. Both the input vector <span class="math inline">\boldsymbol{x}</span> and the output <span class="math inline">\boldsymbol{y}</span> are one-hot encoded word representations. The hidden layer is the word embedding of size <span class="math inline">N</span>.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Lilian Weng (2017), <a href="https://lilianweng.github.io/posts/2017-10-15-word-embedding/">Learning Word Embedding</a>, Blog post, Figure 1.</p>
</div>
</section>
<section id="word-vector-arithmetic" class="level3">
<h3 class="anchored" data-anchor-id="word-vector-arithmetic">Word Vector Arithmetic</h3>
<div class="columns">
<div class="column">
<p>Relationships between words becomes vector math.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="vectors-Figure_03_02_09.jpeg" class="img-fluid figure-img"></p>
<figcaption>You remember vectors, right?</figcaption>
</figure>
</div>
<div class="notes">
<ul>
<li>E.g., if we calculate the direction and distance between the coordinates of the words <em>Paris</em> and <em>France</em>, and trace this direction and distance from <em>London</em>, we should be close to the word <em>England</em>.</li>
</ul>
</div>
</div><div class="column">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="krohn_f02_07.jpeg" class="img-fluid figure-img"></p>
<figcaption>Illustrative word vector arithmetic</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="krohn_f02_08.jpeg" class="img-fluid figure-img"></p>
<figcaption>Screenshot from <a href="https://lamyiowce.github.io/word2viz/">Word2viz</a></figcaption>
</figure>
</div>
</div>
</div>
<div class="footer">
<p>Sources: PressBooks, <a href="https://pressbooks.bccampus.ca/collegephysics/chapter/vector-addition-and-subtraction-graphical-methods/">College Physics: OpenStax</a>, Chapter 17 Figure 9, and Krohn (2019), <em>Deep Learning Illustrated</em>, Figures 2-7 &amp; 2-8.</p>
</div>
</section>
</section>
<section id="word-embeddings-ii" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="word-embeddings-ii">Word Embeddings II</h2>
<section id="pretrained-word-embeddings" class="level3">
<h3 class="anchored" data-anchor-id="pretrained-word-embeddings">Pretrained word embeddings</h3>
<div id="38122e76" class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="annotated-cell-76"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-76" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-76-1" class="code-annotation-target"><a href="#annotated-cell-76-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install gensim</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-76" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-76" data-code-lines="1" data-code-annotation="1">Imports the <code>gensim</code> library. This is a popular library for document analysis</span>
</dd>
</dl>
</div>
</div>
<p>Load word2vec embeddings trained on Google News:</p>
<div id="d4fac49e" class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="annotated-cell-77"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-77" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-77-1" class="code-annotation-target"><a href="#annotated-cell-77-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> gensim.downloader <span class="im">as</span> api</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-77" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-77-2" class="code-annotation-target"><a href="#annotated-cell-77-2" aria-hidden="true" tabindex="-1"></a>wv <span class="op">=</span> api.load(<span class="st">'word2vec-google-news-300'</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-77" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-77" data-code-lines="1" data-code-annotation="1">Imports the <code>gensim.downloader</code> module from the <code>gensim</code> library and stores is as <code>api</code>. This module contains pretrained models including <strong>Word2Vec</strong> and <strong>GloVe</strong> that can be used for NLP tasks</span>
</dd>
<dt data-target-cell="annotated-cell-77" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-77" data-code-lines="2" data-code-annotation="2">Loads the <strong>Word2Vec</strong> from the <code>word2vec-google-news-300</code> dataset and stores is as <code>wv</code></span>
</dd>
</dl>
</div>
</div>
<p>When run for the first time, that downloads a huge file:</p>
<div id="a0ec2238" class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>gensim_dir <span class="op">=</span> Path(<span class="st">"~/gensim-data/"</span>).expanduser()</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>[<span class="bu">str</span>(p) <span class="cf">for</span> p <span class="kw">in</span> gensim_dir.iterdir()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="99">
<pre><code>['/home/plaub/gensim-data/information.json',
 '/home/plaub/gensim-data/word2vec-google-news-300']</code></pre>
</div>
</div>
<div id="b03fafe5" class="cell" data-execution_count="105">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="bu">next</span>(gensim_dir.glob(<span class="st">"*/*.gz"</span>)).stat().st_size <span class="op">/</span> <span class="dv">1024</span><span class="op">**</span><span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="100">
<pre><code>1.6238203644752502</code></pre>
</div>
</div>
<div id="82c573bc" class="cell" data-execution_count="106">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="ss">f"The size of the vocabulary is </span><span class="sc">{</span><span class="bu">len</span>(wv)<span class="sc">}</span><span class="ss">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="101">
<pre><code>'The size of the vocabulary is 3000000'</code></pre>
</div>
</div>
</section>
<section id="treat-wv-like-a-dictionary" class="level3">
<h3 class="anchored" data-anchor-id="treat-wv-like-a-dictionary">Treat <code>wv</code> like a dictionary</h3>
<div id="f2fcf490" class="cell" data-execution_count="107">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>wv[<span class="st">"pizza"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="102">
<pre><code>array([-1.26e-01,  2.54e-02,  1.67e-01,  5.51e-01, -7.67e-02,  1.29e-01,
        1.03e-01, -3.95e-04,  1.22e-01,  4.32e-02,  1.73e-01, -6.84e-02,
        3.42e-01,  8.40e-02,  6.69e-02,  2.68e-01, -3.71e-02, -5.57e-02,
        1.81e-01,  1.90e-02, -5.08e-02,  9.03e-03,  1.77e-01,  6.49e-02,
       -6.25e-02, -9.42e-02, -9.72e-02,  4.00e-01,  1.15e-01,  1.03e-01,
       -1.87e-02, -2.70e-01,  1.81e-01,  1.25e-01, -3.17e-02, -5.49e-02,
        3.46e-01, -1.57e-02,  1.82e-05,  2.07e-01, -1.26e-01, -2.83e-01,
        2.00e-01,  8.35e-02, -4.74e-02, -3.11e-02, -2.62e-01,  1.70e-01,
       -2.03e-02,  1.53e-01, -1.21e-01,  3.75e-01, -5.69e-02, -4.76e-03,
       -1.95e-01, -2.03e-01,  3.01e-01, -1.01e-01, -3.18e-01, -9.03e-02,
       -1.19e-01,  1.95e-01, -8.79e-02,  1.58e-01,  1.52e-02, -1.60e-01,
       -3.30e-01, -4.67e-01,  1.69e-01,  2.23e-02,  1.55e-01,  1.08e-01,
       -3.56e-02,  9.13e-02, -8.69e-02, -1.20e-01, -3.09e-01, -2.61e-02,
       -7.23e-02, -4.80e-01,  3.78e-02, -1.36e-01, -1.03e-01, -2.91e-01,
       -1.93e-01, -4.22e-01, -1.06e-01,  3.55e-01,  1.67e-01, -3.63e-03,
       -7.42e-02, -3.22e-01, -7.52e-02, -8.25e-02, -2.91e-01, -1.26e-01,
        1.68e-02,  5.00e-02,  1.28e-01, -7.42e-02, -1.31e-01, -2.46e-01,
        6.49e-02,  1.53e-01,  2.60e-01, -1.05e-01,  3.57e-01, -4.30e-02,
       -1.58e-01,  8.20e-02, -5.98e-02, -2.34e-01, -3.22e-01, -1.26e-01,
        5.40e-02, -1.88e-01,  1.36e-01, -6.59e-02,  8.36e-03, -1.85e-01,
       -2.97e-01, -1.85e-01, -4.74e-02, -1.06e-01, -6.93e-02,  3.83e-02,
       -3.20e-02,  3.64e-02, -1.20e-01,  1.77e-01, -1.16e-01,  1.99e-02,
        8.64e-02,  6.08e-02, -1.41e-01,  3.30e-01,  1.94e-01, -1.56e-01,
        3.93e-01,  1.81e-03,  7.28e-02, -2.54e-01, -3.54e-02,  2.87e-03,
       -1.73e-01,  9.77e-03, -1.56e-02,  3.23e-03, -1.70e-01,  1.55e-01,
        7.18e-02,  4.10e-01, -2.11e-01,  1.32e-01,  7.63e-03,  4.79e-02,
       -4.54e-02,  7.32e-02, -4.06e-01, -2.06e-02, -4.04e-01, -1.01e-01,
       -2.03e-01,  1.55e-01, -1.89e-01,  6.59e-02,  6.54e-02, -2.05e-01,
        5.47e-02, -3.06e-02, -1.54e-01, -2.62e-01,  3.81e-03, -8.20e-02,
       -3.20e-01,  2.84e-02,  2.70e-01,  1.74e-01, -1.67e-01,  2.23e-01,
        6.35e-02, -1.96e-01,  1.46e-01, -1.56e-02,  2.60e-02, -6.30e-02,
        2.94e-02,  3.28e-01, -4.69e-02, -1.52e-01,  6.98e-02,  3.18e-01,
       -1.08e-01,  3.66e-02, -1.99e-01,  1.64e-03,  6.41e-03, -1.47e-01,
       -6.25e-02, -4.36e-03, -2.75e-01,  8.54e-02, -5.00e-02, -3.12e-01,
       -1.34e-01, -1.99e-01,  5.18e-02, -9.28e-02, -2.40e-01, -7.86e-02,
       -1.54e-01, -6.64e-02, -1.97e-01,  1.77e-01, -1.57e-01, -1.63e-01,
        6.01e-02, -5.86e-02, -2.23e-01, -6.59e-02, -9.38e-02, -4.14e-01,
        2.56e-01, -1.77e-01,  2.52e-01,  1.48e-01, -1.04e-01, -8.61e-03,
       -1.23e-01, -9.23e-02,  4.42e-02, -1.71e-01, -1.98e-01,  1.92e-01,
        2.85e-01, -4.35e-02,  1.08e-01, -5.37e-02, -2.10e-02,  1.46e-01,
        3.83e-01,  2.32e-02, -8.84e-02,  7.32e-02, -1.01e-01, -1.06e-01,
        4.12e-01,  2.11e-01,  2.79e-01, -2.09e-02,  2.07e-01,  9.81e-02,
        2.39e-01,  7.67e-02,  2.02e-01, -6.08e-02, -2.64e-03, -1.84e-01,
       -1.57e-02, -3.20e-01,  9.03e-02,  1.02e-01, -4.96e-01, -9.72e-02,
       -8.11e-02, -1.81e-01, -1.46e-01,  8.64e-02, -2.04e-01, -2.02e-01,
       -5.47e-02,  2.54e-01,  2.09e-02, -1.16e-01,  2.02e-01, -8.06e-02,
       -1.05e-01, -7.96e-02,  1.97e-02, -2.49e-01,  1.31e-01,  2.89e-01,
       -2.26e-01,  4.55e-01, -2.73e-01, -2.58e-01, -3.15e-02,  4.04e-01,
       -2.68e-01,  2.89e-01, -1.84e-01, -1.48e-01, -1.07e-01,  1.28e-01,
        5.47e-01, -8.69e-02, -1.48e-02,  6.98e-02, -8.50e-02, -1.55e-01],
      dtype=float32)</code></pre>
</div>
</div>
<div id="8f7f80ed" class="cell" data-execution_count="108">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(wv[<span class="st">"pizza"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="103">
<pre><code>300</code></pre>
</div>
</div>
</section>
<section id="find-nearby-word-vectors" class="level3">
<h3 class="anchored" data-anchor-id="find-nearby-word-vectors">Find nearby word vectors</h3>
<p>With <code>wv</code>, we can find words similar for a given word, or compute the similarity between two words.</p>
<div id="57dd2ef3" class="cell" data-execution_count="109">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>wv.most_similar(<span class="st">"Python"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="104">
<pre><code>[('Jython', 0.6152505874633789),
 ('Perl_Python', 0.5710949897766113),
 ('IronPython', 0.5704679489135742),
 ('scripting_languages', 0.5695090889930725),
 ('PHP_Perl', 0.5687724947929382),
 ('Java_Python', 0.5681070685386658),
 ('PHP', 0.5660915970802307),
 ('Python_Ruby', 0.5632461905479431),
 ('Visual_Basic', 0.5603480339050293),
 ('Perl', 0.5530891418457031)]</code></pre>
</div>
</div>
<div id="fa419ac4" class="cell" data-execution_count="110">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>wv.similarity(<span class="st">"Python"</span>, <span class="st">"Java"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="105">
<pre><code>0.46189708</code></pre>
</div>
</div>
<div id="854c0015" class="cell" data-execution_count="111">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>wv.similarity(<span class="st">"Python"</span>, <span class="st">"sport"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="106">
<pre><code>0.08406468</code></pre>
</div>
</div>
<div id="da063183" class="cell" data-execution_count="112">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>wv.similarity(<span class="st">"Python"</span>, <span class="st">"R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="107">
<pre><code>0.066954285</code></pre>
</div>
</div>
<div class="footer">
<p>Fun fact: Gensim’s <code>most_similar</code> uses Spotify’s <code>annoy</code> library (“Approximate Nearest Neighbors Oh Yeah”)</p>
</div>
</section>
<section id="what-does-similarity-mean" class="level3">
<h3 class="anchored" data-anchor-id="what-does-similarity-mean">What does ‘similarity’ mean?</h3>
<p>The ‘similarity’ scores</p>
<div id="2b0f6313" class="cell" data-execution_count="113">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>wv.similarity(<span class="st">"Sydney"</span>, <span class="st">"Melbourne"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="108">
<pre><code>0.8613987</code></pre>
</div>
</div>
<p>are normally based on cosine distance.</p>
<div id="daba0372" class="cell" data-execution_count="114">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> wv[<span class="st">"Sydney"</span>]</span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> wv[<span class="st">"Melbourne"</span>]</span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>x.dot(y) <span class="op">/</span> (np.linalg.norm(x) <span class="op">*</span> np.linalg.norm(y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="109">
<pre><code>0.86139864</code></pre>
</div>
</div>
<div id="55deafe4" class="cell" data-execution_count="115">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>wv.similarity(<span class="st">"Sydney"</span>, <span class="st">"Aarhus"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="110">
<pre><code>0.19079602</code></pre>
</div>
</div>
</section>
<section id="wengs-got-word2vec" class="level3">
<h3 class="anchored" data-anchor-id="wengs-got-word2vec">Weng’s GoT Word2Vec</h3>
<p>In the GoT word embedding space, the top similar words to “king” and “queen” are:</p>
<div class="columns">
<div class="column">
<div class="sourceCode" id="cb173"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>model.most_similar(<span class="st">"king"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>('kings', 0.897245) 
('baratheon', 0.809675) 
('son', 0.763614)
('robert', 0.708522)
('lords', 0.698684)
('joffrey', 0.696455)
('prince', 0.695699)
('brother', 0.685239)
('aerys', 0.684527)
('stannis', 0.682932)</code></pre>
</div><div class="column">
<div class="sourceCode" id="cb175"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>model.most_similar(<span class="st">"queen"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>('cersei', 0.942618)
('joffrey', 0.933756)
('margaery', 0.931099)
('sister', 0.928902)
('prince', 0.927364)
('uncle', 0.922507)
('varys', 0.918421)
('ned', 0.917492)
('melisandre', 0.915403)
('robb', 0.915272)</code></pre>
</div>
</div>
<div class="footer">
<p>Source: Lilian Weng (2017), <a href="https://lilianweng.github.io/posts/2017-10-15-word-embedding/">Learning Word Embedding</a>, Blog post.</p>
</div>
</section>
<section id="combining-word-vectors" class="level3">
<h3 class="anchored" data-anchor-id="combining-word-vectors">Combining word vectors</h3>
<p>You can summarise a sentence by averaging the individual word vectors.</p>
<div id="45ae7f3f" class="cell" data-execution_count="116">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>sv <span class="op">=</span> (wv[<span class="st">"Melbourne"</span>] <span class="op">+</span> wv[<span class="st">"has"</span>] <span class="op">+</span> wv[<span class="st">"better"</span>] <span class="op">+</span> wv[<span class="st">"coffee"</span>]) <span class="op">/</span> <span class="dv">4</span></span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(sv), sv[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="111">
<pre><code>(300, array([-0.08, -0.11, -0.16,  0.24,  0.06], dtype=float32))</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>As it turns out, averaging word embeddings is a surprisingly effective way to create word embeddings. It’s not perfect (as you’ll see), but it does a strong job of capturing what you might perceive to be complex relationships between words.</p>
</blockquote>
<div class="footer">
<p>Source: Trask (2019), Grokking Deep Learning, Chapter 12.</p>
</div>
</section>
<section id="recipe-recommender" class="level3">
<h3 class="anchored" data-anchor-id="recipe-recommender">Recipe recommender</h3>
<div class="columns">
<div class="column" style="width:49%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="duarte-o-carmo-recipe-space-1.png" class="img-fluid figure-img"></p>
<figcaption>Recipes are the average of the word vectors of the ingredients.</figcaption>
</figure>
</div>
</div><div class="column" style="width:51%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="duarte-o-carmo-recipe-space-2.png" class="img-fluid figure-img"></p>
<figcaption>Nearest neighbours used to classify new recipes as potentially delicious.</figcaption>
</figure>
</div>
</div>
</div>
<div class="footer">
<p>Source: Duarte O.Carmo (2022), <a href="https://duarteocarmo.com/blog/scandinavia-food-python-recommendation-systems">A recipe recommendation system</a>, Blog post.</p>
</div>
</section>
<section id="analogies-with-word-vectors" class="level3">
<h3 class="anchored" data-anchor-id="analogies-with-word-vectors">Analogies with word vectors</h3>
<p>Obama is to America as ___ is to Australia.</p>
<div class="fragment">
<p><span class="math display"> \text{Obama} - \text{America} + \text{Australia} = ? </span></p>
</div>
<div class="fragment">
<div id="67a43ad6" class="cell" data-execution_count="117">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>wv.most_similar(positive<span class="op">=</span>[<span class="st">"Obama"</span>, <span class="st">"Australia"</span>], negative<span class="op">=</span>[<span class="st">"America"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="112">
<pre><code>[('Mr_Rudd', 0.6151423454284668),
 ('Prime_Minister_Julia_Gillard', 0.6045385003089905),
 ('Prime_Minister_Kevin_Rudd', 0.5982581973075867),
 ('Kevin_Rudd', 0.5627648830413818),
 ('Ms_Gillard', 0.5517690777778625),
 ('Opposition_Leader_Kevin_Rudd', 0.5298037528991699),
 ('Mr_Beazley', 0.5259249210357666),
 ('Gillard', 0.5250653624534607),
 ('NARDA_GILMORE', 0.5203536748886108),
 ('Mr_Downer', 0.5150347948074341)]</code></pre>
</div>
</div>
</div>
</section>
<section id="testing-more-associations" class="level3">
<h3 class="anchored" data-anchor-id="testing-more-associations">Testing more associations</h3>
<div id="775dd4f3" class="cell" data-execution_count="118">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>wv.most_similar(positive<span class="op">=</span>[<span class="st">"France"</span>, <span class="st">"London"</span>], negative<span class="op">=</span>[<span class="st">"Paris"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="113">
<pre><code>[('Britain', 0.7368935346603394),
 ('UK', 0.6637030839920044),
 ('England', 0.6119861602783203),
 ('United_Kingdom', 0.6067784428596497),
 ('Great_Britain', 0.5870823860168457),
 ('Britian', 0.5852951407432556),
 ('Scotland', 0.5410018563270569),
 ('British', 0.5318332314491272),
 ('Europe', 0.5307435989379883),
 ('East_Midlands', 0.5230222344398499)]</code></pre>
</div>
</div>
</section>
<section id="quickly-get-to-bad-associations" class="level3">
<h3 class="anchored" data-anchor-id="quickly-get-to-bad-associations">Quickly get to bad associations</h3>
<div id="db061119" class="cell" data-execution_count="119">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>wv.most_similar(positive<span class="op">=</span>[<span class="st">"King"</span>, <span class="st">"woman"</span>], negative<span class="op">=</span>[<span class="st">"man"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="114">
<pre><code>[('Queen', 0.5515626668930054),
 ('Oprah_BFF_Gayle', 0.47597548365592957),
 ('Geoffrey_Rush_Exit', 0.46460166573524475),
 ('Princess', 0.4533674716949463),
 ('Yvonne_Stickney', 0.4507041573524475),
 ('L._Bonauto', 0.4422135353088379),
 ('gal_pal_Gayle', 0.4408389925956726),
 ('Alveda_C.', 0.4402790665626526),
 ('Tupou_V.', 0.4373864233493805),
 ('K._Letourneau', 0.4351031482219696)]</code></pre>
</div>
</div>
<div id="3e85eb77" class="cell" data-execution_count="120">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>wv.most_similar(positive<span class="op">=</span>[<span class="st">"computer_programmer"</span>, <span class="st">"woman"</span>], negative<span class="op">=</span>[<span class="st">"man"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="115">
<pre><code>[('homemaker', 0.5627118945121765),
 ('housewife', 0.5105047225952148),
 ('graphic_designer', 0.505180299282074),
 ('schoolteacher', 0.497949481010437),
 ('businesswoman', 0.493489146232605),
 ('paralegal', 0.49255111813545227),
 ('registered_nurse', 0.4907974898815155),
 ('saleswoman', 0.4881627559661865),
 ('electrical_engineer', 0.4797725975513458),
 ('mechanical_engineer', 0.4755399227142334)]</code></pre>
</div>
</div>
</section>
<section id="bias-in-nlp-models" class="level3 smaller">
<h3 class="smaller anchored" data-anchor-id="bias-in-nlp-models">Bias in NLP models</h3>
<div class="columns">
<div class="column">
<p><img src="the-verge-banner-microsoft-tay.jpeg" class="img-fluid"></p>
<p>The Verge (2016), <a href="https://www.theverge.com/2016/3/24/11297050/tay-microsoft-chatbot-racist">Twitter taught Microsoft’s AI chatbot to be a racist a****** in less than a day</a>.</p>
</div><div class="column">
<blockquote class="blockquote">
<p>… there are serious questions to answer, like how are we going to teach AI using public data without incorporating the worst traits of humanity? If we create bots that mirror their users, do we care if their users are human trash? There are plenty of examples of technology embodying — either accidentally or on purpose — the prejudices of society, and Tay’s adventures on Twitter show that even big corporations like Microsoft forget to take any preventative measures against these problems.</p>
</blockquote>
</div>
</div>
</section>
<section id="the-library-cheats-a-little-bit" class="level3">
<h3 class="anchored" data-anchor-id="the-library-cheats-a-little-bit">The library cheats a little bit</h3>
<div id="45a3b2d1" class="cell" data-execution_count="121">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>wv.similar_by_vector(wv[<span class="st">"computer_programmer"</span>] <span class="op">-</span> wv[<span class="st">"man"</span>] <span class="op">+</span> wv[<span class="st">"woman"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="116">
<pre><code>[('computer_programmer', 0.910581111907959),
 ('homemaker', 0.5771316289901733),
 ('schoolteacher', 0.5500192046165466),
 ('graphic_designer', 0.5464698672294617),
 ('mechanical_engineer', 0.539836585521698),
 ('electrical_engineer', 0.5337055325508118),
 ('housewife', 0.5274525284767151),
 ('programmer', 0.5096209049224854),
 ('businesswoman', 0.5029540657997131),
 ('keypunch_operator', 0.4974639415740967)]</code></pre>
</div>
</div>
<p>To get the ‘nice’ analogies, the <code>.most_similar</code> ignores the input words as possible answers.</p>
<div id="cafbbe0c" class="cell" data-execution_count="122">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ignore (don't return) keys from the input</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> [</span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>    (<span class="va">self</span>.index_to_key[sim <span class="op">+</span> clip_start], <span class="bu">float</span>(dists[sim]))</span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> sim <span class="kw">in</span> best <span class="cf">if</span> (sim <span class="op">+</span> clip_start) <span class="kw">not</span> <span class="kw">in</span> all_keys</span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">
<p>Source: gensim, <a href="https://github.com/RaRe-Technologies/gensim/blob/eeb7e8662d5350efe68fa14db08b02d273735af9/gensim/models/keyedvectors.py#L853">gensim/models/keyedvectors.py</a>, lines 853-857.</p>
</div>
</section>
</section>
<section id="car-crash-nlp-part-ii" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="car-crash-nlp-part-ii">Car Crash NLP Part II</h2>
<div class="footer">
<p>Dataset source: <a href="https://github.com/JSchelldorfer/ActuarialDataScience/blob/master/12%20-%20NLP%20Using%20Transformers/Actuarial_Applications_of_NLP_Part_1.ipynb">Dr Jürg Schelldorfer’s GitHub</a>.</p>
</div>
<section id="predict-injury-severity" class="level3">
<h3 class="anchored" data-anchor-id="predict-injury-severity">Predict injury severity</h3>
<div id="3f285de7" class="cell" data-execution_count="123">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> df[<span class="st">"SUMMARY_EN"</span>]</span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> LabelEncoder().fit_transform(df[<span class="st">"INJSEVB"</span>])</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a>X_main, X_test, y_main, y_test <span class="op">=</span> <span class="op">\</span></span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a>    train_test_split(features, target, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a>X_train, X_val, y_train, y_val <span class="op">=</span> <span class="op">\</span></span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a>    train_test_split(X_main, y_main, test_size<span class="op">=</span><span class="fl">0.25</span>, random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb190-8"><a href="#cb190-8" aria-hidden="true" tabindex="-1"></a>X_train.shape, X_val.shape, X_test.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="117">
<pre><code>((4169,), (1390,), (1390,))</code></pre>
</div>
</div>
</section>
<section id="using-keras-textvectorization" class="level3">
<h3 class="anchored" data-anchor-id="using-keras-textvectorization">Using Keras <code>TextVectorization</code></h3>
<div id="70395276" class="cell" data-execution_count="124">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>max_tokens <span class="op">=</span> <span class="dv">1_000</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>vect <span class="op">=</span> layers.TextVectorization(</span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>    max_tokens<span class="op">=</span>max_tokens,</span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>    output_mode<span class="op">=</span><span class="st">"tf_idf"</span>,</span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a>    standardize<span class="op">=</span><span class="st">"lower_and_strip_punctuation"</span>,</span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a>vect.adapt(X_train)</span>
<span id="cb192-9"><a href="#cb192-9" aria-hidden="true" tabindex="-1"></a>vocab <span class="op">=</span> vect.get_vocabulary()</span>
<span id="cb192-10"><a href="#cb192-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-11"><a href="#cb192-11" aria-hidden="true" tabindex="-1"></a>X_train_txt <span class="op">=</span> vect(X_train)</span>
<span id="cb192-12"><a href="#cb192-12" aria-hidden="true" tabindex="-1"></a>X_val_txt <span class="op">=</span> vect(X_val)</span>
<span id="cb192-13"><a href="#cb192-13" aria-hidden="true" tabindex="-1"></a>X_test_txt <span class="op">=</span> vect(X_test)</span>
<span id="cb192-14"><a href="#cb192-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-15"><a href="#cb192-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(vocab[:<span class="dv">50</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['[UNK]', 'the', 'was', 'a', 'to', 'of', 'and', 'in', 'driver', 'for', 'this', 'vehicle', 'critical', 'lane', 'he', 'on', 'with', 'that', 'left', 'roadway', 'coded', 'she', 'event', 'crash', 'not', 'at', 'intersection', 'traveling', 'right', 'precrash', 'as', 'from', 'were', 'by', 'had', 'reason', 'his', 'side', 'is', 'front', 'her', 'traffic', 'an', 'it', 'two', 'speed', 'stated', 'one', 'occurred', 'no']</code></pre>
</div>
</div>
</section>
<section id="the-tf-idf-vectors" class="level3">
<h3 class="anchored" data-anchor-id="the-tf-idf-vectors">The TF-IDF vectors</h3>
<div id="784a51ae" class="cell" data-execution_count="125">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(X_train_txt, columns<span class="op">=</span>vocab, index<span class="op">=</span>X_train.index)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="119">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">[UNK]</th>
<th data-quarto-table-cell-role="th">the</th>
<th data-quarto-table-cell-role="th">was</th>
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">to</th>
<th data-quarto-table-cell-role="th">of</th>
<th data-quarto-table-cell-role="th">and</th>
<th data-quarto-table-cell-role="th">in</th>
<th data-quarto-table-cell-role="th">driver</th>
<th data-quarto-table-cell-role="th">for</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">encroaching</th>
<th data-quarto-table-cell-role="th">closely</th>
<th data-quarto-table-cell-role="th">ordinarily</th>
<th data-quarto-table-cell-role="th">locked</th>
<th data-quarto-table-cell-role="th">history</th>
<th data-quarto-table-cell-role="th">fourleg</th>
<th data-quarto-table-cell-role="th">determined</th>
<th data-quarto-table-cell-role="th">box</th>
<th data-quarto-table-cell-role="th">altima</th>
<th data-quarto-table-cell-role="th">above</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2532</td>
<td>121.857979</td>
<td>42.274662</td>
<td>10.395409</td>
<td>10.395409</td>
<td>11.785541</td>
<td>8.323526</td>
<td>8.323526</td>
<td>9.775118</td>
<td>3.489896</td>
<td>4.168983</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.00000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6209</td>
<td>72.596237</td>
<td>17.325682</td>
<td>10.395409</td>
<td>5.544218</td>
<td>4.159603</td>
<td>5.549018</td>
<td>7.629900</td>
<td>4.887559</td>
<td>4.187876</td>
<td>6.253474</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.00000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2561</td>
<td>124.450699</td>
<td>30.493198</td>
<td>15.246599</td>
<td>11.088436</td>
<td>9.012472</td>
<td>7.629900</td>
<td>8.323526</td>
<td>2.792891</td>
<td>3.489896</td>
<td>5.558644</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.00000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6882</td>
<td>75.188965</td>
<td>20.790817</td>
<td>4.851191</td>
<td>7.623300</td>
<td>9.012472</td>
<td>4.855391</td>
<td>4.161763</td>
<td>2.094668</td>
<td>5.583834</td>
<td>2.084491</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>3.61771</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">206</td>
<td>147.785202</td>
<td>27.028063</td>
<td>13.167518</td>
<td>6.237246</td>
<td>8.319205</td>
<td>4.855391</td>
<td>6.242645</td>
<td>2.094668</td>
<td>3.489896</td>
<td>9.032796</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.00000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6356</td>
<td>75.188965</td>
<td>15.246599</td>
<td>9.702381</td>
<td>8.316327</td>
<td>7.625938</td>
<td>5.549018</td>
<td>7.629900</td>
<td>8.378673</td>
<td>2.791917</td>
<td>5.558644</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.00000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>4169 rows × 1000 columns</p>
</div>
</div>
</div>
</section>
<section id="feed-tf-idf-into-an-ann" class="level3">
<h3 class="anchored" data-anchor-id="feed-tf-idf-into-an-ann">Feed TF-IDF into an ANN</h3>
<div id="7db5a68c" class="cell" data-execution_count="126">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">42</span>)</span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>tfidf_model <span class="op">=</span> keras.models.Sequential([</span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>    layers.Input((X_train_txt.shape[<span class="dv">1</span>],)),</span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a>    layers.Dense(<span class="dv">250</span>, <span class="st">"relu"</span>),</span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a>    layers.Dense(<span class="dv">1</span>, <span class="st">"sigmoid"</span>)</span>
<span id="cb195-6"><a href="#cb195-6" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb195-7"><a href="#cb195-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-8"><a href="#cb195-8" aria-hidden="true" tabindex="-1"></a>tfidf_model.compile(<span class="st">"adam"</span>, <span class="st">"binary_crossentropy"</span>, metrics<span class="op">=</span>[<span class="st">"accuracy"</span>])</span>
<span id="cb195-9"><a href="#cb195-9" aria-hidden="true" tabindex="-1"></a>tfidf_model.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Model: "sequential_3"</span>
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> Layer (type)                    </span>┃<span style="font-weight: bold"> Output Shape           </span>┃<span style="font-weight: bold">       Param # </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ dense_6 (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                 │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">250</span>)            │       <span style="color: #00af00; text-decoration-color: #00af00">250,250</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense_7 (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                 │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">1</span>)              │           <span style="color: #00af00; text-decoration-color: #00af00">251</span> │
└─────────────────────────────────┴────────────────────────┴───────────────┘
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Total params: </span><span style="color: #00af00; text-decoration-color: #00af00">250,501</span> (978.52 KB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">250,501</span> (978.52 KB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Non-trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">0</span> (0.00 B)
</pre>
</div>
</div>
</section>
<section id="fit-evaluate" class="level3">
<h3 class="anchored" data-anchor-id="fit-evaluate">Fit &amp; evaluate</h3>
<div id="ed856fe1" class="cell" data-execution_count="127">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>es <span class="op">=</span> keras.callbacks.EarlyStopping(patience<span class="op">=</span><span class="dv">10</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>    monitor<span class="op">=</span><span class="st">"val_accuracy"</span>, verbose<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> Path(<span class="st">"tfidf-model.keras"</span>).exists():</span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a>    tfidf_model.fit(X_train_txt, y_train, epochs<span class="op">=</span><span class="dv">1_000</span>, callbacks<span class="op">=</span>es,</span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a>        validation_data<span class="op">=</span>(X_val_txt, y_val), verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a>    tfidf_model.save(<span class="st">"tfidf-model.keras"</span>)</span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a>    tfidf_model <span class="op">=</span> keras.models.load_model(<span class="st">"tfidf-model.keras"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="b58b6a63" class="cell" data-execution_count="128">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>tfidf_model.evaluate(X_train_txt, y_train, verbose<span class="op">=</span><span class="dv">0</span>, batch_size<span class="op">=</span><span class="dv">1_000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="122">
<pre><code>[0.11705566942691803, 0.9575437903404236]</code></pre>
</div>
</div>
<div id="2deccb1b" class="cell" data-execution_count="129">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>tfidf_model.evaluate(X_val_txt, y_val, verbose<span class="op">=</span><span class="dv">0</span>, batch_size<span class="op">=</span><span class="dv">1_000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="123">
<pre><code>[0.3212660849094391, 0.8848921060562134]</code></pre>
</div>
</div>
</section>
<section id="keep-text-as-sequence-of-tokens" class="level3">
<h3 class="anchored" data-anchor-id="keep-text-as-sequence-of-tokens">Keep text as sequence of tokens</h3>
<div id="9ae296ca" class="cell" data-execution_count="130">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>max_length <span class="op">=</span> <span class="dv">500</span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>max_tokens <span class="op">=</span> <span class="dv">1_000</span></span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>vect <span class="op">=</span> layers.TextVectorization(</span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>    max_tokens<span class="op">=</span>max_tokens,</span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a>    output_sequence_length<span class="op">=</span>max_length,</span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a>    standardize<span class="op">=</span><span class="st">"lower_and_strip_punctuation"</span>,</span>
<span id="cb201-7"><a href="#cb201-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb201-8"><a href="#cb201-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-9"><a href="#cb201-9" aria-hidden="true" tabindex="-1"></a>vect.adapt(X_train)</span>
<span id="cb201-10"><a href="#cb201-10" aria-hidden="true" tabindex="-1"></a>vocab <span class="op">=</span> vect.get_vocabulary()</span>
<span id="cb201-11"><a href="#cb201-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-12"><a href="#cb201-12" aria-hidden="true" tabindex="-1"></a>X_train_txt <span class="op">=</span> vect(X_train)</span>
<span id="cb201-13"><a href="#cb201-13" aria-hidden="true" tabindex="-1"></a>X_val_txt <span class="op">=</span> vect(X_val)</span>
<span id="cb201-14"><a href="#cb201-14" aria-hidden="true" tabindex="-1"></a>X_test_txt <span class="op">=</span> vect(X_test)</span>
<span id="cb201-15"><a href="#cb201-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-16"><a href="#cb201-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(vocab[:<span class="dv">50</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['', '[UNK]', 'the', 'was', 'a', 'to', 'of', 'and', 'in', 'driver', 'for', 'this', 'vehicle', 'critical', 'lane', 'he', 'on', 'with', 'that', 'left', 'roadway', 'coded', 'she', 'event', 'crash', 'not', 'at', 'intersection', 'traveling', 'right', 'precrash', 'as', 'from', 'were', 'by', 'had', 'reason', 'his', 'side', 'is', 'front', 'her', 'traffic', 'an', 'it', 'two', 'speed', 'stated', 'one', 'occurred']</code></pre>
</div>
</div>
</section>
<section id="a-sequence-of-integers" class="level3">
<h3 class="anchored" data-anchor-id="a-sequence-of-integers">A sequence of integers</h3>
<div id="bef2af18" class="cell" data-execution_count="131">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>X_train_txt[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="125">
<pre><code>&lt;tf.Tensor: shape=(500,), dtype=int64, numpy=
array([ 11,  24,  49,   8,   2, 253, 219,   6,   4, 165,   8,   2, 410,
         6,   4, 564, 971,  27,   2,  27, 568,   6,   4, 192,   1,  45,
        51, 208,  65, 235,  54,  14,  20, 867,  34,  43, 183,   1,  45,
        51, 208,  65, 235,  54,  14,  20, 178,  34,   4, 676,   1,  42,
       237,   2, 153, 192,  20,   3, 107,   7,  75,  17,   4, 612, 441,
       549,   2,  88,  46,   3, 207,  63, 185,  55,   2,  42, 243,   3,
       400,   7,  58,  33,  50, 172, 251,  84,  26,   2,  60,   6,   2,
        24,   1,   4, 402, 970,   1,   1,   3,  68,  26,   2,  27,  94,
       118,   8,  14, 101, 311,  10,   2, 237,   5, 422, 269,  44, 154,
        54,  19,   1,   4, 308, 342,   1,   3,  79,   8,  14,  45, 159,
         2, 121,  27, 190,  44, 598,   5, 325,  75,  70,   2, 105, 189,
       231,   1, 241,  81,  19,  31,   1, 193,   2,  54,  81,   9, 134,
         4, 174,  12,  17,   1, 390,   1, 159,   2,  27,  32,   2, 119,
         1,  68,   8,   2, 410,   6,   2,  27,   8,   1,   5,   2, 159,
       174,  12,   1, 168,   2,  27,   7,  69,   2,  40,   6,   1,  17,
        81,  40,  19, 246,  73,  83,  64,   5, 129,  56,   8,   2,  27,
         7,  33,  73,  71,  57,   5,  82,   2,   9,   6,   1,   4,   1,
        59, 382,   5, 113,   8, 276, 258,   1, 317, 928, 284,  10, 784,
       294, 462, 483,   7,   1,  15,   3,  16,  37, 112,   5, 677, 144,
         1,  26,   2,  60,   6,   2,  24,  15,  47,  18,  70,   2, 105,
       429,  15,  35, 448,   1,   5, 493,  37,  54,  62,  68,  25,   1,
        33,   5, 325,  70,  15, 134,   2, 174, 232, 406,  15, 341, 134,
         1, 691,   2,  27,   7,  15,   1,  10,  93,  15,   3,  25, 216,
         8,   2,  24,   2,  13,  30,  23,  10,   1,   3,  21,  11,  12,
        28,  76,   2,  14, 130,  19,  38,   6, 106,  14,   2,  13,  36,
         3,  21,  31,   4,   9,  91, 180,   1, 137,   1,   2,  87,  97,
        21,   5,   1, 285,  43,   1, 511, 569,  15, 775, 140,   1,   2,
        27,   7,  25,  68,  31, 184,  31,   2, 159, 174,  12,   1,   2,
        42,   1,   2,   9,   6,   1,   4,   1,  59,   8, 276, 258,   3,
       489,  37, 753, 544,  10,   4, 975, 313,  26,   2,  60,   6,   2,
        24,  15,   3,  16,  37, 112, 110,  32, 151,  70,   2,  24,  49,
        15,  47,  15,   3,  79,   8,  14, 191,  31,   2,  42, 105, 189,
       231,  15, 647,   2,  12,   8,   2,  19,  94, 118,  35,   1,   5,
        54,  19,   7, 141,   2,  27,  15,   1,  31,   2,  12, 347,  81,
        54,   7,  90,   8,   2, 410,   6,   2,  27,  15, 503,  62, 154,
        25, 143,   1,  15, 157, 134,   2, 174,  12,  17,  81, 390,   7,
         1,  16, 111,  15, 168,   2,  27,  15, 588, 329, 117,   7,   3,
       163,   5, 113, 947, 175,  26,   4, 643,   1,   2,  13,  30,  23,
        10,   1,   3,  21,  52,  12])&gt;</code></pre>
</div>
</div>
</section>
<section id="feed-lstm-a-sequence-of-one-hots" class="level3">
<h3 class="anchored" data-anchor-id="feed-lstm-a-sequence-of-one-hots">Feed LSTM a sequence of one-hots</h3>
<div id="9edd4046" class="cell" data-execution_count="132">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.layers <span class="im">import</span> CategoryEncoding, Bidirectional, LSTM</span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">42</span>)</span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>one_hot_model <span class="op">=</span> Sequential([Input(shape<span class="op">=</span>(max_length,), dtype<span class="op">=</span><span class="st">"int64"</span>),</span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a>    CategoryEncoding(num_tokens<span class="op">=</span>max_tokens, output_mode<span class="op">=</span><span class="st">"one_hot"</span>),</span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a>    Bidirectional(LSTM(<span class="dv">24</span>)),</span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a>    Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"sigmoid"</span>)])</span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a>one_hot_model.compile(optimizer<span class="op">=</span><span class="st">"adam"</span>,</span>
<span id="cb205-8"><a href="#cb205-8" aria-hidden="true" tabindex="-1"></a>    loss<span class="op">=</span><span class="st">"binary_crossentropy"</span>, metrics<span class="op">=</span>[<span class="st">"accuracy"</span>])</span>
<span id="cb205-9"><a href="#cb205-9" aria-hidden="true" tabindex="-1"></a>one_hot_model.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Model: "sequential_4"</span>
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> Layer (type)                    </span>┃<span style="font-weight: bold"> Output Shape           </span>┃<span style="font-weight: bold">       Param # </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ category_encoding               │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">500</span>, <span style="color: #00af00; text-decoration-color: #00af00">1000</span>)      │             <span style="color: #00af00; text-decoration-color: #00af00">0</span> │
│ (<span style="color: #0087ff; text-decoration-color: #0087ff">CategoryEncoding</span>)              │                        │               │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ bidirectional (<span style="color: #0087ff; text-decoration-color: #0087ff">Bidirectional</span>)   │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">48</span>)             │       <span style="color: #00af00; text-decoration-color: #00af00">196,800</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense_8 (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                 │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">1</span>)              │            <span style="color: #00af00; text-decoration-color: #00af00">49</span> │
└─────────────────────────────────┴────────────────────────┴───────────────┘
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Total params: </span><span style="color: #00af00; text-decoration-color: #00af00">196,849</span> (768.94 KB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">196,849</span> (768.94 KB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Non-trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">0</span> (0.00 B)
</pre>
</div>
</div>
</section>
<section id="fit-evaluate-1" class="level3">
<h3 class="anchored" data-anchor-id="fit-evaluate-1">Fit &amp; evaluate</h3>
<div id="4f561eec" class="cell" data-execution_count="133">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>es <span class="op">=</span> keras.callbacks.EarlyStopping(patience<span class="op">=</span><span class="dv">10</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a>    monitor<span class="op">=</span><span class="st">"val_accuracy"</span>, verbose<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> Path(<span class="st">"one-hot-model.keras"</span>).exists():</span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a>    one_hot_model.fit(X_train_txt, y_train, epochs<span class="op">=</span><span class="dv">1_000</span>, callbacks<span class="op">=</span>es,</span>
<span id="cb206-6"><a href="#cb206-6" aria-hidden="true" tabindex="-1"></a>        validation_data<span class="op">=</span>(X_val_txt, y_val), verbose<span class="op">=</span><span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb206-7"><a href="#cb206-7" aria-hidden="true" tabindex="-1"></a>    one_hot_model.save(<span class="st">"one-hot-model.keras"</span>)</span>
<span id="cb206-8"><a href="#cb206-8" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb206-9"><a href="#cb206-9" aria-hidden="true" tabindex="-1"></a>    one_hot_model <span class="op">=</span> keras.models.load_model(<span class="st">"one-hot-model.keras"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="13c1492d" class="cell" data-execution_count="134">
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>one_hot_model.evaluate(X_train_txt, y_train, verbose<span class="op">=</span><span class="dv">0</span>, batch_size<span class="op">=</span><span class="dv">1_000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="128">
<pre><code>[0.31880417466163635, 0.8918206095695496]</code></pre>
</div>
</div>
<div id="beacaa4e" class="cell" data-execution_count="135">
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>one_hot_model.evaluate(X_val_txt, y_val, verbose<span class="op">=</span><span class="dv">0</span>, batch_size<span class="op">=</span><span class="dv">1_000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="129">
<pre><code>[0.3709336221218109, 0.8776978254318237]</code></pre>
</div>
</div>
</section>
<section id="custom-embeddings" class="level3">
<h3 class="anchored" data-anchor-id="custom-embeddings">Custom embeddings</h3>
<div id="8c78b1f3" class="cell" data-execution_count="136">
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.layers <span class="im">import</span> Embedding</span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a>embed_lstm <span class="op">=</span> Sequential([Input(shape<span class="op">=</span>(max_length,), dtype<span class="op">=</span><span class="st">"int64"</span>),</span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a>    Embedding(input_dim<span class="op">=</span>max_tokens, output_dim<span class="op">=</span><span class="dv">32</span>, mask_zero<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a>    Bidirectional(LSTM(<span class="dv">24</span>)),</span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a>    Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"sigmoid"</span>)])</span>
<span id="cb211-6"><a href="#cb211-6" aria-hidden="true" tabindex="-1"></a>embed_lstm.compile(<span class="st">"adam"</span>, <span class="st">"binary_crossentropy"</span>, metrics<span class="op">=</span>[<span class="st">"accuracy"</span>])</span>
<span id="cb211-7"><a href="#cb211-7" aria-hidden="true" tabindex="-1"></a>embed_lstm.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Model: "sequential_5"</span>
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> Layer (type)                    </span>┃<span style="font-weight: bold"> Output Shape           </span>┃<span style="font-weight: bold">       Param # </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ embedding (<span style="color: #0087ff; text-decoration-color: #0087ff">Embedding</span>)           │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">500</span>, <span style="color: #00af00; text-decoration-color: #00af00">32</span>)        │        <span style="color: #00af00; text-decoration-color: #00af00">32,000</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ bidirectional_1 (<span style="color: #0087ff; text-decoration-color: #0087ff">Bidirectional</span>) │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">48</span>)             │        <span style="color: #00af00; text-decoration-color: #00af00">10,944</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense_9 (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                 │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">1</span>)              │            <span style="color: #00af00; text-decoration-color: #00af00">49</span> │
└─────────────────────────────────┴────────────────────────┴───────────────┘
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Total params: </span><span style="color: #00af00; text-decoration-color: #00af00">42,993</span> (167.94 KB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">42,993</span> (167.94 KB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Non-trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">0</span> (0.00 B)
</pre>
</div>
</div>
</section>
<section id="fit-evaluate-2" class="level3">
<h3 class="anchored" data-anchor-id="fit-evaluate-2">Fit &amp; evaluate</h3>
<div id="4e62e1df" class="cell" data-execution_count="137">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>es <span class="op">=</span> keras.callbacks.EarlyStopping(patience<span class="op">=</span><span class="dv">10</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a>    monitor<span class="op">=</span><span class="st">"val_accuracy"</span>, verbose<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> Path(<span class="st">"embed-lstm.keras"</span>).exists():</span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a>    embed_lstm.fit(X_train_txt, y_train, epochs<span class="op">=</span><span class="dv">1_000</span>, callbacks<span class="op">=</span>es,</span>
<span id="cb212-6"><a href="#cb212-6" aria-hidden="true" tabindex="-1"></a>        validation_data<span class="op">=</span>(X_val_txt, y_val), verbose<span class="op">=</span><span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb212-7"><a href="#cb212-7" aria-hidden="true" tabindex="-1"></a>    embed_lstm.save(<span class="st">"embed-lstm.keras"</span>)</span>
<span id="cb212-8"><a href="#cb212-8" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb212-9"><a href="#cb212-9" aria-hidden="true" tabindex="-1"></a>    embed_lstm <span class="op">=</span> keras.models.load_model(<span class="st">"embed-lstm.keras"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="b2cd8153" class="cell" data-execution_count="138">
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a>embed_lstm.evaluate(X_train_txt, y_train, verbose<span class="op">=</span><span class="dv">0</span>, batch_size<span class="op">=</span><span class="dv">1_000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-02-26 10:51:53.156660: E tensorflow/core/util/util.cc:131] oneDNN supports DT_BOOL only on platforms with AVX-512. Falling back to the default Eigen-based implementation if present.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="132">
<pre><code>[0.27049171924591064, 0.9030942916870117]</code></pre>
</div>
</div>
<div id="7ec09bec" class="cell" data-execution_count="139">
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a>embed_lstm.evaluate(X_val_txt, y_val, verbose<span class="op">=</span><span class="dv">0</span>, batch_size<span class="op">=</span><span class="dv">1_000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="133">
<pre><code>[0.36852043867111206, 0.8553956747055054]</code></pre>
</div>
</div>
<div id="239a7f74" class="cell" data-execution_count="140">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>embed_lstm.evaluate(X_test_txt, y_test, verbose<span class="op">=</span><span class="dv">0</span>, batch_size<span class="op">=</span><span class="dv">1_000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="134">
<pre><code>[0.38728299736976624, 0.8467625975608826]</code></pre>
</div>
</div>
</section>


</section>

<div id="quarto-appendix" class="default"><section id="package-versions" class="level3 appendix" data-visibility="uncounted"><h2 class="anchored quarto-appendix-heading">Package Versions</h2><div class="quarto-appendix-contents">

<div id="b33d35a2" class="cell" data-execution_count="141">
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> watermark <span class="im">import</span> watermark</span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(watermark(python<span class="op">=</span><span class="va">True</span>, packages<span class="op">=</span><span class="st">"keras,matplotlib,numpy,pandas,seaborn,scipy,torch,tensorflow,tf_keras"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Python implementation: CPython
Python version       : 3.11.11
IPython version      : 8.32.0

keras     : 3.8.0
matplotlib: 3.10.0
numpy     : 1.26.4
pandas    : 2.2.3
seaborn   : 0.13.2
scipy     : 1.13.1
torch     : 2.5.1+cu124
tensorflow: 2.18.0
tf_keras  : 2.18.0
</code></pre>
</div>
</div>
</div></section><section id="glossary" class="level3 appendix" data-visibility="uncounted"><h2 class="anchored quarto-appendix-heading">Glossary</h2><div class="quarto-appendix-contents">

<div class="columns">
<div class="column">
<ul>
<li>bag of words</li>
<li>lemmatization</li>
<li><span class="math inline">n</span>-grams</li>
<li>one-hot embedding</li>
</ul>
</div><div class="column">
<ul>
<li>TF-IDF</li>
<li>vocabulary</li>
<li>word embedding</li>
<li>word2vec</li>
</ul>
</div>
</div>


</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../Exercises/hurricane-damage.html" class="pagination-link" aria-label="Exercise: Aerial Photos of Hurricane Damage">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Exercise: Aerial Photos of Hurricane Damage</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../Exercises/police-reports.html" class="pagination-link" aria-label="Exercise: Police Reports of US Car Crashes">
        <span class="nav-page-text">Exercise: Police Reports of US Car Crashes</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>