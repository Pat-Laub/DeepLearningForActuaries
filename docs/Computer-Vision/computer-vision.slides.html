<!DOCTYPE html>
<html lang="en"><head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-15a8f4913ea29731a45b81ab225b8fd8.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-contrib/reveal-auto-agenda-0.0.3/reveal-auto-agenda.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.7.13">

  <meta name="author" content="Patrick Laub">
  <title>AI for Actuaries – Computer Vision</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {  background-color: #e9ecef; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #0040ff; font-weight: bold; } /* Alert */
    code span.an { color: #4090c0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #336699; } /* Attribute */
    code span.bn { color: #0033a0; } /* BaseN */
    code span.bu { color: #0055cc; } /* BuiltIn */
    code span.cf { color: #0055cc; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #002080; } /* Constant */
    code span.co { color: #4090c0; font-style: italic; } /* Comment */
    code span.cv { color: #4090c0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #3060a0; font-style: italic; } /* Documentation */
    code span.dt { color: #0044bb; } /* DataType */
    code span.dv { color: #0033a0; } /* DecVal */
    code span.er { color: #0040ff; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #0033a0; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #0055cc; font-weight: bold; } /* Import */
    code span.in { color: #4090c0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #0055cc; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #0055cc; } /* Other */
    code span.pp { color: #336699; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #336699; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #4090c0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-0151b54ac4ccf28bedfd6d1098a60b77.css">
  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
  
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
</head>
<body class="quarto-light">
<script>
  let selectedAnnoteEl;
</script>
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Computer Vision</h1>
  <p class="subtitle">ACTL3143 &amp; ACTL5111 Deep Learning for Actuaries</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Patrick Laub 
</div>
</div>
</div>

</section>
<section>
<section id="images" class="title-slide slide level1 agenda-slide center" data-visibility="uncounted">
<h1>Images</h1>
<div class="agenda-heading">
<p>Lecture Outline</p>
</div>
<div class="agenda">
<ul>
<li><div class="agenda-active">
<p>Images</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Convolutional Layers</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Convolutional Layer Options</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Convolutional Neural Networks</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Chinese Character Recognition Dataset</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Fitting a (multinomial) logistic regression</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Fitting a CNN</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Error Analysis</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Hyperparameter tuning</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Benchmark Problems</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Transfer Learning</p>
</div></li>
</ul>
</div>
</section>
<section id="shapes-of-data" class="slide level2">
<h2>Shapes of data</h2>

<img data-src="medium-tensor-rank.png" class="r-stretch quarto-figure-center"><p class="caption">Illustration of tensors of different rank.</p><div class="footer">
<p>Source: Paras Patidar (2019), <a href="https://medium.com/mlait/tensors-representation-of-data-in-neural-networks-bbe8a711b93b">Tensors — Representation of Data In Neural Networks</a>, Medium article.</p>
</div>
</section>
<section id="shapes-of-photos" class="slide level2">
<h2>Shapes of photos</h2>

<img data-src="rgb-channels.png" class="r-stretch quarto-figure-center"><p class="caption">A photo is a rank 3 tensor.</p><div class="footer">
<p>Source: Kim et al (2021), <a href="https://www.mdpi.com/applsci/applsci-11-03418/article_deploy/html/images/applsci-11-03418-g001.png">Data Hiding Method for Color AMBTC Compressed Images Using Color Difference</a>, Applied Sciences.</p>
</div>
</section>
<section id="how-the-computer-sees-them" class="slide level2 smaller">
<h2>How the computer sees them</h2>
<div id="223bdc77" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a></a><span class="im">from</span> matplotlib.image <span class="im">import</span> imread</span>
<span id="cb1-2"><a></a>img1 <span class="op">=</span> imread(<span class="st">'pu.gif'</span>)<span class="op">;</span> img2 <span class="op">=</span> imread(<span class="st">'pl.gif'</span>)</span>
<span id="cb1-3"><a></a>img3 <span class="op">=</span> imread(<span class="st">'pr.gif'</span>)<span class="op">;</span> img4 <span class="op">=</span> imread(<span class="st">'pg.bmp'</span>)</span>
<span id="cb1-4"><a></a><span class="ss">f"Shapes are: </span><span class="sc">{</span>img1<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>img2<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>img3<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>img4<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">."</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="2011605d" class="cell" data-execution_count="4">
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>'Shapes are: (16, 16, 3), (16, 16, 3), (16, 16, 3), (16, 16, 3).'</code></pre>
</div>
</div>
<div class="columns">
<div class="column" style="width:25%;">
<div id="1e0bcb95" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a></a>img1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>array([[[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0]],

       [[255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0]],

       [[255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0]],

       [[255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0]],

       [[255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0]],

       [[  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]]], dtype=uint8)</code></pre>
</div>
</div>
</div><div class="column" style="width:25%;">
<div id="0501ed0a" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a></a>img2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>array([[[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]]], dtype=uint8)</code></pre>
</div>
</div>
</div><div class="column" style="width:25%;">
<div id="cfd83985" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a></a>img3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>array([[[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [255, 255,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]]], dtype=uint8)</code></pre>
</div>
</div>
</div><div class="column" style="width:25%;">
<div id="c663ba47" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a></a>img4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>array([[[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [  0,   0,   0],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0]],

       [[  0,   0,   0],
        [255, 163, 177],
        [255, 163, 177],
        [255, 255, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [255, 255, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0]],

       [[255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 255, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [255, 255, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177]],

       [[255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [ 51,   0, 255],
        [ 51,   0, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [ 51,   0, 255],
        [ 51,   0, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177]],

       [[255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [ 51,   0, 255],
        [ 51,   0, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [ 51,   0, 255],
        [ 51,   0, 255],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177]],

       [[255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 255, 255],
        [255, 255, 255],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177]],

       [[255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177]],

       [[255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177]],

       [[255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177]],

       [[255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177]],

       [[255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0]],

       [[255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 163, 177],
        [255, 163, 177],
        [255, 163, 177],
        [  0,   0,   0],
        [  0,   0,   0]],

       [[255, 163, 177],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 163, 177],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0],
        [255, 163, 177],
        [  0,   0,   0],
        [  0,   0,   0],
        [  0,   0,   0]]], dtype=uint8)</code></pre>
</div>
</div>
</div></div>
</section>
<section id="how-we-see-them" class="slide level2">
<h2>How we see them</h2>
<div id="7bad4aea" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a></a><span class="im">from</span> matplotlib.pyplot <span class="im">import</span> imshow</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="columns">
<div class="column" style="width:25%;">
<div id="d26b6938" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a></a>imshow(img1)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="computer-vision_files/figure-revealjs/cell-11-output-1.png" width="704" height="691"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:25%;">
<div id="bae0ea52" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a></a>imshow(img2)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="computer-vision_files/figure-revealjs/cell-12-output-1.png" width="704" height="691"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:25%;">
<div id="da1eade0" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a></a>imshow(img3)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="computer-vision_files/figure-revealjs/cell-13-output-1.png" width="704" height="691"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:25%;">
<div id="205c82ad" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a></a>imshow(img4)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="computer-vision_files/figure-revealjs/cell-14-output-1.png" width="704" height="691"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="why-is-255-special" class="slide level2">
<h2>Why is 255 special?</h2>
<p>Each pixel’s colour intensity is stored in one byte.</p>
<p>One byte is 8 bits, so in binary that is 00000000 to 11111111.</p>
<p>The largest <em>unsigned</em> number this can be is <span class="math inline">2^8-1 = 255</span>.</p>
<div id="6bd3d1db" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a></a>np.array([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">255</span>, <span class="dv">256</span>]).astype(np.uint8)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>array([  0,   1, 255,   0], dtype=uint8)</code></pre>
</div>
</div>
<p>If you had <em>signed</em> numbers, this would go from -128 to 127.</p>
<div id="6ad9005b" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a></a>np.array([<span class="op">-</span><span class="dv">128</span>, <span class="dv">1</span>, <span class="dv">127</span>, <span class="dv">128</span>]).astype(np.int8)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>array([-128,    1,  127, -128], dtype=int8)</code></pre>
</div>
</div>
<p>Alternatively, <em>hexidecimal</em> numbers are used. E.g. 10100001 is split into 1010 0001, and 1010=A, 0001=1, so combined it is 0xA1.</p>
</section>
<section id="image-editing-with-kernels" class="slide level2">
<h2>Image editing with kernels</h2>
<p>Take a look at <a href="https://setosa.io/ev/image-kernels/">https://setosa.io/ev/image-kernels/</a>.</p>

<img data-src="convolution.gif" class="r-stretch quarto-figure-center"><p class="caption">An example of an image kernel in action.</p><div class="footer">
<p>Source: <a href="http://deeplearning.stanford.edu/wiki/index.php/Feature_extraction_using_convolution">Stanford’s deep learning tutorial</a> via <a href="https://stats.stackexchange.com/a/188216">Stack Exchange</a>.</p>
</div>
</section></section>
<section>
<section id="convolutional-layers" class="title-slide slide level1 agenda-slide center" data-visibility="uncounted">
<h1>Convolutional Layers</h1>
<div class="agenda-heading">
<p>Lecture Outline</p>
</div>
<div class="agenda">
<ul>
<li><div class="agenda-inactive agenda-pre-active">
<p>Images</p>
</div></li>
<li><div class="agenda-active">
<p>Convolutional Layers</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Convolutional Layer Options</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Convolutional Neural Networks</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Chinese Character Recognition Dataset</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Fitting a (multinomial) logistic regression</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Fitting a CNN</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Error Analysis</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Hyperparameter tuning</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Benchmark Problems</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Transfer Learning</p>
</div></li>
</ul>
</div>
</section>
<section id="convolution-not-complicated" class="slide level2">
<h2>‘Convolution’ not ‘complicated’</h2>
<p>Say <span class="math inline">X_1, X_2 \sim f_X</span> are i.i.d., and we look at <span class="math inline">S = X_1 + X_2</span>.</p>
<p>The density for <span class="math inline">S</span> is then</p>
<p><span class="math display">
f_S(s) = \int_{x_1=-\infty}^{\infty} f_X(x_1) \, f_X(s-x_1) \,\mathrm{d}s .
</span></p>
<p>This is the <em>convolution</em> operation, <span class="math inline">f_S = f_X \star f_X</span>.</p>
</section>
<section id="images-are-rank-3-tensors" class="slide level2">
<h2>Images are rank 3 tensors</h2>
<p>Height, width, and number of channels.</p>

<img data-src="Glassner/16-1.png" class="r-stretch quarto-figure-center"><p class="caption">Examples of rank 3 tensors.</p><p>Grayscale image has 1 channel. RGB image has 3 channels.</p>
<p>Example: Yellow = Red + Green.</p>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="example-detecting-yellow" class="slide level2">
<h2>Example: Detecting yellow</h2>
<div class="columns">
<div class="column">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Glassner/16-3.png"></p>
<figcaption>Applying a neuron to an image pixel.</figcaption>
</figure>
</div>
</div><div class="column">
<p><br></p>
<p>Apply a neuron to each pixel in the image.</p>
<p><br></p>
<p>If red/green <span class="math inline">\nearrow</span> or blue <span class="math inline">\searrow</span> then yellowness <span class="math inline">\nearrow</span>.</p>
<p><br></p>
<p>Set RGB weights to 1, 1, -1.</p>
</div></div>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="example-detecting-yellow-ii" class="slide level2">
<h2>Example: Detecting yellow II</h2>

<img data-src="Glassner/16-4.png" class="r-stretch quarto-figure-center"><p class="caption">Scan the 3-channel input (colour image) with the neuron to produce a 1-channel output (grayscale image).</p><p>The output is produced by <em>sweeping</em> the neuron over the input. This is called <strong>convolution</strong>.</p>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="example-detecting-yellow-iii" class="slide level2" data-visibility="uncounted">
<h2>Example: Detecting yellow III</h2>

<img data-src="Glassner/16-5.png" class="r-stretch quarto-figure-center"><p class="caption">The more yellow the pixel in the colour image (left), the more white it is in the grayscale image.</p><p>The neuron or its weights is called a <strong>filter</strong>. We <em>convolve</em> the image with a filter, i.e.&nbsp;a <strong>convolutional filter</strong>.</p>
</section>
<section id="terminology" class="slide level2">
<h2>Terminology</h2>
<ul>
<li>The same neuron is used to sweep over the image, so we can store the weights in some shared memory and process the pixels in parallel. We say that the neurons are <em>weight sharing</em>.</li>
<li>In the previous example, the neuron only takes one pixel as input. Usually a larger filter containing a <em>block of weights</em> is used to process not only a pixel but also its neighboring pixels all at once.</li>
<li>The weights are called the filter <strong>kernels</strong>.</li>
<li>The cluster of pixels that forms the input of a filter is called its <em>footprint</em>.</li>
</ul>
</section>
<section id="spatial-filter" class="slide level2">
<h2>Spatial filter</h2>

<img data-src="Glassner/16-9.png" class="r-stretch quarto-figure-center"><p class="caption">Example 3x3 filter</p><p>When a filter’s footprint is &gt; 1 pixel, it is a <strong>spatial filter</strong>.</p>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="multidimensional-convolution" class="slide level2">
<h2>Multidimensional convolution</h2>
<p>Need <span class="math inline">\# \text{ Channels in Input} = \# \text{ Channels in Filter}</span>.</p>

<img data-src="Glassner/16-18.png" class="r-stretch quarto-figure-center"><p class="caption">Example: a 3x3 filter with 3 channels, containing 27 weights.</p><div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="example-3x3-filter-over-rgb-input" class="slide level2">
<h2>Example: 3x3 filter over RGB input</h2>

<img data-src="Glassner/16-19.png" class="r-stretch quarto-figure-center"><p class="caption">Each channel is multipled separately &amp; then added together.</p><div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="input-output-relationship" class="slide level2">
<h2>Input-output relationship</h2>

<img data-src="Glassner/16-10.png" class="r-stretch quarto-figure-center"><p class="caption">Matching the original image footprints against the output location.</p><div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section></section>
<section>
<section id="convolutional-layer-options" class="title-slide slide level1 agenda-slide center" data-visibility="uncounted">
<h1>Convolutional Layer Options</h1>
<div class="agenda-heading">
<p>Lecture Outline</p>
</div>
<div class="agenda">
<ul>
<li><div class="agenda-inactive agenda-pre-active">
<p>Images</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Convolutional Layers</p>
</div></li>
<li><div class="agenda-active">
<p>Convolutional Layer Options</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Convolutional Neural Networks</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Chinese Character Recognition Dataset</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Fitting a (multinomial) logistic regression</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Fitting a CNN</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Error Analysis</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Hyperparameter tuning</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Benchmark Problems</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Transfer Learning</p>
</div></li>
</ul>
</div>
</section>
<section id="padding" class="slide level2">
<h2>Padding</h2>

<img data-src="Glassner/16-15.png" class="r-stretch quarto-figure-center"><p class="caption">What happens when filters go off the edge of the input?</p><ul>
<li>How to avoid the filter’s receptive field falling off the side of the input.</li>
<li>If we only scan the filter over places of the input where the filter can fit perfectly, it will lead to loss of information, especially after many filters.</li>
</ul>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="padding-1" class="slide level2">
<h2>Padding</h2>
<p>Add a border of extra elements around the input, called <strong>padding</strong>. Normally we place zeros in all the new elements, called <strong>zero padding</strong>.</p>

<img data-src="Glassner/16-17.png" class="r-stretch quarto-figure-center"><p class="caption">Padded values can be added to the outside of the input.</p><div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="convolution-layer" class="slide level2">
<h2>Convolution layer</h2>
<ul>
<li>Multiple filters are bundled together in one layer.</li>
<li>The filters are applied <em>simultaneously</em> and <em>independently</em> to the input.</li>
<li>Filters can have different footprints, but in practice we almost always use the same footprint for every filter in a convolution layer.</li>
<li>Number of channels in the output will be the same as the number of filters.</li>
</ul>
</section>
<section id="example" class="slide level2">
<h2>Example</h2>
<div class="columns">
<div class="column">
<p>In the image:</p>
<ul>
<li>6-channel input tensor</li>
<li>input pixels</li>
<li>four 3x3 filters</li>
<li>four output tensors</li>
<li>final output tensor.</li>
</ul>
</div><div class="column">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Glassner/16-21.png"></p>
<figcaption>Example network highlighting that the number of output channels equals the number of filters.</figcaption>
</figure>
</div>
</div></div>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="x1-convolution" class="slide level2">
<h2>1x1 convolution</h2>
<ul>
<li>Feature reduction: Reduce the number of channels in the input tensor (removing correlated features) by using fewer filters than the number of channels in the input. This is because the number of channels in the output is always the same as number of filters.</li>
<li>1x1 convolution: Convolution using 1x1 filters.</li>
<li>When the channels are correlated, 1x1 convolution is very effective at reducing channels without loss of information.</li>
</ul>
</section>
<section id="example-of-1x1-convolution" class="slide level2 smaller">
<h2>Example of 1x1 convolution</h2>

<img data-src="Glassner/16-23.png" class="r-stretch quarto-figure-center"><p class="caption">Example network with 1x1 convolution.</p><ul>
<li>Input tensor contains 300 channels.</li>
<li>Use 175 1x1 filters in the convolution layer (300 weights each).</li>
<li>Each filter produces a 1-channel output.</li>
<li>Final output tensor has 175 channels.</li>
</ul>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="striding" class="slide level2">
<h2>Striding</h2>
<p>We don’t have to go one pixel across/down at a time.</p>

<img data-src="Glassner/16-29.png" class="r-stretch quarto-figure-center"><p class="caption">Example: Use a stride of three horizontally and two vertically.</p><p>Dimension of output will be smaller than input.</p>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="choosing-strides" class="slide level2 smaller">
<h2>Choosing strides</h2>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img data-src="Glassner/16-31.png"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img data-src="Glassner/16-32.png"></p>
</div>
</div>
</div>
<p>When a filter scans the input step by step, it processes the same input elements multiple times. Even with larger strides, this can still happen (left image).</p>
<p><strong>If</strong> we want to save time, we can choose strides that prevents input elements from being used more than once. Example (right image): 3x3 filter, stride 3 in both directions.</p>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="specifying-a-convolutional-layer" class="slide level2">
<h2>Specifying a convolutional layer</h2>
<p>Need to choose:</p>
<ul>
<li>number of filters,</li>
<li>their footprints (e.g.&nbsp;3x3, 5x5, etc.),</li>
<li>activation functions,</li>
<li>padding &amp; striding (optional).</li>
</ul>
<p>All the filter weights are learned during training.</p>
</section></section>
<section>
<section id="convolutional-neural-networks" class="title-slide slide level1 agenda-slide center" data-visibility="uncounted">
<h1>Convolutional Neural Networks</h1>
<div class="agenda-heading">
<p>Lecture Outline</p>
</div>
<div class="agenda">
<ul>
<li><div class="agenda-inactive agenda-pre-active">
<p>Images</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Convolutional Layers</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Convolutional Layer Options</p>
</div></li>
<li><div class="agenda-active">
<p>Convolutional Neural Networks</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Chinese Character Recognition Dataset</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Fitting a (multinomial) logistic regression</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Fitting a CNN</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Error Analysis</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Hyperparameter tuning</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Benchmark Problems</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Transfer Learning</p>
</div></li>
</ul>
</div>
</section>
<section id="definition-of-cnn" class="slide level2">
<h2>Definition of CNN</h2>
<div class="columns">
<div class="column" style="width:60%;">
<p><br> <br></p>
<p>A neural network that uses <em>convolution layers</em> is called a <em>convolutional neural network</em>.</p>
</div><div class="column" style="width:40%;">
<p><img data-src="xkcd-trained_a_neural_net_2x.png"></p>
</div></div>
<div class="footer">
<p>Source: Randall Munroe (2019), <a href="https://xkcd.com/2173/">xkcd #2173: Trained a Neural Net</a>.</p>
</div>
</section>
<section id="architecture" class="slide level2">
<h2>Architecture</h2>

<img data-src="Geron-mls2_1411.png" class="r-stretch quarto-figure-center"><p class="caption">Typical CNN architecture.</p><div class="footer">
<p>Source: Aurélien Géron (2019), <em>Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</em>, 2nd Edition, Figure 14-11.</p>
</div>
</section>
<section id="architecture-2" class="slide level2">
<h2>Architecture #2</h2>

<img data-src="mathworks-typical-cnn.svg" class="r-stretch"><div class="footer">
<p>Source: MathWorks, <a href="https://au.mathworks.com/campaigns/offers/next/deep-learning-ebook.html"><em>Introducing Deep Learning with MATLAB</em></a>, Ebook.</p>
</div>
</section>
<section id="pooling" class="slide level2">
<h2>Pooling</h2>
<p><strong>Pooling</strong>, or <strong>downsampling</strong>, is a technique to blur a tensor.</p>

<img data-src="Glassner/16-27.png" class="r-stretch quarto-figure-center"><p class="caption">Illustration of pool operations.</p><p>(a): Input tensor (b): Subdivide input tensor into 2x2 blocks (c): Average pooling (d): Max pooling (e): Icon for a pooling layer</p>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="pooling-for-multiple-channels" class="slide level2 smaller">
<h2>Pooling for multiple channels</h2>

<img data-src="Glassner/16-28.png" class="r-stretch quarto-figure-center"><p class="caption">Pooling a multichannel input.</p><ul>
<li>Input tensor: 6x6 with 1 channel, zero padding.</li>
<li>Convolution layer: Three 3x3 filters.</li>
<li>Convolution layer output: 6x6 with 3 channels.</li>
<li>Pooling layer: apply max pooling to each channel.</li>
<li>Pooling layer output: 3x3, 3 channels.</li>
</ul>
<div class="footer">
<p>Source: Glassner (2021), <em>Deep Learning: A Visual Approach</em>, Chapter 16.</p>
</div>
</section>
<section id="whywhy-not-use-pooling" class="slide level2">
<h2>Why/why not use pooling?</h2>
<p><strong>Why?</strong> Pooling <em>reduces the size</em> of tensors, therefore reduces memory usage and execution time (recall that 1x1 convolution <em>reduces the number of channels</em> in a tensor).</p>
<p><strong>Why not?</strong></p>

<img data-src="reddit-hinton-pooling.png" class="r-stretch quarto-figure-center"><p class="caption">Geoffrey Hinton</p><div class="footer">
<p>Source: Hinton, <a href="https://www.reddit.com/r/MachineLearning/comments/2lmo0l/comment/clyj4jv/?utm_source=share&amp;utm_medium=web2x&amp;context=3">Reddit AMA</a>.</p>
</div>
</section>
<section id="what-do-the-cnn-layers-learn" class="slide level2">
<h2>What do the CNN layers learn?</h2>

<img data-src="distill-feature-visualisation.png" class="r-stretch"><div class="footer">
<p>Source: Distill article, <a href="https://distill.pub/2017/feature-visualization/">Feature Visualization</a>.</p>
</div>
</section></section>
<section>
<section id="chinese-character-recognition-dataset" class="title-slide slide level1 agenda-slide center" data-visibility="uncounted">
<h1>Chinese Character Recognition Dataset</h1>
<div class="agenda-heading">
<p>Lecture Outline</p>
</div>
<div class="agenda">
<ul>
<li><div class="agenda-inactive agenda-pre-active">
<p>Images</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Convolutional Layers</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Convolutional Layer Options</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Convolutional Neural Networks</p>
</div></li>
<li><div class="agenda-active">
<p>Chinese Character Recognition Dataset</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Fitting a (multinomial) logistic regression</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Fitting a CNN</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Error Analysis</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Hyperparameter tuning</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Benchmark Problems</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Transfer Learning</p>
</div></li>
</ul>
</div>
</section>
<section id="mnist-dataset" class="slide level2">
<h2>MNIST Dataset</h2>

<img data-src="wiki-MnistExamples.png" class="r-stretch quarto-figure-center"><p class="caption">The MNIST dataset.</p><div class="footer">
<p>Source: Wikipedia, <a href="https://en.wikipedia.org/wiki/MNIST_database">MNIST database</a>.</p>
</div>
</section>
<section id="casia-chinese-handwriting-database" class="slide level2">
<h2>CASIA Chinese handwriting database</h2>
<p>Dataset source: <a href="https://nlpr.ia.ac.cn/databases/handwriting/Home.html">Institute of Automation of Chinese Academy of Sciences (CASIA)</a></p>

<img data-src="Offlin1.jpg" class="r-stretch quarto-figure-center"><p class="caption">A 13 GB dataset of 3,999,571 handwritten characters.</p><div class="footer">
<p>Source: Liu et al.&nbsp;(2011), <a href="https://nlpr.ia.ac.cn/databases/handwriting/Home.html">CASIA online and offline Chinese handwriting databases</a>, 2011 International Conference on Document Analysis and Recognition.</p>
</div>
</section>
<section id="inspect-a-subset-of-characters" class="slide level2">
<h2>Inspect a subset of characters</h2>
<div class="columns">
<div class="column">
<p>Pulling out 55 characters to experiment with.</p>
<p>人从众大夫天口太因鱼犬吠哭火炎啖木林森本竹羊美羔山出女囡鸟日东月朋明肉肤工白虎门闪问闲水牛马吗妈玉王国主川舟虫</p>
</div><div class="column">
<p>Inspect directory structure</p>
<div id="2b264aba" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a></a><span class="op">!</span>pip install directory_tree</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="2f8073af" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a></a><span class="im">from</span> directory_tree <span class="im">import</span> display_tree</span>
<span id="cb21-2"><a></a>display_tree(<span class="st">"CASIA-Dataset"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="58e636c8" class="cell" data-execution_count="18">
<div class="cell-output cell-output-stdout">
<pre><code>CASIA-Dataset/
├── Test/
│   ├── 东/
│   │   ├── 1.png
│   │   ├── 10.png
│   │   ├── 100.png
│   │   ├── 101.png
│   │   ├── 102.png
│   │   ├── 103.png
│   │   ├── 104.png
│   │   ├── 105.png
│   │   ├── 106.png
...
        ├── 97.png
        ├── 98.png
        └── 99.png
</code></pre>
</div>
</div>
</div></div>
</section>
<section id="count-number-of-images-for-each-character" class="slide level2">
<h2>Count number of images for each character</h2>
<div id="a58ca412" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a></a><span class="kw">def</span> count_images_in_folders(root_folder):</span>
<span id="cb23-2"><a></a>    counts <span class="op">=</span> {}</span>
<span id="cb23-3"><a></a>    <span class="cf">for</span> folder <span class="kw">in</span> root_folder.iterdir():</span>
<span id="cb23-4"><a></a>        counts[folder.name] <span class="op">=</span> <span class="bu">len</span>(<span class="bu">list</span>(folder.glob(<span class="st">"*.png"</span>)))</span>
<span id="cb23-5"><a></a>    <span class="cf">return</span> counts</span>
<span id="cb23-6"><a></a></span>
<span id="cb23-7"><a></a>train_counts <span class="op">=</span> count_images_in_folders(Path(<span class="st">"CASIA-Dataset/Train"</span>))</span>
<span id="cb23-8"><a></a>test_counts <span class="op">=</span> count_images_in_folders(Path(<span class="st">"CASIA-Dataset/Test"</span>))</span>
<span id="cb23-9"><a></a></span>
<span id="cb23-10"><a></a><span class="bu">print</span>(train_counts)</span>
<span id="cb23-11"><a></a><span class="bu">print</span>(test_counts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'太': 596, '朋': 595, '羊': 600, '哭': 584, '囡': 240, '明': 596, '川': 593, '马': 597, '羔': 597, '天': 598, '吠': 601, '肉': 598, '夫': 599, '水': 597, '火': 599, '玉': 602, '妈': 595, '鸟': 598, '工': 600, '从': 598, '竹': 600, '王': 601, '人': 597, '美': 591, '众': 600, '因': 603, '东': 601, '大': 603, '吗': 596, '虫': 602, '日': 597, '门': 597, '啖': 240, '林': 598, '牛': 599, '舟': 601, '本': 604, '鱼': 602, '闪': 597, '山': 598, '口': 597, '主': 599, '炎': 602, '国': 600, '闲': 598, '问': 601, '犬': 598, '白': 604, '虎': 597, '出': 602, '森': 598, '肤': 601, '女': 597, '月': 604, '木': 598}
{'太': 143, '朋': 144, '羊': 144, '哭': 138, '囡': 59, '明': 144, '川': 142, '马': 144, '羔': 141, '天': 143, '吠': 141, '肉': 143, '夫': 141, '水': 143, '火': 142, '玉': 142, '妈': 142, '鸟': 143, '工': 141, '从': 142, '竹': 142, '王': 145, '人': 144, '美': 144, '众': 143, '因': 144, '东': 142, '大': 144, '吗': 143, '虫': 144, '日': 143, '门': 144, '啖': 60, '林': 143, '牛': 144, '舟': 143, '本': 143, '鱼': 143, '闪': 143, '山': 144, '口': 143, '主': 141, '炎': 143, '国': 142, '闲': 142, '问': 143, '犬': 141, '白': 141, '虎': 143, '出': 142, '森': 144, '肤': 140, '女': 144, '月': 144, '木': 144}</code></pre>
</div>
</div>
</section>
<section id="number-of-images-for-each-character" class="slide level2">
<h2>Number of images for each character</h2>
<div id="9bab9ce2" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a></a>plt.hist(train_counts.values(), bins<span class="op">=</span><span class="dv">30</span>, label<span class="op">=</span><span class="st">"Train"</span>)</span>
<span id="cb25-2"><a></a>plt.hist(test_counts.values(), bins<span class="op">=</span><span class="dv">30</span>, label<span class="op">=</span><span class="st">"Test"</span>)</span>
<span id="cb25-3"><a></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="computer-vision_files/figure-revealjs/cell-21-output-1.png" width="1522" height="690"></p>
</figure>
</div>
</div>
</div>
<p>It differs, but basically ~600 training and ~140 test images per character. A couple of characters have a lot less of both though.</p>
</section>
<section id="checking-the-dimensions" class="slide level2">
<h2>Checking the dimensions</h2>
<div id="871a8863" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a></a><span class="kw">def</span> get_image_dimensions(root_folder):</span>
<span id="cb26-2"><a></a>    dimensions <span class="op">=</span> []</span>
<span id="cb26-3"><a></a>    <span class="cf">for</span> folder <span class="kw">in</span> root_folder.iterdir():</span>
<span id="cb26-4"><a></a>        <span class="cf">for</span> image <span class="kw">in</span> folder.glob(<span class="st">"*.png"</span>):</span>
<span id="cb26-5"><a></a>            img <span class="op">=</span> imread(image)</span>
<span id="cb26-6"><a></a>            dimensions.append(img.shape)</span>
<span id="cb26-7"><a></a>    <span class="cf">return</span> dimensions</span>
<span id="cb26-8"><a></a></span>
<span id="cb26-9"><a></a>train_dimensions <span class="op">=</span> get_image_dimensions(Path(<span class="st">"CASIA-Dataset/Train"</span>))</span>
<span id="cb26-10"><a></a>test_dimensions <span class="op">=</span> get_image_dimensions(Path(<span class="st">"CASIA-Dataset/Test"</span>))</span>
<span id="cb26-11"><a></a></span>
<span id="cb26-12"><a></a>train_heights <span class="op">=</span> [d[<span class="dv">0</span>] <span class="cf">for</span> d <span class="kw">in</span> train_dimensions]</span>
<span id="cb26-13"><a></a>train_widths <span class="op">=</span> [d[<span class="dv">1</span>] <span class="cf">for</span> d <span class="kw">in</span> train_dimensions]</span>
<span id="cb26-14"><a></a>test_heights <span class="op">=</span> [d[<span class="dv">0</span>] <span class="cf">for</span> d <span class="kw">in</span> test_dimensions]</span>
<span id="cb26-15"><a></a>test_widths <span class="op">=</span> [d[<span class="dv">1</span>] <span class="cf">for</span> d <span class="kw">in</span> test_dimensions]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="checking-the-dimensions-ii" class="slide level2">
<h2>Checking the dimensions II</h2>
<div id="905721b8" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a></a>plt.hist(train_heights, bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Train Heights"</span>)</span>
<span id="cb27-2"><a></a>plt.hist(train_widths, bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Train Widths"</span>)</span>
<span id="cb27-3"><a></a>plt.hist(test_heights, bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Test Heights"</span>)</span>
<span id="cb27-4"><a></a>plt.hist(test_widths, bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Test Widths"</span>)</span>
<span id="cb27-5"><a></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="computer-vision_files/figure-revealjs/cell-23-output-1.png" width="1584" height="690"></p>
</figure>
</div>
</div>
</div>
<p>The images are taller than they are wide. We have more training images than test images.</p>
</section>
<section id="checking-the-dimensions-iii" class="slide level2">
<h2>Checking the dimensions III</h2>
<div id="2e2622f3" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a></a>plt.hist(train_heights, bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Train Heights"</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-2"><a></a>plt.hist(train_widths, bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Train Widths"</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-3"><a></a>plt.hist(test_heights, bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Test Heights"</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-4"><a></a>plt.hist(test_widths, bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Test Widths"</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-5"><a></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="computer-vision_files/figure-revealjs/cell-24-output-1.png" width="1568" height="690"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="checking-the-dimensions-iv" class="slide level2">
<h2>Checking the dimensions IV</h2>
<div class="columns">
<div class="column">
<div id="4fe15c9d" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a></a>plt.hist(train_heights, bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Train Heights"</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-2"><a></a>plt.hist(test_heights, bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Test Heights"</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-3"><a></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="computer-vision_files/figure-revealjs/cell-25-output-1.png" width="1568" height="690"></p>
</figure>
</div>
</div>
</div>
</div><div class="column">
<div id="42cdf355" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a></a>plt.hist(train_widths, bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Train Widths"</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-2"><a></a>plt.hist(test_widths, bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Test Widths"</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-3"><a></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="computer-vision_files/figure-revealjs/cell-26-output-1.png" width="1568" height="690"></p>
</figure>
</div>
</div>
</div>
</div></div>
<p>The distribution of dimensions are pretty similar between training and test sets.</p>
</section>
<section id="keras-image-dataset-loading" class="slide level2">
<h2>Keras image dataset loading</h2>
<div id="3955bcd6" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a></a><span class="im">from</span> keras.utils <span class="im">import</span> image_dataset_from_directory</span>
<span id="cb31-2"><a></a></span>
<span id="cb31-3"><a></a>data_dir <span class="op">=</span> <span class="st">"CASIA-Dataset"</span></span>
<span id="cb31-4"><a></a>batch_size <span class="op">=</span> <span class="dv">32</span></span>
<span id="cb31-5"><a></a>img_height <span class="op">=</span> <span class="dv">80</span></span>
<span id="cb31-6"><a></a>img_width <span class="op">=</span> <span class="dv">60</span></span>
<span id="cb31-7"><a></a>img_size <span class="op">=</span> (img_height, img_width)</span>
<span id="cb31-8"><a></a></span>
<span id="cb31-9"><a></a>train_ds <span class="op">=</span> image_dataset_from_directory(</span>
<span id="cb31-10"><a></a>    data_dir <span class="op">+</span> <span class="st">"/Train"</span>,</span>
<span id="cb31-11"><a></a>    image_size<span class="op">=</span>img_size,</span>
<span id="cb31-12"><a></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb31-13"><a></a>    shuffle<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb31-14"><a></a>    color_mode<span class="op">=</span><span class="st">'grayscale'</span>)</span>
<span id="cb31-15"><a></a></span>
<span id="cb31-16"><a></a>test_ds <span class="op">=</span> image_dataset_from_directory(</span>
<span id="cb31-17"><a></a>    data_dir <span class="op">+</span> <span class="st">"/Test"</span>,</span>
<span id="cb31-18"><a></a>    image_size<span class="op">=</span>img_size,</span>
<span id="cb31-19"><a></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb31-20"><a></a>    shuffle<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb31-21"><a></a>    color_mode<span class="op">=</span><span class="st">'grayscale'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Found 32206 files belonging to 55 classes.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Found 7684 files belonging to 55 classes.</code></pre>
</div>
</div>
</section>
<section id="convert-to-numpy-arrays" class="slide level2">
<h2>Convert to numpy arrays</h2>
<div id="e97f1c26" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a></a>class_names <span class="op">=</span> train_ds.class_names</span>
<span id="cb34-2"><a></a><span class="bu">print</span>(class_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['东', '主', '人', '从', '众', '出', '口', '吗', '吠', '哭', '啖', '因', '囡', '国', '大', '天', '太', '夫', '女', '妈', '山', '川', '工', '日', '明', '月', '朋', '木', '本', '林', '森', '水', '火', '炎', '牛', '犬', '玉', '王', '白', '竹', '羊', '美', '羔', '肉', '肤', '舟', '虎', '虫', '门', '闪', '问', '闲', '马', '鱼', '鸟']</code></pre>
</div>
</div>
<div id="34f5cd95" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a></a><span class="co"># NB: Need shuffle=False earlier for these X &amp; y to line up.</span></span>
<span id="cb36-2"><a></a>X_main <span class="op">=</span> np.concatenate(<span class="bu">list</span>(train_ds.<span class="bu">map</span>(<span class="kw">lambda</span> x, y: x)))</span>
<span id="cb36-3"><a></a>y_main <span class="op">=</span> np.concatenate(<span class="bu">list</span>(train_ds.<span class="bu">map</span>(<span class="kw">lambda</span> x, y: y)))</span>
<span id="cb36-4"><a></a></span>
<span id="cb36-5"><a></a>X_test <span class="op">=</span> np.concatenate(<span class="bu">list</span>(test_ds.<span class="bu">map</span>(<span class="kw">lambda</span> x, y: x)))</span>
<span id="cb36-6"><a></a>y_test <span class="op">=</span> np.concatenate(<span class="bu">list</span>(test_ds.<span class="bu">map</span>(<span class="kw">lambda</span> x, y: y)))</span>
<span id="cb36-7"><a></a></span>
<span id="cb36-8"><a></a>X_main.shape, y_main.shape, X_test.shape, y_test.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>((32206, 80, 60, 1), (32206,), (7684, 80, 60, 1), (7684,))</code></pre>
</div>
</div>
</section>
<section id="some-setup" class="slide level2">
<h2>Some setup</h2>
<div id="569f1044" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a></a>X_train, X_val, y_train, y_val <span class="op">=</span> train_test_split(X_main, y_main, test_size<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb38-2"><a></a>    random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb38-3"><a></a><span class="bu">print</span>(X_train.shape, y_train.shape, X_val.shape, y_val.shape, X_test.shape, y_test.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(25764, 80, 60, 1) (25764,) (6442, 80, 60, 1) (6442,) (7684, 80, 60, 1) (7684,)</code></pre>
</div>
</div>
<div id="079998bf" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a></a><span class="im">import</span> matplotlib.font_manager <span class="im">as</span> fm</span>
<span id="cb40-2"><a></a>CHINESE_FONT <span class="op">=</span> fm.FontProperties(fname<span class="op">=</span><span class="st">"STHeitiTC-Medium-01.ttf"</span>)</span>
<span id="cb40-3"><a></a></span>
<span id="cb40-4"><a></a><span class="kw">def</span> plot_mandarin_characters(X, y, class_names, n<span class="op">=</span><span class="dv">5</span>, title_font<span class="op">=</span>CHINESE_FONT):</span>
<span id="cb40-5"><a></a>    <span class="co"># Plot the first n images in X</span></span>
<span id="cb40-6"><a></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb40-7"><a></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb40-8"><a></a>        plt.subplot(<span class="dv">1</span>, n, i <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb40-9"><a></a>        plt.imshow(X[i], cmap<span class="op">=</span><span class="st">"gray"</span>)</span>
<span id="cb40-10"><a></a>        plt.title(class_names[y[i]], fontproperties<span class="op">=</span>title_font)</span>
<span id="cb40-11"><a></a>        plt.axis(<span class="st">"off"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="c16331a6" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a></a>class_names[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>['东', '主', '人', '从', '众']</code></pre>
</div>
</div>
<div id="4e94531c" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a></a>X_dong <span class="op">=</span> X_train[y_train <span class="op">==</span> <span class="dv">0</span>]<span class="op">;</span> y_dong <span class="op">=</span> y_train[y_train <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb43-2"><a></a>X_ren <span class="op">=</span> X_train[y_train <span class="op">==</span> <span class="dv">2</span>]<span class="op">;</span> y_ren <span class="op">=</span> y_train[y_train <span class="op">==</span> <span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plotting-some-training-characters" class="slide level2 smaller">
<h2>Plotting some training characters</h2>
<div id="65a6be0d" class="cell" data-execution_count="33">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a></a>plot_mandarin_characters(X_dong, y_dong, class_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="computer-vision_files/figure-revealjs/cell-34-output-1.png" width="2782" height="762"></p>
</figure>
</div>
</div>
</div>
<div id="468413fb" class="cell" data-execution_count="34">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a></a>plot_mandarin_characters(X_ren, y_ren, class_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="computer-vision_files/figure-revealjs/cell-35-output-1.png" width="2782" height="762"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="without-the-colourmap.." class="slide level2">
<h2>Without the colourmap..</h2>
<div class="columns">
<div class="column" style="width:5%;">

</div><div class="column" style="width:45%;">
<div id="be48ca96" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a></a>dong <span class="op">=</span> X_test[y_test <span class="op">==</span> <span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb46-2"><a></a>plt.imshow(dong, cmap<span class="op">=</span><span class="st">"gray"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="computer-vision_files/figure-revealjs/cell-36-output-1.png" width="570" height="705"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:45%;">
<div id="4599c9c2" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a></a>dong <span class="op">=</span> X_test[y_test <span class="op">==</span> <span class="dv">0</span>][<span class="dv">1</span>]</span>
<span id="cb47-2"><a></a>plt.imshow(dong)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="computer-vision_files/figure-revealjs/cell-37-output-1.png" width="570" height="705"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:5%;">

</div></div>
</section></section>
<section>
<section id="fitting-a-multinomial-logistic-regression" class="title-slide slide level1 agenda-slide center">
<h1>Fitting a (multinomial) logistic regression</h1>
<div class="agenda-heading">
<p>Lecture Outline</p>
</div>
<div class="agenda">
<ul>
<li><div class="agenda-inactive agenda-pre-active">
<p>Images</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Convolutional Layers</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Convolutional Layer Options</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Convolutional Neural Networks</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Chinese Character Recognition Dataset</p>
</div></li>
<li><div class="agenda-active">
<p>Fitting a (multinomial) logistic regression</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Fitting a CNN</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Error Analysis</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Hyperparameter tuning</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Benchmark Problems</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Transfer Learning</p>
</div></li>
</ul>
</div>
</section>
<section id="make-a-logistic-regression" class="slide level2">
<h2>Make a logistic regression</h2>

<img data-src="flattening-image-to-vector.png" class="r-stretch quarto-figure-center"><p class="caption">Basically pretend it’s not an image</p><div id="ce2789c3" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a></a><span class="im">from</span> keras.layers <span class="im">import</span> Rescaling, Flatten</span>
<span id="cb48-2"><a></a></span>
<span id="cb48-3"><a></a>num_classes <span class="op">=</span> np.unique(y_train).shape[<span class="dv">0</span>]</span>
<span id="cb48-4"><a></a>random.seed(<span class="dv">123</span>)</span>
<span id="cb48-5"><a></a>model <span class="op">=</span> Sequential([</span>
<span id="cb48-6"><a></a>  Input((img_height, img_width, <span class="dv">1</span>)), Flatten(), Rescaling(<span class="fl">1.</span><span class="op">/</span><span class="dv">255</span>),</span>
<span id="cb48-7"><a></a>  Dense(num_classes, activation<span class="op">=</span><span class="st">"softmax"</span>)</span>
<span id="cb48-8"><a></a>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Tip</strong></p>
</div>
<div class="callout-content">
<p>The <code>Rescaling</code> layer will rescale the intensities to [0, 1].</p>
</div>
</div>
</div>
</section>
<section id="inspecting-the-model" class="slide level2">
<h2>Inspecting the model</h2>
<div id="5be8900a" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a></a>model.summary()                            </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Model: "sequential"</span>
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> Layer (type)                    </span>┃<span style="font-weight: bold"> Output Shape           </span>┃<span style="font-weight: bold">       Param # </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ flatten (<span style="color: #0087ff; text-decoration-color: #0087ff">Flatten</span>)               │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">4800</span>)           │             <span style="color: #00af00; text-decoration-color: #00af00">0</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ rescaling (<span style="color: #0087ff; text-decoration-color: #0087ff">Rescaling</span>)           │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">4800</span>)           │             <span style="color: #00af00; text-decoration-color: #00af00">0</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                   │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">55</span>)             │       <span style="color: #00af00; text-decoration-color: #00af00">264,055</span> │
└─────────────────────────────────┴────────────────────────┴───────────────┘
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Total params: </span><span style="color: #00af00; text-decoration-color: #00af00">264,055</span> (1.01 MB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">264,055</span> (1.01 MB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Non-trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">0</span> (0.00 B)
</pre>
</div>
</div>
</section>
<section id="plot-the-model" class="slide level2">
<h2>Plot the model</h2>
<div id="f5dd293c" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a></a>plot_model(model, show_shapes<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="computer-vision_files/figure-revealjs/cell-40-output-1.png" class="r-stretch"></section>
<section id="fitting-the-model" class="slide level2">
<h2>Fitting the model</h2>
<div id="235d20b2" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb51" data-code-line-numbers="1-7,14-15|"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a></a>loss <span class="op">=</span> keras.losses.SparseCategoricalCrossentropy()</span>
<span id="cb51-2"><a></a>topk <span class="op">=</span> keras.metrics.SparseTopKCategoricalAccuracy(k<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb51-3"><a></a>model.compile(optimizer<span class="op">=</span><span class="st">'adam'</span>, loss<span class="op">=</span>loss, metrics<span class="op">=</span>[<span class="st">'accuracy'</span>, topk])</span>
<span id="cb51-4"><a></a></span>
<span id="cb51-5"><a></a>epochs <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb51-6"><a></a>es <span class="op">=</span> EarlyStopping(patience<span class="op">=</span><span class="dv">15</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb51-7"><a></a>    monitor<span class="op">=</span><span class="st">"val_accuracy"</span>, verbose<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb51-8"><a></a></span>
<span id="cb51-9"><a></a><span class="cf">if</span> Path(<span class="st">"logistic.keras"</span>).exists():</span>
<span id="cb51-10"><a></a>    model <span class="op">=</span> keras.models.load_model(<span class="st">"logistic.keras"</span>)</span>
<span id="cb51-11"><a></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">"logistic_history.json"</span>, <span class="st">"r"</span>) <span class="im">as</span> json_file:</span>
<span id="cb51-12"><a></a>        history <span class="op">=</span> json.load(json_file)</span>
<span id="cb51-13"><a></a><span class="cf">else</span>:</span>
<span id="cb51-14"><a></a>    hist <span class="op">=</span> model.fit(X_train, y_train, validation_data<span class="op">=</span>(X_val, y_val),</span>
<span id="cb51-15"><a></a>      epochs<span class="op">=</span>epochs, callbacks<span class="op">=</span>[es], verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb51-16"><a></a>    model.save(<span class="st">"logistic.keras"</span>)</span>
<span id="cb51-17"><a></a>    history <span class="op">=</span> hist.history</span>
<span id="cb51-18"><a></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">"logistic_history.json"</span>, <span class="st">"w"</span>) <span class="im">as</span> json_file:</span>
<span id="cb51-19"><a></a>        json.dump(history, json_file)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Most of this last part is just to save time rendering this slides, you don’t need it.</p>
</section>
<section id="plot-the-lossaccuracy-curves" class="slide level2">
<h2>Plot the loss/accuracy curves</h2>
<div id="5d969afb" class="cell" data-execution_count="42">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a></a><span class="kw">def</span> plot_history(history):</span>
<span id="cb52-2"><a></a>    epochs <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(history[<span class="st">"loss"</span>]))</span>
<span id="cb52-3"><a></a></span>
<span id="cb52-4"><a></a>    plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb52-5"><a></a>    plt.plot(epochs, history[<span class="st">"accuracy"</span>], label<span class="op">=</span><span class="st">"Train"</span>)</span>
<span id="cb52-6"><a></a>    plt.plot(epochs, history[<span class="st">"val_accuracy"</span>], label<span class="op">=</span><span class="st">"Val"</span>)</span>
<span id="cb52-7"><a></a>    plt.legend(loc<span class="op">=</span><span class="st">"lower right"</span>)</span>
<span id="cb52-8"><a></a>    plt.title(<span class="st">"Accuracy"</span>)</span>
<span id="cb52-9"><a></a></span>
<span id="cb52-10"><a></a>    plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb52-11"><a></a>    plt.plot(epochs, history[<span class="st">"loss"</span>], label<span class="op">=</span><span class="st">"Train"</span>)</span>
<span id="cb52-12"><a></a>    plt.plot(epochs, history[<span class="st">"val_loss"</span>], label<span class="op">=</span><span class="st">"Val"</span>)</span>
<span id="cb52-13"><a></a>    plt.legend(loc<span class="op">=</span><span class="st">"upper right"</span>)</span>
<span id="cb52-14"><a></a>    plt.title(<span class="st">"Loss"</span>)</span>
<span id="cb52-15"><a></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="0a40a717" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a></a>plot_history(history)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="computer-vision_files/figure-revealjs/cell-44-output-1.png" width="1537" height="764"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="look-at-the-metrics" class="slide level2">
<h2>Look at the metrics</h2>
<div id="94a47ec0" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a></a><span class="bu">print</span>(model.evaluate(X_train, y_train, verbose<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb54-2"><a></a><span class="bu">print</span>(model.evaluate(X_val, y_val, verbose<span class="op">=</span><span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1.7625384330749512, 0.6106194853782654, 0.8532060384750366]
[2.2966883182525635, 0.5490530729293823, 0.8084445595741272]</code></pre>
</div>
</div>
<div id="ec0c6a63" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a></a>loss_value, accuracy, top5_accuracy <span class="op">=</span> model.evaluate(X_test, y_test, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb56-2"><a></a><span class="bu">print</span>(<span class="ss">f"Validation Loss: </span><span class="sc">{</span>loss_value<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb56-3"><a></a><span class="bu">print</span>(<span class="ss">f"Validation Accuracy: </span><span class="sc">{</span>accuracy<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb56-4"><a></a><span class="bu">print</span>(<span class="ss">f"Validation Top 5 Accuracy: </span><span class="sc">{</span>top5_accuracy<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Validation Loss: 3.4015
Validation Accuracy: 0.4771
Validation Top 5 Accuracy: 0.7898</code></pre>
</div>
</div>
</section></section>
<section>
<section id="fitting-a-cnn" class="title-slide slide level1 agenda-slide center" data-visibility="uncounted">
<h1>Fitting a CNN</h1>
<div class="agenda-heading">
<p>Lecture Outline</p>
</div>
<div class="agenda">
<ul>
<li><div class="agenda-inactive agenda-pre-active">
<p>Images</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Convolutional Layers</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Convolutional Layer Options</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Convolutional Neural Networks</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Chinese Character Recognition Dataset</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Fitting a (multinomial) logistic regression</p>
</div></li>
<li><div class="agenda-active">
<p>Fitting a CNN</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Error Analysis</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Hyperparameter tuning</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Benchmark Problems</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Transfer Learning</p>
</div></li>
</ul>
</div>
</section>
<section id="make-a-cnn" class="slide level2">
<h2>Make a CNN</h2>
<div id="cf3c6c0b" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a></a><span class="im">from</span> keras.layers <span class="im">import</span> Conv2D, MaxPooling2D</span>
<span id="cb58-2"><a></a></span>
<span id="cb58-3"><a></a>random.seed(<span class="dv">123</span>)</span>
<span id="cb58-4"><a></a></span>
<span id="cb58-5"><a></a>model <span class="op">=</span> Sequential([</span>
<span id="cb58-6"><a></a>  Input((img_height, img_width, <span class="dv">1</span>)),</span>
<span id="cb58-7"><a></a>  Rescaling(<span class="fl">1.</span><span class="op">/</span><span class="dv">255</span>),</span>
<span id="cb58-8"><a></a>  Conv2D(<span class="dv">16</span>, <span class="dv">3</span>, padding<span class="op">=</span><span class="st">"same"</span>, activation<span class="op">=</span><span class="st">"relu"</span>, name<span class="op">=</span><span class="st">"conv1"</span>),</span>
<span id="cb58-9"><a></a>  MaxPooling2D(name<span class="op">=</span><span class="st">"pool1"</span>),</span>
<span id="cb58-10"><a></a>  Conv2D(<span class="dv">32</span>, <span class="dv">3</span>, padding<span class="op">=</span><span class="st">"same"</span>, activation<span class="op">=</span><span class="st">"relu"</span>, name<span class="op">=</span><span class="st">"conv2"</span>),</span>
<span id="cb58-11"><a></a>  MaxPooling2D(name<span class="op">=</span><span class="st">"pool2"</span>),</span>
<span id="cb58-12"><a></a>  Conv2D(<span class="dv">64</span>, <span class="dv">3</span>, padding<span class="op">=</span><span class="st">"same"</span>, activation<span class="op">=</span><span class="st">"relu"</span>, name<span class="op">=</span><span class="st">"conv3"</span>),</span>
<span id="cb58-13"><a></a>  MaxPooling2D(name<span class="op">=</span><span class="st">"pool3"</span>, pool_size<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>)),</span>
<span id="cb58-14"><a></a>  Flatten(), Dense(<span class="dv">64</span>, activation<span class="op">=</span><span class="st">"relu"</span>), Dense(num_classes)</span>
<span id="cb58-15"><a></a>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">
<p>Architecture inspired by <a href="https://www.tensorflow.org/tutorials/images/classification">https://www.tensorflow.org/tutorials/images/classification</a>.</p>
</div>
</section>
<section id="inspect-the-model" class="slide level2">
<h2>Inspect the model</h2>
<div id="96aa850c" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a></a>model.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Model: "sequential_1"</span>
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> Layer (type)                    </span>┃<span style="font-weight: bold"> Output Shape           </span>┃<span style="font-weight: bold">       Param # </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ rescaling_1 (<span style="color: #0087ff; text-decoration-color: #0087ff">Rescaling</span>)         │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">80</span>, <span style="color: #00af00; text-decoration-color: #00af00">60</span>, <span style="color: #00af00; text-decoration-color: #00af00">1</span>)      │             <span style="color: #00af00; text-decoration-color: #00af00">0</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ conv1 (<span style="color: #0087ff; text-decoration-color: #0087ff">Conv2D</span>)                  │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">80</span>, <span style="color: #00af00; text-decoration-color: #00af00">60</span>, <span style="color: #00af00; text-decoration-color: #00af00">16</span>)     │           <span style="color: #00af00; text-decoration-color: #00af00">160</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ pool1 (<span style="color: #0087ff; text-decoration-color: #0087ff">MaxPooling2D</span>)            │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">40</span>, <span style="color: #00af00; text-decoration-color: #00af00">30</span>, <span style="color: #00af00; text-decoration-color: #00af00">16</span>)     │             <span style="color: #00af00; text-decoration-color: #00af00">0</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ conv2 (<span style="color: #0087ff; text-decoration-color: #0087ff">Conv2D</span>)                  │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">40</span>, <span style="color: #00af00; text-decoration-color: #00af00">30</span>, <span style="color: #00af00; text-decoration-color: #00af00">32</span>)     │         <span style="color: #00af00; text-decoration-color: #00af00">4,640</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ pool2 (<span style="color: #0087ff; text-decoration-color: #0087ff">MaxPooling2D</span>)            │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">20</span>, <span style="color: #00af00; text-decoration-color: #00af00">15</span>, <span style="color: #00af00; text-decoration-color: #00af00">32</span>)     │             <span style="color: #00af00; text-decoration-color: #00af00">0</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ conv3 (<span style="color: #0087ff; text-decoration-color: #0087ff">Conv2D</span>)                  │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">20</span>, <span style="color: #00af00; text-decoration-color: #00af00">15</span>, <span style="color: #00af00; text-decoration-color: #00af00">64</span>)     │        <span style="color: #00af00; text-decoration-color: #00af00">18,496</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ pool3 (<span style="color: #0087ff; text-decoration-color: #0087ff">MaxPooling2D</span>)            │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">5</span>, <span style="color: #00af00; text-decoration-color: #00af00">3</span>, <span style="color: #00af00; text-decoration-color: #00af00">64</span>)       │             <span style="color: #00af00; text-decoration-color: #00af00">0</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ flatten_1 (<span style="color: #0087ff; text-decoration-color: #0087ff">Flatten</span>)             │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">960</span>)            │             <span style="color: #00af00; text-decoration-color: #00af00">0</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense_1 (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                 │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">64</span>)             │        <span style="color: #00af00; text-decoration-color: #00af00">61,504</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense_2 (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                 │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">55</span>)             │         <span style="color: #00af00; text-decoration-color: #00af00">3,575</span> │
└─────────────────────────────────┴────────────────────────┴───────────────┘
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Total params: </span><span style="color: #00af00; text-decoration-color: #00af00">88,375</span> (345.21 KB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">88,375</span> (345.21 KB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Non-trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">0</span> (0.00 B)
</pre>
</div>
</div>
</section>
<section id="plot-the-cnn" class="slide level2">
<h2>Plot the CNN</h2>
<div id="072a7006" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a></a>plot_model(model, show_shapes<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="computer-vision_files/figure-revealjs/cell-49-output-1.png" class="r-stretch"></section>
<section id="fit-the-cnn" class="slide level2">
<h2>Fit the CNN</h2>
<div id="08fbbca2" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a></a>loss <span class="op">=</span> keras.losses.SparseCategoricalCrossentropy(from_logits<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb61-2"><a></a>topk <span class="op">=</span> keras.metrics.SparseTopKCategoricalAccuracy(k<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb61-3"><a></a>model.compile(optimizer<span class="op">=</span><span class="st">'adam'</span>, loss<span class="op">=</span>loss, metrics<span class="op">=</span>[<span class="st">'accuracy'</span>, topk])</span>
<span id="cb61-4"><a></a></span>
<span id="cb61-5"><a></a>epochs <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb61-6"><a></a>es <span class="op">=</span> EarlyStopping(patience<span class="op">=</span><span class="dv">15</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb61-7"><a></a>    monitor<span class="op">=</span><span class="st">"val_accuracy"</span>, verbose<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb61-8"><a></a></span>
<span id="cb61-9"><a></a><span class="cf">if</span> Path(<span class="st">"cnn.keras"</span>).exists():</span>
<span id="cb61-10"><a></a>    model <span class="op">=</span> keras.models.load_model(<span class="st">"cnn.keras"</span>)</span>
<span id="cb61-11"><a></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">"cnn_history.json"</span>, <span class="st">"r"</span>) <span class="im">as</span> json_file:</span>
<span id="cb61-12"><a></a>        history <span class="op">=</span> json.load(json_file)</span>
<span id="cb61-13"><a></a><span class="cf">else</span>:</span>
<span id="cb61-14"><a></a>    hist <span class="op">=</span> model.fit(X_train, y_train, validation_data<span class="op">=</span>(X_val, y_val),</span>
<span id="cb61-15"><a></a>      epochs<span class="op">=</span>epochs, callbacks<span class="op">=</span>[es], verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb61-16"><a></a>    model.save(<span class="st">"cnn.keras"</span>)</span>
<span id="cb61-17"><a></a>    history <span class="op">=</span> hist.history</span>
<span id="cb61-18"><a></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">"cnn_history.json"</span>, <span class="st">"w"</span>) <span class="im">as</span> json_file:</span>
<span id="cb61-19"><a></a>        json.dump(history, json_file)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Tip</strong></p>
</div>
<div class="callout-content">
<p>Instead of using softmax activation, just added <code>from_logits=True</code> to the loss function; this is more numerically stable.</p>
</div>
</div>
</div>
</section>
<section id="plot-the-lossaccuracy-curves-1" class="slide level2">
<h2>Plot the loss/accuracy curves</h2>
<div id="39e8e09e" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a></a>plot_history(history)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="computer-vision_files/figure-revealjs/cell-52-output-1.png" width="1537" height="764"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="look-at-the-metrics-1" class="slide level2">
<h2>Look at the metrics</h2>
<div id="80adc04b" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a></a><span class="bu">print</span>(model.evaluate(X_train, y_train, verbose<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb63-2"><a></a><span class="bu">print</span>(model.evaluate(X_val, y_val, verbose<span class="op">=</span><span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[0.01601475104689598, 0.9946824908256531, 1.0]
[0.4305052161216736, 0.9318534731864929, 0.9947221279144287]</code></pre>
</div>
</div>
<div id="3e569969" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a></a>loss_value, accuracy, top5_accuracy <span class="op">=</span> model.evaluate(X_test, y_test, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb65-2"><a></a><span class="bu">print</span>(<span class="ss">f"Validation Loss: </span><span class="sc">{</span>loss_value<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb65-3"><a></a><span class="bu">print</span>(<span class="ss">f"Validation Accuracy: </span><span class="sc">{</span>accuracy<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb65-4"><a></a><span class="bu">print</span>(<span class="ss">f"Validation Top 5 Accuracy: </span><span class="sc">{</span>top5_accuracy<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Validation Loss: 0.8504
Validation Accuracy: 0.8860
Validation Top 5 Accuracy: 0.9858</code></pre>
</div>
</div>
</section>
<section id="make-a-prediction" class="slide level2">
<h2>Make a prediction</h2>
<div id="6d622bad" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a></a>model.predict(X_test[<span class="dv">0</span>], verbose<span class="op">=</span><span class="dv">0</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[52], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> <span class="ansi-yellow-bg">model</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">predict</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">X_test</span><span class="ansi-yellow-bg">[</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">0</span><span class="ansi-yellow-bg">]</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">verbose</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">0</span><span class="ansi-yellow-bg">)</span>;

File <span class="ansi-green-fg">~/miniconda3/envs/ai2025/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py:122</span>, in <span class="ansi-cyan-fg">filter_traceback.&lt;locals&gt;.error_handler</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-fg ansi-bold">    119</span>     filtered_tb <span style="color:rgb(98,98,98)">=</span> _process_traceback_frames(e<span style="color:rgb(98,98,98)">.</span>__traceback__)
<span class="ansi-green-fg ansi-bold">    120</span>     <span style="font-style:italic;color:rgb(95,135,135)"># To get the full stack trace, call:</span>
<span class="ansi-green-fg ansi-bold">    121</span>     <span style="font-style:italic;color:rgb(95,135,135)"># `keras.config.disable_traceback_filtering()`</span>
<span class="ansi-green-fg">--&gt; 122</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> e<span style="color:rgb(98,98,98)">.</span>with_traceback(filtered_tb) <span style="font-weight:bold;color:rgb(0,135,0)">from</span><span style="color:rgb(188,188,188)"> </span><span style="font-weight:bold;color:rgb(0,135,0)">None</span>
<span class="ansi-green-fg ansi-bold">    123</span> <span style="font-weight:bold;color:rgb(0,135,0)">finally</span>:
<span class="ansi-green-fg ansi-bold">    124</span>     <span style="font-weight:bold;color:rgb(0,135,0)">del</span> filtered_tb

File <span class="ansi-green-fg">~/miniconda3/envs/ai2025/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py:122</span>, in <span class="ansi-cyan-fg">filter_traceback.&lt;locals&gt;.error_handler</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-fg ansi-bold">    119</span>     filtered_tb <span style="color:rgb(98,98,98)">=</span> _process_traceback_frames(e<span style="color:rgb(98,98,98)">.</span>__traceback__)
<span class="ansi-green-fg ansi-bold">    120</span>     <span style="font-style:italic;color:rgb(95,135,135)"># To get the full stack trace, call:</span>
<span class="ansi-green-fg ansi-bold">    121</span>     <span style="font-style:italic;color:rgb(95,135,135)"># `keras.config.disable_traceback_filtering()`</span>
<span class="ansi-green-fg">--&gt; 122</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> e<span style="color:rgb(98,98,98)">.</span>with_traceback(filtered_tb) <span style="font-weight:bold;color:rgb(0,135,0)">from</span><span style="color:rgb(188,188,188)"> </span><span style="font-weight:bold;color:rgb(0,135,0)">None</span>
<span class="ansi-green-fg ansi-bold">    123</span> <span style="font-weight:bold;color:rgb(0,135,0)">finally</span>:
<span class="ansi-green-fg ansi-bold">    124</span>     <span style="font-weight:bold;color:rgb(0,135,0)">del</span> filtered_tb

<span class="ansi-red-fg">ValueError</span>: Exception encountered when calling MaxPooling2D.call().

<span class="ansi-bold">Negative dimension size caused by subtracting 2 from 1 for '{{node sequential_1_1/pool1_1/MaxPool2d}} = MaxPool[T=DT_FLOAT, data_format="NHWC", explicit_paddings=[], ksize=[1, 2, 2, 1], padding="VALID", strides=[1, 2, 2, 1]](sequential_1_1/conv1_1/Relu)' with input shapes: [32,60,1,16].</span>

Arguments received by MaxPooling2D.call():
  • inputs=tf.Tensor(shape=(32, 60, 1, 16), dtype=float32)</pre>
</div>
</div>
</div>
<div id="eb41a6c0" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a></a>X_val[<span class="dv">0</span>].shape, X_val[<span class="dv">0</span>][np.newaxis, :].shape, X_val[[<span class="dv">0</span>]].shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>((80, 60, 1), (1, 80, 60, 1), (1, 80, 60, 1))</code></pre>
</div>
</div>
<div id="16ce957f" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a></a>model.predict(X_val[[<span class="dv">0</span>]], verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>array([[-27.75, -33.43, -61.25, -45.47, -16.26, -18.03, -38.82,  -8.48,
        -24.19, -41.46, -14.05,  -1.9 , -11.72, -15.72, -55.43, -49.13,
        -20.48, -32.75,  -9.72,  -0.97, -37.01, -54.47, -64.23, -30.72,
        -14.  , -36.27, -24.38, -42.4 , -18.55, -15.39, -25.44, -31.77,
        -40.55, -20.16, -43.67, -46.77, -31.43, -38.17,  -5.83, -19.47,
        -72.93, -60.61, -49.84,  20.21, -24.8 , -19.48,   5.86,  -4.55,
        -37.49,  -9.48, -12.66,  -6.69, -36.01,  -9.77, -11.05]],
      dtype=float32)</code></pre>
</div>
</div>
</section>
<section id="predict-on-the-test-set-ii" class="slide level2">
<h2>Predict on the test set II</h2>
<div id="e67336d2" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a></a>model.predict(X_test[[<span class="dv">0</span>]], verbose<span class="op">=</span><span class="dv">0</span>).argmax()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>0</code></pre>
</div>
</div>
<div id="6d7cdfc7" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a></a>class_names[model.predict(X_test[[<span class="dv">0</span>]], verbose<span class="op">=</span><span class="dv">0</span>).argmax()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<pre><code>'东'</code></pre>
</div>
</div>
<div id="52415ca4" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a></a>plt.imshow(X_test[<span class="dv">0</span>], cmap<span class="op">=</span><span class="st">"gray"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="computer-vision_files/figure-revealjs/cell-60-output-1.png" width="570" height="705"></p>
</figure>
</div>
</div>
</div>
</section></section>
<section>
<section id="error-analysis" class="title-slide slide level1 agenda-slide center">
<h1>Error Analysis</h1>
<div class="agenda-heading">
<p>Lecture Outline</p>
</div>
<div class="agenda">
<ul>
<li><div class="agenda-inactive agenda-pre-active">
<p>Images</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Convolutional Layers</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Convolutional Layer Options</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Convolutional Neural Networks</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Chinese Character Recognition Dataset</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Fitting a (multinomial) logistic regression</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Fitting a CNN</p>
</div></li>
<li><div class="agenda-active">
<p>Error Analysis</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Hyperparameter tuning</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Benchmark Problems</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Transfer Learning</p>
</div></li>
</ul>
</div>
</section>
<section id="take-a-look-at-the-failure-cases" class="slide level2">
<h2>Take a look at the failure cases</h2>
<div id="c51082f5" class="cell" data-execution_count="60">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a></a><span class="kw">def</span> plot_failed_predictions(X, y, class_names, max_errors <span class="op">=</span> <span class="dv">20</span>,</span>
<span id="cb77-2"><a></a>            num_rows <span class="op">=</span> <span class="dv">4</span>, num_cols <span class="op">=</span> <span class="dv">5</span>, title_font<span class="op">=</span>CHINESE_FONT):</span>
<span id="cb77-3"><a></a>    plt.figure(figsize<span class="op">=</span>(num_cols <span class="op">*</span> <span class="dv">2</span>, num_rows <span class="op">*</span> <span class="dv">2</span>))</span>
<span id="cb77-4"><a></a>    errors <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb77-5"><a></a>    y_pred <span class="op">=</span> model.predict(X, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb77-6"><a></a>    y_pred_classes <span class="op">=</span> y_pred.argmax(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb77-7"><a></a>    y_pred_probs <span class="op">=</span> keras.ops.softmax(y_pred).numpy().max(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb77-8"><a></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(y_pred)):</span>
<span id="cb77-9"><a></a>        <span class="cf">if</span> errors <span class="op">&gt;=</span> max_errors:</span>
<span id="cb77-10"><a></a>            <span class="cf">break</span></span>
<span id="cb77-11"><a></a>        <span class="cf">if</span> y_pred_classes[i] <span class="op">!=</span> y[i]:</span>
<span id="cb77-12"><a></a>            plt.subplot(num_rows, num_cols, errors <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb77-13"><a></a>            plt.imshow(X[i], cmap<span class="op">=</span><span class="st">"gray"</span>)</span>
<span id="cb77-14"><a></a>            true_class <span class="op">=</span> class_names[y[i]]</span>
<span id="cb77-15"><a></a>            pred_class <span class="op">=</span> class_names[y_pred_classes[i]]</span>
<span id="cb77-16"><a></a>            conf <span class="op">=</span> y_pred_probs[i]</span>
<span id="cb77-17"><a></a>            msg <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>true_class<span class="sc">}</span><span class="ss"> not </span><span class="sc">{</span>pred_class<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>conf<span class="op">*</span><span class="dv">100</span><span class="sc">:.0f}</span><span class="ss">%)"</span></span>
<span id="cb77-18"><a></a>            plt.title(msg, fontproperties<span class="op">=</span>title_font)</span>
<span id="cb77-19"><a></a>            plt.axis(<span class="st">"off"</span>)</span>
<span id="cb77-20"><a></a>            errors <span class="op">+=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="7f6fc7f5" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a></a>plot_failed_predictions(X_test, y_test, class_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="computer-vision_files/figure-revealjs/cell-62-output-1.png" width="2681" height="2297"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="confidence-of-predictions" class="slide level2">
<h2>Confidence of predictions</h2>
<div id="5ff1e6fc" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a></a>y_log <span class="op">=</span> model.predict(X_test, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb79-2"><a></a>y_pred <span class="op">=</span> keras.ops.convert_to_numpy(keras.activations.softmax(y_log))</span>
<span id="cb79-3"><a></a>y_pred_class <span class="op">=</span> np.argmax(y_pred, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb79-4"><a></a>y_pred_prob <span class="op">=</span> y_pred[np.arange(y_pred.shape[<span class="dv">0</span>]), y_pred_class]</span>
<span id="cb79-5"><a></a></span>
<span id="cb79-6"><a></a>confidence_when_correct <span class="op">=</span> y_pred_prob[y_pred_class <span class="op">==</span> y_test]</span>
<span id="cb79-7"><a></a>confidence_when_wrong <span class="op">=</span> y_pred_prob[y_pred_class <span class="op">!=</span> y_test]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="columns">
<div class="column">
<div id="9d78d6a8" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a></a>plt.hist(confidence_when_correct)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="computer-vision_files/figure-revealjs/cell-64-output-1.png" width="1584" height="690"></p>
</figure>
</div>
</div>
</div>
</div><div class="column">
<div id="7715500a" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a></a>plt.hist(confidence_when_wrong)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="computer-vision_files/figure-revealjs/cell-65-output-1.png" width="1553" height="690"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="another-test-set" class="slide level2">
<h2>Another test set</h2>
<p>55 poorly written Mandarin characters (<span class="math inline">55 \times 7 = 385</span>).</p>

<img data-src="mandarin-practice-notebook3.png" class="r-stretch quarto-figure-center"><p class="caption">Dataset of notes when learning/practising basic characters.</p></section>
<section id="evaluate-on-the-new-test-set" class="slide level2">
<h2>Evaluate on the new test set</h2>
<div id="1e66d4ed" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a></a>pat_ds <span class="op">=</span> image_dataset_from_directory(</span>
<span id="cb82-2"><a></a>    <span class="st">"mandarin"</span>,</span>
<span id="cb82-3"><a></a>    image_size<span class="op">=</span>img_size,</span>
<span id="cb82-4"><a></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb82-5"><a></a>    shuffle<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb82-6"><a></a>    color_mode<span class="op">=</span><span class="st">'grayscale'</span>)</span>
<span id="cb82-7"><a></a></span>
<span id="cb82-8"><a></a>X_pat <span class="op">=</span> np.concatenate(<span class="bu">list</span>(pat_ds.<span class="bu">map</span>(<span class="kw">lambda</span> x, y: x)))</span>
<span id="cb82-9"><a></a>y_pat <span class="op">=</span> np.concatenate(<span class="bu">list</span>(pat_ds.<span class="bu">map</span>(<span class="kw">lambda</span> x, y: y)))</span>
<span id="cb82-10"><a></a></span>
<span id="cb82-11"><a></a><span class="cf">assert</span> pat_ds.class_names <span class="op">==</span> class_names</span>
<span id="cb82-12"><a></a>X_pat.shape, y_pat.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Found 385 files belonging to 55 classes.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="63">
<pre><code>((385, 80, 60, 1), (385,))</code></pre>
</div>
</div>
<div id="c44c43a9" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a></a>pat_metrics <span class="op">=</span> model.evaluate(X_pat, y_pat, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb85-2"><a></a>pat_metrics</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<pre><code>[2.999114513397217, 0.7636363506317139, 0.948051929473877]</code></pre>
</div>
</div>
<div id="75b815d4" class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a></a>correct <span class="op">=</span> model.predict(X_pat, verbose<span class="op">=</span><span class="dv">0</span>).argmax(axis<span class="op">=</span><span class="dv">1</span>) <span class="op">==</span> y_pat</span>
<span id="cb87-2"><a></a>np.sum(<span class="op">~</span>correct)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="65">
<pre><code>91</code></pre>
</div>
</div>
</section>
<section id="errors" class="slide level2">
<h2>Errors</h2>
<div id="c8d7e9e6" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a></a>plot_failed_predictions(X_pat, y_pat, class_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="computer-vision_files/figure-revealjs/cell-69-output-1.png" width="2681" height="2297"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="which-is-worst" class="slide level2">
<h2>Which is worst…</h2>
<div id="bb27fb6a" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a></a>class_accuracies <span class="op">=</span> []</span>
<span id="cb90-2"><a></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_classes):</span>
<span id="cb90-3"><a></a>    class_indices <span class="op">=</span> y_pat <span class="op">==</span> i</span>
<span id="cb90-4"><a></a>    y_pred <span class="op">=</span> model.predict(X_pat[class_indices], verbose<span class="op">=</span><span class="dv">0</span>).argmax(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb90-5"><a></a>    class_correct <span class="op">=</span> y_pred <span class="op">==</span> y_pat[class_indices]</span>
<span id="cb90-6"><a></a>    class_accuracies.append(np.mean(class_correct))</span>
<span id="cb90-7"><a></a></span>
<span id="cb90-8"><a></a>class_accuracies <span class="op">=</span> pd.DataFrame({<span class="st">"Class"</span>: class_names, <span class="st">"Accuracy"</span>: class_accuracies})</span>
<span id="cb90-9"><a></a>class_accuracies.sort_values(<span class="st">"Accuracy"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Class</th>
<th data-quarto-table-cell-role="th">Accuracy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">23</td>
<td>日</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">14</td>
<td>大</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>吠</td>
<td>0.142857</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50</td>
<td>问</td>
<td>0.142857</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>从</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>主</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">36</td>
<td>玉</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">54</td>
<td>鸟</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

<p>55 rows × 2 columns</p>
</div>
</div>
</div>
</section>
<section id="least-ai--legible-characters" class="slide level2">
<h2>Least (AI-) legible characters</h2>
<div id="288beaba" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a></a>fails <span class="op">=</span> class_accuracies[class_accuracies[<span class="st">"Accuracy"</span>] <span class="op">&lt;</span> <span class="fl">0.5</span>]</span>
<span id="cb91-2"><a></a>fails.sort_values(<span class="st">"Accuracy"</span>).plot(kind<span class="op">=</span><span class="st">"bar"</span>, x<span class="op">=</span><span class="st">"Class"</span>)</span>
<span id="cb91-3"><a></a>plt.xticks(fontproperties<span class="op">=</span>CHINESE_FONT, rotation<span class="op">=</span><span class="dv">0</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="computer-vision_files/figure-revealjs/cell-71-output-1.png" width="1537" height="755"></p>
</figure>
</div>
</div>
</div>
</section></section>
<section>
<section id="hyperparameter-tuning" class="title-slide slide level1 agenda-slide center" data-visibility="uncounted">
<h1>Hyperparameter tuning</h1>
<div class="agenda-heading">
<p>Lecture Outline</p>
</div>
<div class="agenda">
<ul>
<li><div class="agenda-inactive agenda-pre-active">
<p>Images</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Convolutional Layers</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Convolutional Layer Options</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Convolutional Neural Networks</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Chinese Character Recognition Dataset</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Fitting a (multinomial) logistic regression</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Fitting a CNN</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Error Analysis</p>
</div></li>
<li><div class="agenda-active">
<p>Hyperparameter tuning</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Benchmark Problems</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Transfer Learning</p>
</div></li>
</ul>
</div>
</section>
<section id="trial-error" class="slide level2">
<h2>Trial &amp; error</h2>
<div class="columns">
<div class="column">
<p><br> <br></p>
<p>Frankly, a lot of this is just ‘enlightened’ trial and error.</p>
</div><div class="column">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="twitter-advice.png"></p>
<figcaption>Or ‘received wisdom’ from experts…</figcaption>
</figure>
</div>
</div></div>
<div class="footer">
<p>Source: <a href="https://twitter.com/tetraduzione/status/1525501171221274627?s=20&amp;t=ulVFesw-f7hCuG9KyaoYbQ">Twitter</a>.</p>
</div>
</section>
<section id="keras-tuner" class="slide level2">
<h2>Keras Tuner</h2>
<div id="7a589db1" class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a></a><span class="op">!</span>pip install keras<span class="op">-</span>tuner</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="7bec8722" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a></a><span class="im">import</span> keras_tuner <span class="im">as</span> kt</span>
<span id="cb93-2"><a></a></span>
<span id="cb93-3"><a></a><span class="kw">def</span> build_model(hp):</span>
<span id="cb93-4"><a></a>    model <span class="op">=</span> Sequential()</span>
<span id="cb93-5"><a></a>    model.add(</span>
<span id="cb93-6"><a></a>        Dense(</span>
<span id="cb93-7"><a></a>            hp.Choice(<span class="st">"neurons"</span>, [<span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">16</span>, <span class="dv">32</span>, <span class="dv">64</span>, <span class="dv">128</span>, <span class="dv">256</span>]),</span>
<span id="cb93-8"><a></a>            activation<span class="op">=</span>hp.Choice(<span class="st">"activation"</span>,</span>
<span id="cb93-9"><a></a>                [<span class="st">"relu"</span>, <span class="st">"leaky_relu"</span>, <span class="st">"tanh"</span>]),</span>
<span id="cb93-10"><a></a>        )</span>
<span id="cb93-11"><a></a>    )</span>
<span id="cb93-12"><a></a>  </span>
<span id="cb93-13"><a></a>    model.add(Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"exponential"</span>))</span>
<span id="cb93-14"><a></a>    </span>
<span id="cb93-15"><a></a>    learning_rate <span class="op">=</span> hp.Float(<span class="st">"lr"</span>,</span>
<span id="cb93-16"><a></a>        min_value<span class="op">=</span><span class="fl">1e-4</span>, max_value<span class="op">=</span><span class="fl">1e-2</span>, sampling<span class="op">=</span><span class="st">"log"</span>)</span>
<span id="cb93-17"><a></a>    opt <span class="op">=</span> keras.optimizers.Adam(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb93-18"><a></a></span>
<span id="cb93-19"><a></a>    model.compile(optimizer<span class="op">=</span>opt, loss<span class="op">=</span><span class="st">"poisson"</span>)</span>
<span id="cb93-20"><a></a>    </span>
<span id="cb93-21"><a></a>    <span class="cf">return</span> model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="do-a-random-search" class="slide level2">
<h2>Do a random search</h2>
<div class="columns">
<div class="column" style="width:60%;">
<div id="23ad18e2" class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a></a>tuner <span class="op">=</span> kt.RandomSearch(</span>
<span id="cb94-2"><a></a>  build_model,</span>
<span id="cb94-3"><a></a>  objective<span class="op">=</span><span class="st">"val_loss"</span>,</span>
<span id="cb94-4"><a></a>  max_trials<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb94-5"><a></a>  directory<span class="op">=</span><span class="st">"random-search"</span>)</span>
<span id="cb94-6"><a></a></span>
<span id="cb94-7"><a></a>es <span class="op">=</span> EarlyStopping(patience<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb94-8"><a></a>  restore_best_weights<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb94-9"><a></a></span>
<span id="cb94-10"><a></a>tuner.search(X_train_sc, y_train,</span>
<span id="cb94-11"><a></a>  epochs<span class="op">=</span><span class="dv">100</span>, callbacks <span class="op">=</span> [es],</span>
<span id="cb94-12"><a></a>  validation_data<span class="op">=</span>(X_val_sc, y_val))</span>
<span id="cb94-13"><a></a></span>
<span id="cb94-14"><a></a>best_model <span class="op">=</span> tuner.get_best_models()[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reloading Tuner from random-search/untitled_project/tuner0.json</code></pre>
</div>
</div>
</div><div class="column" style="width:40%;">
<div id="1982e095" class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a></a>tuner.results_summary(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Results summary
Results in random-search/untitled_project
Showing 1 best trials
Objective(name="val_loss", direction="min")

Trial 02 summary
Hyperparameters:
neurons: 8
activation: tanh
lr: 0.0021043482724264983
Score: 0.3167361915111542</code></pre>
</div>
</div>
</div></div>
</section>
<section id="tune-layers-separately" class="slide level2">
<h2>Tune layers separately</h2>
<div id="8915e16e" class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a></a><span class="kw">def</span> build_model(hp):</span>
<span id="cb98-2"><a></a>    model <span class="op">=</span> Sequential()</span>
<span id="cb98-3"><a></a></span>
<span id="cb98-4"><a></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(hp.Int(<span class="st">"numHiddenLayers"</span>, <span class="dv">1</span>, <span class="dv">3</span>)):</span>
<span id="cb98-5"><a></a>      <span class="co"># Tune number of units in each layer separately.</span></span>
<span id="cb98-6"><a></a>      model.add(</span>
<span id="cb98-7"><a></a>          Dense(</span>
<span id="cb98-8"><a></a>              hp.Choice(<span class="ss">f"neurons_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>, [<span class="dv">8</span>, <span class="dv">16</span>, <span class="dv">32</span>, <span class="dv">64</span>]),</span>
<span id="cb98-9"><a></a>              activation<span class="op">=</span><span class="st">"relu"</span></span>
<span id="cb98-10"><a></a>          )</span>
<span id="cb98-11"><a></a>      )</span>
<span id="cb98-12"><a></a>    model.add(Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"exponential"</span>))</span>
<span id="cb98-13"><a></a></span>
<span id="cb98-14"><a></a>    opt <span class="op">=</span> keras.optimizers.Adam(learning_rate<span class="op">=</span><span class="fl">0.0005</span>)</span>
<span id="cb98-15"><a></a>    model.compile(optimizer<span class="op">=</span>opt, loss<span class="op">=</span><span class="st">"poisson"</span>)</span>
<span id="cb98-16"><a></a>    </span>
<span id="cb98-17"><a></a>    <span class="cf">return</span> model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="do-a-bayesian-search" class="slide level2">
<h2>Do a Bayesian search</h2>
<div class="columns">
<div class="column" style="width:60%;">
<div id="3c992116" class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a></a>tuner <span class="op">=</span> kt.BayesianOptimization(</span>
<span id="cb99-2"><a></a>  build_model,</span>
<span id="cb99-3"><a></a>  objective<span class="op">=</span><span class="st">"val_loss"</span>,</span>
<span id="cb99-4"><a></a>  directory<span class="op">=</span><span class="st">"bayesian-search"</span>,</span>
<span id="cb99-5"><a></a>  max_trials<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb99-6"><a></a></span>
<span id="cb99-7"><a></a>es <span class="op">=</span> EarlyStopping(patience<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb99-8"><a></a>  restore_best_weights<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb99-9"><a></a></span>
<span id="cb99-10"><a></a>tuner.search(X_train_sc, y_train,</span>
<span id="cb99-11"><a></a>  epochs<span class="op">=</span><span class="dv">100</span>, callbacks <span class="op">=</span> [es],</span>
<span id="cb99-12"><a></a>  validation_data<span class="op">=</span>(X_val_sc, y_val))</span>
<span id="cb99-13"><a></a></span>
<span id="cb99-14"><a></a>best_model <span class="op">=</span> tuner.get_best_models()[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reloading Tuner from bayesian-search/untitled_project/tuner0.json</code></pre>
</div>
</div>
</div><div class="column" style="width:40%;">
<div id="e272ab8e" class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a></a>tuner.results_summary(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Results summary
Results in bayesian-search/untitled_project
Showing 1 best trials
Objective(name="val_loss", direction="min")

Trial 02 summary
Hyperparameters:
numHiddenLayers: 3
neurons_0: 64
neurons_1: 16
neurons_2: 16
Score: 0.3142806887626648</code></pre>
</div>
</div>
</div></div>
</section></section>
<section>
<section id="benchmark-problems" class="title-slide slide level1 agenda-slide center" data-visibility="uncounted">
<h1>Benchmark Problems</h1>
<div class="agenda-heading">
<p>Lecture Outline</p>
</div>
<div class="agenda">
<ul>
<li><div class="agenda-inactive agenda-pre-active">
<p>Images</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Convolutional Layers</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Convolutional Layer Options</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Convolutional Neural Networks</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Chinese Character Recognition Dataset</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Fitting a (multinomial) logistic regression</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Fitting a CNN</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Error Analysis</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Hyperparameter tuning</p>
</div></li>
<li><div class="agenda-active">
<p>Benchmark Problems</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Transfer Learning</p>
</div></li>
</ul>
</div>
</section>
<section id="demo-object-classification" class="slide level2">
<h2>Demo: Object classification</h2>
<div class="columns">
<div class="column">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="teach-images.png"></p>
<figcaption>Example object classification run.</figcaption>
</figure>
</div>
</div><div class="column">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="https://info.deeplearning.ai/hs-fs/hubfs/NOCODE.gif?width=1199&amp;upscale=true&amp;name=NOCODE.gif"></p>
<figcaption>Example of object classification.</figcaption>
</figure>
</div>
</div></div>
<div class="footer">
<p>Source: Teachable Machine, <a href="https://teachablemachine.withgoogle.com/">https://teachablemachine.withgoogle.com/</a>.</p>
</div>
</section>
<section id="how-does-that-work" class="slide level2">
<h2>How does that work?</h2>
<blockquote>
<p>… these models use a technique called transfer learning. There’s a pretrained neural network, and when you create your own classes, you can sort of picture that your classes are becoming the last layer or step of the neural net. Specifically, both the image and pose models are learning off of pretrained mobilenet models …</p>
</blockquote>
<p><a href="https://teachablemachine.withgoogle.com/faq#Diving-Deeper">Teachable Machine FAQ</a></p>
</section>
<section id="benchmarks" class="slide level2">
<h2>Benchmarks</h2>
<p><a href="https://www.cs.toronto.edu/~kriz/cifar.html">CIFAR-11 / CIFAR-100 dataset</a> from Canadian Institute for Advanced Research</p>
<ul>
<li>9 classes: 60000 32x32 colour images</li>
<li>99 classes: 60000 32x32 colour images</li>
</ul>
<p><a href="https://www.image-net.org/index.php">ImageNet</a> and the <em>ImageNet Large Scale Visual Recognition Challenge (ILSVRC)</em>; originally <a href="https://image-net.org/challenges/LSVRC/2014/browse-synsets">1,000 synsets</a>.</p>
<ul>
<li>In 2021: 14,197,122 labelled images from 21,841 synsets.</li>
<li>See <a href="https://keras.io/api/applications/">Keras applications</a> for downloadable models.</li>
</ul>
</section>
<section id="lenet-6-1998" class="slide level2 smaller">
<h2>LeNet-6 (1998)</h2>
<table class="caption-top" style="width:100%;">
<colgroup>
<col style="width: 9%">
<col style="width: 23%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 18%">
<col style="width: 11%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th>Layer</th>
<th>Type</th>
<th>Channels</th>
<th>Size</th>
<th>Kernel size</th>
<th>Stride</th>
<th>Activation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>In</td>
<td>Input</td>
<td>0</td>
<td>32×32</td>
<td>–</td>
<td>–</td>
<td>–</td>
</tr>
<tr class="even">
<td>C0</td>
<td>Convolution</td>
<td>6</td>
<td>28×28</td>
<td>5×5</td>
<td>1</td>
<td>tanh</td>
</tr>
<tr class="odd">
<td>S1</td>
<td>Avg pooling</td>
<td>6</td>
<td>14×14</td>
<td>2×2</td>
<td>2</td>
<td>tanh</td>
</tr>
<tr class="even">
<td>C2</td>
<td>Convolution</td>
<td>16</td>
<td>10×10</td>
<td>5×5</td>
<td>1</td>
<td>tanh</td>
</tr>
<tr class="odd">
<td>S3</td>
<td>Avg pooling</td>
<td>16</td>
<td>5×5</td>
<td>2×2</td>
<td>2</td>
<td>tanh</td>
</tr>
<tr class="even">
<td>C4</td>
<td>Convolution</td>
<td>120</td>
<td>1×1</td>
<td>5×5</td>
<td>1</td>
<td>tanh</td>
</tr>
<tr class="odd">
<td>F5</td>
<td>Fully connected</td>
<td>–</td>
<td>84</td>
<td>–</td>
<td>–</td>
<td>tanh</td>
</tr>
<tr class="even">
<td>Out</td>
<td>Fully connected</td>
<td>–</td>
<td>9</td>
<td>–</td>
<td>–</td>
<td>RBF</td>
</tr>
</tbody>
</table>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>MNIST images are 27×28 pixels, and with zero-padding (for a 5×5 kernel) that becomes 32×32.</p>
</div>
</div>
</div>
<div class="footer">
<p>Source: Aurélien Géron (2018), <em>Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</em>, 2nd Edition, Chapter 14.</p>
</div>
</section>
<section id="alexnet-2011" class="slide level2 smaller">
<h2>AlexNet (2011)</h2>
<table class="caption-top">
<colgroup>
<col style="width: 8%">
<col style="width: 19%">
<col style="width: 10%">
<col style="width: 12%">
<col style="width: 15%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th>Layer</th>
<th>Type</th>
<th>Channels</th>
<th>Size</th>
<th>Kernel</th>
<th>Stride</th>
<th>Padding</th>
<th>Activation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>In</td>
<td>Input</td>
<td>2</td>
<td>227×227</td>
<td>–</td>
<td>–</td>
<td>–</td>
<td>–</td>
</tr>
<tr class="even">
<td>C0</td>
<td>Convolution</td>
<td>96</td>
<td>55×55</td>
<td>11×11</td>
<td>4</td>
<td>valid</td>
<td>ReLU</td>
</tr>
<tr class="odd">
<td>S1</td>
<td>Max pool</td>
<td>96</td>
<td>27×27</td>
<td>3×3</td>
<td>2</td>
<td>valid</td>
<td>–</td>
</tr>
<tr class="even">
<td>C2</td>
<td>Convolution</td>
<td>256</td>
<td>27×27</td>
<td>5×5</td>
<td>1</td>
<td>same</td>
<td>ReLU</td>
</tr>
<tr class="odd">
<td>S3</td>
<td>Max pool</td>
<td>256</td>
<td>13×13</td>
<td>3×3</td>
<td>2</td>
<td>valid</td>
<td>–</td>
</tr>
<tr class="even">
<td>C4</td>
<td>Convolution</td>
<td>384</td>
<td>13×13</td>
<td>3×3</td>
<td>1</td>
<td>same</td>
<td>ReLU</td>
</tr>
<tr class="odd">
<td>C5</td>
<td>Convolution</td>
<td>384</td>
<td>13×13</td>
<td>3×3</td>
<td>1</td>
<td>same</td>
<td>ReLU</td>
</tr>
<tr class="even">
<td>C6</td>
<td>Convolution</td>
<td>256</td>
<td>13×13</td>
<td>3×3</td>
<td>1</td>
<td>same</td>
<td>ReLU</td>
</tr>
<tr class="odd">
<td>S7</td>
<td>Max pool</td>
<td>256</td>
<td>6×6</td>
<td>3×3</td>
<td>2</td>
<td>valid</td>
<td>–</td>
</tr>
<tr class="even">
<td>F8</td>
<td>Fully conn.</td>
<td>–</td>
<td>4,096</td>
<td>–</td>
<td>–</td>
<td>–</td>
<td>ReLU</td>
</tr>
<tr class="odd">
<td>F9</td>
<td>Fully conn.</td>
<td>–</td>
<td>4,096</td>
<td>–</td>
<td>–</td>
<td>–</td>
<td>ReLU</td>
</tr>
<tr class="even">
<td>Out</td>
<td>Fully conn.</td>
<td>–</td>
<td>0,000</td>
<td>–</td>
<td>–</td>
<td>–</td>
<td>Softmax</td>
</tr>
</tbody>
</table>
<div class="footer">
<p>Winner of the ILSVRC 2012 challenge (top-five error 17%), developed by Alex Krizhevsky, Ilya Sutskever, and Geoffrey Hinton.</p>
</div>
</section>
<section id="data-augmentation" class="slide level2">
<h2>Data Augmentation</h2>

<img data-src="data-augmentation.png" class="r-stretch quarto-figure-center"><p class="caption">Examples of data augmentation.</p><div class="footer">
<p>Source: Buah et al.&nbsp;(2019), <em>Can Artificial Intelligence Assist Project Developers in Long-Term Management of Energy Projects? The Case of CO2 Capture and Storage</em>.</p>
</div>
</section>
<section id="inception-module-2013" class="slide level2">
<h2>Inception module (2013)</h2>
<p>Used in ILSVRC 2013 winning solution (top-5 error &lt; 7%).</p>
<div class="columns">
<div class="column" style="width:59%;">
<p><img data-src="inception-module-fig-2b.png"></p>
</div><div class="column" style="width:39%;">
<p><br></p>
<p><img data-src="inception-meme.jpeg"></p>
</div></div>
<p>VGGNet was the runner-up.</p>
<div class="footer">
<p>Source: Szegedy, C. et al.&nbsp;(2014), <a href="https://arxiv.org/pdf/1409.4842.pdf"><em>Going deeper with convolutions</em></a>. and <a href="https://knowyourmeme.com/memes/we-need-to-go-deeper">KnowYourMeme.com</a></p>
</div>
</section>
<section id="googlenet-inception_v0-2014" class="slide level2">
<h2>GoogLeNet / Inception_v0 (2014)</h2>

<img data-src="Geron-mls2_1414.png" class="r-stretch quarto-figure-center"><p class="caption">Schematic of the GoogLeNet architecture.</p><div class="footer">
<p>Source: Aurélien Géron (2018), <em>Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</em>, 2nd Edition, Figure 14-14.</p>
</div>
</section>
<section id="depth-is-important-for-image-tasks" class="slide level2">
<h2>Depth is important for image tasks</h2>

<img data-src="goodfellow-depth-matters.png" class="r-stretch quarto-figure-center"><p class="caption">Deeper models aren’t just better because they have more parameters. Model depth given in the legend. Accuracy is on the Street View House Numbers dataset.</p><div class="footer">
<p>Source: Goodfellow et al.&nbsp;(2015), <a href="http://www.deeplearningbook.org">Deep Learning</a>, Figure 6.7.</p>
</div>
</section>
<section id="residual-connection" class="slide level2">
<h2>Residual connection</h2>

<img data-src="Geron-mls2_1415.png" class="r-stretch quarto-figure-center"><p class="caption">Illustration of a residual connection.</p><div class="footer">
<p>Source: Aurélien Géron (2018), <em>Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</em>, 2nd Edition, Figure 14-15.</p>
</div>
</section>
<section id="resnet-2014" class="slide level2">
<h2>ResNet (2014)</h2>
<p>ResNet won the ILSVRC 2014 challenge (top-5 error 3.6%), developed by <a href="https://arxiv.org/abs/1512.03385">Kaiming He et al.</a></p>

<img data-src="Geron-mls2_1417.png" class="r-stretch quarto-figure-center"><p class="caption">Diagram of the ResNet architecture.</p><div class="footer">
<p>Source: Aurélien Géron (2018), <em>Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</em>, 2nd Edition, Figure 14-17.</p>
</div>
</section></section>
<section>
<section id="transfer-learning" class="title-slide slide level1 agenda-slide center" data-visibility="uncounted">
<h1>Transfer Learning</h1>
<div class="agenda-heading">
<p>Lecture Outline</p>
</div>
<div class="agenda">
<ul>
<li><div class="agenda-inactive agenda-pre-active">
<p>Images</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Convolutional Layers</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Convolutional Layer Options</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Convolutional Neural Networks</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Chinese Character Recognition Dataset</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Fitting a (multinomial) logistic regression</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Fitting a CNN</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Error Analysis</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Hyperparameter tuning</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Benchmark Problems</p>
</div></li>
<li><div class="agenda-active">
<p>Transfer Learning</p>
</div></li>
</ul>
</div>
</section>
<section id="pretrained-model" class="slide level2">
<h2>Pretrained model</h2>
<div id="c00faf1c" class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a></a><span class="kw">def</span> classify_imagenet(paths, model_module, ModelClass, dims):</span>
<span id="cb103-2"><a></a>    images <span class="op">=</span> [keras.utils.load_img(path, target_size<span class="op">=</span>dims) <span class="cf">for</span> path <span class="kw">in</span> paths]</span>
<span id="cb103-3"><a></a>    image_array <span class="op">=</span> np.array([keras.utils.img_to_array(img) <span class="cf">for</span> img <span class="kw">in</span> images])</span>
<span id="cb103-4"><a></a>    inputs <span class="op">=</span> model_module.preprocess_input(image_array)</span>
<span id="cb103-5"><a></a></span>
<span id="cb103-6"><a></a>    model <span class="op">=</span> ModelClass(weights<span class="op">=</span><span class="st">"imagenet"</span>)</span>
<span id="cb103-7"><a></a>    Y_proba <span class="op">=</span> model(inputs)</span>
<span id="cb103-8"><a></a>    top_k <span class="op">=</span> model_module.decode_predictions(Y_proba, top<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb103-9"><a></a></span>
<span id="cb103-10"><a></a>    <span class="cf">for</span> image_index <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(images)):</span>
<span id="cb103-11"><a></a>        <span class="bu">print</span>(<span class="ss">f"Image #</span><span class="sc">{</span>image_index<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb103-12"><a></a>        <span class="cf">for</span> class_id, name, y_proba <span class="kw">in</span> top_k[image_index]:</span>
<span id="cb103-13"><a></a>            <span class="bu">print</span>(<span class="ss">f" </span><span class="sc">{</span>class_id<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span><span class="bu">int</span>(y_proba<span class="op">*</span><span class="dv">100</span>)<span class="sc">}</span><span class="ss">%"</span>)</span>
<span id="cb103-14"><a></a>        <span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="predicted-classes-mobilenet" class="slide level2">
<h2>Predicted classes (MobileNet)</h2>
<div class="columns">
<div class="column" style="width:15%;">

</div><div class="column" style="width:50%;">
<p><br><br></p>
<div id="d6657de3" class="cell" data-execution_count="82">
<div class="cell-output cell-output-stdout">
<pre><code>Image #0:
 n04350905 - suit 39%
 n04591157 - Windsor_tie 34%
 n02749479 - assault_rifle 13%

Image #1:
 n03529860 - home_theater 25%
 n02749479 - assault_rifle 9%
 n04009552 - projector 5%

Image #2:
 n03529860 - home_theater 9%
 n03924679 - photocopier 7%
 n02786058 - Band_Aid 6%
</code></pre>
</div>
</div>
</div><div class="column" style="width:20%;">
<p><img src="patrick-0.jpg" data-lazy-loaded="" style="padding: 0px; margin: 0px"> <img src="umbrella-0.jpg" data-lazy-loaded="" style="padding: 0px; margin: 0px"> <img src="hand-15.jpg" data-lazy-loaded="" style="padding: 0px; margin=0px"></p>
</div><div class="column" style="width:15%;">

</div></div>
</section>
<section id="predicted-classes-mobilenetv2" class="slide level2">
<h2>Predicted classes (MobileNetV2)</h2>
<div class="columns">
<div class="column" style="width:15%;">

</div><div class="column" style="width:50%;">
<p><br><br></p>
<div id="8dc44fc6" class="cell" data-execution_count="83">
<div class="cell-output cell-output-stdout">
<pre><code>Image #0:
 n04350905 - suit 34%
 n04591157 - Windsor_tie 8%
 n03630383 - lab_coat 7%

Image #1:
 n04023962 - punching_bag 9%
 n04336792 - stretcher 4%
 n03529860 - home_theater 4%

Image #2:
 n04404412 - television 42%
 n02977058 - cash_machine 6%
 n04152593 - screen 3%
</code></pre>
</div>
</div>
</div><div class="column" style="width:20%;">
<p><img src="patrick-0.jpg" data-lazy-loaded="" style="padding: 0px; margin: 0px"> <img src="umbrella-0.jpg" data-lazy-loaded="" style="padding: 0px; margin: 0px"> <img src="hand-15.jpg" data-lazy-loaded="" style="padding: 0px; margin=0px"></p>
</div><div class="column" style="width:15%;">

</div></div>
</section>
<section id="predicted-classes-inceptionv3" class="slide level2">
<h2>Predicted classes (InceptionV3)</h2>
<div class="columns">
<div class="column" style="width:15%;">

</div><div class="column" style="width:50%;">
<p><br><br></p>
<div id="40673e50" class="cell" data-execution_count="84">
<div class="cell-output cell-output-stdout">
<pre><code>Image #0:
 n04350905 - suit 25%
 n04591157 - Windsor_tie 10%
 n03630383 - lab_coat 6%

Image #1:
 n04507155 - umbrella 52%
 n04404412 - television 2%
 n03529860 - home_theater 2%

Image #2:
 n04404412 - television 17%
 n02777292 - balance_beam 7%
 n03942813 - ping-pong_ball 6%
</code></pre>
</div>
</div>
</div><div class="column" style="width:20%;">
<p><img src="patrick-0.jpg" data-lazy-loaded="" style="padding: 0px; margin: 0px"> <img src="umbrella-0.jpg" data-lazy-loaded="" style="padding: 0px; margin: 0px"> <img src="hand-15.jpg" data-lazy-loaded="" style="padding: 0px; margin=0px"></p>
</div><div class="column" style="width:15%;">

</div></div>
</section>
<section id="predicted-classes-mobilenet-1" class="slide level2">
<h2>Predicted classes (MobileNet)</h2>
<div class="columns">
<div class="column" style="width:15%;">

</div><div class="column" style="width:50%;">
<p><br><br></p>
<div id="69b889fa" class="cell" data-execution_count="85">
<div class="cell-output cell-output-stdout">
<pre><code>Image #0:
 n03483316 - hand_blower 21%
 n03271574 - electric_fan 8%
 n07579787 - plate 4%

Image #1:
 n03942813 - ping-pong_ball 88%
 n02782093 - balloon 3%
 n04023962 - punching_bag 1%

Image #2:
 n04557648 - water_bottle 31%
 n04336792 - stretcher 13%
 n03868863 - oxygen_mask 7%
</code></pre>
</div>
</div>
</div><div class="column" style="width:20%;">
<p><img src="charger-4.jpg" data-lazy-loaded="" style="padding: 0px; margin: 0px"> <img src="table-tennis-17.jpg" data-lazy-loaded="" style="padding: 0px; margin: 0px"> <img src="water-bottle-15.jpg" data-lazy-loaded="" style="padding: 0px; margin=0px"></p>
</div><div class="column" style="width:15%;">

</div></div>
</section>
<section id="predicted-classes-mobilenetv2-1" class="slide level2">
<h2>Predicted classes (MobileNetV2)</h2>
<div class="columns">
<div class="column" style="width:15%;">

</div><div class="column" style="width:50%;">
<p><br><br></p>
<div id="379bd157" class="cell" data-execution_count="86">
<div class="cell-output cell-output-stdout">
<pre><code>Image #0:
 n03868863 - oxygen_mask 36%
 n03483316 - hand_blower 7%
 n03271574 - electric_fan 7%

Image #1:
 n03942813 - ping-pong_ball 29%
 n04270147 - spatula 12%
 n03970156 - plunger 8%

Image #2:
 n02815834 - beaker 40%
 n03868863 - oxygen_mask 16%
 n04557648 - water_bottle 4%
</code></pre>
</div>
</div>
</div><div class="column" style="width:20%;">
<p><img src="charger-4.jpg" data-lazy-loaded="" style="padding: 0px; margin: 0px"> <img src="table-tennis-17.jpg" data-lazy-loaded="" style="padding: 0px; margin: 0px"> <img src="water-bottle-15.jpg" data-lazy-loaded="" style="padding: 0px; margin=0px"></p>
</div><div class="column" style="width:15%;">

</div></div>
</section>
<section id="predicted-classes-inceptionv3-1" class="slide level2">
<h2>Predicted classes (InceptionV3)</h2>
<div class="columns">
<div class="column" style="width:15%;">

</div><div class="column" style="width:50%;">
<p><br><br></p>
<div id="8d8d2853" class="cell" data-execution_count="87">
<div class="cell-output cell-output-stdout">
<pre><code>Image #0:
 n02815834 - beaker 19%
 n03179701 - desk 15%
 n03868863 - oxygen_mask 9%

Image #1:
 n03942813 - ping-pong_ball 87%
 n02782093 - balloon 8%
 n02790996 - barbell 0%

Image #2:
 n04557648 - water_bottle 56%
 n03983396 - pop_bottle 9%
 n03868863 - oxygen_mask 7%
</code></pre>
</div>
</div>
</div><div class="column" style="width:20%;">
<p><img src="charger-4.jpg" data-lazy-loaded="" style="padding: 0px; margin: 0px"> <img src="table-tennis-17.jpg" data-lazy-loaded="" style="padding: 0px; margin: 0px"> <img src="water-bottle-15.jpg" data-lazy-loaded="" style="padding: 0px; margin=0px"></p>
</div><div class="column" style="width:15%;">

</div></div>
</section>
<section id="transfer-learned-model" class="slide level2">
<h2>Transfer learned model</h2>
<div id="a01d0d06" class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a></a><span class="im">import</span> tf_keras <span class="im">as</span> keras</span>
<span id="cb110-2"><a></a>model_file <span class="op">=</span> <span class="st">"teachable-machines/2024/3143/converted_keras/keras_model.h5"</span></span>
<span id="cb110-3"><a></a>model <span class="op">=</span> keras.models.load_model(model_file)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="50b382a4" class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a></a>model.layers[<span class="dv">0</span>].layers[<span class="dv">0</span>].layers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="87">
<pre><code>[&lt;tf_keras.src.engine.input_layer.InputLayer at 0x7ed139fd3090&gt;,
 &lt;tf_keras.src.layers.reshaping.zero_padding2d.ZeroPadding2D at 0x7ed139fd36d0&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed139effa90&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed139071ed0&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed13a3a8bd0&gt;,
 &lt;tf_keras.src.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x7ed139f7e750&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed13a357890&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed139f7ec10&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed139d49290&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed139e8ffd0&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed13a3aa110&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed13a2f4590&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed13a2f4510&gt;,
 &lt;tf_keras.src.layers.reshaping.zero_padding2d.ZeroPadding2D at 0x7ed13a2f7410&gt;,
 &lt;tf_keras.src.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x7ed13a2f7cd0&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed13a3a7c10&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed13a3a5990&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed13a3a77d0&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed13a3a6710&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed13a3a5690&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed13a3a7150&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed13a3a5110&gt;,
 &lt;tf_keras.src.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x7ed13a3a7d90&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed13a3a4390&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed13a3a7a50&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed139f9cc90&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed139f9f4d0&gt;,
 &lt;tf_keras.src.layers.merging.add.Add at 0x7ed139f9d550&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed139f9d390&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed139ebe410&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed139d0a190&gt;,
 &lt;tf_keras.src.layers.reshaping.zero_padding2d.ZeroPadding2D at 0x7ed13a3b0d90&gt;,
 &lt;tf_keras.src.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x7ed13a3b0290&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed13a3b0910&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed13a3b3a50&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed13a3b2c50&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed13a3b0e90&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed13a3b1990&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed13a44d3d0&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed139fbac10&gt;,
 &lt;tf_keras.src.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x7ed139fbafd0&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed139fba210&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed139fbbcd0&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed139fbbf10&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed13a3557d0&gt;,
 &lt;tf_keras.src.layers.merging.add.Add at 0x7ed139d49850&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed139d810d0&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed139d83150&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed139d805d0&gt;,
 &lt;tf_keras.src.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x7ed139d83ad0&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed139d83c50&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed139d839d0&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed139fab810&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed139fabe10&gt;,
 &lt;tf_keras.src.layers.merging.add.Add at 0x7ed139fa9e90&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed139fab650&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed139fa9d50&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed139fa8690&gt;,
 &lt;tf_keras.src.layers.reshaping.zero_padding2d.ZeroPadding2D at 0x7ed139d2c7d0&gt;,
 &lt;tf_keras.src.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x7ed139d2f510&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed139f8bf10&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed139f88410&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed139f89d50&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed139f88fd0&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed139ec8c50&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed13a2fde10&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed13a2fca90&gt;,
 &lt;tf_keras.src.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x7ed13a2fdd10&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed139ff9f10&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed139ff8c50&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed13b21e650&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed13b21f550&gt;,
 &lt;tf_keras.src.layers.merging.add.Add at 0x7ed13b21c890&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed13b21efd0&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed13b21da90&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed13b21d150&gt;,
 &lt;tf_keras.src.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x7ed13b21fd90&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed12fc2be50&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed12fc2b9d0&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed12fc28150&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed12fc29750&gt;,
 &lt;tf_keras.src.layers.merging.add.Add at 0x7ed12fc2a4d0&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed13a482090&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed13a482e90&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed13a482a10&gt;,
 &lt;tf_keras.src.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x7ed13a480950&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed13a4808d0&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed13a482d90&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed13a481cd0&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed139f70990&gt;,
 &lt;tf_keras.src.layers.merging.add.Add at 0x7ed139f73010&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed139f73d10&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed139f70310&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed139f71650&gt;,
 &lt;tf_keras.src.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x7ed139f72350&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed139d21990&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed139d22390&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed139f21c90&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed139f22110&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed139fd2bd0&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed13a34f090&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed13a34e3d0&gt;,
 &lt;tf_keras.src.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x7ed13a34cc10&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed139f30bd0&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed139f30290&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed139f30c10&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed139f32790&gt;,
 &lt;tf_keras.src.layers.merging.add.Add at 0x7ed139f30d90&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed13a304a50&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed13a307990&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed13a3048d0&gt;,
 &lt;tf_keras.src.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x7ed13a304e50&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed13a307210&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed13a307610&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed139fa5f90&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed139fa5bd0&gt;,
 &lt;tf_keras.src.layers.merging.add.Add at 0x7ed139fa7390&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed13a320d50&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed13a320e90&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed13a323a50&gt;,
 &lt;tf_keras.src.layers.reshaping.zero_padding2d.ZeroPadding2D at 0x7ed13a320190&gt;,
 &lt;tf_keras.src.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x7ed13a329310&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed13a32b7d0&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed13a32a8d0&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed13a32b410&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed13a32bed0&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed13a32a6d0&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed13a34a510&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed13a348250&gt;,
 &lt;tf_keras.src.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x7ed13a34ae90&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed13a349c90&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed13a34b310&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed139d24d50&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed139f57bd0&gt;,
 &lt;tf_keras.src.layers.merging.add.Add at 0x7ed139f563d0&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed139f56690&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed139f54f10&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed139f56fd0&gt;,
 &lt;tf_keras.src.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x7ed12fdcb650&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed12fdca510&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed12fdc9950&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed12fdca150&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed12fdc9650&gt;,
 &lt;tf_keras.src.layers.merging.add.Add at 0x7ed12fdc8c90&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed12fdcab90&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed12fdec190&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed12fded910&gt;,
 &lt;tf_keras.src.layers.convolutional.depthwise_conv2d.DepthwiseConv2D at 0x7ed12fdeed50&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed12fdeeb90&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed12fdef910&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed12fded190&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed139f24750&gt;,
 &lt;tf_keras.src.layers.convolutional.conv2d.Conv2D at 0x7ed13a344190&gt;,
 &lt;tf_keras.src.layers.normalization.batch_normalization.BatchNormalization at 0x7ed13a3473d0&gt;,
 &lt;tf_keras.src.layers.activation.relu.ReLU at 0x7ed13a347550&gt;]</code></pre>
</div>
</div>
<div id="f14bf456" class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a></a><span class="bu">len</span>(model.layers[<span class="dv">0</span>].layers[<span class="dv">0</span>].layers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="88">
<pre><code>155</code></pre>
</div>
</div>
</section>
<section id="the-original-pretrained-model" class="slide level2">
<h2>The original pretrained model</h2>
<div style="overflow:auto; height: 90%">
<p><img src="mobilenet-model.png"></p>
</div>
</section>
<section id="transfer-learning-1" class="slide level2">
<h2>Transfer learning</h2>
<div class="sourceCode" id="cb115"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a></a><span class="co"># Pull in the base model we are transferring from.</span></span>
<span id="cb115-2"><a></a>base_model <span class="op">=</span> keras.applications.Xception(</span>
<span id="cb115-3"><a></a>    weights<span class="op">=</span><span class="st">"imagenet"</span>,  <span class="co"># Load weights pre-trained on ImageNet.</span></span>
<span id="cb115-4"><a></a>    input_shape<span class="op">=</span>(<span class="dv">149</span>, <span class="dv">150</span>, <span class="dv">3</span>),</span>
<span id="cb115-5"><a></a>    include_top<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb115-6"><a></a>)  <span class="co"># Discard the ImageNet classifier at the top.</span></span>
<span id="cb115-7"><a></a></span>
<span id="cb115-8"><a></a><span class="co"># Tell it not to update its weights.</span></span>
<span id="cb115-9"><a></a>base_model.trainable <span class="op">=</span> <span class="va">False</span></span>
<span id="cb115-10"><a></a></span>
<span id="cb115-11"><a></a><span class="co"># Make our new model on top of the base model.</span></span>
<span id="cb115-12"><a></a>inputs <span class="op">=</span> keras.Input(shape<span class="op">=</span>(<span class="dv">149</span>, <span class="dv">150</span>, <span class="dv">3</span>))</span>
<span id="cb115-13"><a></a>x <span class="op">=</span> base_model(inputs, training<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb115-14"><a></a>x <span class="op">=</span> keras.layers.GlobalAveragePooling1D()(x)</span>
<span id="cb115-15"><a></a>outputs <span class="op">=</span> keras.layers.Dense(<span class="dv">0</span>)(x)</span>
<span id="cb115-16"><a></a>model <span class="op">=</span> keras.Model(inputs, outputs)</span>
<span id="cb115-17"><a></a></span>
<span id="cb115-18"><a></a><span class="co"># Compile and fit on our data.</span></span>
<span id="cb115-19"><a></a>model.compile(</span>
<span id="cb115-20"><a></a>    optimizer<span class="op">=</span>keras.optimizers.Adam(),</span>
<span id="cb115-21"><a></a>    loss<span class="op">=</span>keras.losses.BinaryCrossentropy(from_logits<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb115-22"><a></a>    metrics<span class="op">=</span>[keras.metrics.BinaryAccuracy()],</span>
<span id="cb115-23"><a></a>)</span>
<span id="cb115-24"><a></a>model.fit(new_dataset, epochs<span class="op">=</span><span class="dv">19</span>, callbacks<span class="op">=</span>..., validation_data<span class="op">=</span>...)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="footer">
<p>Source: François Chollet (2019), <a href="https://keras.io/guides/transfer_learning/">Transfer learning &amp; fine-tuning</a>, Keras documentation.</p>
</div>
</section>
<section id="fine-tuning" class="slide level2">
<h2>Fine-tuning</h2>
<div class="sourceCode" id="cb116"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a></a><span class="co"># Unfreeze the base model</span></span>
<span id="cb116-2"><a></a>base_model.trainable <span class="op">=</span> <span class="va">True</span></span>
<span id="cb116-3"><a></a></span>
<span id="cb116-4"><a></a><span class="co"># It's important to recompile your model after you make any changes</span></span>
<span id="cb116-5"><a></a><span class="co"># to the `trainable` attribute of any inner layer, so that your changes</span></span>
<span id="cb116-6"><a></a><span class="co"># are take into account</span></span>
<span id="cb116-7"><a></a>model.compile(</span>
<span id="cb116-8"><a></a>    optimizer<span class="op">=</span>keras.optimizers.Adam(<span class="fl">0e-5</span>),  <span class="co"># Very low learning rate</span></span>
<span id="cb116-9"><a></a>    loss<span class="op">=</span>keras.losses.BinaryCrossentropy(from_logits<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb116-10"><a></a>    metrics<span class="op">=</span>[keras.metrics.BinaryAccuracy()],</span>
<span id="cb116-11"><a></a>)</span>
<span id="cb116-12"><a></a></span>
<span id="cb116-13"><a></a><span class="co"># Train end-to-end. Be careful to stop before you overfit!</span></span>
<span id="cb116-14"><a></a>model.fit(new_dataset, epochs<span class="op">=</span><span class="dv">9</span>, callbacks<span class="op">=</span>..., validation_data<span class="op">=</span>...)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-caution callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Caution</strong></p>
</div>
<div class="callout-content">
<p>Keep the learning rate low, otherwise you may accidentally throw away the useful information in the base model.</p>
</div>
</div>
</div>
<div class="footer">
<p>Source: François Chollet (2019), <a href="https://keras.io/guides/transfer_learning/">Transfer learning &amp; fine-tuning</a>, Keras documentation.</p>
</div>
</section>
<section id="package-versions" class="slide level2 appendix" data-visibility="uncounted">
<h2>Package Versions</h2>
<div id="af55cdd0" class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a></a><span class="im">from</span> watermark <span class="im">import</span> watermark</span>
<span id="cb117-2"><a></a><span class="bu">print</span>(watermark(python<span class="op">=</span><span class="va">True</span>, packages<span class="op">=</span><span class="st">"keras,matplotlib,numpy,pandas,seaborn,scipy,torch,tensorflow,tf_keras"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Python implementation: CPython
Python version       : 3.11.11
IPython version      : 8.32.0

keras     : 3.8.0
matplotlib: 3.10.0
numpy     : 1.26.4
pandas    : 2.2.3
seaborn   : 0.13.2
scipy     : 1.13.1
torch     : 2.5.1+cu124
tensorflow: 2.18.0
tf_keras  : 2.18.0
</code></pre>
</div>
</div>
</section>
<section id="glossary" class="slide level2 appendix" data-visibility="uncounted">
<h2>Glossary</h2>
<div class="columns">
<div class="column">
<ul>
<li>AlexNet</li>
<li>benchmark problems</li>
<li>channels</li>
<li>CIFAR-10 / CIFAR-100</li>
<li>computer vision</li>
<li>convolutional layer</li>
<li>convolutional network</li>
<li>error analysis</li>
<li>filter</li>
<li>GoogLeNet &amp; Inception</li>
</ul>
</div><div class="column">
<ul>
<li>ImageNet challenge</li>
<li>fine-tuning</li>
<li>flatten layer</li>
<li>kernel</li>
<li>max pooling</li>
<li>MNIST</li>
<li>stride</li>
<li>tensor (rank)</li>
<li>transfer learning</li>
</ul>
</div></div>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="../unsw-logo.png" class="slide-logo"></p>
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': false,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true,"boardmarkerWidth":4,"grid":false,"background":["rgba(255,255,255,0.0)","https://github.com/rajgoel/reveal.js-plugins/raw/master/chalkboard/img/blackboard.png"]},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: true,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: true,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: false,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1000,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
            // Handle positioning of the toggle
        window.addEventListener(
          "resize",
          throttle(() => {
            elRect = undefined;
            if (selectedAnnoteEl) {
              selectCodeLines(selectedAnnoteEl);
            }
          }, 10)
        );
        function throttle(fn, ms) {
        let throttle = false;
        let timer;
          return (...args) => {
            if(!throttle) { // first call gets through
                fn.apply(this, args);
                throttle = true;
            } else { // all the others get throttled
                if(timer) clearTimeout(timer); // cancel #2
                timer = setTimeout(() => {
                  fn.apply(this, args);
                  timer = throttle = false;
                }, ms);
            }
          };
        }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>